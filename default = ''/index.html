<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 5.4.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"zhiyuanshi1901.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.12.2","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="Zhiyuan Shi">
<meta property="og:url" content="https://zhiyuanshi1901.github.io/default%20=%20''/index.html">
<meta property="og:site_name" content="Zhiyuan Shi">
<meta property="og:locale" content="en_US">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://zhiyuanshi1901.github.io/default%20=%20''/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"default = ''/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Zhiyuan Shi</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Zhiyuan Shi</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">14</span></a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">28</span></a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name"></p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">54</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">28</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/ZhiyuanShi1901" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ZhiyuanShi1901" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:dshi78066@gmail.com" title="Personal E-Mail → mailto:dshi78066@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>Personal E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:1901030201@s.upc.edu.cn" title="Work E-Mail → mailto:1901030201@s.upc.edu.cn" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>Work E-Mail</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhiyuanshi1901.github.io/2023/04/23/%E5%90%84%E7%A7%8D%E7%89%A9%E7%90%86%E5%AD%A6%E5%90%8D%E8%AF%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/04/23/%E5%90%84%E7%A7%8D%E7%89%A9%E7%90%86%E5%AD%A6%E5%90%8D%E8%AF%8D/" class="post-title-link" itemprop="url">各种物理学名词</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2023-04-23 19:26:18 / Modified: 19:35:13" itemprop="dateCreated datePublished" datetime="2023-04-23T19:26:18+08:00">2023-04-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%89%A9%E7%90%86%E5%AD%A6/" itemprop="url" rel="index"><span itemprop="name">物理学</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="这里收录一些之前没见过或很少见的物理学名词。这些名词一般在wiki中容易找到解释。"><a href="#这里收录一些之前没见过或很少见的物理学名词。这些名词一般在wiki中容易找到解释。" class="headerlink" title="这里收录一些之前没见过或很少见的物理学名词。这些名词一般在wiki中容易找到解释。"></a>这里收录一些之前没见过或很少见的物理学名词。这些名词一般在wiki中容易找到解释。</h1><h1 id="Brunt-Vaisala-frequency"><a href="#Brunt-Vaisala-frequency" class="headerlink" title="Brunt-Vaisala frequency"></a>Brunt-Vaisala frequency</h1><p>在大气动力学、海洋学、星震学和地球物理学中，Brunt-Väisälä 频率或浮力频率是衡量流体对垂直位移（例如由对流引起的位移）的稳定性的量度。<br>更准确地说，它是垂直位移的包裹在静态稳定环境中振荡的频率。它以David Brunt和Vilho Väisälä的名字命名。它可以用作大气层结的量度。</p>
<p>来源：<br><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Brunt%E2%80%93V%C3%A4is%C3%A4l%C3%A4_frequency">https://en.wikipedia.org/wiki/Brunt%E2%80%93V%C3%A4is%C3%A4l%C3%A4_frequency</a></p>
<h1 id="adam-williamson-condition"><a href="#adam-williamson-condition" class="headerlink" title="adam-williamson condition"></a>adam-williamson condition</h1><p>亚当–威廉姆森方程</p>
<p>亚当–威廉姆斯方程是指一个用来确定密度的方程。该方程常用于确定地震波的速度与地球内部密度之间的关系。<br>通过岩石的平均密度和P波、S波的速度的函数分布，它可以预测地球密度随深度的关系。<br>该方程的模型假定地球是对称的、均匀的球形，并且处于流体静力的平衡中。该方程实际上也可以应用于具有该性质的球壳。它被认为是是重要地球内部模型之一，例如初步地球参考模型。</p>
<p>来源：<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E4%BA%9A%E5%BD%93%E2%80%93%E5%A8%81%E5%BB%89%E5%A7%86%E6%A3%AE%E6%96%B9%E7%A8%8B">https://zh.wikipedia.org/wiki/%E4%BA%9A%E5%BD%93%E2%80%93%E5%A8%81%E5%BB%89%E5%A7%86%E6%A3%AE%E6%96%B9%E7%A8%8B</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhiyuanshi1901.github.io/2023/03/12/%E5%9C%B0%E7%90%83%E7%89%A9%E7%90%86%E5%8F%8D%E6%BC%94%E4%BD%9C%E4%B8%9A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/12/%E5%9C%B0%E7%90%83%E7%89%A9%E7%90%86%E5%8F%8D%E6%BC%94%E4%BD%9C%E4%B8%9A/" class="post-title-link" itemprop="url">地球物理反演作业</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2023-03-12 14:59:35 / Modified: 15:04:21" itemprop="dateCreated datePublished" datetime="2023-03-12T14:59:35+08:00">2023-03-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E4%BD%9C%E4%B8%9A%E5%B8%83%E7%BD%AE/" itemprop="url" rel="index"><span itemprop="name">作业布置</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="作业1"><a href="#作业1" class="headerlink" title="作业1"></a>作业1</h1><p>fortran计算：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line">program ch1_filter</span><br><span class="line">implicit none</span><br><span class="line">real, dimension(:), allocatable :: Xin, Xout1_average, Xout2_average,  &amp;</span><br><span class="line">Xout1_weighted, Xout2_weighted, Xout1_middle, Xout2_middle</span><br><span class="line">integer :: n=0, i,j, STAT</span><br><span class="line">real :: wn</span><br><span class="line">integer, parameter :: window1=7, window2=13</span><br><span class="line">real, dimension(window1) :: w1, input1</span><br><span class="line">real, dimension(window2) :: w2, input2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">open(1, file=&#x27;homework.txt&#x27;, form=&#x27;formatted&#x27;, status=&#x27;old&#x27; )</span><br><span class="line">! 读取文件行数</span><br><span class="line">DO WHILE (.TRUE.)</span><br><span class="line">    READ(1,*,IOSTAT=STAT)</span><br><span class="line">    IF(STAT .NE. 0) EXIT</span><br><span class="line">    n=n+1</span><br><span class="line">ENDDO</span><br><span class="line"></span><br><span class="line">open(2, status=&#x27;replace&#x27;,action=&#x27;write&#x27;, file=&#x27;result.dat&#x27;)</span><br><span class="line">allocate(Xin(n), Xout1_average(int(n-2*(window1-1)/2)),Xout2_average(int(n-2*(window2-1)/2)))</span><br><span class="line">allocate(Xout1_weighted(n-2*(window1-1)/2),Xout2_weighted(n-2*(window2-1)/2))</span><br><span class="line">allocate(Xout1_middle(n-2*(window1-1)/2),Xout2_middle(n-2*(window2-1)/2))</span><br><span class="line">close(unit=1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">open(3, file=&#x27;homework.txt&#x27;, form=&#x27;formatted&#x27;, status=&#x27;old&#x27; )</span><br><span class="line">read(3,*) (Xin(i) , i=1,n) </span><br><span class="line"></span><br><span class="line">do i=1,n</span><br><span class="line">print *, Xin(i)</span><br><span class="line">end do</span><br><span class="line"></span><br><span class="line">! 平均处理</span><br><span class="line">do i=1, n-2*(window1-1)/2</span><br><span class="line">    Xout1_average(i)=0.</span><br><span class="line">    do j=i, i+window1-1</span><br><span class="line">        Xout1_average(i)=Xout1_average(i)+Xin(j)</span><br><span class="line">    enddo</span><br><span class="line">    Xout1_average(i)=Xout1_average(i)/window1</span><br><span class="line">enddo</span><br><span class="line"></span><br><span class="line">do i=1, n-2*(window2-1)/2</span><br><span class="line">    Xout2_average(i)=0.</span><br><span class="line">    do j=i, i+window2-1</span><br><span class="line">        Xout2_average(i)=Xout2_average(i)+Xin(j)</span><br><span class="line">    enddo</span><br><span class="line">    Xout2_average(i)=Xout2_average(i)/window2</span><br><span class="line">enddo</span><br><span class="line"></span><br><span class="line">! 加权平均1</span><br><span class="line">do i=1, window1</span><br><span class="line">    wn=(window1+1)/2</span><br><span class="line">    if(i.le.wn) then </span><br><span class="line">    w1(i) = i/(wn**2)</span><br><span class="line">    else</span><br><span class="line">    w1(i) = (2*wn-i)/(wn**2)</span><br><span class="line">    endif</span><br><span class="line">enddo</span><br><span class="line"></span><br><span class="line">do i=1, n-2*(window1-1)/2</span><br><span class="line">    Xout1_weighted(i)=0.</span><br><span class="line">    do j=i, i+window1-1</span><br><span class="line">        Xout1_weighted(i)=Xout1_weighted(i)+Xin(j)*w1(j-i+1)</span><br><span class="line">    enddo</span><br><span class="line">enddo</span><br><span class="line">! 加权平均2</span><br><span class="line">do i=1, window2</span><br><span class="line">    wn=(window2+1)/2</span><br><span class="line">    if(i.le.wn) then </span><br><span class="line">    w2(i) = i/(wn**2)</span><br><span class="line">    else</span><br><span class="line">    w2(i) = (2*wn-i)/(wn**2)</span><br><span class="line">    endif</span><br><span class="line">enddo</span><br><span class="line"></span><br><span class="line">do i=1, n-2*(window1-1)/2</span><br><span class="line">    Xout2_weighted(i)=0.</span><br><span class="line">    do j=i, i+window1-1</span><br><span class="line">        Xout2_weighted(i)=Xout2_weighted(i)+Xin(j)*w2(j-i+1)</span><br><span class="line">    enddo</span><br><span class="line">enddo</span><br><span class="line"></span><br><span class="line">! 中值滤波1</span><br><span class="line">do i=1, n-2*(window1-1)/2</span><br><span class="line"></span><br><span class="line">    do j=i, i+window1-1</span><br><span class="line">        input1(j-i+1) = Xin(j)</span><br><span class="line">    enddo</span><br><span class="line">    call sort(input1,Xout1_middle(i),window1)</span><br><span class="line">enddo</span><br><span class="line"></span><br><span class="line">! 中值滤波2</span><br><span class="line">do i=1, n-2*(window2-1)/2</span><br><span class="line">    </span><br><span class="line">    do j=i, i+window2-1</span><br><span class="line">        input2(j-i+1) = Xin(j)</span><br><span class="line">    enddo</span><br><span class="line">    call sort(input2,Xout2_middle(i),window2)</span><br><span class="line">enddo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">do i=1, 132</span><br><span class="line">    write(2, 100) i, Xin(i+10), Xout1_average(i+7), Xout2_average(i+4), Xout1_weighted(i+7), Xout2_weighted(i+4), &amp;</span><br><span class="line">            Xout1_middle(i+7), Xout2_middle(i+4)</span><br><span class="line">enddo</span><br><span class="line"> 100 format(I4, 7(x, F15.4))</span><br><span class="line">end program ch1_filter</span><br><span class="line"></span><br><span class="line">SUBROUTINE sort(a,b,n)</span><br><span class="line">dimension :: a(n)</span><br><span class="line">real b</span><br><span class="line">real temp</span><br><span class="line">do i=1,n-1</span><br><span class="line">  do j=i+1,n</span><br><span class="line">   if (a(i).gt.a(j)) then</span><br><span class="line">   temp = a(i)</span><br><span class="line">   a(i) = a(j)</span><br><span class="line">   a(j) = temp</span><br><span class="line">   endif</span><br><span class="line">  enddo</span><br><span class="line">enddo </span><br><span class="line">b=a((n+1)/2)</span><br><span class="line">return</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>matlab绘制图像</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">load result.dat</span><br><span class="line"></span><br><span class="line">figure(1)</span><br><span class="line">hold on;</span><br><span class="line">subplot(4,2,1:2)</span><br><span class="line">plot(result(:,1), result(:,2), &#x27;r-&#x27;)</span><br><span class="line">title(&#x27;原始数据&#x27;)</span><br><span class="line">subplot(4,2,3)</span><br><span class="line">plot(result(:,1), result(:,3), &#x27;r-&#x27;)</span><br><span class="line">title(&#x27;平均值，窗口7&#x27;)</span><br><span class="line">subplot(4,2,4)</span><br><span class="line">plot(result(:,1), result(:,4), &#x27;r-&#x27;)</span><br><span class="line">title(&#x27;平均值，窗口13&#x27;)</span><br><span class="line">subplot(4,2,5)</span><br><span class="line">plot(result(:,1), result(:,5), &#x27;r-&#x27;)</span><br><span class="line">title(&#x27;权重，窗口7&#x27;)</span><br><span class="line">subplot(4,2,6)</span><br><span class="line">plot(result(:,1), result(:,6), &#x27;r-&#x27;)</span><br><span class="line">title(&#x27;权重，窗口13&#x27;)</span><br><span class="line">subplot(4,2,7)</span><br><span class="line">plot(result(:,1), result(:,7), &#x27;r-&#x27;)</span><br><span class="line">title(&#x27;中值滤波，窗口7&#x27;)</span><br><span class="line">subplot(4,2,8)</span><br><span class="line">plot(result(:,1), result(:,8), &#x27;r-&#x27;)</span><br><span class="line">title(&#x27;中值滤波，窗口13&#x27;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhiyuanshi1901.github.io/2023/03/06/GMT%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/06/GMT%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">GMT学习笔记</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2023-03-06 21:17:59 / Modified: 21:10:38" itemprop="dateCreated datePublished" datetime="2023-03-06T21:17:59+08:00">2023-03-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%9C%B0%E9%9C%87%E5%AD%A6%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/" itemprop="url" rel="index"><span itemprop="name">地震学常用软件</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://docs.gmt-china.org/latest/">https://docs.gmt-china.org/latest/</a></p>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>GMT分为Linux版本和Windows版本，本次使用在linux版本，在ubuntu下运行。<br>使用miniconda进行安装gmt十分方便。</p>
<pre><code>conda install gmt -c conda-forge
gmt --version  //进行测试
</code></pre>
<p>升级：</p>
<pre><code>conda update gmt
</code></pre>
<p>卸载：</p>
<pre><code>conda remove gmt
</code></pre>
<h1 id="入门使用"><a href="#入门使用" class="headerlink" title="入门使用"></a>入门使用</h1><h2 id="初步使用"><a href="#初步使用" class="headerlink" title="初步使用"></a>初步使用</h2><h3 id="GMT基本内容"><a href="#GMT基本内容" class="headerlink" title="GMT基本内容"></a>GMT基本内容</h3><p>在终端中输入</p>
<pre><code>gmt  //开始使用gmt
gmt --new-script &gt; 文件名 //创建一个.sh文件
gedit 文件名 //使用gedit文本编辑器编辑脚本文件
bash 文件名  //执行该脚本
</code></pre>
<p>建立的gmt文件内容为：</p>
<p>文件内容：</p>
<pre><code>gmt begin figurename pdf  # figurename指生成图片文件名，不给定时默认gmtsession
# pdf为格式。
    # Place modern session commands here
    gmt coast -Rg -JH15c -Gpurple -Baf -B+t&quot;My first Plot&quot;
gmt end show  # show表示自动打开生成的图片文件
</code></pre>
<h3 id="GMT脚本模板"><a href="#GMT脚本模板" class="headerlink" title="GMT脚本模板"></a>GMT脚本模板</h3><p>gmt的命令格式为：</p>
<p>gmt+模块名+[-选项+参数]</p>
<p>coast 表示绘制海岸线</p>
<p>-R指选项，g为参数</p>
<p>+t为-B的子选项</p>
<h3 id="coast模块"><a href="#coast模块" class="headerlink" title="coast模块"></a>coast模块</h3><ul>
<li><p>-JH180&#x2F;15c：指定地图投影参数，H表示使用Hammer投影，地图中心为经度180°（0-360°为标准）<br>地图宽度为15cm</p>
<ul>
<li>H：hammer投影</li>
<li>M：墨卡托投影</li>
</ul>
</li>
<li><p>-R 表示指定绘图范围。格式为：</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-R起始经度/结束经度/起始纬度/结束纬度</span><br><span class="line">-Rg # g表示global，写法相当于下面语句，表示绘制全球地图</span><br><span class="line">-R0/360/-90/90</span><br></pre></td></tr></table></figure>
<p>  或者使用国家代码表示区域范围</p>
<ul>
<li>NZ：新西兰国家代码，表示绘制该国的地图。</li>
<li>CN：中国国家代码。</li>
</ul>
</li>
<li><p>-B 表示增加边框及经纬线，参数一般为g。</p>
<ul>
<li>a：annotation 增加标注，即经纬度数字等</li>
<li>f：frame 刻度线，周边的刻度线</li>
<li>g：grid 网格线</li>
<li>xa4g2： 表示x轴标注间隔4°，网格线间隔2°，y轴同理</li>
<li>WSen：控制四条边的属性，大写表示添加标注，小写表示只绘制边框不显示标注</li>
<li>+t“标题内容”：增加标题</li>
</ul>
</li>
<li><p>-W 表示绘制海岸线</p>
<ul>
<li>0.5p,black：表示岸线为0.5p宽的黑色线条<ul>
<li>颜色有：黑色black，浅红色lightred</li>
</ul>
</li>
<li>1&#x2F;0.5p,black：1&#x2F;表示绘制1级海岸线</li>
</ul>
</li>
<li><p>-A 绘制对象湖泊或岛屿的最小面积（平方千米）</p>
</li>
<li><p>-G 设置陆地填充色</p>
</li>
<li><p>-S 设置水体颜色</p>
</li>
<li><p>-C 设置湖泊颜色，不设置为S颜色</p>
</li>
<li><p>-N 绘制国界、省界等，</p>
<ul>
<li>-N1 表示国界</li>
<li>-N2 表示省界 此处使用中国国界省界数据绘制，具体内容如下：<a target="_blank" rel="noopener" href="https://docs.gmt-china.org/latest/dataset-CN/CN-border/">https://docs.gmt-china.org/latest/dataset-CN/CN-border/</a></li>
</ul>
<p>下载好相应数据包后，使用方式如下：<br>      <figure class="highlight plaintext"><figcaption><span>plot CN-border-La.gmt -W0.1p```，此绘制的事中国国界省界十段线和南海诸岛。</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  </span><br><span class="line">+ -L 添加比例尺</span><br><span class="line">    </span><br><span class="line">    比例尺参数</span><br><span class="line">  + g经度/纬度  比例尺位置</span><br><span class="line">  + +w1000k 比例尺长度为1000km</span><br><span class="line">  + +c25 绘制比例尺为北纬25°</span><br><span class="line">  + +f 比例尺风格</span><br><span class="line">  + +u 显示比例尺对应单位</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### basemap模块</span><br><span class="line">绘制线性坐标轴和三维坐标轴</span><br><span class="line">+ -J</span><br><span class="line">  + X8c/5c：X轴宽度8cm、高度5cm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">+ -R</span><br><span class="line">  + x轴左/x轴右/y轴左/y轴右，表示图的范围</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">+ -B  参数同上</span><br><span class="line">  + +l“坐标轴名”</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">三维线性坐标轴：</span><br><span class="line">+ -R </span><br><span class="line">  + x轴左/x轴右/y轴左/y轴右/z轴下/z轴上</span><br><span class="line"></span><br><span class="line">z轴参数同x、y轴</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### gridimage模块 </span><br><span class="line">绘制全球地形起伏</span><br><span class="line"></span><br><span class="line">+ @erath_relief_xxx指定地形起伏数据精度</span><br><span class="line">  + 30m表示30′分辨率。1′约2km。</span><br><span class="line">  + 1s表示以1″为分辨率，约为30m</span><br><span class="line"></span><br><span class="line">+ -J 同coast模块</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">+ -I+d 增加光照效果</span><br><span class="line"></span><br><span class="line">#### 增加色标：</span><br><span class="line"></span><br><span class="line">    gmt colorbar</span><br><span class="line"></span><br><span class="line">+ -B 设置色标标注间隔，添加标签</span><br><span class="line">  + xaf+l“标签”：设置间隔和标签，同上</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">+ -D 色标放置位置</span><br><span class="line">  + JMR 地形起伏图右侧中间</span><br><span class="line">  + +w10c 色标长度10cm</span><br><span class="line">  + +o1.5c/0c 向右偏移1.5cm</span><br><span class="line">  + +ml 标签放在色标左侧</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### makecpt模块：</span><br><span class="line">制作CPT文件，供接下来的grdimage和colorcolorbar命令使用。</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
</li>
</ul>
<p>gmt basemap 参数<br>gmt makecpt -Cglobe -T -8000&#x2F;8000<br>gmt colorbar -Bxa2000 -B+l”m”</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 绘图示例：</span><br><span class="line">绘制模型速度剖面的gmt脚本，使用TAUP自动生成：</span><br><span class="line">```commandline</span><br><span class="line">#!/bin/sh</span><br><span class="line">#</span><br><span class="line"># This script will plot the modelmyself velocity model using GMT. If you want to</span><br><span class="line">#use this as a data file for psxy in another script, delete these</span><br><span class="line"># first lines, as well as the last line.</span><br><span class="line">#</span><br><span class="line">/bin/rm -f modelmyself_vel.ps gmt.history</span><br><span class="line"></span><br><span class="line">PCOLOR=0/0/255</span><br><span class="line">SCOLOR=255/0/0</span><br><span class="line">P2COLOR=0/255/255</span><br><span class="line">S2COLOR=255/0/255</span><br><span class="line"></span><br><span class="line">gmt psbasemap -JX6i/-9i -P -R0/11.657488500000001/0/6371.0 -Bxa2f1+l&#x27;Velocity (km/s)&#x27; -Byf200a400+l&#x27;Depth (km)&#x27; -BWSen+t&#x27;modelmyself&#x27;  -K &gt; modelmyself_vel.ps</span><br><span class="line"></span><br><span class="line">gmt psxy -JX -P -R -W2p,$&#123;PCOLOR&#125; -: -m -O -K &gt;&gt; modelmyself_vel.ps &lt;&lt;END</span><br><span class="line">0.0 9.74431</span><br><span class="line">371.0 9.74431</span><br><span class="line">871.0 9.74431</span><br><span class="line">1371.0 9.74431</span><br><span class="line">1891.0 9.74431</span><br><span class="line">2891.0 9.74431</span><br><span class="line">2891.0 10.33598</span><br><span class="line">3370.5 10.33598</span><br><span class="line">3870.5 10.33598</span><br><span class="line">4370.5 10.33598</span><br><span class="line">4670.5 10.33598</span><br><span class="line">5149.5 10.33598</span><br><span class="line">5149.5 11.10237</span><br><span class="line">5371.0 11.10237</span><br><span class="line">6371.0 11.10237</span><br><span class="line">END</span><br><span class="line"></span><br><span class="line">gmt psxy -JX -P -R -W2p,$&#123;SCOLOR&#125; -: -m -O  -K &gt;&gt; modelmyself_vel.ps &lt;&lt;END</span><br><span class="line">0.0 5.21269</span><br><span class="line">371.0 5.21269</span><br><span class="line">871.0 5.21269</span><br><span class="line">1371.0 5.21269</span><br><span class="line">1891.0 5.21269</span><br><span class="line">2891.0 5.21269</span><br><span class="line">2891.0 0.0</span><br><span class="line">3370.5 0.0</span><br><span class="line">3870.5 0.0</span><br><span class="line">4370.5 0.0</span><br><span class="line">4670.5 0.0</span><br><span class="line">5149.5 0.0</span><br><span class="line">5149.5 3.51458</span><br><span class="line">5371.0 3.51458</span><br><span class="line">6371.0 3.51458</span><br><span class="line">END</span><br><span class="line">gmt psxy -JX -P -R -W2p,$&#123;P2COLOR&#125; -: -m -O -K &gt;&gt; modelmyself_vel.ps &lt;&lt;END</span><br><span class="line">0.0 9.74431</span><br><span class="line">371.0 9.74431</span><br><span class="line">871.0 9.74431</span><br><span class="line">1371.0 9.74431</span><br><span class="line">1891.0 9.74431</span><br><span class="line">2891.0 9.74431</span><br><span class="line">2891.0 9.20998</span><br><span class="line">3370.5 10.33598</span><br><span class="line">3870.5 10.33598</span><br><span class="line">4370.5 10.33598</span><br><span class="line">4470.5 10.33598</span><br><span class="line">4670.5 10.33598</span><br><span class="line">4670.5 11.10237</span><br><span class="line">5371.0 11.10237</span><br><span class="line">6371.0 11.10237</span><br><span class="line">END</span><br><span class="line"></span><br><span class="line">gmt psxy -JX -P -R -W2p,$&#123;S2COLOR&#125; -: -m -O &gt;&gt; modelmyself_vel.ps &lt;&lt;END</span><br><span class="line">0.0 5.21269</span><br><span class="line">371.0 5.21269</span><br><span class="line">871.0 5.21269</span><br><span class="line">1371.0 5.21269</span><br><span class="line">1891.0 5.21269</span><br><span class="line">2891.0 5.21269</span><br><span class="line">2891.0 0.0</span><br><span class="line">3370.5 0.0</span><br><span class="line">3870.5 0.0</span><br><span class="line">4370.5 0.0</span><br><span class="line">4470.5 0.0</span><br><span class="line">4670.5 0.0</span><br><span class="line">4670.5 3.51458</span><br><span class="line">5371.0 3.51458</span><br><span class="line">6371.0 3.51458</span><br><span class="line">END</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># convert ps to pdf, clean up .ps file</span><br><span class="line">gmt psconvert -P -Tf  modelmyself_vel.ps &amp;&amp; rm modelmyself_vel.ps</span><br><span class="line"># clean up after gmt...</span><br><span class="line">/bin/rm gmt.history</span><br></pre></td></tr></table></figure>

<p>其中，语句</p>
<pre><code>gmt psxy -JX -P -R -W2p,$&#123;PCOLOR&#125; -: -m -O -K
</code></pre>
<p>为绘制语句。其中：</p>
<ul>
<li>-J 表示投影方式</li>
<li>-P </li>
<li>-R </li>
<li>-W2p 表示线段宽度为2</li>
<li>${PCOLOR}为设置的颜色变量。</li>
<li>-O -K<ul>
<li>-K 表示第一个图层</li>
<li>-K -O 表示中间的图层</li>
<li>-O 表示最后一个图层</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhiyuanshi1901.github.io/2023/03/01/Taup%E5%88%9D%E6%8E%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/01/Taup%E5%88%9D%E6%8E%A2/" class="post-title-link" itemprop="url">Taup初探</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-03-01 21:47:29" itemprop="dateCreated datePublished" datetime="2023-03-01T21:47:29+08:00">2023-03-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-04-05 10:43:12" itemprop="dateModified" datetime="2023-04-05T10:43:12+08:00">2023-04-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%9C%B0%E9%9C%87%E5%AD%A6%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/" itemprop="url" rel="index"><span itemprop="name">地震学常用软件</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h1><h2 id="What-and-WHere"><a href="#What-and-WHere" class="headerlink" title="What and WHere"></a>What and WHere</h2><p>README.md 开始信息<br>LICENSE GNU LGPL licence<br>StdModels 在&#x2F;lib&#x2F;TauP-2.6.1.jar&#x2F;edu&#x2F;sc&#x2F;seis&#x2F;TauP&#x2F;StdModels中存在的模型</p>
<h1 id="创建模型"><a href="#创建模型" class="headerlink" title="创建模型"></a>创建模型</h1><h2 id="nd模型"><a href="#nd模型" class="headerlink" title=".nd模型"></a>.nd模型</h2><p>模型中，每一列为：<br>depth（km）；P波速度（km&#x2F;s）；S波速度(km&#x2F;s)；密度（g&#x2F;cm3）；Qp；Qs。</p>
<p>但是只有前三列为有效值，其余三列无效，只是为了兼容之后的某些情况。</p>
<p>注意！模型最后一行留一空白行。</p>
<p>使用英文单词表示分界面：</p>
<ul>
<li>mantle 莫霍界面</li>
<li>outer-core CMB</li>
<li>inner-core ICB<br>示例：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/* below is a simple named discontinuities model. */</span><br><span class="line">0.0 5.0 3.0 2.7</span><br><span class="line">20 5.0 3.0 2.7</span><br><span class="line">20 6.5 3.7 2.9</span><br><span class="line">33 6.5 3.7 2.9</span><br><span class="line">mantle # the word &quot;mantle&quot; designates that this is the moho</span><br><span class="line">33 7.8 4.4 3.3</span><br><span class="line">410 8.9 4.7 3.5</span><br><span class="line">410 9.1 4.9 3.7</span><br><span class="line">670 10.2 5.5 4.0</span><br><span class="line">670 10.7 5.9 4.4</span><br><span class="line">2891 13.7 7.2 5.6</span><br><span class="line">outer-core # &quot;outer-core&quot; designates that this is the core mantle boundary</span><br><span class="line">2891 8.0 0.0 9.9</span><br><span class="line">5149.5 10.3 0.0 12.2</span><br><span class="line">inner-core # &quot;inner-core&quot; makes this the inner-outer core boundary</span><br><span class="line">5149.5 11 3.5 12.7</span><br><span class="line">6371 11.3 3.7 13</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="vel模型"><a href="#vel模型" class="headerlink" title=".vel模型"></a>.vel模型</h2><p>前两行为模型描述，两行之后为模型。<br>间断面使用两行相同的深度表示。每一行为：<br>depth；P波速度；S波速度；密度 （单位同上）</p>
<p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line">ak135 - P</span><br><span class="line">ak135 - S</span><br><span class="line">     0.000      5.8000      3.4600     2.7200</span><br><span class="line">    20.000      5.8000      3.4600      2.7200</span><br><span class="line">    20.000      6.5000      3.8500      2.9200</span><br><span class="line">    35.000      6.5000      3.8500      2.9200</span><br><span class="line">    35.000      8.0400      4.4800      3.3198</span><br><span class="line">    77.500      8.0450      4.4900      3.3455</span><br><span class="line">   120.000      8.0500      4.5000      3.3713</span><br><span class="line">   165.000      8.1750      4.5090      3.3985</span><br><span class="line">   210.000      8.3000      4.5180      3.4258</span><br><span class="line">   210.000      8.3000      4.5230      3.4258</span><br><span class="line">   260.000      8.4825      4.6090      3.4561</span><br><span class="line">   310.000      8.6650      4.6960      3.4864</span><br><span class="line">   360.000      8.8475      4.7830      3.5167</span><br><span class="line">   410.000      9.0300      4.8700      3.5470</span><br><span class="line">   410.000      9.3600      5.0800      3.7557</span><br><span class="line">   460.000      9.5280      5.1860      3.8175</span><br><span class="line">   510.000      9.6960      5.2920      3.8793</span><br><span class="line">   560.000      9.8640      5.3980      3.9410</span><br><span class="line">   610.000     10.0320      5.5040      4.0028</span><br><span class="line">   660.000     10.2000      5.6100      4.0646</span><br><span class="line">   660.000     10.7900      5.9600      4.3714</span><br><span class="line">   710.000     10.9229      6.0897      4.4010</span><br><span class="line">   760.000     11.0558      6.2095      4.4305</span><br><span class="line">   809.500     11.1353      6.2426      4.4596</span><br><span class="line">   859.000     11.2221      6.2798      4.4885</span><br><span class="line">   908.500     11.3068      6.3160      4.5173</span><br><span class="line">   958.000     11.3896      6.3512      4.5459</span><br><span class="line">  1007.500     11.4705      6.3854      4.5744</span><br><span class="line">  1057.000     11.5495      6.4187      4.6028</span><br><span class="line">  1106.500     11.6269      6.4510      4.6310</span><br><span class="line">  1156.000     11.7026      6.4828      4.6591</span><br><span class="line">  1205.500     11.7766      6.5138      4.6870</span><br><span class="line">  1255.000     11.8491      6.5439      4.7148</span><br><span class="line">  1304.500     11.9200      6.5727      4.7424</span><br><span class="line">  1354.000     11.9895      6.6008      4.7699</span><br><span class="line">  1403.500     12.0577      6.6285      4.7973</span><br><span class="line">  1453.000     12.1245      6.6555      4.8245</span><br><span class="line">  1502.500     12.1912      6.6815      4.8515</span><br><span class="line">  1552.000     12.2550      6.7073      4.8785</span><br><span class="line">  1601.500     12.3185      6.7326      4.9052</span><br><span class="line">  1651.000     12.3819      6.7573      4.9319</span><br><span class="line">  1700.500     12.4426      6.7815      4.9584</span><br><span class="line">  1750.000     12.5031      6.8052      4.9847</span><br><span class="line">  1799.500     12.5631      6.8286      5.0109</span><br><span class="line">  1849.000     12.6221      6.8515      5.0370</span><br><span class="line">  1898.500     12.6804      6.8742      5.0629</span><br><span class="line">  1948.000     12.7382      6.8972      5.0887</span><br><span class="line">  1997.500     12.7956      6.9194      5.1143</span><br><span class="line">  2047.000     12.8526      6.9418      5.1398</span><br><span class="line">  2096.500     12.9096      6.9627      5.1652</span><br><span class="line">  2146.000     12.9668      6.9855      5.1904</span><br><span class="line">  2195.500     13.0222      7.0063      5.2154</span><br><span class="line">  2245.000     13.0783      7.0281      5.2403</span><br><span class="line">  2294.500     13.1336      7.0500      5.2651</span><br><span class="line">  2344.000     13.1894      7.0720      5.2898</span><br><span class="line">  2393.500     13.2465      7.0931      5.3142</span><br><span class="line">  2443.000     13.3018      7.1144      5.3386</span><br><span class="line">  2492.500     13.3585      7.1369      5.3628</span><br><span class="line">  2542.000     13.4156      7.1586      5.3869</span><br><span class="line">  2591.500     13.4741      7.1807      5.4108</span><br><span class="line">  2640.000     13.5312      7.2031      5.4345</span><br><span class="line">  2690.000     13.5900      7.2258      5.4582</span><br><span class="line">  2740.000     13.6494      7.2490      5.4817</span><br><span class="line">  2740.000     13.6494      7.2490      5.4817</span><br><span class="line">  2789.670     13.6530      7.2597      5.5051</span><br><span class="line">  2839.330     13.6566      7.2704      5.5284</span><br><span class="line">  2891.500     13.6602      7.2811      5.5515</span><br><span class="line">  2891.500      8.0000      0.0000      9.9145</span><br><span class="line">  2939.330      8.0382      0.0000      9.9942</span><br><span class="line">  2989.660      8.1283      0.0000     10.0722</span><br><span class="line">  3039.990      8.2213      0.0000     10.1485</span><br><span class="line">  3090.320      8.3122      0.0000     10.2233</span><br><span class="line">  3140.660      8.4001      0.0000     10.2964</span><br><span class="line">  3190.990      8.4861      0.0000     10.3679</span><br><span class="line">  3241.320      8.5692      0.0000     10.4378</span><br><span class="line">  3291.650      8.6496      0.0000     10.5062</span><br><span class="line">  3341.980      8.7283      0.0000     10.5731</span><br><span class="line">  3392.310      8.8036      0.0000     10.6385</span><br><span class="line">  3442.640      8.8761      0.0000     10.7023</span><br><span class="line">  3492.970      8.9461      0.0000     10.7647</span><br><span class="line">  3543.300      9.0138      0.0000     10.8257</span><br><span class="line">  3593.640      9.0792      0.0000     10.8852</span><br><span class="line">  3643.970      9.1426      0.0000     10.9434</span><br><span class="line">  3694.300      9.2042      0.0000     11.0001</span><br><span class="line">  3744.630      9.2634      0.0000     11.0555</span><br><span class="line">  3794.960      9.3205      0.0000     11.1095</span><br><span class="line">  3845.290      9.3760      0.0000     11.1623</span><br><span class="line">  3895.620      9.4297      0.0000     11.2137</span><br><span class="line">  3945.950      9.4814      0.0000     11.2639</span><br><span class="line">  3996.280      9.5306      0.0000     11.3127</span><br><span class="line">  4046.620      9.5777      0.0000     11.3604</span><br><span class="line">  4096.950      9.6232      0.0000     11.40690</span><br><span class="line">  4147.280      9.6673      0.0000     11.4521</span><br><span class="line">  4197.610      9.7100      0.0000     11.4962</span><br><span class="line">  4247.940      9.7513      0.0000     11.5391</span><br><span class="line">  4298.270      9.7914      0.0000     11.5809</span><br><span class="line">  4348.600      9.8304      0.0000     11.6216</span><br><span class="line">  4398.930      9.8682      0.0000     11.6612</span><br><span class="line">  4449.260      9.9051      0.0000     11.6998</span><br><span class="line">  4499.600      9.9410      0.0000     11.7373</span><br><span class="line">  4549.930      9.9761      0.0000     11.7737</span><br><span class="line">  4600.260     10.0103      0.0000     11.8092</span><br><span class="line">  4650.590     10.0439      0.0000     11.8437</span><br><span class="line">  4700.920     10.0768      0.0000     11.8772</span><br><span class="line">  4801.580     10.1415      0.0000     11.94140</span><br><span class="line">  4851.910     10.1739      0.0000     11.9722</span><br><span class="line">  4902.240     10.2049      0.0000     12.0001</span><br><span class="line">  4952.580     10.2329      0.0000     12.0311</span><br><span class="line">  5002.910     10.2565      0.0000     12.0593</span><br><span class="line">  5053.240     10.2745      0.0000     12.0867</span><br><span class="line">  5103.570     10.2854      0.0000     12.1133</span><br><span class="line">  5153.500     10.2890      0.0000     12.1391</span><br><span class="line">  5153.500     11.0427      3.5043     12.7037</span><br><span class="line">  5204.610     11.0585      3.5187     12.7289</span><br><span class="line">  5255.320     11.0718      3.5314     12.7530</span><br><span class="line">  5306.040     11.0850      3.5435     12.7760</span><br><span class="line">  5356.750     11.0983      3.5551     12.7980</span><br><span class="line">  5407.460     11.1166      3.5661     12.8188</span><br><span class="line">  5458.170     11.1316      3.5765     12.8387</span><br><span class="line">  5508.890     11.1457      3.5864     12.8574</span><br><span class="line">  5559.600     11.1590      3.5957     12.8751</span><br><span class="line">  5610.310     11.1715      3.6044     12.8917</span><br><span class="line">  5661.020     11.1832      3.6126     12.9072</span><br><span class="line">  5711.740     11.1941      3.6202     12.9217</span><br><span class="line">  5813.160     11.2134      3.6337     12.9474</span><br><span class="line">  5863.870     11.2219      3.6396     12.9586</span><br><span class="line">  5914.590     11.2295      3.6450     12.9688</span><br><span class="line">  5965.300     11.2364      3.6498     12.9779</span><br><span class="line">  6016.010     11.2424      3.6540     12.9859</span><br><span class="line">  6066.720     11.2477      3.6577     12.9929</span><br><span class="line">  6117.440     11.2521      3.6608     12.9988</span><br><span class="line">  6168.150     11.2557      3.6633     13.0036</span><br><span class="line">  6218.860     11.2586      3.6653     13.0074</span><br><span class="line">  6269.570     11.2606      3.6667     13.0100</span><br><span class="line">  6320.290     11.2618      3.6675     13.0117</span><br><span class="line">  6371.000     11.2622      3.6678     13.0122</span><br></pre></td></tr></table></figure>

<h2 id="创建taup模型"><a href="#创建taup模型" class="headerlink" title="创建taup模型"></a>创建taup模型</h2><p>创建完成模型后，可以通过语句完成taup模型创建</p>
<pre><code>taup create -nd prem_normal.nd --verbose
</code></pre>
<p>生成的模型名称为prem_normal.taup</p>
<h2 id="错误信息"><a href="#错误信息" class="headerlink" title="错误信息"></a>错误信息</h2><h3 id="创建模型时，注意地表处S波速度不能为0-否则报错。"><a href="#创建模型时，注意地表处S波速度不能为0-否则报错。" class="headerlink" title="创建模型时，注意地表处S波速度不能为0,否则报错。"></a>创建模型时，注意地表处S波速度不能为0,否则报错。</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error starting tool: create edu.sc.seis.TauP.SlownessModelException: TauP Exception: SlownessModel Exception: Unable to handle zero S velocity layers at surface. This should be fixed at some point, but is a limitation of TauP at this point</span><br></pre></td></tr></table></figure>
<h3 id="S波速度与P波速度关系"><a href="#S波速度与P波速度关系" class="headerlink" title="S波速度与P波速度关系"></a>S波速度与P波速度关系</h3><p>S波速度小于P波速度。因此大于时会报错。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Caused by: edu.sc.seis.TauP.VelocityModelException: TauP Exception: VelocityModel Exception: S velocity, 3.19101 at depth 0.0 is greater than the P velocity, 1.44996</span><br></pre></td></tr></table></figure>

<h1 id="计算震相走时"><a href="#计算震相走时" class="headerlink" title="计算震相走时"></a>计算震相走时</h1><h2 id="交互输入"><a href="#交互输入" class="headerlink" title="交互输入"></a>交互输入</h2><pre><code>taup time --mod prem_normal.nd
</code></pre>
<h3 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Enter:</span><br><span class="line">h for new depth</span><br><span class="line">r to recalculate</span><br><span class="line">p to append phases, </span><br><span class="line">c to clear phases</span><br><span class="line">l to list phases</span><br><span class="line">s for new station lat lon</span><br><span class="line">e for new event lat lon</span><br><span class="line">a for new azimuth</span><br><span class="line">b for new back azimuth</span><br><span class="line">t for takeoff angle</span><br><span class="line">m for new model or </span><br><span class="line">q to quit.</span><br><span class="line"></span><br><span class="line">Enter Distance or Option [hrpclseabmqt]: h</span><br><span class="line">Enter Depth: 140.0</span><br><span class="line">Enter Distance or Option [hrpclseabmqt]: l</span><br><span class="line">18 phases.</span><br><span class="line">p,s,P,S,pP,sS,Pn,Sn,PcP,ScS,Pdiff,Sdiff,PKP,SKS,PKiKP,SKiKS,PKIKP,SKIKS</span><br><span class="line">Enter Distance or Option [hrpclseabmqt]: 100</span><br><span class="line"></span><br><span class="line">Model: prem_normal</span><br><span class="line">Distance   Depth   Phase   Travel    Ray Param  Takeoff  Incident  Purist    Purist</span><br><span class="line">  (deg)     (km)   Name    Time (s)  p (s/deg)   (deg)    (deg)   Distance   Name </span><br><span class="line">-----------------------------------------------------------------------------------</span><br><span class="line">  100.00   140.0   Pdiff    812.04     4.437     18.61     3.32   100.00   = Pdiff</span><br><span class="line">  100.00   140.0   PKiKP   1078.11     1.797      7.43     1.34   100.00   = PKiKP</span><br><span class="line">  100.00   140.0   SKS     1443.09     4.955     11.38     2.55   100.00   = SKS  </span><br><span class="line">  100.00   140.0   SKiKS   1502.74     1.888      4.31     0.97   100.00   = SKiKS</span><br><span class="line">  100.00   140.0   S       1503.79     8.537     19.87     4.40   100.00   = S    </span><br><span class="line">  100.00   140.0   ScS     1503.93     8.405     19.55     4.33   100.00   = ScS  </span><br><span class="line">  100.00   140.0   sS      1571.60     8.584    160.02     4.43   100.00   = sS   </span><br><span class="line"></span><br><span class="line">Enter Distance or Option [hrpclseabmqt]: q</span><br></pre></td></tr></table></figure>

<h2 id="也可以使用命令行命令直接进行计算："><a href="#也可以使用命令行命令直接进行计算：" class="headerlink" title="也可以使用命令行命令直接进行计算："></a>也可以使用命令行命令直接进行计算：</h2><p>-mod 输入模型名称<br>-h 震源深度 km<br>–stadepth 地震仪深度 km</p>
<p>-deg 震中距 度<br>-km 震中距 千米<br>或者给出经纬度（假设地球为球体）<br>-sta lat lon 台站经纬度<br>-evt lat lon 事件经纬度</p>
<p>–rayp 只输出射线参数<br>–time 只输出走时<br>–rel phasename 同时输出相对走时？<br>–json json格式输出走时</p>
<p>-ph 震相名称<br>-pf 震相文件，即包含震相名称的文件</p>
<h3 id="示例：-1"><a href="#示例：-1" class="headerlink" title="示例："></a>示例：</h3><pre><code>taup time -mod prem_normal.nd -h 200 -deg 170 --rel P --json
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;model&quot;: &quot;prem_normal&quot;,</span><br><span class="line">  &quot;sourcedepth&quot;: 200.0,</span><br><span class="line">  &quot;receiverdepth&quot;: 0.0,</span><br><span class="line">  &quot;phases&quot;: [ &quot;p&quot;, &quot;s&quot;, &quot;P&quot;, &quot;S&quot;, &quot;pP&quot;, &quot;sS&quot;, &quot;Pn&quot;, &quot;Sn&quot;, &quot;PcP&quot;, &quot;ScS&quot;, &quot;Pdiff&quot;, &quot;Sdiff&quot;, &quot;PKP&quot;, &quot;SKS&quot;, &quot;PKiKP&quot;, &quot;SKiKS&quot;, &quot;PKIKP&quot;, &quot;SKIKS&quot; ],</span><br><span class="line">  &quot;arrivals&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;distdeg&quot;: 170.0,</span><br><span class="line">      &quot;phase&quot;: &quot;PKIKP&quot;,</span><br><span class="line">      &quot;time&quot;: 1186.1327,</span><br><span class="line">      &quot;rayparam&quot;: 0.5805277,</span><br><span class="line">      &quot;takeoff&quot;: 2.3948026,</span><br><span class="line">      &quot;incident&quot;: 0.43373135,</span><br><span class="line">      &quot;puristdist&quot;: 170.0,</span><br><span class="line">      &quot;puristname&quot;: &quot;PKIKP&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;distdeg&quot;: 170.0,</span><br><span class="line">      &quot;phase&quot;: &quot;PKP&quot;,</span><br><span class="line">      &quot;time&quot;: 1261.7003,</span><br><span class="line">      &quot;rayparam&quot;: 4.42584,</span><br><span class="line">      &quot;takeoff&quot;: 18.575956,</span><br><span class="line">      &quot;incident&quot;: 3.308497,</span><br><span class="line">      &quot;puristdist&quot;: 170.0,</span><br><span class="line">      &quot;puristname&quot;: &quot;PKP&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;distdeg&quot;: 170.0,</span><br><span class="line">      &quot;phase&quot;: &quot;SKIKS&quot;,</span><br><span class="line">      &quot;time&quot;: 1596.8145,</span><br><span class="line">      &quot;rayparam&quot;: 0.45553252,</span><br><span class="line">      &quot;takeoff&quot;: 1.0524957,</span><br><span class="line">      &quot;incident&quot;: 0.23472442,</span><br><span class="line">      &quot;puristdist&quot;: 170.0,</span><br><span class="line">      &quot;puristname&quot;: &quot;SKIKS&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>截至此时，其只能在命令行中输出信息。</p>
<h1 id="绘制速度剖面图"><a href="#绘制速度剖面图" class="headerlink" title="绘制速度剖面图"></a>绘制速度剖面图</h1><pre><code>taup velplot -nd prem_normal.nd
sh prem_normal_vel.gmt
</code></pre>
<p>即可使用gmt绘制出漂亮的速度剖面图。</p>
<ul>
<li>模型类型</li>
<li>-mod 直接输入Taup中自带的模型名称。不需要调用其他文件。例如：<code>iasp91</code> <code>prem</code>等。可以在安装目录StdModel文件夹中查看。</li>
<li>-nd 输入文件名称。</li>
<li>-tvel</li>
<li>–version 在命令行输出Taup版本。</li>
<li>–debug 可能是出现bug会在命令行有输出？目前还没有创建bug测试。</li>
<li>–verbose 未知</li>
</ul>
<p>注意：必须已安装gmt。安装见《GMT安装》。</p>
<h1 id="绘制模型慢度剖面图"><a href="#绘制模型慢度剖面图" class="headerlink" title="绘制模型慢度剖面图"></a>绘制模型慢度剖面图</h1><h1 id="绘制走时曲线"><a href="#绘制走时曲线" class="headerlink" title="绘制走时曲线"></a>绘制走时曲线</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export model=&#x27;premoonaver&#x27;</span><br><span class="line">export phases=&#x27;p,s,PKP,ScS,PcP,P,S&#x27;</span><br><span class="line">taup_curve -mod $model.nd -h 867.0 -ph $&#123;phases&#125; -o time_curve -gmt</span><br><span class="line">sh time_curve.gmt</span><br></pre></td></tr></table></figure>
<p>注意：震相s与S不同，需要单独绘制。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhiyuanshi1901.github.io/2023/03/01/%E5%9C%A8linux%E5%B9%B3%E5%8F%B0%E4%BD%BF%E7%94%A8%E8%85%BE%E8%AE%AF%E4%BC%9A%E8%AE%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/01/%E5%9C%A8linux%E5%B9%B3%E5%8F%B0%E4%BD%BF%E7%94%A8%E8%85%BE%E8%AE%AF%E4%BC%9A%E8%AE%AE/" class="post-title-link" itemprop="url">在linux平台使用腾讯会议</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2023-03-01 16:46:56 / Modified: 16:51:50" itemprop="dateCreated datePublished" datetime="2023-03-01T16:46:56+08:00">2023-03-01</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Zqinstarking/article/details/128053342">https://blog.csdn.net/Zqinstarking/article/details/128053342</a></p>
<p>下载腾讯会议deb包。</p>
<p>解压deb包，并解压data包。</p>
<p>在某个地方（比如桌面）创建一个sh脚本文件。这里命名为<code>getwemeetapp.sh</code>。</p>
<p>脚本文件中输入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">cd ~/Documents/tencentmeeting/data/opt/wemeet  # 此处为腾讯会议下载解压后的地址。</span><br><span class="line">sh wemeetapp.sh</span><br></pre></td></tr></table></figure>
<p>事实上可以直接在任何地方运行，但是每次需要输入很长的语句，使用另一个sh脚本可以快速打开。</p>
<p>在桌面打开终端，运行：<br><code>./getwemeetapp.sh</code><br>即可打开腾讯会议。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhiyuanshi1901.github.io/2023/02/25/%E5%B8%B8%E7%94%A8%E8%AE%BA%E6%96%87%E7%BD%91%E7%AB%99/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/02/25/%E5%B8%B8%E7%94%A8%E8%AE%BA%E6%96%87%E7%BD%91%E7%AB%99/" class="post-title-link" itemprop="url">常用论文网站</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-02-25 16:36:33" itemprop="dateCreated datePublished" datetime="2023-02-25T16:36:33+08:00">2023-02-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-02-28 15:59:55" itemprop="dateModified" datetime="2023-02-28T15:59:55+08:00">2023-02-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>这里整理一些常用的论文查找网站。</p>
<h1 id="汇总型网站-按照推荐顺序排列"><a href="#汇总型网站-按照推荐顺序排列" class="headerlink" title="汇总型网站 (按照推荐顺序排列)"></a>汇总型网站 (按照推荐顺序排列)</h1><p><a target="_blank" rel="noopener" href="https://www.researchgate.net/">researchgate</a><br>在这个网站可以找到大部分发表文献的作者，向其提交申请，经过对方同意可以获取文献。并且网站具有交流的功能，可以通过follow等方式关注感兴趣的作者和内容。</p>
<p><a target="_blank" rel="noopener" href="https://www.academia.edu/">academia</a><br>可以直接下载文献。</p>
<p><a target="_blank" rel="noopener" href="https://www.sciencedirect.com/">Sciencedirect</a><br>可以通过机构登录获取文献。</p>
<p><a target="_blank" rel="noopener" href="https://link.springer.com/">springer</a><br>可以通过机构登录获取文献。</p>
<p><a target="_blank" rel="noopener" href="https://www.semanticscholar.org/">semanticscholar</a></p>
<h1 id="期刊"><a href="#期刊" class="headerlink" title="期刊"></a>期刊</h1><p>此仅放置相应的期刊官网。可以通过google搜索到相应期刊官网，一些文献可以直接下载。</p>
<p><a target="_blank" rel="noopener" href="https://agupubs.onlinelibrary.wiley.com/">American Geophysical Union</a><br>美国地球物理学会。</p>
<p><a target="_blank" rel="noopener" href="https://pubs.geoscienceworld.org/">GeoScienceWorld</a><br>GeoScienceWorld（GSW）是由7家地球科学领域的顶尖协会共同建立的非营利型组织。（词源百度百科）</p>
<p><a target="_blank" rel="noopener" href="https://core.ac.uk/">Core</a><br>CORE is the world’s largest aggregator of open access research papers from repositories and journals. (词源官网)</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhiyuanshi1901.github.io/2023/02/07/baidu_verify_codeva-0NlQJTBPs1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/02/07/baidu_verify_codeva-0NlQJTBPs1/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2023-02-07 12:18:04 / Modified: 12:16:53" itemprop="dateCreated datePublished" datetime="2023-02-07T12:18:04+08:00">2023-02-07</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          34e895a3fd0bee1dadbd8358d3b14d24
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhiyuanshi1901.github.io/2023/02/05/Python-SAC-IO/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/02/05/Python-SAC-IO/" class="post-title-link" itemprop="url">Python-SAC-IO</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-02-05 20:50:23" itemprop="dateCreated datePublished" datetime="2023-02-05T20:50:23+08:00">2023-02-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-04-22 15:53:24" itemprop="dateModified" datetime="2023-04-22T15:53:24+08:00">2023-04-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>在Python中使用包实现SAC文件读取。有如下三个SAC读取相关的库：<br><a target="_blank" rel="noopener" href="https://github.com/pysmo/pysmo">pysmo</a><br><a target="_blank" rel="noopener" href="https://github.com/eost/sacpy">sacpy</a><br><a target="_blank" rel="noopener" href="https://pyrocko.org/docs/current/install/packages/anaconda.html">pyrocko</a></p>
<p>注意：有些库不支持较高的Python版本。例如pyrocko只支持到3.6.*版本。使用conda创建环境较为方便，建议使用3.6版本的<br>python，在改版本下均可安装以下库及Obspy。</p>
<p>运行如果出现报错：</p>
<pre><code>&#39;version_info&#39; object has no attribute &#39;__version__&#39;
</code></pre>
<p>试一下运行：</p>
<pre><code>pip install pyparsing==2.4.7
</code></pre>
<h1 id="pysmo"><a href="#pysmo" class="headerlink" title="pysmo"></a>pysmo</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><pre><code>pip install pysmo
pip install pysmo --pre
pip install git+https://github.com/pysmo/pysmo
</code></pre>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>官方文档：<a target="_blank" rel="noopener" href="https://pysmo.readthedocs.io/en/latest/sac.html">https://pysmo.readthedocs.io/en/latest/sac.html</a></p>
<h3 id="读取文件"><a href="#读取文件" class="headerlink" title="读取文件"></a>读取文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">from pysmo import SacIO</span><br><span class="line">seismogram = SacIO.from_file(&#x27;filename.sac&#x27;)</span><br><span class="line">datas = seismogram.data</span><br><span class="line">print(datas)</span><br></pre></td></tr></table></figure>

<h3 id="读取采样率"><a href="#读取采样率" class="headerlink" title="读取采样率"></a>读取采样率</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">delta = seismogram.delta</span><br><span class="line">print(delta)</span><br></pre></td></tr></table></figure>

<h3 id="修改采样率"><a href="#修改采样率" class="headerlink" title="修改采样率"></a>修改采样率</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">seismogram.delta = 0.05</span><br></pre></td></tr></table></figure>
<h3 id="读取IRIS的地震数据"><a href="#读取IRIS的地震数据" class="headerlink" title="读取IRIS的地震数据"></a>读取IRIS的地震数据</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from pysmo import SacIO</span><br><span class="line">&gt;&gt;&gt; my_sac = SacIO.from_iris(</span><br><span class="line">&gt;&gt;&gt;             net=&quot;C1&quot;,</span><br><span class="line">&gt;&gt;&gt;             sta=&quot;VA01&quot;,</span><br><span class="line">&gt;&gt;&gt;             cha=&quot;BHZ&quot;,</span><br><span class="line">&gt;&gt;&gt;             loc=&quot;--&quot;,</span><br><span class="line">&gt;&gt;&gt;             start=&quot;2021-03-22T13:00:00&quot;,</span><br><span class="line">&gt;&gt;&gt;             duration=1 * 60 * 60,</span><br><span class="line">&gt;&gt;&gt;             scale=&quot;AUTO&quot;,</span><br><span class="line">&gt;&gt;&gt;             demean=&quot;true&quot;,</span><br><span class="line">&gt;&gt;&gt;             force_single_result=True)</span><br><span class="line">&gt;&gt;&gt; my_sac.npts</span><br><span class="line">144001</span><br></pre></td></tr></table></figure>


<h1 id="sacpy"><a href="#sacpy" class="headerlink" title="sacpy"></a>sacpy</h1><h2 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h2><p>使用pip即可</p>
<pre><code>pip install sacpy
</code></pre>
<h1 id="pyrocko"><a href="#pyrocko" class="headerlink" title="pyrocko"></a>pyrocko</h1><h1 id="Obspy"><a href="#Obspy" class="headerlink" title="Obspy"></a>Obspy</h1><p>Obspy也可以直接读取sac文件。如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import obspy</span><br><span class="line">import numpy as np</span><br><span class="line">import matplotlib.pyplot as plt</span><br><span class="line"></span><br><span class="line">st = obspy.read(&quot;filename.sac&quot;)</span><br><span class="line">tr=st[0]</span><br><span class="line">print(st)</span><br><span class="line">print(type(st))</span><br><span class="line">print(st[0].data)</span><br><span class="line">print(st[0].stats.delta)</span><br></pre></td></tr></table></figure>
<p>注意： 使用obspy读取得到的为stream格式，该格式是一个列表。需要使用<code>st[0]</code>表示sac的图像数据。</p>
<h2 id="获取基本信息"><a href="#获取基本信息" class="headerlink" title="获取基本信息"></a>获取基本信息</h2><pre><code>st[0].stats
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">      network: NA</span><br><span class="line">      station: BILL</span><br><span class="line">     location: </span><br><span class="line">      channel: LHE</span><br><span class="line">    starttime: 2000-01-14T23:37:10.800000Z</span><br><span class="line">      endtime: 2000-01-15T00:30:29.800000Z</span><br><span class="line">sampling_rate: 1.0</span><br><span class="line">        delta: 1.0</span><br><span class="line">         npts: 3200</span><br><span class="line">        calib: 1.0</span><br><span class="line">      _format: SAC</span><br><span class="line">          sac: AttribDict(&#123;&#x27;delta&#x27;: 1.0, &#x27;depmin&#x27;: -4299.8511, &#x27;depmax&#x27;: 4099.0977, &#x27;b&#x27;: 0.0, &#x27;e&#x27;: 3199.0, &#x27;o&#x27;: 0.0, &#x27;internal0&#x27;: 2.0, &#x27;stla&#x27;: 68.065102, &#x27;stlo&#x27;: 166.45239, &#x27;stdp&#x27;: 0.0, &#x27;evla&#x27;: 25.610001, &#x27;evlo&#x27;: 101.06, &#x27;evdp&#x27;: 33000.0, &#x27;dist&#x27;: 6370.9048, &#x27;az&#x27;: 23.937832, &#x27;baz&#x27;: 257.17334, &#x27;gcarc&#x27;: 57.340527, &#x27;depmen&#x27;: -2.0147384e-06, &#x27;nzyear&#x27;: 2000, &#x27;nzjday&#x27;: 14, &#x27;nzhour&#x27;: 23, &#x27;nzmin&#x27;: 37, &#x27;nzsec&#x27;: 10, &#x27;nzmsec&#x27;: 800, &#x27;nvhdr&#x27;: 6, &#x27;norid&#x27;: 0, &#x27;nevid&#x27;: 0, &#x27;npts&#x27;: 3200, &#x27;iftype&#x27;: 1, &#x27;iztype&#x27;: 9, &#x27;leven&#x27;: 1, &#x27;lpspol&#x27;: 0, &#x27;lovrok&#x27;: 1, &#x27;lcalda&#x27;: 1, &#x27;unused23&#x27;: 0, &#x27;kstnm&#x27;: &#x27;BILL&#x27;, &#x27;kcmpnm&#x27;: &#x27;LHE&#x27;, &#x27;knetwk&#x27;: &#x27;NA&#x27;, &#x27;kevnm&#x27;: &#x27;&#x27;&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="获取采样率"><a href="#获取采样率" class="headerlink" title="获取采样率"></a>获取采样率</h2><pre><code>st[0].stats.delta
</code></pre>
<h1 id="去趋势"><a href="#去趋势" class="headerlink" title="去趋势"></a>去趋势</h1><p>使用：</p>
<pre><code>st=obspy.read(filepath)
st[0].detrend(&#39;polynomial&#39;, order=3) # 进行去趋势，选择为多项式，阶数为3
</code></pre>
<p>去除线性或者多阶趋势。<br>选项1可选：</p>
<ul>
<li>simple<br>Subtracts a linear function defined by first&#x2F;last sample of the trace (uses obspy.signal.detrend.simple()).</li>
<li>linear<br>Fitting a linear function to the trace with least squares and subtracting it (uses scipy.signal.detrend()).</li>
<li>constant or demean<br>Mean of data is subtracted (uses scipy.signal.detrend()).</li>
<li>polynomial<br>Subtracts a polynomial of a given order. (uses obspy.signal.detrend.polynomial()).</li>
<li>spline<br>Subtracts a spline of a given order with a given number of samples between spline nodes.(uses obspy.signal.detrend.spline()).</li>
</ul>
<h1 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h1><h2 id><a href="#" class="headerlink" title></a></h2><p>使用方法</p>
<p>在最后两行：<br>第一行为图所在目录（文件夹），文件为SAC格式。如果不是SAC格式，将被忽略。<br>第二行为：</p>
<ul>
<li>path1 路径 </li>
<li>2 图类型type<ul>
<li>type&#x3D;1 速度图</li>
<li>type&#x3D;2 加速度图<br>均转换为位移图。</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">import numpy</span><br><span class="line">import sacpy</span><br><span class="line">import pysmo</span><br><span class="line"># import pyrocko</span><br><span class="line">import obspy</span><br><span class="line">import numpy as np</span><br><span class="line">import matplotlib.pyplot as plt</span><br><span class="line">from pysmo import SacIO</span><br><span class="line">import os</span><br><span class="line">from obspy.signal.detrend import polynomial  # 去除多阶趋势</span><br><span class="line"></span><br><span class="line">def cusdetrend(filepath, tr, order=3):  # 去趋势</span><br><span class="line"># 文件路径；由读取sac文件得到的trace，即seismogram[0]；执行多项式去趋势的阶数，默认为3阶</span><br><span class="line">    seismogram = tr.copy()</span><br><span class="line">    been_detrend = seismogram.detrend(&#x27;polynomial&#x27;, order=order) # 进行去趋势，选择为多项式，阶数为3</span><br><span class="line">    return been_detrend</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def integral(input_file, dt):  # 执行积分</span><br><span class="line"># 输入文件为列表文件；dt为时间采样间隔</span><br><span class="line">    length = len(input_file)</span><br><span class="line">    output = [0 for i in range(0, length)]</span><br><span class="line">    for i in range(0, length-1):</span><br><span class="line">        if i == 0:</span><br><span class="line">            output[i] = 0</span><br><span class="line">        else:</span><br><span class="line">            time = 0</span><br><span class="line">            for j in range(0, i):</span><br><span class="line">                time = time + (input_file[j]+input_file[j+1])/2*dt</span><br><span class="line">            output[i] = time</span><br><span class="line"></span><br><span class="line">    return output</span><br><span class="line"></span><br><span class="line">def cus2disp(input_file, dt, type): # 转换为位移图， </span><br><span class="line"># 输入文件（列表）；采样时间间隔；输入图形类型（1为速度图，2为加速度图）</span><br><span class="line">    if type == 1:</span><br><span class="line">        outfile = integral(input_file, dt)</span><br><span class="line">    elif type == 2:</span><br><span class="line">        outfile = integral(integral(input_file, dt), dt)</span><br><span class="line">    else:</span><br><span class="line">        print(&#x27;wrong input type!&#x27;)</span><br><span class="line">    return outfile</span><br><span class="line"></span><br><span class="line">def savejpg(filepath, tr, imgtype):  # 绘制图形</span><br><span class="line"># 文件路径；trace；图形类型，目前没有用</span><br><span class="line">    # 调整画布大小，进行绘制</span><br><span class="line">    t = np.arange(0, (tr.stats.npts / tr.stats.sampling_rate), tr.stats.delta)</span><br><span class="line">    fig = plt.figure(1, figsize=(16, 9), dpi=200)</span><br><span class="line">    plt.subplot(2, 1, 2)</span><br><span class="line">    plt.plot(t, tr.data, &#x27;k&#x27;)</span><br><span class="line">    plt.xlabel(&#x27;T(s)&#x27;)</span><br><span class="line">    plt.ylabel(&#x27;Displacement(nm)&#x27;)</span><br><span class="line">    plt.title(&#x27;had detrend&#x27;+&#x27; &#x27;+tr.stats.station+tr.stats.channel)</span><br><span class="line">    # 判断文件是否存在, 存在，则删除文件</span><br><span class="line">    savepath=filepath+&#x27;detrend&#x27;+tr.stats.station+&#x27;_&#x27;+tr.stats.channel+&#x27;.jpg&#x27;</span><br><span class="line">    if(os.path.exists(savepath)):</span><br><span class="line">        os.remove(savepath)</span><br><span class="line">    # 保存</span><br><span class="line">    print(&#x27;###############################&#x27;)</span><br><span class="line">    print(&#x27;saving jpg file.&#x27;)</span><br><span class="line">    plt.savefig(filepath+&#x27;detrend&#x27;+tr.stats.station+&#x27;_&#x27;+tr.stats.channel+&#x27;.jpg&#x27;)</span><br><span class="line">    print(f&#x27;The file has been saved as &#123;filepath&#125;&#123;tr.stats.station&#125;_&#123;tr.stats.channel&#125;.jpg&#x27;)</span><br><span class="line">    print(&#x27;###############################&#x27;)</span><br><span class="line">    # plt.show()</span><br><span class="line">    plt.close(fig)</span><br><span class="line">    plt.close(&#x27;all&#x27;)</span><br><span class="line"></span><br><span class="line">    # 判断文件是否存在, 存在，则删除文件</span><br><span class="line">    savepath=filepath+&#x27;detrend&#x27;+tr.stats.station+&#x27;_&#x27;+tr.stats.channel+&#x27;.sac&#x27;</span><br><span class="line">    if(os.path.exists(savepath)):</span><br><span class="line">        os.remove(savepath)</span><br><span class="line">    print(&#x27;###############################&#x27;)</span><br><span class="line">    print(&#x27;saving sac file...&#x27;)</span><br><span class="line">    tr.write(savepath, format=&#x27;SAC&#x27;)</span><br><span class="line">    print(f&#x27;The file has been saved as &#123;filepath&#125;&#123;tr.stats.station&#125;_&#123;tr.stats.channel&#125;.jpg&#x27;)</span><br><span class="line">    print(&#x27;###############################&#x27;)</span><br><span class="line"></span><br><span class="line">def acc2dis_detrend(path, type):  # 主程序：转换为displacement并去趋势</span><br><span class="line"># 文件路径；type=1 为velo，type=2为acc</span><br><span class="line">    for file_name in os.listdir(path):</span><br><span class="line">        if(file_name[-3:]!=&#x27;SAC&#x27;):  # 避免读取其他文件</span><br><span class="line">            continue</span><br><span class="line">        filepath = path+&#x27;/&#x27;+file_name</span><br><span class="line">        seismogram = obspy.read(filepath)</span><br><span class="line">        trace = seismogram[0]</span><br><span class="line">        # 进行转换,返回值为列表</span><br><span class="line">        trace_data = cus2disp(trace.data, dt=trace.stats.delta, type=type)</span><br><span class="line">        # 列表导入到stream数据中,只有这样才能使用obspy的去趋势函数。</span><br><span class="line">        trace.data = numpy.array(trace_data[0:len(trace_data)-1])</span><br><span class="line">        print(trace.data)</span><br><span class="line">        # 进行去趋势</span><br><span class="line">        detrend_result = cusdetrend(filepath, trace, order=3)  # 进行去趋势。</span><br><span class="line">        # 保存</span><br><span class="line">        if type == 1:</span><br><span class="line">            imgtype = &#x27;velocity(nm/s)&#x27;</span><br><span class="line">        elif type == 2:</span><br><span class="line">            imgtype = &#x27;accelate(nm/s2)&#x27;</span><br><span class="line">        savejpg(filepath, detrend_result, imgtype)</span><br><span class="line"></span><br><span class="line"># 文件所在位置</span><br><span class="line">path1 = &#x27;G:/Pythonworks/Obspy_data_solve/seismogram/0_200acc&#x27;</span><br><span class="line"># 执行</span><br><span class="line">acc2dis_detrend(path1, 2)</span><br></pre></td></tr></table></figure>

<h1 id="归一化"><a href="#归一化" class="headerlink" title="归一化"></a>归一化</h1><h2 id="安装-sklearn-库"><a href="#安装-sklearn-库" class="headerlink" title="安装 sklearn 库"></a>安装 sklearn 库</h2><p>conda 安装：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda install -c anaconda scikit-learn</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhiyuanshi1901.github.io/2023/01/27/mineos%E7%A8%8B%E5%BA%8F%E8%A7%A3%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/01/27/mineos%E7%A8%8B%E5%BA%8F%E8%A7%A3%E6%9E%90/" class="post-title-link" itemprop="url">mineos程序解析</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-01-27 17:46:21" itemprop="dateCreated datePublished" datetime="2023-01-27T17:46:21+08:00">2023-01-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-03-25 19:12:08" itemprop="dateModified" datetime="2023-03-25T19:12:08+08:00">2023-03-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%9C%B0%E9%9C%87%E5%AD%A6%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/" itemprop="url" rel="index"><span itemprop="name">地震学常用软件</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="简要说明"><a href="#简要说明" class="headerlink" title="简要说明"></a>简要说明</h1><p>本文主要对mineos软件运行的程序进行深入解析，尝试理解程序运行的原理。<br>内容均源自mineos软件的程序代码。</p>
<h1 id="minos-bran程序子进程介绍"><a href="#minos-bran程序子进程介绍" class="headerlink" title="minos_bran程序子进程介绍"></a>minos_bran程序子进程介绍</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wmin=max(wmin,0.1d0) ! wmin最小为0.1mhz，此为w最小限制。</span><br><span class="line"></span><br><span class="line">if(lmin.le.0) lmin=1 ! l最小值小于等于0时，l最小值为1</span><br><span class="line">if(jcom.eq.1) then  ! jcom等于1（径向振型）时，l只计算0阶情况</span><br><span class="line">    lmin=0</span><br><span class="line">    lmax=0</span><br><span class="line">end if</span><br></pre></td></tr></table></figure>
<p>w最小为0.1mHz，这是w的最小限制<br>l最小值为1<br>选择计算径向振型时，l只计算基阶，即l&#x3D;0的情况。</p>
<h2 id="model-iin-iout"><a href="#model-iin-iout" class="headerlink" title="model(iin, iout)"></a>model(iin, iout)</h2><h3 id="drspln-i1-i2-x-y-q-f"><a href="#drspln-i1-i2-x-y-q-f" class="headerlink" title="drspln(i1,i2,x,y,q,f)"></a>drspln(i1,i2,x,y,q,f)</h3><p><em>rspln computes cubic spline interpolation coefficients for y(x) between grid points i1 and i2 saving them in q.<br>the interpolation is continuous with continuous first and second derivitives.<br>it agrees exactly with y at grid points and with the three point first derivitives at both end points (i1 and i2).<br>x must be monotonic but if two successive values of x are equal a discontinuity is assumed and<br>seperate interpolation is done on each strictly monotonic segment.<br>the arrays must be dimensioned at least - x(i2), y(i2), q(3,i2), and f(3,i2). f is working storage for rspln.  -rpb</em></p>
<p>rspln在i1与i2点之间计算y(x)的三次样条插值系数，将系数保存到q。<br>插值是连续的，具有连续的一阶和二阶导数。<br>它与网格点处的 y 以及两个端点（i1 和 i2）处的三点一阶导数完全一致。<br>x 必须是单调的，但如果 x 的两个连续值相等，则假定此处为间断面（模型具有莫霍面和古登堡面等），对每个严格单调的部分进行单独插值。（有间断面的情况插值在间断面之间进行）<br>数组的维度必须至少为 - x(i2)、y(i2)、q(3,i2) 和 f(3,i2)。（例如，i1&#x3D;1，i2&#x3D;n（模型节点数），x&#x3D;r，y&#x3D;rho）<br>f 是 rspln 的工作存储器。</p>
<p>示例：</p>
<pre><code>drspln(1,n,r,rho,qro,wrk)
</code></pre>
<p>从点1-n进行对rho(r)的spline插值，结果保存到qro中。<br>wrk为一个工作存储器，存储器可能只是用于存储中间值，无实际含义。（存疑）</p>
<h3 id="grav-g-rho-qro-r-n"><a href="#grav-g-rho-qro-r-n" class="headerlink" title="grav(g,rho,qro,r,n)"></a>grav(g,rho,qro,r,n)</h3><p><em>given rho and spline coeffs,computes gravity</em><br>给定 rho 和样条系数，计算重力。</p>
<p>变量：</p>
<ul>
<li>nsl 地表边界，为固态侧边界。若是具有海洋的地球模型，则nsl为地表与海洋边界的固态侧。</li>
<li>nslp1 地表边界，液态侧。</li>
<li>ncip1 ICB索引液态侧</li>
<li>nocp1 CMB索引固态侧</li>
<li>tref 校正值。&lt;&#x3D;0时无校正。</li>
</ul>
<h2 id="wtable-iout-ioeig-ifreq"><a href="#wtable-iout-ioeig-ifreq" class="headerlink" title="wtable(iout,ioeig,ifreq)"></a>wtable(iout,ioeig,ifreq)</h2><p><em>makes up table of frequencies</em><br>计算本征频率列表</p>
<p>共用区变量：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">common/bits/pi,rn,vn,wn,w,wsq,wray,qinv,cg,wgrav,tref,fct,eps,fl,</span><br><span class="line">  +  fl1,fl2,fl3,sfl3,jcom,nord,l,kg,kount,knsw,ifanis,iback</span><br><span class="line">   common/shanks/b(46),c(10),dx,step(8),stepf,maxo,in</span><br><span class="line">   common/mtab/we(2),de(2),ke(2),wtry,bm</span><br></pre></td></tr></table></figure>
<ul>
<li>iout 输出模型列表文件单元号</li>
<li>ioeig 输出本征函数文件单元号</li>
<li>ifreq &#x3D;0时不输出本征函数文件</li>
</ul>
<h3 id="steps-eps"><a href="#steps-eps" class="headerlink" title="steps(eps)"></a>steps(eps)</h3><p>计算8个无量纲step大小for rks integration积分</p>
<ul>
<li>eps 输入的eps，即准确度大小。</li>
</ul>
<h3 id="detqn-wdim-knt-det-ifeif"><a href="#detqn-wdim-knt-det-ifeif" class="headerlink" title="detqn(wdim,knt,det,ifeif)"></a>detqn(wdim,knt,det,ifeif)</h3><p><em>supevises the integration of the equations,it returns the value<br>of the secular determinant as det and the count of zero crossings</em><br>假设方程的积分，它返回行列式形式的secular dterminant的值（det）和零交点数量。</p>
<ul>
<li>wdim 一个二维数组，为最小和最大本征频率计算范围</li>
<li>knt 零交叉点数量</li>
<li>det 长期行列式的值</li>
<li>ifeif</li>
</ul>
<p>共用区变量：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> common r(mk),fmu(mk),flam(mk),qshear(mk),qkappa(mk),</span><br><span class="line">+ xa2(mk),xlam(mk),rho(mk),qro(3,mk),g(mk),qg(3,mk),</span><br><span class="line">+ fcon(mk),fspl(3,mk),lcon(mk),lspl(3,mk),ncon(mk),</span><br><span class="line">+ nspl(3,mk),ccon(mk),cspl(3,mk),acon(mk),aspl(3,mk)</span><br><span class="line"> common/bits/pi,rn,vn,wn,w,wsq,wray,qinv,cg,wgrav,tref,fct,eps,fl,</span><br><span class="line">+  fl1,fl2,fl3,sfl3,jcom,nord,l,kg,kount,knsw,ifanis,iback</span><br><span class="line"> common/eifx/a(14,mk),dum(mk)</span><br><span class="line"> common/rindx/nic,noc,nsl,nicp1,nocp1,nslp1,n</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">print *,&#x27;eigenfunction file (output):&#x27;</span><br><span class="line">read(5,100) filnam</span><br><span class="line">print *,filnam(1:lnblnk(filnam))</span><br><span class="line">ifreq=1</span><br><span class="line">if(filnam(1:4).eq.&#x27;none&#x27;) ifreq=0 ! 如果filnam前四个字符为none，则ifreq=0</span><br><span class="line">open(3,file=filnam,form=&#x27;unformatted&#x27;,iostat=iret)</span><br></pre></td></tr></table></figure>
<p>这里说明了ifreq的来历。当本征函数文件（eigenfunction file）名前四个字符为none时，ifreq&#x3D;0，将不再计算本征函数文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(ifeif.eq.0) return</span><br></pre></td></tr></table></figure>
<p>该语句表明ifreq在detqn子进程中为ifeif参数。当ifreq&#x3D;0时，即本征函数文件名为：’none*’时不再输出本征函数文件（文件为空）。</p>
<h4 id="sdepth-wdim-ls"><a href="#sdepth-wdim-ls" class="headerlink" title="sdepth(wdim,ls)"></a>sdepth(wdim,ls)</h4><p>finds starting level,ls, for a given l and w<br>对于给定的l和w寻找开始的层ls</p>
<h4 id="fprpmn-jf-jl-f-h-nvefm-iexp"><a href="#fprpmn-jf-jl-f-h-nvefm-iexp" class="headerlink" title="fprpmn(jf,jl,f,h,nvefm,iexp)"></a>fprpmn(jf,jl,f,h,nvefm,iexp)</h4><p>propagate the minor vector in a fluid region from level jf to jl<br>在流体区域从jf层到jl层传播minor vector</p>
<h5 id="zknt-s-sp-f-fp-x-y-ifsol"><a href="#zknt-s-sp-f-fp-x-y-ifsol" class="headerlink" title="zknt(s,sp,f,fp,x,y,ifsol)"></a>zknt(s,sp,f,fp,x,y,ifsol)</h5><p>zknt(s,h,f,fp,x,y,1)</p>
<p>给定次向量和导数，构造模式计数</p>
<h4 id="remedy-ls"><a href="#remedy-ls" class="headerlink" title="remedy(ls)"></a>remedy(ls)</h4><p>Obtains the eigenfunction of an awkward spheroidal mode by integrating to the icb or the mcb.<br>通过积分到ICB或CMB得到一个不合适的（awkward）球振振型的本征函数</p>
<h5 id="fprop-jf-jl-f-iexp"><a href="#fprop-jf-jl-f-iexp" class="headerlink" title="fprop(jf,jl,f,iexp)"></a>fprop(jf,jl,f,iexp)</h5><p><em>fprop propagates the fundamental matrix f from jf to jl (a fluid region)</em><br>fprop 将基本矩阵 f 从 jf 传播到 jl（流体区域）</p>
<p>示例：</p>
<pre><code>fprop(noc,nicp1,af,iexp)
# 该函数位于2515行左右，表示地壳上海洋部分基本矩阵af的传播。
</code></pre>
<h5 id="fsbdry-af-as-kg"><a href="#fsbdry-af-as-kg" class="headerlink" title="fsbdry(af,as,kg)"></a>fsbdry(af,as,kg)</h5><p><em>fsbdry creates solid fundamental matrix as from fluid fundamental matrix af.<br>It is presumed that fsbdry is used to cross a f&#x2F;s boundary.</em></p>
<p>fsbdry 从流体基本矩阵 af 创建固体基本矩阵 as。<br>假定 fsbdry函数 用于跨越 f&#x2F;s 边界。</p>
<h5 id="sprop-li-jf-jl-f-iexp"><a href="#sprop-li-jf-jl-f-iexp" class="headerlink" title="sprop(li,jf,jl,f,iexp)"></a>sprop(li,jf,jl,f,iexp)</h5><p>sprop propagates the fundamental matrix f from jf to jl (a solid region)<br>if jorth&#x3D;1 the columns of f are orthogonalized at each level except in regions of oscillatory p and s.</p>
<p>sprop 将基本矩阵 f 从 jf 传播到jl（实心区域） 如果jnorth&#x3D;1，f的列在除振荡 p 和 s 区域之外的每个层（level）上都是正交的。</p>
<h6 id="ortho-li-lc-b-kg"><a href="#ortho-li-lc-b-kg" class="headerlink" title="ortho(li,lc,b,kg)"></a>ortho(li,lc,b,kg)</h6><p>Finds the orthogonal matrix v such that the columns of b<em>v are orthogonal,<br>the array a is replaced by a</em>v for levels li - lc.<br>Array b is replaced by b*v and is then ready for entry to sprop at level lc.<br>This is intended to diminish the onset of degeneracy caused by rapid exponential<br>growth in the mantle for modes with deeply turning S and shallowly turning P.</p>
<p>找到正交矩阵 v，使得 b<em>v 的列是正交的，对于层 li 至 lc，数组 a 被 a</em>v 替换。<br>数组 b 被 b*v 替换，然后准备好进入 lc 层的 sprop。这是为了减少由深度旋转 S 和<br>浅度旋转 P 的模式在地幔中快速指数增长引起的退化的开始。</p>
<h5 id="sfbdry-jf-jl-as-af-kg"><a href="#sfbdry-jf-jl-as-af-kg" class="headerlink" title="sfbdry(jf,jl,as,af,kg)"></a>sfbdry(jf,jl,as,af,kg)</h5><p><em>The tangential traction scalar is forced to vanish at the solid side of a s&#x2F;f boundary(level jl).<br>a(j,3,i) is elliminated for i&#x3D;jf…jl and af is loaded from a at level jl.</em><br>切向牵引标量在 s&#x2F;f 边界的实体侧（水平 jl）消失。 a(j,3,i) 对于 i&#x3D;jf…jl 被消除并且 af 从 a 在级别 jl 加载。</p>
<h5 id="baylis-q-maxo1"><a href="#baylis-q-maxo1" class="headerlink" title="baylis(q,maxo1)"></a>baylis(q,maxo1)</h5><p><em>baylis returns the coefficients for rks integration.<br>see e. baylis shanks(1966 a. m. s.) and references therein for the coefficients.<br>the eight runge-kutta-shanks formulae are (1-1) (2-2) (3-3) (4-4) (5-5) (6-6) (7-7) (8-10).<br>for orders greater than 4 the formulae are approximate rather than exact so incurring less roundoff.</em></p>
<p>baylis 返回 rks 积分的系数。 见e. baylis shanks（1966 a. m. s.）及其中的系数参考。<br>八runge-kutta-shanks公式是 (1-1) (2-2) (3-3) (4-4) (5-5) (6-6) (7-7) (8-10)。<br>对于大于 4 的阶数，公式是近似的而不是精确的，因此产生的舍入较少。</p>
<h5 id="match-n-j-kg-af-afr-icomp"><a href="#match-n-j-kg-af-afr-icomp" class="headerlink" title="match(n,j,kg,af,afr,icomp)"></a>match(n,j,kg,af,afr,icomp)</h5><p><em>Matches boundary conditions during downward integration – first try is at cmb, second try is at icb.</em><br>在向下积分时符合边界条件——第一次尝试在 cmb，第二次尝试在 icb。</p>
<h4 id="eifout-lsmin"><a href="#eifout-lsmin" class="headerlink" title="eifout(lsmin)"></a>eifout(lsmin)</h4><p><em>massages spheroidal mode eigenfunctions before output</em><br>在输出前“修改”球振振型本征函数</p>
<h3 id="rotspl-eps1-wt-iout-ioeig-ifreq-ncall"><a href="#rotspl-eps1-wt-iout-ioeig-ifreq-ncall" class="headerlink" title="rotspl(eps1,wt,iout,ioeig,ifreq,ncall)"></a>rotspl(eps1,wt,iout,ioeig,ifreq,ncall)</h3><p>通过样条差值查找roots</p>
<p>kchar 1s 2t 3s 4c</p>
<ul>
<li>eps1 输入的频率准确度控制参数eps</li>
<li>wt 两个元素的数组：wmin和wmax</li>
<li>iout 输出模型文件的单元号</li>
<li>ioeig 输出本征函数文件的单元号</li>
<li>ifreq 与本征函数文件名有关。前四个字符为none时为0,输出缺少qmod和wdiff（q和动能与势能之比-1）,其他时候为1。</li>
<li>ncall 一个有关计数的参数</li>
</ul>
<h3 id="gauslv-r1-r2-iq-fint-nint"><a href="#gauslv-r1-r2-iq-fint-nint" class="headerlink" title="gauslv(r1,r2,iq,fint,nint)"></a>gauslv(r1,r2,iq,fint,nint)</h3><p>fifth order gauss-legendre integration<br>五阶高斯-勒让德积分。</p>
<h4 id="intgds-rr-iq-vals"><a href="#intgds-rr-iq-vals" class="headerlink" title="intgds(rr,iq,vals)"></a>intgds(rr,iq,vals)</h4><p>interpolates integrands for normalisation,cg,q etc..for use with gauslv<br>插值积分以进行归一化、cg、q等，gauslv使用该�</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhiyuanshi1901.github.io/2023/01/26/%E5%9C%B0%E9%9C%87%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%96%B9%E6%B3%95%E5%AE%9E%E8%AE%AD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/01/26/%E5%9C%B0%E9%9C%87%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%96%B9%E6%B3%95%E5%AE%9E%E8%AE%AD/" class="post-title-link" itemprop="url">地震数据处理方法实训</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-01-26 22:18:21" itemprop="dateCreated datePublished" datetime="2023-01-26T22:18:21+08:00">2023-01-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-03-04 11:58:40" itemprop="dateModified" datetime="2023-03-04T11:58:40+08:00">2023-03-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E4%BD%9C%E4%B8%9A%E5%B8%83%E7%BD%AE/" itemprop="url" rel="index"><span itemprop="name">作业布置</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="褶积滤波"><a href="#褶积滤波" class="headerlink" title="褶积滤波"></a>褶积滤波</h1><p>这里使用的子进程为实训手册中已有的子进程。<br>计算使用FORTRAN。<br>绘图使用MATLAB。</p>
<p>使用理想低通滤波器和带通滤波器进行滤波。对应滤波保留的频率范围为：<br>低通滤波器：0-70Hz<br>带通滤波器：10-80Hz</p>
<p>均使用时域下的滤波因子得到滤波器，所有滤波过程在时域之下进行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">program ch1_conv_fliter</span><br><span class="line">real, dimension(100) :: X,r_low_end=0., coun=[(i,i=1,100)],r_band_end=0.</span><br><span class="line">real,dimension (101) :: h_low=0., h_band=0., t1</span><br><span class="line">real,dimension (101+100-1) :: r_low=0., r_band=0.</span><br><span class="line">real :: wc1=70.0,wc2=10.0,wc3=80.0 ! 滤波器的滤波边界</span><br><span class="line">complex, dimension(100,2) :: C   ! 定义一个复数数组C，用于表示X。</span><br><span class="line">character(10) :: filename=&#x27;INPUT1.DAT&#x27;</span><br><span class="line">integer :: i, num=100</span><br><span class="line">real, parameter :: pi=3.1415926535, dt=2</span><br><span class="line">! 读取input1的数据并输出到屏幕</span><br><span class="line">open(1, file=filename, form=&#x27;formatted&#x27;, status=&#x27;old&#x27;)</span><br><span class="line">read (1,*)(X(i), i=1,100)</span><br><span class="line">print *,&#x27;################################################&#x27;</span><br><span class="line">print *,&#x27;This is the data in the &#x27;,filename ,&#x27;.&#x27;</span><br><span class="line">print *,&#x27;################################################&#x27;</span><br><span class="line">do i=1,100</span><br><span class="line">PRINT *,X(i)</span><br><span class="line">end do</span><br><span class="line">print *,&#x27;################################################&#x27;</span><br><span class="line"></span><br><span class="line">! 理想低通滤波器</span><br><span class="line">low_pass_fliter: do i=1,101</span><br><span class="line">t1(i) = dt*(i-100/2-1)/1000.</span><br><span class="line">! t1(i) = dt*(i-1)/1000.</span><br><span class="line">	if ((t1(i).lt.0.0001) .and. (t1(i).gt.-0.0001)) then</span><br><span class="line">	h_low(i)=2*pi*wc1/pi</span><br><span class="line">	else</span><br><span class="line">	h_low(i)=sin(2*pi*wc1*t1(i))/(pi*t1(i))</span><br><span class="line">	endif</span><br><span class="line">end do low_pass_fliter</span><br><span class="line"></span><br><span class="line">call CON(X,h_low,r_low,100,101,100+101-1)</span><br><span class="line">! 得到最后的输出，r_low_end为最终的滤波结果</span><br><span class="line">do i=1,100</span><br><span class="line">r_low_end(i)=r_low(i+50)</span><br><span class="line">end do</span><br><span class="line"></span><br><span class="line">print *,&#x27;################################################&#x27;</span><br><span class="line">print *,&#x27;This is the last result, low pass 70.&#x27;</span><br><span class="line">print *,&#x27;################################################&#x27;</span><br><span class="line">do i=1,100</span><br><span class="line">PRINT *,r_low_end(i)</span><br><span class="line">end do</span><br><span class="line">print *,&#x27;################################################&#x27;</span><br><span class="line">! 写入70HZ低通滤波器结果</span><br><span class="line">! open(2,file=&#x27;con_low_filter_70.dat&#x27;, status=&#x27;replace&#x27;, action=&#x27;write&#x27;)</span><br><span class="line">! write_70: do i=1,100</span><br><span class="line">! 	write(2,100) coun(i),r_low_end(i)</span><br><span class="line">	</span><br><span class="line">! end do write_70</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">! 理想带通滤波器</span><br><span class="line">band_pass_fliter: do i=1,101</span><br><span class="line">	if ((t1(i).lt.0.0001) .and. (t1(i).gt.-0.0001)) then</span><br><span class="line">	h_band(i)=2*pi*(wc3-wc2)/pi</span><br><span class="line">	else</span><br><span class="line">	h_band(i)=sin(2*pi*wc3*t1(i))/(pi*t1(i))-sin(2*pi*wc2*t1(i))/(pi*t1(i))</span><br><span class="line">	endif</span><br><span class="line">end do band_pass_fliter</span><br><span class="line"></span><br><span class="line">call CON(X,h_band,r_band,100,101,100+101-1)</span><br><span class="line">! 得到最后的输出，r_band_end为最终的滤波结果</span><br><span class="line">do i=1,100</span><br><span class="line">r_band_end(i)=r_band(i+50)</span><br><span class="line">end do</span><br><span class="line"></span><br><span class="line">print *,&#x27;################################################&#x27;</span><br><span class="line">print *,&#x27;This is the last result，band pass 80-10hz&#x27;</span><br><span class="line">print *,&#x27;################################################&#x27;</span><br><span class="line">do i=1,100</span><br><span class="line">PRINT *,r_band_end(i)</span><br><span class="line">end do</span><br><span class="line">print *,&#x27;################################################&#x27;</span><br><span class="line">! 写入滤波器结果</span><br><span class="line">open(3,file=&#x27;ch1_result.dat&#x27;, status=&#x27;replace&#x27;, action=&#x27;write&#x27;)</span><br><span class="line">! write(3,*) &quot;number,origin,low_pass_70,band_pass_80_10&quot;</span><br><span class="line">write_8: do i=1,100</span><br><span class="line">	write(3,100) coun(i),(i-1.)*dt ,X(i),r_low_end(i),r_band_end(i) ! number,t,origin,low_pass_70,band_pass_80_10</span><br><span class="line">100 format(F4.0,X,F6.0,x,2(F14.7,X), F14.7)</span><br><span class="line">end do write_8</span><br><span class="line">! 未经过截取的数据</span><br><span class="line">open(4,file=&#x27;ch1_result_no.dat&#x27;, status=&#x27;replace&#x27;, action=&#x27;write&#x27;)</span><br><span class="line">! write(3,*) &quot;number,origin,low_pass_70,band_pass_80_10&quot;</span><br><span class="line">write_9: do i=1,200</span><br><span class="line">	write(4,200) (i-1.)*dt ,r_low(i),r_band(i) ! number,t,origin,low_pass_70,band_pass_80_10</span><br><span class="line">200 format(2(F14.7,X), F14.7)</span><br><span class="line">end do write_9</span><br><span class="line"></span><br><span class="line">end program ch1_conv_fliter</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SUBROUTINE DFT(N,C,S)</span><br><span class="line">	COMPLEX C(N),Y(512),W</span><br><span class="line">	IF(S.EQ.1.0)Z=1.0</span><br><span class="line">	IF(S.EQ.-1.0)Z=1.0/FLOAT(N)</span><br><span class="line">	DO 20 I=1,N</span><br><span class="line">	Y(I)=(0.0,0.0)</span><br><span class="line">	DO 20 J=1,N</span><br><span class="line">	A=COS(2.0*3.14159265*(I-1)*(J-1)/FLOAT(N))</span><br><span class="line">	B=SIN(2.0*3.14159265*(I-1)*(J-1)/FLOAT(N))*(-S)</span><br><span class="line">	W=CMPLX(A,B)</span><br><span class="line"> 20	Y(I)=Y(I)+C(J)*W</span><br><span class="line">	DO 30 I=1,N</span><br><span class="line"> 30	C(I)=Y(I)*Z</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br><span class="line"></span><br><span class="line">	SUBROUTINE CON(A,B,C,I,J,K)</span><br><span class="line">	DIMENSION A(I),B(J),C(K)</span><br><span class="line">	DO 1 K1=1,K</span><br><span class="line">  1	C(K1)=0.0</span><br><span class="line">	DO 2 I1=1,I</span><br><span class="line">	DO 2 I2=1,J</span><br><span class="line">	II=I1+I2-1</span><br><span class="line">  2	C(II)=C(II)+A(I1)*B(I2)*0.004</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gfortran ch1_conv_fliter  # 编译</span><br><span class="line">./a.out # 执行</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">clear</span><br><span class="line">load ch1_result.dat</span><br><span class="line">load ch1_result_no.dat</span><br><span class="line">figure(1)</span><br><span class="line">hold on</span><br><span class="line">subplot(3,1,1)</span><br><span class="line">plot(ch1_result(:,2), ch1_result(:,3))</span><br><span class="line">title(&#x27;Origin&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(3,1,2)</span><br><span class="line">plot(ch1_result(:,2), ch1_result(:,4))</span><br><span class="line">title(&#x27;low_pass-70&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(3,1,3)</span><br><span class="line">plot(ch1_result(:,2), ch1_result(:,5))</span><br><span class="line">title(&#x27;band_pass_10-80&#x27;)</span><br><span class="line"></span><br><span class="line">figure(2)</span><br><span class="line">hold on</span><br><span class="line">subplot(3,1,2)</span><br><span class="line">plot(ch1_result_no(:,1), ch1_result_no(:,2))</span><br><span class="line">title(&#x27;low_pass-70&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(3,1,3)</span><br><span class="line">plot(ch1_result_no(:,1), ch1_result_no(:,3))</span><br><span class="line">title(&#x27;band_pass_10-80&#x27;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="快变滤波"><a href="#快变滤波" class="headerlink" title="快变滤波"></a>快变滤波</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br></pre></td><td class="code"><pre><span class="line">program ch2_fliter</span><br><span class="line">real, dimension(100) :: X</span><br><span class="line">real, dimension(:), allocatable:: X_fft_output,H_low,H_band,X_real, X_image</span><br><span class="line">COMPLEX, dimension(:), allocatable:: C, C_low,C_band ! 定义一个复数数组C，用于表示X。C_low表示使用低通滤波器得到的最终频率域数据。</span><br><span class="line">real, dimension(:,:), allocatable:: X_low, X_band</span><br><span class="line">real :: wc1=70.0,wc2=10.0,wc3=80.0,dt=2.  ! 滤波器的滤波边界! 采样间隔2ms</span><br><span class="line">character(10) :: filename=&#x27;INPUT1.DAT&#x27;</span><br><span class="line">integer :: i, num=100, nfft ! 频率域采样间隔</span><br><span class="line">real, parameter :: pi=3.1415926535 </span><br><span class="line">real :: df, k, f</span><br><span class="line">! 读取input1的数据并输出到屏幕</span><br><span class="line">open(1, file=filename, form=&#x27;formatted&#x27;, status=&#x27;old&#x27;)</span><br><span class="line">read (1,*)(X(i), i=1,100)</span><br><span class="line">print *,&#x27;################################################&#x27;</span><br><span class="line">print *,&#x27;This is the data in the &#x27;,filename ,&#x27;.&#x27;</span><br><span class="line">print *,&#x27;################################################&#x27;</span><br><span class="line">do i=1,100</span><br><span class="line">PRINT *,X(i)</span><br><span class="line">end do</span><br><span class="line">print *,&#x27;################################################&#x27;</span><br><span class="line"></span><br><span class="line">! 创建文件,输出原始数据</span><br><span class="line">open(unit=10, status=&#x27;replace&#x27;,action=&#x27;write&#x27;, file=&#x27;ch2_result.dat&#x27;)</span><br><span class="line">! write(10,*)&#x27;Origin data of seis.&#x27;</span><br><span class="line">! write(10,*)&#x27;t(ms),amplitude&#x27;</span><br><span class="line">do i=1,num</span><br><span class="line">t=(i-1)*dt</span><br><span class="line">! write(10,300) t,X(i)</span><br><span class="line">enddo</span><br><span class="line">300 format(F4.0,&#x27;,&#x27;,F15.6)</span><br><span class="line"></span><br><span class="line">dt=dt/1000. ! 转换单位为s</span><br><span class="line">! 计算FFT点数</span><br><span class="line">k=log(real(num))/log(2.)</span><br><span class="line">if(num .gt. 2**k) k=int(k+1)</span><br><span class="line">nfft=2**k</span><br><span class="line">print *, &#x27;FFT点数为：&#x27;,nfft</span><br><span class="line">! 定义可变数组大小</span><br><span class="line">allocate(X_fft_output(nfft),H_low(nfft),H_band(nfft),X_real(nfft), X_image(nfft))</span><br><span class="line">allocate(C(nfft), C_low(nfft),C_band(nfft),X_low(nfft,2), X_band(nfft,2))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">! 频率域采样间隔</span><br><span class="line">df=1./(nfft*dt)</span><br><span class="line">print *, &#x27;频率域采样间隔为：&#x27;, df ,&#x27;HZ&#x27;</span><br><span class="line"></span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line">print *, &#x27;数据重组,为了使用fft将输入数据补零&#x27;</span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line">! 进行数据重组，将X转换为fft需要的数组C</span><br><span class="line">real_to_complex: do i=1,nfft</span><br><span class="line">if (i.le.num) then</span><br><span class="line">	C(i)=CMPLX(X(i), 0.0)</span><br><span class="line">else</span><br><span class="line">	C(i)=CMPLX(0.0, 0.0)</span><br><span class="line">endif</span><br><span class="line">end do real_to_complex</span><br><span class="line"></span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line">print *,&#x27;补零后的复数数组：&#x27;</span><br><span class="line">print *, C</span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line"></span><br><span class="line">! 进行FFT</span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line">print *, &#x27;执行FFT&#x27;</span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line">call FFT(nfft,C,1.0)</span><br><span class="line">! 得到实部和虚部</span><br><span class="line">complex_to_real: do i=1,nfft</span><br><span class="line"> 	X_real(i)=real(C(i))</span><br><span class="line">	X_image(i)=aimag(C(i))</span><br><span class="line">end do complex_to_real</span><br><span class="line">print *,&#x27;FFT后的频谱数据。&#x27;</span><br><span class="line">print *,&#x27;-real-------------------------------------------&#x27;</span><br><span class="line">print *, X_real</span><br><span class="line">print *,&#x27;-image-------------------------------------------&#x27;</span><br><span class="line">print *, X_image</span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line"></span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line">print *, &#x27;设计滤波器&#x27;</span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line"></span><br><span class="line">! 设置频率域滤波器</span><br><span class="line">! 低通滤波器</span><br><span class="line">low_pass_filter: do i=1,(nfft/2+1)</span><br><span class="line">	f=(i-1)*df</span><br><span class="line">	if((f.le.wc1).and.(f.ge.(-wc1))) then </span><br><span class="line">		H_low(i)=1.</span><br><span class="line">	else</span><br><span class="line">		H_low(i)=0.</span><br><span class="line">	end if</span><br><span class="line">end do low_pass_filter</span><br><span class="line">low_pass_filter2: do i=(nfft/2)+2,nfft</span><br><span class="line">	f=(i-1)*df</span><br><span class="line">	H_low(i)=H_low(nfft-i+2)</span><br><span class="line">end do low_pass_filter2</span><br><span class="line"></span><br><span class="line">! 带通滤波器</span><br><span class="line">band_pass_filter: do i=1,(nfft/2+1)</span><br><span class="line">	f=(i-1)*df</span><br><span class="line">	if((f.le.wc3.and.f.ge.wc2) .or. (f.ge.(-wc3).and.(f.le.(-wc2)))) then </span><br><span class="line">		H_band(i)=1.</span><br><span class="line">	else</span><br><span class="line">		H_band(i)=0.</span><br><span class="line">	end if</span><br><span class="line">end do band_pass_filter</span><br><span class="line">band_pass_filter2: do i=(nfft/2)+2,nfft</span><br><span class="line">	f=(i-1)*df</span><br><span class="line">	H_band(i)=H_band(nfft-i+2)</span><br><span class="line">end do band_pass_filter2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">100 format(I4, &#x27;,&#x27; , 3(f15.6,&#x27;,&#x27;),f15.6)</span><br><span class="line">! 进行频率域滤波</span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line">print *, &#x27;执行频率域滤波&#x27;</span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line">! 低通滤波,得到频率域结果</span><br><span class="line">! write(10,*) &quot;low pass frequency&quot;</span><br><span class="line">! write(10,*) &quot;i,frequence,real,image,amplitude&quot;</span><br><span class="line">do i=1,nfft</span><br><span class="line">	f=(i-1)*df</span><br><span class="line">	X_low(i,1)=X_real(i)*H_low(i)</span><br><span class="line">	X_low(i,2)=X_image(i)*H_low(i)</span><br><span class="line">	f=(i-1)*df</span><br><span class="line">	amp=sqrt(X_low(i,1)*X_low(i,1)+X_low(i,2)*X_low(i,2))*dt</span><br><span class="line">	! write(10,100) i, f, X_low(i,1),X_low(i,2),amp</span><br><span class="line">	C_low(i)=complex(X_low(i,1),X_low(i,2)) ! 将X转化为复数数组</span><br><span class="line">enddo </span><br><span class="line"></span><br><span class="line">! 带通滤波,得到频率域结果</span><br><span class="line">! write(10,*) &quot;band pass frequency&quot;</span><br><span class="line">! write(10,*) &quot;i,frequence,real,image,amplitude&quot;</span><br><span class="line">do i=1,nfft</span><br><span class="line">	f=(i-1)*df</span><br><span class="line">	X_band(i,1)=X_real(i)*H_band(i)</span><br><span class="line">	X_band(i,2)=X_image(i)*H_band(i)</span><br><span class="line">	f=(i-1)*df</span><br><span class="line">	amp=sqrt(X_band(i,1)*X_band(i,1)+X_band(i,2)*X_band(i,2))*dt</span><br><span class="line">	! write(10,100) i, f, X_band(i,1),X_band(i,2),amp</span><br><span class="line">	C_band(i)=complex(X_band(i,1),X_band(i,2)) ! 将X转化为复数数组</span><br><span class="line">enddo </span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line">print *, &#x27;频率域滤波执行完成&#x27;</span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">! write(10,*) &quot;low pass time&quot;</span><br><span class="line">! write(10,*) &quot;i,time(ms),origin, amplitude_low,amplitude_band&quot;</span><br><span class="line"></span><br><span class="line">! 进行反FFT</span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line">print *, &#x27;执行反FFT变换，得到时间域&#x27;</span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line">call FFT(nfft,C_low,-1.0)</span><br><span class="line">call FFT(nfft,C_band,-1.0)</span><br><span class="line"></span><br><span class="line">do i=1,num</span><br><span class="line">t=(i-1)*dt*1000.</span><br><span class="line">write(10,200) i, t, X(i), real(C_low(i)), real(C_band(i))</span><br><span class="line">enddo</span><br><span class="line">200 format(I4,x,F15.6,x,2(F15.6,x),F15.6)</span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line">print *, &#x27;写入完成&#x27;</span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">deallocate(X_fft_output)</span><br><span class="line">end program ch2_fliter</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SUBROUTINE DFT(N,C,S)</span><br><span class="line">	COMPLEX C(N),Y(512),W</span><br><span class="line">	IF(S.EQ.1.0)Z=1.0</span><br><span class="line">	IF(S.EQ.-1.0)Z=1.0/FLOAT(N)</span><br><span class="line">	DO 20 I=1,N</span><br><span class="line">	Y(I)=(0.0,0.0)</span><br><span class="line">	DO 20 J=1,N</span><br><span class="line">	A=COS(2.0*3.14159265*(I-1)*(J-1)/FLOAT(N))</span><br><span class="line">	B=SIN(2.0*3.14159265*(I-1)*(J-1)/FLOAT(N))*(-S)</span><br><span class="line">	W=CMPLX(A,B)</span><br><span class="line"> 20	Y(I)=Y(I)+C(J)*W</span><br><span class="line">	DO 30 I=1,N</span><br><span class="line"> 30	C(I)=Y(I)*Z</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br><span class="line"></span><br><span class="line">	SUBROUTINE CON(A,B,C,I,J,K)</span><br><span class="line">	DIMENSION A(I),B(J),C(K)</span><br><span class="line">	DO 1 K1=1,K</span><br><span class="line">  1	C(K1)=0.0</span><br><span class="line">	DO 2 I1=1,I</span><br><span class="line">	DO 2 I2=1,J</span><br><span class="line">	II=I1+I2-1</span><br><span class="line">  2	C(II)=C(II)+A(I1)*B(I2)*0.004</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br><span class="line"></span><br><span class="line">	SUBROUTINE FFT(LX,CX,SIGNI)</span><br><span class="line">	COMPLEX CX(LX),CARG,CEXP,CW,CTEMP</span><br><span class="line">	J=1</span><br><span class="line">	SC=1.0/LX</span><br><span class="line">	IF(SIGNI.EQ.1.0)SC=1.0</span><br><span class="line">	SIG=-SIGNI</span><br><span class="line">	DO 30 I=1,LX</span><br><span class="line">	IF(I.GT.J)GO TO 10</span><br><span class="line">	CTEMP=CX(J)*SC</span><br><span class="line">	CX(J)=CX(I)*SC</span><br><span class="line">	CX(I)=CTEMP</span><br><span class="line"> 10     M=LX/2</span><br><span class="line"> 20	IF(J.LE.M)GO TO 30</span><br><span class="line">	J=J-M</span><br><span class="line">	M=M/2</span><br><span class="line">	IF(M.GE.1)GO TO 20</span><br><span class="line"> 30	J=J+M</span><br><span class="line">	L=1</span><br><span class="line"> 40	ISTEP=2*L</span><br><span class="line">	DO 50 M=1,L</span><br><span class="line">	CARG=(0.0,1.0)*(3.14159265*SIG*(M-1))/L</span><br><span class="line">	CW=CEXP(CARG)</span><br><span class="line">	DO 50 I=M,LX,ISTEP</span><br><span class="line">	CTEMP=CW*CX(I+L)</span><br><span class="line">	CX(I+L)=CX(I)-CTEMP</span><br><span class="line"> 50	CX(I)=CX(I)+CTEMP</span><br><span class="line">	L=ISTEP</span><br><span class="line">	IF(L.LT.LX)GO TO 40</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">clear</span><br><span class="line">load ch2_result.dat</span><br><span class="line"></span><br><span class="line">figure(2)</span><br><span class="line">hold on</span><br><span class="line">subplot(3,1,1)</span><br><span class="line">plot(ch2_result(:,2), ch2_result(:,3))</span><br><span class="line">title(&#x27;Origin&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(3,1,2)</span><br><span class="line">plot(ch2_result(:,2), ch2_result(:,4))</span><br><span class="line">title(&#x27;lowpass 70&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(3,1,3)</span><br><span class="line">plot(ch2_result(:,2), ch2_result(:,5))</span><br><span class="line">title(&#x27;bandpass 10-80&#x27;)</span><br></pre></td></tr></table></figure>

<h1 id="褶积滤波与递归滤波的比较"><a href="#褶积滤波与递归滤波的比较" class="headerlink" title="褶积滤波与递归滤波的比较"></a>褶积滤波与递归滤波的比较</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line">program ch3_compare</span><br><span class="line">implicit none</span><br><span class="line">real :: sum_ax, sum_bx</span><br><span class="line">real, dimension(50) :: X, con_fliter_result_end, con_fliter_zero_result_end, X_digui, X_digui_zero</span><br><span class="line">real, parameter :: dt=2</span><br><span class="line">! 褶积滤波的滤波因子</span><br><span class="line">real, dimension(21) :: hn,hn_r</span><br><span class="line">integer :: i, j, p, numht_zero, num_con_fliter_zero_result, num_con_fliter_result</span><br><span class="line">real, dimension(:), allocatable:: ht_zero, con_fliter_result, con_fliter_zero_result</span><br><span class="line"></span><br><span class="line">real, dimension(5) :: a</span><br><span class="line">real, dimension(4) :: b</span><br><span class="line">real(kind=4) :: t1, t1e, t2, t2e, t3, t3e, t4, t4e  ! 定义运行时间</span><br><span class="line"></span><br><span class="line">hn=[1.0, 5.254, 11.6, 13.7, 8.47, 0.775, -3.325, -2.764, &amp;</span><br><span class="line">-0.364, 1.099, 0.97, 0.15, -0.37, -0.344, -0.06, -0.126, 0.122, 0.025, -0.042, -0.043,0.0]</span><br><span class="line"></span><br><span class="line">a=[1,4,6,4,1]</span><br><span class="line">b=[-1.254,0.987,-0.341,0.0524]</span><br><span class="line"></span><br><span class="line">! 返序的hn，用于制作零相位滤波因子</span><br><span class="line">do i=1,size(hn)</span><br><span class="line">    hn_r(size(hn)-i+1)=hn(i)</span><br><span class="line">enddo</span><br><span class="line">open(unit=2, file=&#x27;ch3_test_result.dat&#x27;, status=&#x27;replace&#x27;, action=&#x27;write&#x27;)</span><br><span class="line">open(unit=3, file=&#x27;ch3_result.dat&#x27;, status=&#x27;replace&#x27;, action=&#x27;write&#x27;)</span><br><span class="line">open(1, file=&#x27;INPUT3.DAT&#x27;, form=&#x27;FORMATTED&#x27;, status=&#x27;OLD&#x27;)</span><br><span class="line">read(1,*) (X(i), i=1,50)</span><br><span class="line"></span><br><span class="line">numht_zero=2*size(hn)-1</span><br><span class="line">allocate(ht_zero(numht_zero))</span><br><span class="line"></span><br><span class="line">! 计算零相位滤波因子ht_zero，其为h(t)*h(-t)</span><br><span class="line">call CON(hn, hn_r, ht_zero, size(hn), size(hn_r), numht_zero)</span><br><span class="line">! 开启零相位褶积滤波结果数组</span><br><span class="line">num_con_fliter_zero_result=size(X)+numht_zero-1</span><br><span class="line">allocate(con_fliter_zero_result(num_con_fliter_zero_result))</span><br><span class="line">! 输出原始数据</span><br><span class="line">write(2,*) &#x27;Original data.&#x27;</span><br><span class="line">do i=1, size(X)</span><br><span class="line">    write (2,100) i, dt*(i-1)/1000., X(i)</span><br><span class="line">enddo</span><br><span class="line">call cpu_time(t1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">! 计算零相位褶积滤波</span><br><span class="line">do p=1,1000000</span><br><span class="line">call CON(X, ht_zero, con_fliter_zero_result, size(X), size(ht_zero), num_con_fliter_zero_result)</span><br><span class="line">! write(2,*) &#x27;Zero phase convolution filter result1.&#x27;</span><br><span class="line">do i=(numht_zero-1)/2+1, num_con_fliter_zero_result-(numht_zero-1)/2</span><br><span class="line">    ! write (2,100) i-(numht_zero-1)/2-1+1, dt*(i-(numht_zero-1)/2-1)/1000., con_fliter_zero_result(i) ! 舍去两端(size(ht)-1)/2个点</span><br><span class="line">	con_fliter_zero_result_end(i-((numht_zero-1)/2+1)+1)=con_fliter_zero_result(i)</span><br><span class="line">enddo</span><br><span class="line">end do</span><br><span class="line">call cpu_time(t1e)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">! 计算褶积滤波</span><br><span class="line">num_con_fliter_result=size(X)+size(hn)-1</span><br><span class="line">allocate(con_fliter_result(num_con_fliter_result))</span><br><span class="line">call cpu_time(t2)</span><br><span class="line">do p=1,1000000</span><br><span class="line">call CON(X, hn, con_fliter_result, size(X), size(hn), num_con_fliter_result)</span><br><span class="line">! write(2,*) &#x27;convolution filter result.&#x27;</span><br><span class="line">do i=(size(hn)-1)/2+1, num_con_fliter_result-(size(hn)-1)/2</span><br><span class="line">    ! write (2,100) i-(size(hn)-1)/2-1+1, dt*(i-(size(hn)-1)/2-1)/1000., con_fliter_result(i) ! 舍去两端(size(ht)-1)/2个点</span><br><span class="line">	con_fliter_result_end(i+1-((size(hn)-1)/2+1))=con_fliter_zero_result(i)</span><br><span class="line">enddo</span><br><span class="line">enddo</span><br><span class="line">call cpu_time(t2e)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">! 创建递归滤波</span><br><span class="line">call cpu_time(t3)</span><br><span class="line">do p=1,1000000</span><br><span class="line">do i=1,size(X)</span><br><span class="line">sum_ax=0.</span><br><span class="line">sum_bx=0.</span><br><span class="line">	if(i.lt.(size(a)-1)) then</span><br><span class="line">		if(i.eq.1) then</span><br><span class="line">			sum_ax=a(i)*X(i)</span><br><span class="line">			sum_bx=0.</span><br><span class="line">		else</span><br><span class="line">			do j=1,i</span><br><span class="line">				sum_ax=sum_ax+X(j)*a(i+1-j)</span><br><span class="line">			end do</span><br><span class="line"></span><br><span class="line">			do j=1,i-1</span><br><span class="line">				sum_bx=sum_bx+X_digui(j)*b(i-j)</span><br><span class="line">			end do</span><br><span class="line">		endif</span><br><span class="line">	else </span><br><span class="line">		do j=1,size(a)</span><br><span class="line">			sum_ax=sum_ax+X(i-j+1)*a(j)</span><br><span class="line">		end do</span><br><span class="line">		do j=1,size(b)</span><br><span class="line">			sum_bx=sum_bx+X_digui(i-j)*b(j)</span><br><span class="line">		end do</span><br><span class="line">	endif</span><br><span class="line"> 	X_digui(i)=sum_ax-sum_bx</span><br><span class="line">enddo</span><br><span class="line">enddo</span><br><span class="line">call cpu_time(t3e)</span><br><span class="line"></span><br><span class="line">! write (2, *) &#x27;Digui filter data&#x27;</span><br><span class="line">! do i=1,size(X_digui)</span><br><span class="line">!     write (2,100) i, (i-1)*dt/1000., X_digui(i)</span><br><span class="line">! enddo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">call cpu_time(t4)</span><br><span class="line">! 创建零相位递归滤波</span><br><span class="line">do p=1,1000000</span><br><span class="line">do i=size(X),1,-1</span><br><span class="line">	sum_ax=0.</span><br><span class="line">	sum_bx=0.</span><br><span class="line">	if(i.gt.(size(X)-size(a)+2)) then</span><br><span class="line">		if(i.eq.size(X)) then</span><br><span class="line">			sum_ax=a(1)*X_digui(i)</span><br><span class="line">			sum_bx=0.</span><br><span class="line">		else</span><br><span class="line">			do j=1,size(X_digui)-i+1</span><br><span class="line">				sum_ax=sum_ax+X_digui(i+j-1)*a(j)</span><br><span class="line">			end do</span><br><span class="line"></span><br><span class="line">			do j=1,size(X_digui)-i</span><br><span class="line">				sum_bx=sum_bx+X_digui(i+j)*b(j)</span><br><span class="line">			end do</span><br><span class="line">		endif</span><br><span class="line">	else </span><br><span class="line">		do j=1,size(a)</span><br><span class="line">			sum_ax=sum_ax+X_digui(i+j-1)*a(j)</span><br><span class="line">		end do</span><br><span class="line">		do j=1,size(b)</span><br><span class="line">			sum_bx=sum_bx+X_digui(i+j)*b(j)</span><br><span class="line">		end do</span><br><span class="line">	endif</span><br><span class="line"> 	X_digui_zero(i)=sum_ax-sum_bx</span><br><span class="line">enddo</span><br><span class="line">enddo</span><br><span class="line">call cpu_time(t4e)</span><br><span class="line"></span><br><span class="line">! write (2, *) &#x27;Digui zero filter data&#x27;</span><br><span class="line">! do i=1,size(X_digui)</span><br><span class="line">!     write (2,100) i, (i-1)*dt/1000., X_digui_zero(i)</span><br><span class="line">! enddo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">do i=1,size(X_digui)</span><br><span class="line">    write(3,200) i, (i-1)*dt,X(i), con_fliter_result_end(i), con_fliter_zero_result_end(i), X_digui(i),  X_digui_zero(i)</span><br><span class="line">enddo</span><br><span class="line">100 format(I4, 2(&#x27;,&#x27;, F15.6))</span><br><span class="line">200 format(I4,x,F5.1,5(x, F15.4))</span><br><span class="line">write(2,300) t1e-t1, t2e-t2, t3e-t3, t4e-t4</span><br><span class="line">300 format(4(F29.27,x)) </span><br><span class="line">end program ch3_compare</span><br><span class="line"></span><br><span class="line">	SUBROUTINE CON(A,B,C,I,J,K)</span><br><span class="line">	DIMENSION A(I),B(J),C(K)</span><br><span class="line">	DO 1 K1=1,K</span><br><span class="line">  1	C(K1)=0.0</span><br><span class="line">	DO 2 I1=1,I</span><br><span class="line">	DO 2 I2=1,J</span><br><span class="line">	II=I1+I2-1</span><br><span class="line">  2	C(II)=C(II)+A(I1)*B(I2)*0.004</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">clear</span><br><span class="line">load ch3_result.dat</span><br><span class="line"></span><br><span class="line">figure(2)</span><br><span class="line">hold on</span><br><span class="line">subplot(5,1,1)</span><br><span class="line">plot(ch3_result(:,2), ch3_result(:,3))</span><br><span class="line">title(&#x27;Origin&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(5,1,2)</span><br><span class="line">plot(ch3_result(:,2), ch3_result(:,4))</span><br><span class="line">title(&#x27;褶积滤波&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(5,1,3)</span><br><span class="line">plot(ch3_result(:,2), ch3_result(:,5))</span><br><span class="line">title(&#x27;零相位褶积滤波&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(5,1,4)</span><br><span class="line">plot(ch3_result(:,2), ch3_result(:,6))</span><br><span class="line">title(&#x27;递归滤波&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(5,1,5)</span><br><span class="line">plot(ch3_result(:,2), ch3_result(:,7))</span><br><span class="line">title(&#x27;零相位递归滤波&#x27;)</span><br></pre></td></tr></table></figure>


<h1 id="设计高通滤波因子进行频域分析"><a href="#设计高通滤波因子进行频域分析" class="headerlink" title="设计高通滤波因子进行频域分析"></a>设计高通滤波因子进行频域分析</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">program ch4_highpass</span><br><span class="line">real, parameter :: dt=4., pi=3.1415926535, wc=30.</span><br><span class="line">real, dimension(101) :: ht, t, f, hwr, hwi</span><br><span class="line">complex, dimension(101) :: hw   ! 定义一个复数数组hw，用于表示频率域的滤波因子。</span><br><span class="line">open(6,file=&#x27;ch4_result.dat&#x27;, status=&#x27;replace&#x27;,action=&#x27;write&#x27;)</span><br><span class="line"></span><br><span class="line">! 设计时域滤波因子ht</span><br><span class="line">df=1000/dt/size(f)</span><br><span class="line">do i=1,size(ht)</span><br><span class="line">    t(i)=dt*(i-1.-(size(ht)-1.)/2.)/1000.</span><br><span class="line">	! t(i)=dt*(i-1.)/1000.</span><br><span class="line">    f(i)=df*(i-1)</span><br><span class="line">	! if (t(i).ne.0.) then</span><br><span class="line">	! 	f(i)=1./t(i)</span><br><span class="line">	! else</span><br><span class="line">	! 	f(i)=1./dt*1000.</span><br><span class="line">	! endif</span><br><span class="line">    if (t(i).ne.0) then</span><br><span class="line">        ht(i)=0.-1.*sin(2*pi*t(i)*wc)/pi/t(i)! /(pi*t(i))</span><br><span class="line">        hw(i)=CMPLX(ht(i), 0.0)</span><br><span class="line">    elseif(t(i).eq.0) then</span><br><span class="line">        ht(i)=1000.-2.*wc</span><br><span class="line">        hw(i)=CMPLX(ht(i), 0.0)</span><br><span class="line">    else</span><br><span class="line">        continue</span><br><span class="line">    endif</span><br><span class="line">enddo</span><br><span class="line"></span><br><span class="line">call DFT(size(f), hw, 1.0)</span><br><span class="line"></span><br><span class="line">complex_to_real: do i=1,size(f)</span><br><span class="line"> 	hwr(i)=real(hw(i))</span><br><span class="line">	hwi(i)=aimag(hw(i))</span><br><span class="line">end do complex_to_real</span><br><span class="line"></span><br><span class="line">! 输出：序号，时间，时域滤波因子，频率，频率域滤波器</span><br><span class="line">do i=1,size(f)</span><br><span class="line">    write (6,100) i, t(i), ht(i), f(i), sqrt(hwr(i)**2+hwi(i)**2)</span><br><span class="line">enddo</span><br><span class="line">100 format(I4,6(x,F20.4))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">end program ch4_highpass</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	SUBROUTINE DFT(N,C,S)</span><br><span class="line">	COMPLEX C(N),Y(512),W</span><br><span class="line">	IF(S.EQ.1.0)Z=1.0</span><br><span class="line">	IF(S.EQ.-1.0)Z=1.0/FLOAT(N)</span><br><span class="line">	DO 20 I=1,N</span><br><span class="line">	Y(I)=(0.0,0.0)</span><br><span class="line">	DO 20 J=1,N</span><br><span class="line">	A=COS(2.0*3.14159265*(I-1)*(J-1)/FLOAT(N))</span><br><span class="line">	B=SIN(2.0*3.14159265*(I-1)*(J-1)/FLOAT(N))*(-S)</span><br><span class="line">	W=CMPLX(A,B)</span><br><span class="line"> 20	Y(I)=Y(I)+C(J)*W</span><br><span class="line">	DO 30 I=1,N</span><br><span class="line"> 30	C(I)=Y(I)*Z</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">clear</span><br><span class="line">load ch4_result.dat</span><br><span class="line">load ch4_test.dat</span><br><span class="line"></span><br><span class="line">figure(2)</span><br><span class="line">hold on</span><br><span class="line">subplot(2,1,1)</span><br><span class="line">plot(ch4_result(:,2), ch4_result(:,3))</span><br><span class="line">title(&#x27;Origin&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(2,1,2)</span><br><span class="line">plot(ch4_result(:,4), ch4_result(:,5))</span><br><span class="line">title(&#x27;frequency&#x27;)</span><br></pre></td></tr></table></figure>

<h1 id="不同信号的频谱分析"><a href="#不同信号的频谱分析" class="headerlink" title="不同信号的频谱分析"></a>不同信号的频谱分析</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">program ch5_freanalysis</span><br><span class="line">integer, parameter :: N=128, dt=4, pi=3.1415926535</span><br><span class="line">integer :: k, nfft</span><br><span class="line">complex, dimension(N,2) :: x_per_fre, x_pulse_fre, x_seis_fre</span><br><span class="line">real, dimension(N) :: x_per, x_pulse, x_seis</span><br><span class="line">real :: df,f,x_per_amp, x_pulse_amp, x_seis_amp</span><br><span class="line"></span><br><span class="line">open(1, file=&#x27;WAVE.DAT&#x27;, form=&#x27;formatted&#x27;, status=&#x27;old&#x27;)</span><br><span class="line">read(1,*) (x_seis(i), i=1,N)</span><br><span class="line"></span><br><span class="line">do i=1,N</span><br><span class="line">    x_per(i)=sin(2.*pi*i/64.)</span><br><span class="line">    if(i.eq.1) then</span><br><span class="line">        x_pulse(i)=1</span><br><span class="line">    else </span><br><span class="line">        x_pulse(i)=0   </span><br><span class="line">    endif</span><br><span class="line">    x_per_fre(i,:)=CMPLX(x_per(i),0.0)</span><br><span class="line">    x_pulse_fre(i,:)=CMPLX(x_pulse(i),0.0)</span><br><span class="line">    x_seis_fre(i,:)=CMPLX(x_seis(i),0.0)</span><br><span class="line">enddo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">call FFT(N, x_per_fre, 1.0)</span><br><span class="line">call FFT(N, x_pulse_fre, 1.0)</span><br><span class="line">call FFT(N, x_seis_fre, 1.0)</span><br><span class="line">open(3, file=&#x27;ch5_result.dat&#x27;,status=&#x27;replace&#x27;,action=&#x27;write&#x27;)</span><br><span class="line"></span><br><span class="line">df = 1000./dt/N</span><br><span class="line">do i=1,N</span><br><span class="line">    f = (i-1)*df</span><br><span class="line">    x_per_amp=sqrt(real(x_per_fre(i,1))**2+aimag(x_per_fre(i,2))**2)</span><br><span class="line">    x_pulse_amp=sqrt(real(x_pulse_fre(i,1))**2+aimag(x_pulse_fre(i,2))**2)</span><br><span class="line">    x_seis_amp=sqrt(real(x_seis_fre(i,1))**2+aimag(x_seis_fre(i,2))**2)</span><br><span class="line">    write(3,100) i, f, x_per_amp, x_pulse_amp, x_seis_amp</span><br><span class="line">enddo</span><br><span class="line">100 format(I4, 4(x,F15.4))</span><br><span class="line">end program ch5_freanalysis</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	SUBROUTINE FFT(LX,CX,SIGNI)</span><br><span class="line">	COMPLEX CX(LX),CARG,CEXP,CW,CTEMP</span><br><span class="line">	J=1</span><br><span class="line">	SC=1.0/LX</span><br><span class="line">	IF(SIGNI.EQ.1.0)SC=1.0</span><br><span class="line">	SIG=-SIGNI</span><br><span class="line">	DO 30 I=1,LX</span><br><span class="line">	IF(I.GT.J)GO TO 10</span><br><span class="line">	CTEMP=CX(J)*SC</span><br><span class="line">	CX(J)=CX(I)*SC</span><br><span class="line">	CX(I)=CTEMP</span><br><span class="line"> 10     M=LX/2</span><br><span class="line"> 20	IF(J.LE.M)GO TO 30</span><br><span class="line">	J=J-M</span><br><span class="line">	M=M/2</span><br><span class="line">	IF(M.GE.1)GO TO 20</span><br><span class="line"> 30	J=J+M</span><br><span class="line">	L=1</span><br><span class="line"> 40	ISTEP=2*L</span><br><span class="line">	DO 50 M=1,L</span><br><span class="line">	CARG=(0.0,1.0)*(3.14159265*SIG*(M-1))/L</span><br><span class="line">	CW=CEXP(CARG)</span><br><span class="line">	DO 50 I=M,LX,ISTEP</span><br><span class="line">	CTEMP=CW*CX(I+L)</span><br><span class="line">	CX(I+L)=CX(I)-CTEMP</span><br><span class="line"> 50	CX(I)=CX(I)+CTEMP</span><br><span class="line">	L=ISTEP</span><br><span class="line">	IF(L.LT.LX)GO TO 40</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">load ch5_result.dat</span><br><span class="line"></span><br><span class="line">figure(5)</span><br><span class="line">hold on</span><br><span class="line">subplot(3,1,1)</span><br><span class="line">plot(ch5_result(:,2), ch5_result(:,3))</span><br><span class="line">title(&#x27;周期&#x27;)</span><br><span class="line">xlabel(&#x27;frequency Hz&#x27;)</span><br><span class="line">ylabel(&#x27;amplitude&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(3,1,2)</span><br><span class="line">plot(ch5_result(:,2), ch5_result(:,4))</span><br><span class="line">title(&#x27;脉冲&#x27;)</span><br><span class="line">xlabel(&#x27;frequency Hz&#x27;)</span><br><span class="line">ylabel(&#x27;amplitude&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(3,1,3)</span><br><span class="line">plot(ch5_result(:,2), ch5_result(:,5))</span><br><span class="line">title(&#x27;地震波&#x27;)</span><br><span class="line">xlabel(&#x27;frequency Hz&#x27;)</span><br><span class="line">ylabel(&#x27;amplitude&#x27;)</span><br></pre></td></tr></table></figure>

<h1 id="FFT补零的影响分析"><a href="#FFT补零的影响分析" class="headerlink" title="FFT补零的影响分析"></a>FFT补零的影响分析</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line">program ch6_zeros</span><br><span class="line"></span><br><span class="line">integer, parameter :: N=60, dt=4, pi=3.1415926535, N1=64, N2=128</span><br><span class="line">complex, dimension(N,2) :: x_per_fre, x_seis_fre</span><br><span class="line">complex, dimension(N1,2) :: x_per_fre1, x_seis_fre1</span><br><span class="line">complex, dimension(N2,2) :: x_per_fre2, x_seis_fre2</span><br><span class="line">real, dimension(N) :: x_per, x_seis</span><br><span class="line">real :: df,f,x_per_amp, x_seis_amp</span><br><span class="line"></span><br><span class="line">open(1, file=&#x27;WAVE.DAT&#x27;, form=&#x27;formatted&#x27;, status=&#x27;old&#x27;)</span><br><span class="line">read(1,*) (x_seis(i), i=1,N)</span><br><span class="line">! 设置存储文件</span><br><span class="line">open(3, file=&#x27;ch6_result_nozero.dat&#x27;,status=&#x27;replace&#x27;,action=&#x27;write&#x27;)</span><br><span class="line">open(4, file=&#x27;ch6_result_64.dat&#x27;,status=&#x27;replace&#x27;,action=&#x27;write&#x27;)</span><br><span class="line">open(5, file=&#x27;ch6_result_128.dat&#x27;,status=&#x27;replace&#x27;,action=&#x27;write&#x27;)</span><br><span class="line"></span><br><span class="line">! No zero</span><br><span class="line">do i=1,N</span><br><span class="line">    x_per(i)=sin(2.*pi*i/30.)</span><br><span class="line">    x_per_fre(i,:)=CMPLX(x_per(i),0.0)</span><br><span class="line">    x_seis_fre(i,:)=CMPLX(x_seis(i),0.0)</span><br><span class="line">enddo</span><br><span class="line">call DFT(N, x_per_fre, 1.0)</span><br><span class="line">call DFT(N, x_seis_fre, 1.0)</span><br><span class="line">df = 1000./dt/N</span><br><span class="line">do i=1,N</span><br><span class="line">    f = (i-1)*df</span><br><span class="line">    x_per_amp=sqrt(real(x_per_fre(i,1))**2+aimag(x_per_fre(i,2))**2)</span><br><span class="line">    x_seis_amp=sqrt(real(x_seis_fre(i,1))**2+aimag(x_seis_fre(i,2))**2)</span><br><span class="line">    write(3,100) i, f, x_per_amp, x_seis_amp</span><br><span class="line">end do</span><br><span class="line"></span><br><span class="line">! TO 64 with zero</span><br><span class="line">do i=1,N1</span><br><span class="line">    if (i.le.N) then</span><br><span class="line">        x_per_fre1(i,:)=CMPLX(x_per(i),0.0)</span><br><span class="line">        x_seis_fre1(i,:)=CMPLX(x_seis(i),0.0)</span><br><span class="line">    else</span><br><span class="line">        x_per_fre1(i,:)=CMPLX(0.0,0.0)</span><br><span class="line">        x_seis_fre1(i,:)=CMPLX(0.0,0.0)</span><br><span class="line">    endif</span><br><span class="line">end do</span><br><span class="line">call DFT(N, x_per_fre1, 1.0)</span><br><span class="line">call DFT(N, x_seis_fre1, 1.0)</span><br><span class="line">df = 1000./dt/N1</span><br><span class="line"></span><br><span class="line">do i=1,N1</span><br><span class="line">    f = (i-1)*df</span><br><span class="line">    x_per_amp=sqrt(real(x_per_fre1(i,1))**2+aimag(x_per_fre1(i,2))**2)</span><br><span class="line">    x_seis_amp=sqrt(real(x_seis_fre1(i,1))**2+aimag(x_seis_fre1(i,2))**2)</span><br><span class="line">    write(4,100) i, f, x_per_amp, x_seis_amp</span><br><span class="line">enddo</span><br><span class="line"></span><br><span class="line">! TO 128 with zero</span><br><span class="line">do i=1,N2</span><br><span class="line">    if (i.le.N) then</span><br><span class="line">        x_per_fre2(i,:)=CMPLX(x_per(i),0.0)</span><br><span class="line">        x_seis_fre2(i,:)=CMPLX(x_seis(i),0.0)</span><br><span class="line">    else</span><br><span class="line">        x_per_fre2(i,:)=CMPLX(0.0,0.0)</span><br><span class="line">        x_seis_fre2(i,:)=CMPLX(0.0,0.0)</span><br><span class="line">    endif</span><br><span class="line">end do</span><br><span class="line">call DFT(N, x_per_fre2, 1.0)</span><br><span class="line">call DFT(N, x_seis_fre2, 1.0)</span><br><span class="line">df = 1000./dt/N2</span><br><span class="line">do i=1,N2</span><br><span class="line">    f = (i-1)*df</span><br><span class="line">    x_per_amp=sqrt(real(x_per_fre2(i,1))**2+aimag(x_per_fre2(i,2))**2)</span><br><span class="line">    x_seis_amp=sqrt(real(x_seis_fre2(i,1))**2+aimag(x_seis_fre2(i,2))**2)</span><br><span class="line">    write(5,100) i, f, x_per_amp, x_seis_amp</span><br><span class="line">end do</span><br><span class="line"></span><br><span class="line">100 format(I4, 3(x,F15.4))</span><br><span class="line"></span><br><span class="line">end program ch6_zeros</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	SUBROUTINE FFT(LX,CX,SIGNI)</span><br><span class="line">	COMPLEX CX(LX),CARG,CEXP,CW,CTEMP</span><br><span class="line">	J=1</span><br><span class="line">	SC=1.0/LX</span><br><span class="line">	IF(SIGNI.EQ.1.0)SC=1.0</span><br><span class="line">	SIG=-SIGNI</span><br><span class="line">	DO 30 I=1,LX</span><br><span class="line">	IF(I.GT.J)GO TO 10</span><br><span class="line">	CTEMP=CX(J)*SC</span><br><span class="line">	CX(J)=CX(I)*SC</span><br><span class="line">	CX(I)=CTEMP</span><br><span class="line"> 10     M=LX/2</span><br><span class="line"> 20	IF(J.LE.M)GO TO 30</span><br><span class="line">	J=J-M</span><br><span class="line">	M=M/2</span><br><span class="line">	IF(M.GE.1)GO TO 20</span><br><span class="line"> 30	J=J+M</span><br><span class="line">	L=1</span><br><span class="line"> 40	ISTEP=2*L</span><br><span class="line">	DO 50 M=1,L</span><br><span class="line">	CARG=(0.0,1.0)*(3.14159265*SIG*(M-1))/L</span><br><span class="line">	CW=CEXP(CARG)</span><br><span class="line">	DO 50 I=M,LX,ISTEP</span><br><span class="line">	CTEMP=CW*CX(I+L)</span><br><span class="line">	CX(I+L)=CX(I)-CTEMP</span><br><span class="line"> 50	CX(I)=CX(I)+CTEMP</span><br><span class="line">	L=ISTEP</span><br><span class="line">	IF(L.LT.LX)GO TO 40</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br><span class="line"></span><br><span class="line">SUBROUTINE DFT(N,C,S)</span><br><span class="line">	COMPLEX C(N),Y(512),W</span><br><span class="line">	IF(S.EQ.1.0)Z=1.0</span><br><span class="line">	IF(S.EQ.-1.0)Z=1.0/FLOAT(N)</span><br><span class="line">	DO 20 I=1,N</span><br><span class="line">	Y(I)=(0.0,0.0)</span><br><span class="line">	DO 20 J=1,N</span><br><span class="line">	A=COS(2.0*3.14159265*(I-1)*(J-1)/FLOAT(N))</span><br><span class="line">	B=SIN(2.0*3.14159265*(I-1)*(J-1)/FLOAT(N))*(-S)</span><br><span class="line">	W=CMPLX(A,B)</span><br><span class="line"> 20	Y(I)=Y(I)+C(J)*W</span><br><span class="line">	DO 30 I=1,N</span><br><span class="line"> 30	C(I)=Y(I)*Z</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">load ch6_result_nozero.dat</span><br><span class="line">load ch6_result_64.dat</span><br><span class="line">load ch6_result_128.dat</span><br><span class="line"></span><br><span class="line">figure(5)</span><br><span class="line">hold on</span><br><span class="line">subplot(3,2,1)</span><br><span class="line">plot(ch6_result_nozero(:,2), ch6_result_nozero(:,3))</span><br><span class="line">title(&#x27;周期，无补零&#x27;)</span><br><span class="line">xlabel(&#x27;frequency Hz&#x27;)</span><br><span class="line">ylabel(&#x27;amplitude&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(3,2,2)</span><br><span class="line">plot(ch6_result_nozero(:,2), ch6_result_nozero(:,4))</span><br><span class="line">title(&#x27;非周期，无补零&#x27;)</span><br><span class="line">xlabel(&#x27;frequency Hz&#x27;)</span><br><span class="line">ylabel(&#x27;amplitude&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">subplot(3,2,3)</span><br><span class="line">plot(ch6_result_64(:,2), ch6_result_64(:,3))</span><br><span class="line">title(&#x27;周期，64个点&#x27;)</span><br><span class="line">xlabel(&#x27;frequency Hz&#x27;)</span><br><span class="line">ylabel(&#x27;amplitude&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(3,2,4)</span><br><span class="line">plot(ch6_result_64(:,2), ch6_result_64(:,4))</span><br><span class="line">title(&#x27;非周期，64个点&#x27;)</span><br><span class="line">xlabel(&#x27;frequency Hz&#x27;)</span><br><span class="line">ylabel(&#x27;amplitude&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">subplot(3,2,5)</span><br><span class="line">plot(ch6_result_128(:,2), ch6_result_128(:,3))</span><br><span class="line">title(&#x27;周期，128个点&#x27;)</span><br><span class="line">xlabel(&#x27;frequency Hz&#x27;)</span><br><span class="line">ylabel(&#x27;amplitude&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(3,2,6)</span><br><span class="line">plot(ch6_result_128(:,2), ch6_result_128(:,4))</span><br><span class="line">title(&#x27;非周期，128个点&#x27;)</span><br><span class="line">xlabel(&#x27;frequency Hz&#x27;)</span><br><span class="line">ylabel(&#x27;amplitude&#x27;)</span><br></pre></td></tr></table></figure>

<h1 id="线性褶积与圆周褶积比较"><a href="#线性褶积与圆周褶积比较" class="headerlink" title="线性褶积与圆周褶积比较"></a>线性褶积与圆周褶积比较</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">program ch7_circle</span><br><span class="line">real, parameter :: pi=3.1415926535</span><br><span class="line">real, dimension(101) :: X=0., h_low=0., t</span><br><span class="line">! real,dimension (101) :: h_low=0.</span><br><span class="line">real,dimension (100+101-1) :: result_low=0., result_circle</span><br><span class="line">real,dimension (201) :: X_c=0., h_r=0., t2, result_circle_r</span><br><span class="line">real :: wc1=70.0, f ! 滤波器的滤波边界</span><br><span class="line">integer :: i, dt=2</span><br><span class="line">open(1, file=&#x27;INPUT1.DAT&#x27;, form=&#x27;formatted&#x27;, status=&#x27;old&#x27;)</span><br><span class="line">open(2, file=&#x27;ch7_result.dat&#x27;,status=&#x27;replace&#x27;,action=&#x27;write&#x27;)</span><br><span class="line">open(3, file=&#x27;ch7_result_low.dat&#x27;,status=&#x27;replace&#x27;,action=&#x27;write&#x27;)</span><br><span class="line">open(4, file=&#x27;ch7_result_circle.dat&#x27;,status=&#x27;replace&#x27;,action=&#x27;write&#x27;)</span><br><span class="line">read (1,*)(X(i), i=1,100)</span><br><span class="line"></span><br><span class="line">! 理想低通滤波器</span><br><span class="line"></span><br><span class="line">low_pass_fliter: do i=1,101</span><br><span class="line">t(i) = dt*(i-100/2-1)/1000.</span><br><span class="line">	if ((t(i).lt.0.0001) .and. (t(i).gt.-0.0001)) then</span><br><span class="line">	h_low(i)=2*pi*wc1/pi</span><br><span class="line">	else</span><br><span class="line">	h_low(i)=sin(2*pi*wc1*t(i))/(pi*t(i))</span><br><span class="line">	endif</span><br><span class="line">end do low_pass_fliter</span><br><span class="line"></span><br><span class="line">! 卷积</span><br><span class="line">call CON(X,h_low,result_low,100,101,100+101-1)  ! result_low is the result of linear convolution</span><br><span class="line">call CIRCON(X, h_low, result_circle, 101)</span><br><span class="line"></span><br><span class="line">do i=1,101   ! 为圆周卷积补零</span><br><span class="line">X_c(i) = X(i)</span><br><span class="line">enddo</span><br><span class="line"></span><br><span class="line">do i=1,201</span><br><span class="line">t2(i) = dt*(i-200/2-1)/1000.</span><br><span class="line">	if ((t2(i).lt.0.0001) .and. (t2(i).gt.-0.0001)) then</span><br><span class="line">	h_r(i)=2*pi*wc1/pi</span><br><span class="line">	else</span><br><span class="line">	h_r(i)=sin(2*pi*wc1*t2(i))/(pi*t2(i))</span><br><span class="line">	endif</span><br><span class="line">end do</span><br><span class="line">! 圆周卷积</span><br><span class="line">call CIRCON(X_c, h_r, result_circle_r, 201)</span><br><span class="line"></span><br><span class="line">do i=1,101</span><br><span class="line">    write(2,300) i, (i-1.)*dt, X(i), result_low(i+50), result_circle(i)</span><br><span class="line">end do</span><br><span class="line">300 format(I4, 4(x, F15.4))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">do i=1,101</span><br><span class="line">    write(4,200) i, (i-1.)*dt, X_c(i), result_circle_r(i+100)</span><br><span class="line">end do</span><br><span class="line">200 format(I4, 3(x, F15.4))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">end program ch7_circle</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	SUBROUTINE CON(A,B,C,I,J,K)</span><br><span class="line">	DIMENSION A(I),B(J),C(K)</span><br><span class="line">	DO 1 K1=1,K</span><br><span class="line">  1	C(K1)=0.0</span><br><span class="line">	DO 2 I1=1,I</span><br><span class="line">	DO 2 I2=1,J</span><br><span class="line">	II=I1+I2-1</span><br><span class="line">  2	C(II)=C(II)+A(I1)*B(I2)*0.004</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	SUBROUTINE CIRCON(X,H,Y,N)</span><br><span class="line">	REAL X(N),H(N),Y(N)</span><br><span class="line">	DO I=1,N</span><br><span class="line">	Y(I)=0.0</span><br><span class="line">	ENDDO</span><br><span class="line">	DO I=1,N</span><br><span class="line">	   DO J=1,N</span><br><span class="line">	     IF(I-J.GT.0) Y(I)=Y(I)+X(J)*H(I-J)</span><br><span class="line">	   ENDDO </span><br><span class="line">	ENDDO</span><br><span class="line">	END</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">clear</span><br><span class="line">load ch7_result.dat</span><br><span class="line">load ch7_result_circle.dat</span><br><span class="line">figure(5)</span><br><span class="line">hold on</span><br><span class="line">subplot(3,1,1)</span><br><span class="line">plot(ch7_result(:,2), ch7_result(:,3))</span><br><span class="line">title(&#x27;源数据&#x27;)</span><br><span class="line">xlabel(&#x27;T s&#x27;)</span><br><span class="line">ylabel(&#x27;amplitude&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(3,1,2)</span><br><span class="line">plot(ch7_result(:,2), ch7_result(:,4))</span><br><span class="line">title(&#x27;线性褶积&#x27;)</span><br><span class="line">xlabel(&#x27;T s&#x27;)</span><br><span class="line">ylabel(&#x27;amplitude&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">subplot(3,1,3)</span><br><span class="line">plot(ch7_result(:,2), ch7_result(:,5))</span><br><span class="line">title(&#x27;圆周褶积&#x27;)</span><br><span class="line">xlabel(&#x27;T s&#x27;)</span><br><span class="line">ylabel(&#x27;amplitude&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">figure(6)</span><br><span class="line">hold on</span><br><span class="line">subplot(3,1,1)</span><br><span class="line">plot(ch7_result_circle(:,2), ch7_result_circle(:,3))</span><br><span class="line">title(&#x27;源数据&#x27;)</span><br><span class="line">xlabel(&#x27;T s&#x27;)</span><br><span class="line">ylabel(&#x27;amplitude&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(3,1,2)</span><br><span class="line">plot(ch7_result_circle(:,2), ch7_result_circle(:,4))</span><br><span class="line">title(&#x27;圆周褶积&#x27;)</span><br><span class="line">xlabel(&#x27;T s&#x27;)</span><br><span class="line">ylabel(&#x27;amplitude&#x27;)</span><br></pre></td></tr></table></figure>
<h1 id="最小平方法求反射系数"><a href="#最小平方法求反射系数" class="headerlink" title="最小平方法求反射系数"></a>最小平方法求反射系数</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">program ch8_leasqu</span><br><span class="line">implicit none</span><br><span class="line">integer, parameter :: N=200, Nb=12, m=61</span><br><span class="line">real, dimension(Nb) :: bn</span><br><span class="line">real, dimension(N) :: ref_coe</span><br><span class="line">real, dimension(m) :: rbb, a</span><br><span class="line">real, dimension(N+Nb-1) :: X</span><br><span class="line">real, dimension(N+Nb-1+m-1) :: ref_coe_inver</span><br><span class="line">integer :: i</span><br><span class="line">bn=[17.5, 12.5, 7.0, 0.0, -3.5, -7.0,-3.0, -1.0, 0.0, 1.4, 3.5, 2.0]</span><br><span class="line">! 读取反射系数序列 ref_coe</span><br><span class="line">open(1, file=&#x27;INPUT8.DAT&#x27;, form=&#x27;formatted&#x27;, status=&#x27;old&#x27;)</span><br><span class="line">read(1,*)(ref_coe(i), i=1,200)</span><br><span class="line">! 计算合成地震记录</span><br><span class="line">call CON(bn, ref_coe, X, Nb, N, N+Nb-1)  </span><br><span class="line"></span><br><span class="line">! 使用最小平方法求取反射系数序列</span><br><span class="line">! 求子波自相关</span><br><span class="line">call AUTCOR(Nb,m,bn,rbb)</span><br><span class="line">! 解相应的托布利兹矩阵，求反子波a。</span><br><span class="line">call PEO(m,rbb,a)</span><br><span class="line">! 反子波与地震记录褶积，得到反射系数序列</span><br><span class="line">call CON(a, X, ref_coe_inver, m, N+Nb-1, N+Nb-1+m-1)</span><br><span class="line">open(3, file=&#x27;ch8_input.dat&#x27;, status=&#x27;replace&#x27;,action=&#x27;write&#x27;)</span><br><span class="line">do i=1,N</span><br><span class="line">    write(3,200) i, ref_coe(i)</span><br><span class="line">enddo</span><br><span class="line">200 format(I4, x, F15.4)</span><br><span class="line">open(2, file=&#x27;ch8_result.dat&#x27;, status=&#x27;replace&#x27;,action=&#x27;write&#x27;)</span><br><span class="line">do i=1,N+Nb-1+m-1</span><br><span class="line">    write(2,100) i, ref_coe_inver(i)</span><br><span class="line">enddo</span><br><span class="line">100 format(I4, x, F15.6)</span><br><span class="line"></span><br><span class="line">end program ch8_leasqu</span><br><span class="line"></span><br><span class="line">	SUBROUTINE CON(A,B,C,I,J,K)</span><br><span class="line">	DIMENSION A(I),B(J),C(K)</span><br><span class="line">	DO 1 K1=1,K</span><br><span class="line">  1	C(K1)=0.0</span><br><span class="line">	DO 2 I1=1,I</span><br><span class="line">	DO 2 I2=1,J</span><br><span class="line">	II=I1+I2-1</span><br><span class="line">  2	C(II)=C(II)+A(I1)*B(I2)*0.004</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br><span class="line"></span><br><span class="line">! 解托布利兹矩阵，只有期望输出为脉冲时适用</span><br><span class="line">	SUBROUTINE PEO(LR,R,A)</span><br><span class="line">	DIMENSION R(LR),A(LR)</span><br><span class="line">	V=R(1)</span><br><span class="line">	A(1)=1.0</span><br><span class="line">	IF(LR.EQ.1)RETURN</span><br><span class="line">	DO 6 L=2,LR</span><br><span class="line">	D=0.0</span><br><span class="line">	L3=L-1</span><br><span class="line">	DO 1 J=1,L3</span><br><span class="line">	K=L-J+1</span><br><span class="line"> 1	D=D+A(J)*R(K)</span><br><span class="line">	C=D/V</span><br><span class="line">	IF(L.EQ.2)GOTO 4</span><br><span class="line">	L1=(L-2)/2</span><br><span class="line">	L2=L1+1</span><br><span class="line">	IF(L2.LT.2)GOTO 3</span><br><span class="line">	DO 2 J=2,L2</span><br><span class="line">	HOLD=A(J)</span><br><span class="line">	K=L-J+1</span><br><span class="line">	A(J)=A(J)-C*A(K)</span><br><span class="line"> 2	A(K)=A(K)-C*HOLD</span><br><span class="line">	IF(2*L1.EQ.L-2)GOTO 4</span><br><span class="line"> 3	LT3=L2+1</span><br><span class="line">	A(LT3)=A(LT3)-C*A(LT3)</span><br><span class="line"> 4	A(L)=-C</span><br><span class="line"> 6	V=V-C*D</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br><span class="line"></span><br><span class="line">! 自相关程序</span><br><span class="line">! C自相关的数组 A输出</span><br><span class="line">    SUBROUTINE AUTCOR(J,K,C,A)</span><br><span class="line">	DIMENSION C(J),A(K)</span><br><span class="line">	DO 7 N=1,K</span><br><span class="line">	A(N)=0.0</span><br><span class="line">	I=N</span><br><span class="line">	DO 6 IN=I,J</span><br><span class="line">	IL=IN-N+1</span><br><span class="line">  6	A(N)=A(N)+C(IN)*C(IL)</span><br><span class="line">  7	CONTINUE</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">load ch8_input.dat</span><br><span class="line">load ch8_result.dat</span><br><span class="line"></span><br><span class="line">figure(1)</span><br><span class="line">hold on</span><br><span class="line">subplot(3,1,1)</span><br><span class="line">plot(ch8_input(:,1), ch8_input(:,2))</span><br><span class="line">title(&#x27;原始反射系数序列&#x27;)</span><br><span class="line">subplot(3,1,2)</span><br><span class="line">plot(ch8_result(:,1), ch8_result(:,2))</span><br><span class="line">title(&#x27;反演反射系数序列未截取&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(3,1,3)</span><br><span class="line">plot(ch8_result(1:200,1), ch8_result(1:200,2))</span><br><span class="line">title(&#x27;反演反射系数序列截取到200&#x27;)</span><br></pre></td></tr></table></figure>

<h1 id="子波零相位变换"><a href="#子波零相位变换" class="headerlink" title="子波零相位变换"></a>子波零相位变换</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">program ch9_zerophase</span><br><span class="line">integer, parameter :: N=25</span><br><span class="line">real, dimension(N) :: bo</span><br><span class="line">complex, dimension(N,2) :: bo_comp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bo=[0.,1.,3.,5.,7.,9.,10.,8.,6.,4.,2.,0.,-1.,0.,1.,2.,3.,1.5,0.,-1.,0.,2.,1.,0.,0.]</span><br><span class="line">do i=1,N</span><br><span class="line">    bo_comp(i,:) = CMPLX(bo(i), 0.0)</span><br><span class="line">enddo</span><br><span class="line">! 对原始子波做傅氏变换到频率域</span><br><span class="line">call DFT(N,bo_comp,1.0)</span><br><span class="line">! 在频率域保持振幅谱不变，将虚部设置为0</span><br><span class="line">do i=1,N</span><br><span class="line">    bo_comp(i,:) = CMPLX(sqrt(real(bo_comp(i,1))**2+imag(bo_comp(i,2))**2), 0.0)</span><br><span class="line">enddo</span><br><span class="line">! 变换到时域</span><br><span class="line">call DFT(N, bo_comp, -1.0)</span><br><span class="line"></span><br><span class="line">open(1, file=&#x27;ch9_result.dat&#x27;, status=&#x27;replace&#x27;,action=&#x27;write&#x27;)</span><br><span class="line">do i=1,N</span><br><span class="line">    write(1,100) i, bo(i), real(bo_comp(i,1))</span><br><span class="line">enddo</span><br><span class="line">100 format (I4,2(x,F15.4))</span><br><span class="line"></span><br><span class="line">end program ch9_zerophase</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	SUBROUTINE DFT(N,C,S)</span><br><span class="line">	COMPLEX C(N),Y(512),W</span><br><span class="line">	IF(S.EQ.1.0)Z=1.0</span><br><span class="line">	IF(S.EQ.-1.0)Z=1.0/FLOAT(N)</span><br><span class="line">	DO 20 I=1,N</span><br><span class="line">	Y(I)=(0.0,0.0)</span><br><span class="line">	DO 20 J=1,N</span><br><span class="line">	A=COS(2.0*3.14159265*(I-1)*(J-1)/FLOAT(N))</span><br><span class="line">	B=SIN(2.0*3.14159265*(I-1)*(J-1)/FLOAT(N))*(-S)</span><br><span class="line">	W=CMPLX(A,B)</span><br><span class="line"> 20	Y(I)=Y(I)+C(J)*W</span><br><span class="line">	DO 30 I=1,N</span><br><span class="line"> 30	C(I)=Y(I)*Z</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">load ch9_result.dat</span><br><span class="line"></span><br><span class="line">figure(1)</span><br><span class="line">hold on</span><br><span class="line">subplot(2,1,1)</span><br><span class="line">plot(ch9_result(:,1), ch9_result(:,2))</span><br><span class="line">title(&#x27;原始子波&#x27;)</span><br><span class="line">xlabel(&#x27;序号i，无意义&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(2,1,2)</span><br><span class="line">plot(ch9_result(:,1), ch9_result(:,3))</span><br><span class="line">title(&#x27;零相位子波&#x27;)</span><br><span class="line">xlabel(&#x27;序号i，无意义&#x27;)</span><br></pre></td></tr></table></figure>

<h1 id="子波最小相位转换"><a href="#子波最小相位转换" class="headerlink" title="子波最小相位转换"></a>子波最小相位转换</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">program ch10_leastphase</span><br><span class="line">integer, parameter :: Nb=25, m=26</span><br><span class="line">real, dimension(Nb) :: b</span><br><span class="line">real, dimension(m) :: rbb, y, a0</span><br><span class="line">real, dimension(Nb+m-1) :: by, g, grev</span><br><span class="line">real :: b00,bysingle</span><br><span class="line">integer :: i</span><br><span class="line">real, dimension(2*Nb+m-2) :: b0</span><br><span class="line"></span><br><span class="line">! 已知非最小相位子波</span><br><span class="line">b=[0.,1.,2.,3.,1.5,0.,-1.,0.,1.,3.,5.,7.,9.,10.,8.,6.,4.,2.,0.,-1.,0.,2.,3.,2.,0.]</span><br><span class="line">! 求子波自相关</span><br><span class="line">call AUTCOR(Nb,m,b,rbb)</span><br><span class="line">! 解矩阵，得到y(t)</span><br><span class="line">call PEO(m,rbb,y)</span><br><span class="line">!得到b0（0）,用b00表示</span><br><span class="line">call CON(b,y,by,Nb,m,Nb+m-1)</span><br><span class="line">bysingle=0.</span><br><span class="line">do i = 1,Nb+m-1</span><br><span class="line">    bysingle=bysingle+by(i)**2</span><br><span class="line">enddo</span><br><span class="line">b00=1./bysingle</span><br><span class="line"></span><br><span class="line">! 得到 a0</span><br><span class="line">do i=1,m</span><br><span class="line">    a0(i) = b00*y(i)</span><br><span class="line">enddo</span><br><span class="line"></span><br><span class="line">! 得到g(t)</span><br><span class="line">call CON(b,a0,g, Nb,m,Nb+m-1)</span><br><span class="line"></span><br><span class="line">! 计算g(-t) 即grev</span><br><span class="line">do i=1,Nb+m-1</span><br><span class="line">    grev(i) = g(Nb+m-i)</span><br><span class="line">enddo</span><br><span class="line"></span><br><span class="line">! 计算b0</span><br><span class="line">call CON(b,grev,b0,Nb,Nb+m-1,2*Nb+m-2)</span><br><span class="line"></span><br><span class="line">open(2, file=&#x27;ch10_result.dat&#x27;, status=&#x27;replace&#x27;,action=&#x27;write&#x27;)</span><br><span class="line">open(1, file=&#x27;ch10_input.dat&#x27;, status=&#x27;replace&#x27;,action=&#x27;write&#x27;)</span><br><span class="line">do i=1,Nb</span><br><span class="line">    write(1,100) i, b(i)</span><br><span class="line">enddo</span><br><span class="line">do i=1,2*Nb+m-2</span><br><span class="line">    write(2,100) i, b0(i)</span><br><span class="line">enddo</span><br><span class="line">100 format(I4,x, F15.4)</span><br><span class="line">end program ch10_leastphase</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	SUBROUTINE CON(A,B,C,I,J,K)</span><br><span class="line">	DIMENSION A(I),B(J),C(K)</span><br><span class="line">	DO 1 K1=1,K</span><br><span class="line">  1	C(K1)=0.0</span><br><span class="line">	DO 2 I1=1,I</span><br><span class="line">	DO 2 I2=1,J</span><br><span class="line">	II=I1+I2-1</span><br><span class="line">  2	C(II)=C(II)+A(I1)*B(I2)*0.004</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br><span class="line"></span><br><span class="line">! 解托布利兹矩阵，只有期望输出为脉冲时适用</span><br><span class="line">	SUBROUTINE PEO(LR,R,A)</span><br><span class="line">	DIMENSION R(LR),A(LR)</span><br><span class="line">	V=R(1)</span><br><span class="line">	A(1)=1.0</span><br><span class="line">	IF(LR.EQ.1)RETURN</span><br><span class="line">	DO 6 L=2,LR</span><br><span class="line">	D=0.0</span><br><span class="line">	L3=L-1</span><br><span class="line">	DO 1 J=1,L3</span><br><span class="line">	K=L-J+1</span><br><span class="line"> 1	D=D+A(J)*R(K)</span><br><span class="line">	C=D/V</span><br><span class="line">	IF(L.EQ.2)GOTO 4</span><br><span class="line">	L1=(L-2)/2</span><br><span class="line">	L2=L1+1</span><br><span class="line">	IF(L2.LT.2)GOTO 3</span><br><span class="line">	DO 2 J=2,L2</span><br><span class="line">	HOLD=A(J)</span><br><span class="line">	K=L-J+1</span><br><span class="line">	A(J)=A(J)-C*A(K)</span><br><span class="line"> 2	A(K)=A(K)-C*HOLD</span><br><span class="line">	IF(2*L1.EQ.L-2)GOTO 4</span><br><span class="line"> 3	LT3=L2+1</span><br><span class="line">	A(LT3)=A(LT3)-C*A(LT3)</span><br><span class="line"> 4	A(L)=-C</span><br><span class="line"> 6	V=V-C*D</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br><span class="line"></span><br><span class="line">! 自相关程序</span><br><span class="line">! C自相关的数组 A输出</span><br><span class="line">    SUBROUTINE AUTCOR(J,K,C,A)</span><br><span class="line">	DIMENSION C(J),A(K)</span><br><span class="line">	DO 7 N=1,K</span><br><span class="line">	A(N)=0.0</span><br><span class="line">	I=N</span><br><span class="line">	DO 6 IN=I,J</span><br><span class="line">	IL=IN-N+1</span><br><span class="line">  6	A(N)=A(N)+C(IN)*C(IL)</span><br><span class="line">  7	CONTINUE</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">load ch10_input.dat</span><br><span class="line">load ch10_result.dat</span><br><span class="line"></span><br><span class="line">figure(1)</span><br><span class="line">hold on</span><br><span class="line">subplot(2,1,1)</span><br><span class="line">plot(ch10_input(:,1), ch10_input(:,2))</span><br><span class="line">title(&#x27;原始子波&#x27;)</span><br><span class="line">subplot(2,1,2)</span><br><span class="line">plot(ch10_result(:,1), ch10_result(:,2))</span><br><span class="line">title(&#x27;最小相位子波未截取&#x27;)</span><br></pre></td></tr></table></figure>
<h1 id="静校正"><a href="#静校正" class="headerlink" title="静校正"></a>静校正</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">program ch11_static</span><br><span class="line">real, dimension(1000) :: X</span><br><span class="line">real, dimension(100) :: refer</span><br><span class="line">real, dimension(10,100) :: Xorigin, X_static</span><br><span class="line">integer, dimension(10,1) :: static</span><br><span class="line">integer start, i, k, j, sta</span><br><span class="line">integer, parameter :: M=50</span><br><span class="line">real, dimension(10,M) :: rxy</span><br><span class="line">open(1,file=&#x27;SEIS.DAT&#x27;, form=&#x27;formatted&#x27;,status=&#x27;old&#x27;)</span><br><span class="line">read(1,*)(X(i),i=1,1000)</span><br><span class="line">start=1</span><br><span class="line">do j=1,10</span><br><span class="line">    do k=1,100</span><br><span class="line">        Xorigin(j,k)=X(start)</span><br><span class="line">        start=start+1</span><br><span class="line">    enddo</span><br><span class="line">enddo</span><br><span class="line"></span><br><span class="line">! 选择第1道作为参考道，形成参考道refer</span><br><span class="line">do i=1,100</span><br><span class="line">    refer(i) = Xorigin(1,i)</span><br><span class="line">enddo</span><br><span class="line"></span><br><span class="line">! refer与各道做互相关求取各道的相对剩余静校正量static</span><br><span class="line">! 做互相关</span><br><span class="line">do i=1,10</span><br><span class="line">    call COAUTCOR(100,100,M,refer, Xorigin(i,:), rxy(i,:))</span><br><span class="line">enddo</span><br><span class="line"></span><br><span class="line">! 绘制互相关曲线</span><br><span class="line">open(3, file=&#x27;ch11_outTAO.dat&#x27;, status=&#x27;replace&#x27;,action=&#x27;write&#x27;)</span><br><span class="line"></span><br><span class="line">do j=1,M</span><br><span class="line">    write(3,300)  j-1, rxy(1,j), rxy(2,j), rxy(3,j), rxy(4,j), rxy(5,j), rxy(6,j), rxy(7,j), rxy(8,j), rxy(9,j), rxy(10,j)</span><br><span class="line">enddo</span><br><span class="line">300 format(I4,10(x,F15.4))</span><br><span class="line"></span><br><span class="line">! 由上面的互相关曲线得到了剩余静校正量：static</span><br><span class="line">do i=1,10</span><br><span class="line">    static(i,:)=maxloc(rxy(i,:))</span><br><span class="line">enddo</span><br><span class="line"></span><br><span class="line">! 进行静校正</span><br><span class="line">! 初始化为0，避免生成错误数据</span><br><span class="line">do i=1,10</span><br><span class="line">    do j=1,100</span><br><span class="line">        X_static(i,j)=0.</span><br><span class="line">    enddo</span><br><span class="line">enddo</span><br><span class="line">! 进行静校正</span><br><span class="line">do i=1,10</span><br><span class="line">    sta=static(i,1)</span><br><span class="line">    k=1</span><br><span class="line">    do j=sta,100</span><br><span class="line">        X_static(i,k)=Xorigin(i,j)</span><br><span class="line">        k=k+1</span><br><span class="line">    enddo</span><br><span class="line">enddo</span><br><span class="line">! 输出原始数据集</span><br><span class="line">open(2, file=&#x27;ch11_input.dat&#x27;, status=&#x27;replace&#x27;,action=&#x27;write&#x27;)</span><br><span class="line">do i=1,1000</span><br><span class="line">    write(2,200)  i, X(i)</span><br><span class="line">enddo</span><br><span class="line">200 format(I4,x,F15.4)</span><br><span class="line">! 输出静校正后的数据</span><br><span class="line">open(4, file=&#x27;ch11_outstatic.dat&#x27;, status=&#x27;replace&#x27;,action=&#x27;write&#x27;)</span><br><span class="line">do j=1,100</span><br><span class="line">    write(4,400)  j, X_static(1,j), X_static(2,j), X_static(3,j), &amp;</span><br><span class="line">    X_static(4,j), X_static(5,j), X_static(6,j), X_static(7,j), X_static(8,j), X_static(9,j), X_static(10,j)</span><br><span class="line">enddo</span><br><span class="line">400 format(I4,10(x,F15.4))</span><br><span class="line"></span><br><span class="line">end program ch11_static</span><br><span class="line"></span><br><span class="line">! 互相关</span><br><span class="line">	SUBROUTINE COAUTCOR(J,L,K,A,B,C)     </span><br><span class="line">	DIMENSION A(J),B(L),C(K)</span><br><span class="line">	DO 7 N=1,K</span><br><span class="line">	C(N)=0.0</span><br><span class="line">	IF (J.LE.L+1-N) THEN</span><br><span class="line">		MIN=J</span><br><span class="line">	ELSE </span><br><span class="line">		MIN=L+1-N</span><br><span class="line">	ENDIF</span><br><span class="line"> 	DO 6 IA=1,MIN</span><br><span class="line">	IB=IA+N-1</span><br><span class="line">  6	C(N)=C(N)+A(IA)*B(IB)</span><br><span class="line">  7	CONTINUE</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">clear</span><br><span class="line">load ch11_input.dat</span><br><span class="line">load ch11_outTAO.dat</span><br><span class="line">load ch11_outstatic.dat</span><br><span class="line"></span><br><span class="line">figure(1)</span><br><span class="line">hold on</span><br><span class="line">sgtitle(&#x27;原始地震道&#x27;)</span><br><span class="line">for i=1:10</span><br><span class="line">    subplot(10,1,i)</span><br><span class="line">    plot(1:100, ch11_input(i*100-99:i*100,2))</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">figure(2)</span><br><span class="line">hold on</span><br><span class="line">sgtitle(&#x27;相关函数曲线&#x27;)</span><br><span class="line">for i=1:10 </span><br><span class="line">    subplot(10,1,i)</span><br><span class="line">    plot( ch11_outTAO(:,1), ch11_outTAO(:,i+1))</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">figure(3)</span><br><span class="line">hold on</span><br><span class="line">sgtitle(&#x27;静校正后的地震数据&#x27;)</span><br><span class="line">for i=1:10 </span><br><span class="line">    subplot(10,1,i)</span><br><span class="line">    plot( ch11_outstatic(:,1), ch11_outstatic(:,i+1))</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/default%20=%20''/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/default%20=%20''/page/6/">6</a><a class="extend next" rel="next" href="/default%20=%20''/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder"></span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  





</body>
</html>
