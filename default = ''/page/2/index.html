<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 5.4.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"zhiyuanshi1901.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.12.2","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="日常学习笔记">
<meta property="og:url" content="https://zhiyuanshi1901.github.io/default%20=%20''/page/2/index.html">
<meta property="og:site_name" content="日常学习笔记">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Shi Zhiyuan">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://zhiyuanshi1901.github.io/default%20=%20''/page/2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"default = ''/page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>日常学习笔记</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">日常学习笔记</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">16</span></a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">31</span></a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Shi Zhiyuan</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">60</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">31</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/ZhiyuanShi1901" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ZhiyuanShi1901" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:dshi78066@gmail.com" title="Personal E-Mail → mailto:dshi78066@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>Personal E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:1901030201@s.upc.edu.cn" title="Work E-Mail → mailto:1901030201@s.upc.edu.cn" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>Work E-Mail</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhiyuanshi1901.github.io/2023/03/01/%E5%9C%A8linux%E5%B9%B3%E5%8F%B0%E4%BD%BF%E7%94%A8%E8%85%BE%E8%AE%AF%E4%BC%9A%E8%AE%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Shi Zhiyuan">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="日常学习笔记">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 日常学习笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/01/%E5%9C%A8linux%E5%B9%B3%E5%8F%B0%E4%BD%BF%E7%94%A8%E8%85%BE%E8%AE%AF%E4%BC%9A%E8%AE%AE/" class="post-title-link" itemprop="url">在linux平台使用腾讯会议</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-03-01 16:46:56 / 修改时间：16:51:50" itemprop="dateCreated datePublished" datetime="2023-03-01T16:46:56+08:00">2023-03-01</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Zqinstarking/article/details/128053342">https://blog.csdn.net/Zqinstarking/article/details/128053342</a></p>
<p>下载腾讯会议deb包。</p>
<p>解压deb包，并解压data包。</p>
<p>在某个地方（比如桌面）创建一个sh脚本文件。这里命名为<code>getwemeetapp.sh</code>。</p>
<p>脚本文件中输入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">cd ~/Documents/tencentmeeting/data/opt/wemeet  # 此处为腾讯会议下载解压后的地址。</span><br><span class="line">sh wemeetapp.sh</span><br></pre></td></tr></table></figure>
<p>事实上可以直接在任何地方运行，但是每次需要输入很长的语句，使用另一个sh脚本可以快速打开。</p>
<p>在桌面打开终端，运行：<br><code>./getwemeetapp.sh</code><br>即可打开腾讯会议。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhiyuanshi1901.github.io/2023/02/25/%E5%B8%B8%E7%94%A8%E8%AE%BA%E6%96%87%E7%BD%91%E7%AB%99/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Shi Zhiyuan">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="日常学习笔记">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 日常学习笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/02/25/%E5%B8%B8%E7%94%A8%E8%AE%BA%E6%96%87%E7%BD%91%E7%AB%99/" class="post-title-link" itemprop="url">常用论文网站</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-02-25 16:36:33" itemprop="dateCreated datePublished" datetime="2023-02-25T16:36:33+08:00">2023-02-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-02-28 15:59:55" itemprop="dateModified" datetime="2023-02-28T15:59:55+08:00">2023-02-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>这里整理一些常用的论文查找网站。</p>
<h1 id="汇总型网站-按照推荐顺序排列"><a href="#汇总型网站-按照推荐顺序排列" class="headerlink" title="汇总型网站 (按照推荐顺序排列)"></a>汇总型网站 (按照推荐顺序排列)</h1><p><a target="_blank" rel="noopener" href="https://www.researchgate.net/">researchgate</a><br>在这个网站可以找到大部分发表文献的作者，向其提交申请，经过对方同意可以获取文献。并且网站具有交流的功能，可以通过follow等方式关注感兴趣的作者和内容。</p>
<p><a target="_blank" rel="noopener" href="https://www.academia.edu/">academia</a><br>可以直接下载文献。</p>
<p><a target="_blank" rel="noopener" href="https://www.sciencedirect.com/">Sciencedirect</a><br>可以通过机构登录获取文献。</p>
<p><a target="_blank" rel="noopener" href="https://link.springer.com/">springer</a><br>可以通过机构登录获取文献。</p>
<p><a target="_blank" rel="noopener" href="https://www.semanticscholar.org/">semanticscholar</a></p>
<h1 id="期刊"><a href="#期刊" class="headerlink" title="期刊"></a>期刊</h1><p>此仅放置相应的期刊官网。可以通过google搜索到相应期刊官网，一些文献可以直接下载。</p>
<p><a target="_blank" rel="noopener" href="https://agupubs.onlinelibrary.wiley.com/">American Geophysical Union</a><br>美国地球物理学会。</p>
<p><a target="_blank" rel="noopener" href="https://pubs.geoscienceworld.org/">GeoScienceWorld</a><br>GeoScienceWorld（GSW）是由7家地球科学领域的顶尖协会共同建立的非营利型组织。（词源百度百科）</p>
<p><a target="_blank" rel="noopener" href="https://core.ac.uk/">Core</a><br>CORE is the world’s largest aggregator of open access research papers from repositories and journals. (词源官网)</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhiyuanshi1901.github.io/2023/02/07/baidu_verify_codeva-0NlQJTBPs1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Shi Zhiyuan">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="日常学习笔记">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 日常学习笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/02/07/baidu_verify_codeva-0NlQJTBPs1/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-02-07 12:18:04 / 修改时间：12:16:53" itemprop="dateCreated datePublished" datetime="2023-02-07T12:18:04+08:00">2023-02-07</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          34e895a3fd0bee1dadbd8358d3b14d24
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhiyuanshi1901.github.io/2023/02/05/Python-SAC-IO/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Shi Zhiyuan">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="日常学习笔记">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 日常学习笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/02/05/Python-SAC-IO/" class="post-title-link" itemprop="url">Python-SAC-IO</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-02-05 20:50:23" itemprop="dateCreated datePublished" datetime="2023-02-05T20:50:23+08:00">2023-02-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-04-22 15:53:24" itemprop="dateModified" datetime="2023-04-22T15:53:24+08:00">2023-04-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>在Python中使用包实现SAC文件读取。有如下三个SAC读取相关的库：<br><a target="_blank" rel="noopener" href="https://github.com/pysmo/pysmo">pysmo</a><br><a target="_blank" rel="noopener" href="https://github.com/eost/sacpy">sacpy</a><br><a target="_blank" rel="noopener" href="https://pyrocko.org/docs/current/install/packages/anaconda.html">pyrocko</a></p>
<p>注意：有些库不支持较高的Python版本。例如pyrocko只支持到3.6.*版本。使用conda创建环境较为方便，建议使用3.6版本的<br>python，在改版本下均可安装以下库及Obspy。</p>
<p>运行如果出现报错：</p>
<pre><code>&#39;version_info&#39; object has no attribute &#39;__version__&#39;
</code></pre>
<p>试一下运行：</p>
<pre><code>pip install pyparsing==2.4.7
</code></pre>
<h1 id="pysmo"><a href="#pysmo" class="headerlink" title="pysmo"></a>pysmo</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><pre><code>pip install pysmo
pip install pysmo --pre
pip install git+https://github.com/pysmo/pysmo
</code></pre>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>官方文档：<a target="_blank" rel="noopener" href="https://pysmo.readthedocs.io/en/latest/sac.html">https://pysmo.readthedocs.io/en/latest/sac.html</a></p>
<h3 id="读取文件"><a href="#读取文件" class="headerlink" title="读取文件"></a>读取文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">from pysmo import SacIO</span><br><span class="line">seismogram = SacIO.from_file(&#x27;filename.sac&#x27;)</span><br><span class="line">datas = seismogram.data</span><br><span class="line">print(datas)</span><br></pre></td></tr></table></figure>

<h3 id="读取采样率"><a href="#读取采样率" class="headerlink" title="读取采样率"></a>读取采样率</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">delta = seismogram.delta</span><br><span class="line">print(delta)</span><br></pre></td></tr></table></figure>

<h3 id="修改采样率"><a href="#修改采样率" class="headerlink" title="修改采样率"></a>修改采样率</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">seismogram.delta = 0.05</span><br></pre></td></tr></table></figure>
<h3 id="读取IRIS的地震数据"><a href="#读取IRIS的地震数据" class="headerlink" title="读取IRIS的地震数据"></a>读取IRIS的地震数据</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from pysmo import SacIO</span><br><span class="line">&gt;&gt;&gt; my_sac = SacIO.from_iris(</span><br><span class="line">&gt;&gt;&gt;             net=&quot;C1&quot;,</span><br><span class="line">&gt;&gt;&gt;             sta=&quot;VA01&quot;,</span><br><span class="line">&gt;&gt;&gt;             cha=&quot;BHZ&quot;,</span><br><span class="line">&gt;&gt;&gt;             loc=&quot;--&quot;,</span><br><span class="line">&gt;&gt;&gt;             start=&quot;2021-03-22T13:00:00&quot;,</span><br><span class="line">&gt;&gt;&gt;             duration=1 * 60 * 60,</span><br><span class="line">&gt;&gt;&gt;             scale=&quot;AUTO&quot;,</span><br><span class="line">&gt;&gt;&gt;             demean=&quot;true&quot;,</span><br><span class="line">&gt;&gt;&gt;             force_single_result=True)</span><br><span class="line">&gt;&gt;&gt; my_sac.npts</span><br><span class="line">144001</span><br></pre></td></tr></table></figure>


<h1 id="sacpy"><a href="#sacpy" class="headerlink" title="sacpy"></a>sacpy</h1><h2 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h2><p>使用pip即可</p>
<pre><code>pip install sacpy
</code></pre>
<h1 id="pyrocko"><a href="#pyrocko" class="headerlink" title="pyrocko"></a>pyrocko</h1><h1 id="Obspy"><a href="#Obspy" class="headerlink" title="Obspy"></a>Obspy</h1><p>Obspy也可以直接读取sac文件。如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import obspy</span><br><span class="line">import numpy as np</span><br><span class="line">import matplotlib.pyplot as plt</span><br><span class="line"></span><br><span class="line">st = obspy.read(&quot;filename.sac&quot;)</span><br><span class="line">tr=st[0]</span><br><span class="line">print(st)</span><br><span class="line">print(type(st))</span><br><span class="line">print(st[0].data)</span><br><span class="line">print(st[0].stats.delta)</span><br></pre></td></tr></table></figure>
<p>注意： 使用obspy读取得到的为stream格式，该格式是一个列表。需要使用<code>st[0]</code>表示sac的图像数据。</p>
<h2 id="获取基本信息"><a href="#获取基本信息" class="headerlink" title="获取基本信息"></a>获取基本信息</h2><pre><code>st[0].stats
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">      network: NA</span><br><span class="line">      station: BILL</span><br><span class="line">     location: </span><br><span class="line">      channel: LHE</span><br><span class="line">    starttime: 2000-01-14T23:37:10.800000Z</span><br><span class="line">      endtime: 2000-01-15T00:30:29.800000Z</span><br><span class="line">sampling_rate: 1.0</span><br><span class="line">        delta: 1.0</span><br><span class="line">         npts: 3200</span><br><span class="line">        calib: 1.0</span><br><span class="line">      _format: SAC</span><br><span class="line">          sac: AttribDict(&#123;&#x27;delta&#x27;: 1.0, &#x27;depmin&#x27;: -4299.8511, &#x27;depmax&#x27;: 4099.0977, &#x27;b&#x27;: 0.0, &#x27;e&#x27;: 3199.0, &#x27;o&#x27;: 0.0, &#x27;internal0&#x27;: 2.0, &#x27;stla&#x27;: 68.065102, &#x27;stlo&#x27;: 166.45239, &#x27;stdp&#x27;: 0.0, &#x27;evla&#x27;: 25.610001, &#x27;evlo&#x27;: 101.06, &#x27;evdp&#x27;: 33000.0, &#x27;dist&#x27;: 6370.9048, &#x27;az&#x27;: 23.937832, &#x27;baz&#x27;: 257.17334, &#x27;gcarc&#x27;: 57.340527, &#x27;depmen&#x27;: -2.0147384e-06, &#x27;nzyear&#x27;: 2000, &#x27;nzjday&#x27;: 14, &#x27;nzhour&#x27;: 23, &#x27;nzmin&#x27;: 37, &#x27;nzsec&#x27;: 10, &#x27;nzmsec&#x27;: 800, &#x27;nvhdr&#x27;: 6, &#x27;norid&#x27;: 0, &#x27;nevid&#x27;: 0, &#x27;npts&#x27;: 3200, &#x27;iftype&#x27;: 1, &#x27;iztype&#x27;: 9, &#x27;leven&#x27;: 1, &#x27;lpspol&#x27;: 0, &#x27;lovrok&#x27;: 1, &#x27;lcalda&#x27;: 1, &#x27;unused23&#x27;: 0, &#x27;kstnm&#x27;: &#x27;BILL&#x27;, &#x27;kcmpnm&#x27;: &#x27;LHE&#x27;, &#x27;knetwk&#x27;: &#x27;NA&#x27;, &#x27;kevnm&#x27;: &#x27;&#x27;&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="获取采样率"><a href="#获取采样率" class="headerlink" title="获取采样率"></a>获取采样率</h2><pre><code>st[0].stats.delta
</code></pre>
<h1 id="去趋势"><a href="#去趋势" class="headerlink" title="去趋势"></a>去趋势</h1><p>使用：</p>
<pre><code>st=obspy.read(filepath)
st[0].detrend(&#39;polynomial&#39;, order=3) # 进行去趋势，选择为多项式，阶数为3
</code></pre>
<p>去除线性或者多阶趋势。<br>选项1可选：</p>
<ul>
<li>simple<br>Subtracts a linear function defined by first&#x2F;last sample of the trace (uses obspy.signal.detrend.simple()).</li>
<li>linear<br>Fitting a linear function to the trace with least squares and subtracting it (uses scipy.signal.detrend()).</li>
<li>constant or demean<br>Mean of data is subtracted (uses scipy.signal.detrend()).</li>
<li>polynomial<br>Subtracts a polynomial of a given order. (uses obspy.signal.detrend.polynomial()).</li>
<li>spline<br>Subtracts a spline of a given order with a given number of samples between spline nodes.(uses obspy.signal.detrend.spline()).</li>
</ul>
<h1 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h1><h2 id><a href="#" class="headerlink" title></a></h2><p>使用方法</p>
<p>在最后两行：<br>第一行为图所在目录（文件夹），文件为SAC格式。如果不是SAC格式，将被忽略。<br>第二行为：</p>
<ul>
<li>path1 路径 </li>
<li>2 图类型type<ul>
<li>type&#x3D;1 速度图</li>
<li>type&#x3D;2 加速度图<br>均转换为位移图。</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">import numpy</span><br><span class="line">import sacpy</span><br><span class="line">import pysmo</span><br><span class="line"># import pyrocko</span><br><span class="line">import obspy</span><br><span class="line">import numpy as np</span><br><span class="line">import matplotlib.pyplot as plt</span><br><span class="line">from pysmo import SacIO</span><br><span class="line">import os</span><br><span class="line">from obspy.signal.detrend import polynomial  # 去除多阶趋势</span><br><span class="line"></span><br><span class="line">def cusdetrend(filepath, tr, order=3):  # 去趋势</span><br><span class="line"># 文件路径；由读取sac文件得到的trace，即seismogram[0]；执行多项式去趋势的阶数，默认为3阶</span><br><span class="line">    seismogram = tr.copy()</span><br><span class="line">    been_detrend = seismogram.detrend(&#x27;polynomial&#x27;, order=order) # 进行去趋势，选择为多项式，阶数为3</span><br><span class="line">    return been_detrend</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def integral(input_file, dt):  # 执行积分</span><br><span class="line"># 输入文件为列表文件；dt为时间采样间隔</span><br><span class="line">    length = len(input_file)</span><br><span class="line">    output = [0 for i in range(0, length)]</span><br><span class="line">    for i in range(0, length-1):</span><br><span class="line">        if i == 0:</span><br><span class="line">            output[i] = 0</span><br><span class="line">        else:</span><br><span class="line">            time = 0</span><br><span class="line">            for j in range(0, i):</span><br><span class="line">                time = time + (input_file[j]+input_file[j+1])/2*dt</span><br><span class="line">            output[i] = time</span><br><span class="line"></span><br><span class="line">    return output</span><br><span class="line"></span><br><span class="line">def cus2disp(input_file, dt, type): # 转换为位移图， </span><br><span class="line"># 输入文件（列表）；采样时间间隔；输入图形类型（1为速度图，2为加速度图）</span><br><span class="line">    if type == 1:</span><br><span class="line">        outfile = integral(input_file, dt)</span><br><span class="line">    elif type == 2:</span><br><span class="line">        outfile = integral(integral(input_file, dt), dt)</span><br><span class="line">    else:</span><br><span class="line">        print(&#x27;wrong input type!&#x27;)</span><br><span class="line">    return outfile</span><br><span class="line"></span><br><span class="line">def savejpg(filepath, tr, imgtype):  # 绘制图形</span><br><span class="line"># 文件路径；trace；图形类型，目前没有用</span><br><span class="line">    # 调整画布大小，进行绘制</span><br><span class="line">    t = np.arange(0, (tr.stats.npts / tr.stats.sampling_rate), tr.stats.delta)</span><br><span class="line">    fig = plt.figure(1, figsize=(16, 9), dpi=200)</span><br><span class="line">    plt.subplot(2, 1, 2)</span><br><span class="line">    plt.plot(t, tr.data, &#x27;k&#x27;)</span><br><span class="line">    plt.xlabel(&#x27;T(s)&#x27;)</span><br><span class="line">    plt.ylabel(&#x27;Displacement(nm)&#x27;)</span><br><span class="line">    plt.title(&#x27;had detrend&#x27;+&#x27; &#x27;+tr.stats.station+tr.stats.channel)</span><br><span class="line">    # 判断文件是否存在, 存在，则删除文件</span><br><span class="line">    savepath=filepath+&#x27;detrend&#x27;+tr.stats.station+&#x27;_&#x27;+tr.stats.channel+&#x27;.jpg&#x27;</span><br><span class="line">    if(os.path.exists(savepath)):</span><br><span class="line">        os.remove(savepath)</span><br><span class="line">    # 保存</span><br><span class="line">    print(&#x27;###############################&#x27;)</span><br><span class="line">    print(&#x27;saving jpg file.&#x27;)</span><br><span class="line">    plt.savefig(filepath+&#x27;detrend&#x27;+tr.stats.station+&#x27;_&#x27;+tr.stats.channel+&#x27;.jpg&#x27;)</span><br><span class="line">    print(f&#x27;The file has been saved as &#123;filepath&#125;&#123;tr.stats.station&#125;_&#123;tr.stats.channel&#125;.jpg&#x27;)</span><br><span class="line">    print(&#x27;###############################&#x27;)</span><br><span class="line">    # plt.show()</span><br><span class="line">    plt.close(fig)</span><br><span class="line">    plt.close(&#x27;all&#x27;)</span><br><span class="line"></span><br><span class="line">    # 判断文件是否存在, 存在，则删除文件</span><br><span class="line">    savepath=filepath+&#x27;detrend&#x27;+tr.stats.station+&#x27;_&#x27;+tr.stats.channel+&#x27;.sac&#x27;</span><br><span class="line">    if(os.path.exists(savepath)):</span><br><span class="line">        os.remove(savepath)</span><br><span class="line">    print(&#x27;###############################&#x27;)</span><br><span class="line">    print(&#x27;saving sac file...&#x27;)</span><br><span class="line">    tr.write(savepath, format=&#x27;SAC&#x27;)</span><br><span class="line">    print(f&#x27;The file has been saved as &#123;filepath&#125;&#123;tr.stats.station&#125;_&#123;tr.stats.channel&#125;.jpg&#x27;)</span><br><span class="line">    print(&#x27;###############################&#x27;)</span><br><span class="line"></span><br><span class="line">def acc2dis_detrend(path, type):  # 主程序：转换为displacement并去趋势</span><br><span class="line"># 文件路径；type=1 为velo，type=2为acc</span><br><span class="line">    for file_name in os.listdir(path):</span><br><span class="line">        if(file_name[-3:]!=&#x27;SAC&#x27;):  # 避免读取其他文件</span><br><span class="line">            continue</span><br><span class="line">        filepath = path+&#x27;/&#x27;+file_name</span><br><span class="line">        seismogram = obspy.read(filepath)</span><br><span class="line">        trace = seismogram[0]</span><br><span class="line">        # 进行转换,返回值为列表</span><br><span class="line">        trace_data = cus2disp(trace.data, dt=trace.stats.delta, type=type)</span><br><span class="line">        # 列表导入到stream数据中,只有这样才能使用obspy的去趋势函数。</span><br><span class="line">        trace.data = numpy.array(trace_data[0:len(trace_data)-1])</span><br><span class="line">        print(trace.data)</span><br><span class="line">        # 进行去趋势</span><br><span class="line">        detrend_result = cusdetrend(filepath, trace, order=3)  # 进行去趋势。</span><br><span class="line">        # 保存</span><br><span class="line">        if type == 1:</span><br><span class="line">            imgtype = &#x27;velocity(nm/s)&#x27;</span><br><span class="line">        elif type == 2:</span><br><span class="line">            imgtype = &#x27;accelate(nm/s2)&#x27;</span><br><span class="line">        savejpg(filepath, detrend_result, imgtype)</span><br><span class="line"></span><br><span class="line"># 文件所在位置</span><br><span class="line">path1 = &#x27;G:/Pythonworks/Obspy_data_solve/seismogram/0_200acc&#x27;</span><br><span class="line"># 执行</span><br><span class="line">acc2dis_detrend(path1, 2)</span><br></pre></td></tr></table></figure>

<h1 id="归一化"><a href="#归一化" class="headerlink" title="归一化"></a>归一化</h1><h2 id="安装-sklearn-库"><a href="#安装-sklearn-库" class="headerlink" title="安装 sklearn 库"></a>安装 sklearn 库</h2><p>conda 安装：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda install -c anaconda scikit-learn</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhiyuanshi1901.github.io/2023/01/27/mineos%E7%A8%8B%E5%BA%8F%E8%A7%A3%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Shi Zhiyuan">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="日常学习笔记">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 日常学习笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/01/27/mineos%E7%A8%8B%E5%BA%8F%E8%A7%A3%E6%9E%90/" class="post-title-link" itemprop="url">mineos程序解析</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-01-27 17:46:21" itemprop="dateCreated datePublished" datetime="2023-01-27T17:46:21+08:00">2023-01-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-03-25 19:12:08" itemprop="dateModified" datetime="2023-03-25T19:12:08+08:00">2023-03-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%9C%B0%E9%9C%87%E5%AD%A6%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/" itemprop="url" rel="index"><span itemprop="name">地震学常用软件</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="简要说明"><a href="#简要说明" class="headerlink" title="简要说明"></a>简要说明</h1><p>本文主要对mineos软件运行的程序进行深入解析，尝试理解程序运行的原理。<br>内容均源自mineos软件的程序代码。</p>
<h1 id="minos-bran程序子进程介绍"><a href="#minos-bran程序子进程介绍" class="headerlink" title="minos_bran程序子进程介绍"></a>minos_bran程序子进程介绍</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wmin=max(wmin,0.1d0) ! wmin最小为0.1mhz，此为w最小限制。</span><br><span class="line"></span><br><span class="line">if(lmin.le.0) lmin=1 ! l最小值小于等于0时，l最小值为1</span><br><span class="line">if(jcom.eq.1) then  ! jcom等于1（径向振型）时，l只计算0阶情况</span><br><span class="line">    lmin=0</span><br><span class="line">    lmax=0</span><br><span class="line">end if</span><br></pre></td></tr></table></figure>
<p>w最小为0.1mHz，这是w的最小限制<br>l最小值为1<br>选择计算径向振型时，l只计算基阶，即l&#x3D;0的情况。</p>
<h2 id="model-iin-iout"><a href="#model-iin-iout" class="headerlink" title="model(iin, iout)"></a>model(iin, iout)</h2><h3 id="drspln-i1-i2-x-y-q-f"><a href="#drspln-i1-i2-x-y-q-f" class="headerlink" title="drspln(i1,i2,x,y,q,f)"></a>drspln(i1,i2,x,y,q,f)</h3><p><em>rspln computes cubic spline interpolation coefficients for y(x) between grid points i1 and i2 saving them in q.<br>the interpolation is continuous with continuous first and second derivitives.<br>it agrees exactly with y at grid points and with the three point first derivitives at both end points (i1 and i2).<br>x must be monotonic but if two successive values of x are equal a discontinuity is assumed and<br>seperate interpolation is done on each strictly monotonic segment.<br>the arrays must be dimensioned at least - x(i2), y(i2), q(3,i2), and f(3,i2). f is working storage for rspln.  -rpb</em></p>
<p>rspln在i1与i2点之间计算y(x)的三次样条插值系数，将系数保存到q。<br>插值是连续的，具有连续的一阶和二阶导数。<br>它与网格点处的 y 以及两个端点（i1 和 i2）处的三点一阶导数完全一致。<br>x 必须是单调的，但如果 x 的两个连续值相等，则假定此处为间断面（模型具有莫霍面和古登堡面等），对每个严格单调的部分进行单独插值。（有间断面的情况插值在间断面之间进行）<br>数组的维度必须至少为 - x(i2)、y(i2)、q(3,i2) 和 f(3,i2)。（例如，i1&#x3D;1，i2&#x3D;n（模型节点数），x&#x3D;r，y&#x3D;rho）<br>f 是 rspln 的工作存储器。</p>
<p>示例：</p>
<pre><code>drspln(1,n,r,rho,qro,wrk)
</code></pre>
<p>从点1-n进行对rho(r)的spline插值，结果保存到qro中。<br>wrk为一个工作存储器，存储器可能只是用于存储中间值，无实际含义。（存疑）</p>
<h3 id="grav-g-rho-qro-r-n"><a href="#grav-g-rho-qro-r-n" class="headerlink" title="grav(g,rho,qro,r,n)"></a>grav(g,rho,qro,r,n)</h3><p><em>given rho and spline coeffs,computes gravity</em><br>给定 rho 和样条系数，计算重力。</p>
<p>变量：</p>
<ul>
<li>nsl 地表边界，为固态侧边界。若是具有海洋的地球模型，则nsl为地表与海洋边界的固态侧。</li>
<li>nslp1 地表边界，液态侧。</li>
<li>ncip1 ICB索引液态侧</li>
<li>nocp1 CMB索引固态侧</li>
<li>tref 校正值。&lt;&#x3D;0时无校正。</li>
</ul>
<h2 id="wtable-iout-ioeig-ifreq"><a href="#wtable-iout-ioeig-ifreq" class="headerlink" title="wtable(iout,ioeig,ifreq)"></a>wtable(iout,ioeig,ifreq)</h2><p><em>makes up table of frequencies</em><br>计算本征频率列表</p>
<p>共用区变量：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">common/bits/pi,rn,vn,wn,w,wsq,wray,qinv,cg,wgrav,tref,fct,eps,fl,</span><br><span class="line">  +  fl1,fl2,fl3,sfl3,jcom,nord,l,kg,kount,knsw,ifanis,iback</span><br><span class="line">   common/shanks/b(46),c(10),dx,step(8),stepf,maxo,in</span><br><span class="line">   common/mtab/we(2),de(2),ke(2),wtry,bm</span><br></pre></td></tr></table></figure>
<ul>
<li>iout 输出模型列表文件单元号</li>
<li>ioeig 输出本征函数文件单元号</li>
<li>ifreq &#x3D;0时不输出本征函数文件</li>
</ul>
<h3 id="steps-eps"><a href="#steps-eps" class="headerlink" title="steps(eps)"></a>steps(eps)</h3><p>计算8个无量纲step大小for rks integration积分</p>
<ul>
<li>eps 输入的eps，即准确度大小。</li>
</ul>
<h3 id="detqn-wdim-knt-det-ifeif"><a href="#detqn-wdim-knt-det-ifeif" class="headerlink" title="detqn(wdim,knt,det,ifeif)"></a>detqn(wdim,knt,det,ifeif)</h3><p><em>supevises the integration of the equations,it returns the value<br>of the secular determinant as det and the count of zero crossings</em><br>假设方程的积分，它返回行列式形式的secular dterminant的值（det）和零交点数量。</p>
<ul>
<li>wdim 一个二维数组，为最小和最大本征频率计算范围</li>
<li>knt 零交叉点数量</li>
<li>det 长期行列式的值</li>
<li>ifeif</li>
</ul>
<p>共用区变量：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> common r(mk),fmu(mk),flam(mk),qshear(mk),qkappa(mk),</span><br><span class="line">+ xa2(mk),xlam(mk),rho(mk),qro(3,mk),g(mk),qg(3,mk),</span><br><span class="line">+ fcon(mk),fspl(3,mk),lcon(mk),lspl(3,mk),ncon(mk),</span><br><span class="line">+ nspl(3,mk),ccon(mk),cspl(3,mk),acon(mk),aspl(3,mk)</span><br><span class="line"> common/bits/pi,rn,vn,wn,w,wsq,wray,qinv,cg,wgrav,tref,fct,eps,fl,</span><br><span class="line">+  fl1,fl2,fl3,sfl3,jcom,nord,l,kg,kount,knsw,ifanis,iback</span><br><span class="line"> common/eifx/a(14,mk),dum(mk)</span><br><span class="line"> common/rindx/nic,noc,nsl,nicp1,nocp1,nslp1,n</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">print *,&#x27;eigenfunction file (output):&#x27;</span><br><span class="line">read(5,100) filnam</span><br><span class="line">print *,filnam(1:lnblnk(filnam))</span><br><span class="line">ifreq=1</span><br><span class="line">if(filnam(1:4).eq.&#x27;none&#x27;) ifreq=0 ! 如果filnam前四个字符为none，则ifreq=0</span><br><span class="line">open(3,file=filnam,form=&#x27;unformatted&#x27;,iostat=iret)</span><br></pre></td></tr></table></figure>
<p>这里说明了ifreq的来历。当本征函数文件（eigenfunction file）名前四个字符为none时，ifreq&#x3D;0，将不再计算本征函数文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(ifeif.eq.0) return</span><br></pre></td></tr></table></figure>
<p>该语句表明ifreq在detqn子进程中为ifeif参数。当ifreq&#x3D;0时，即本征函数文件名为：’none*’时不再输出本征函数文件（文件为空）。</p>
<h4 id="sdepth-wdim-ls"><a href="#sdepth-wdim-ls" class="headerlink" title="sdepth(wdim,ls)"></a>sdepth(wdim,ls)</h4><p>finds starting level,ls, for a given l and w<br>对于给定的l和w寻找开始的层ls</p>
<h4 id="fprpmn-jf-jl-f-h-nvefm-iexp"><a href="#fprpmn-jf-jl-f-h-nvefm-iexp" class="headerlink" title="fprpmn(jf,jl,f,h,nvefm,iexp)"></a>fprpmn(jf,jl,f,h,nvefm,iexp)</h4><p>propagate the minor vector in a fluid region from level jf to jl<br>在流体区域从jf层到jl层传播minor vector</p>
<h5 id="zknt-s-sp-f-fp-x-y-ifsol"><a href="#zknt-s-sp-f-fp-x-y-ifsol" class="headerlink" title="zknt(s,sp,f,fp,x,y,ifsol)"></a>zknt(s,sp,f,fp,x,y,ifsol)</h5><p>zknt(s,h,f,fp,x,y,1)</p>
<p>给定次向量和导数，构造模式计数</p>
<h4 id="remedy-ls"><a href="#remedy-ls" class="headerlink" title="remedy(ls)"></a>remedy(ls)</h4><p>Obtains the eigenfunction of an awkward spheroidal mode by integrating to the icb or the mcb.<br>通过积分到ICB或CMB得到一个不合适的（awkward）球振振型的本征函数</p>
<h5 id="fprop-jf-jl-f-iexp"><a href="#fprop-jf-jl-f-iexp" class="headerlink" title="fprop(jf,jl,f,iexp)"></a>fprop(jf,jl,f,iexp)</h5><p><em>fprop propagates the fundamental matrix f from jf to jl (a fluid region)</em><br>fprop 将基本矩阵 f 从 jf 传播到 jl（流体区域）</p>
<p>示例：</p>
<pre><code>fprop(noc,nicp1,af,iexp)
# 该函数位于2515行左右，表示地壳上海洋部分基本矩阵af的传播。
</code></pre>
<h5 id="fsbdry-af-as-kg"><a href="#fsbdry-af-as-kg" class="headerlink" title="fsbdry(af,as,kg)"></a>fsbdry(af,as,kg)</h5><p><em>fsbdry creates solid fundamental matrix as from fluid fundamental matrix af.<br>It is presumed that fsbdry is used to cross a f&#x2F;s boundary.</em></p>
<p>fsbdry 从流体基本矩阵 af 创建固体基本矩阵 as。<br>假定 fsbdry函数 用于跨越 f&#x2F;s 边界。</p>
<h5 id="sprop-li-jf-jl-f-iexp"><a href="#sprop-li-jf-jl-f-iexp" class="headerlink" title="sprop(li,jf,jl,f,iexp)"></a>sprop(li,jf,jl,f,iexp)</h5><p>sprop propagates the fundamental matrix f from jf to jl (a solid region)<br>if jorth&#x3D;1 the columns of f are orthogonalized at each level except in regions of oscillatory p and s.</p>
<p>sprop 将基本矩阵 f 从 jf 传播到jl（实心区域） 如果jnorth&#x3D;1，f的列在除振荡 p 和 s 区域之外的每个层（level）上都是正交的。</p>
<h6 id="ortho-li-lc-b-kg"><a href="#ortho-li-lc-b-kg" class="headerlink" title="ortho(li,lc,b,kg)"></a>ortho(li,lc,b,kg)</h6><p>Finds the orthogonal matrix v such that the columns of b<em>v are orthogonal,<br>the array a is replaced by a</em>v for levels li - lc.<br>Array b is replaced by b*v and is then ready for entry to sprop at level lc.<br>This is intended to diminish the onset of degeneracy caused by rapid exponential<br>growth in the mantle for modes with deeply turning S and shallowly turning P.</p>
<p>找到正交矩阵 v，使得 b<em>v 的列是正交的，对于层 li 至 lc，数组 a 被 a</em>v 替换。<br>数组 b 被 b*v 替换，然后准备好进入 lc 层的 sprop。这是为了减少由深度旋转 S 和<br>浅度旋转 P 的模式在地幔中快速指数增长引起的退化的开始。</p>
<h5 id="sfbdry-jf-jl-as-af-kg"><a href="#sfbdry-jf-jl-as-af-kg" class="headerlink" title="sfbdry(jf,jl,as,af,kg)"></a>sfbdry(jf,jl,as,af,kg)</h5><p><em>The tangential traction scalar is forced to vanish at the solid side of a s&#x2F;f boundary(level jl).<br>a(j,3,i) is elliminated for i&#x3D;jf…jl and af is loaded from a at level jl.</em><br>切向牵引标量在 s&#x2F;f 边界的实体侧（水平 jl）消失。 a(j,3,i) 对于 i&#x3D;jf…jl 被消除并且 af 从 a 在级别 jl 加载。</p>
<h5 id="baylis-q-maxo1"><a href="#baylis-q-maxo1" class="headerlink" title="baylis(q,maxo1)"></a>baylis(q,maxo1)</h5><p><em>baylis returns the coefficients for rks integration.<br>see e. baylis shanks(1966 a. m. s.) and references therein for the coefficients.<br>the eight runge-kutta-shanks formulae are (1-1) (2-2) (3-3) (4-4) (5-5) (6-6) (7-7) (8-10).<br>for orders greater than 4 the formulae are approximate rather than exact so incurring less roundoff.</em></p>
<p>baylis 返回 rks 积分的系数。 见e. baylis shanks（1966 a. m. s.）及其中的系数参考。<br>八runge-kutta-shanks公式是 (1-1) (2-2) (3-3) (4-4) (5-5) (6-6) (7-7) (8-10)。<br>对于大于 4 的阶数，公式是近似的而不是精确的，因此产生的舍入较少。</p>
<h5 id="match-n-j-kg-af-afr-icomp"><a href="#match-n-j-kg-af-afr-icomp" class="headerlink" title="match(n,j,kg,af,afr,icomp)"></a>match(n,j,kg,af,afr,icomp)</h5><p><em>Matches boundary conditions during downward integration – first try is at cmb, second try is at icb.</em><br>在向下积分时符合边界条件——第一次尝试在 cmb，第二次尝试在 icb。</p>
<h4 id="eifout-lsmin"><a href="#eifout-lsmin" class="headerlink" title="eifout(lsmin)"></a>eifout(lsmin)</h4><p><em>massages spheroidal mode eigenfunctions before output</em><br>在输出前“修改”球振振型本征函数</p>
<h3 id="rotspl-eps1-wt-iout-ioeig-ifreq-ncall"><a href="#rotspl-eps1-wt-iout-ioeig-ifreq-ncall" class="headerlink" title="rotspl(eps1,wt,iout,ioeig,ifreq,ncall)"></a>rotspl(eps1,wt,iout,ioeig,ifreq,ncall)</h3><p>通过样条差值查找roots</p>
<p>kchar 1s 2t 3s 4c</p>
<ul>
<li>eps1 输入的频率准确度控制参数eps</li>
<li>wt 两个元素的数组：wmin和wmax</li>
<li>iout 输出模型文件的单元号</li>
<li>ioeig 输出本征函数文件的单元号</li>
<li>ifreq 与本征函数文件名有关。前四个字符为none时为0,输出缺少qmod和wdiff（q和动能与势能之比-1）,其他时候为1。</li>
<li>ncall 一个有关计数的参数</li>
</ul>
<h3 id="gauslv-r1-r2-iq-fint-nint"><a href="#gauslv-r1-r2-iq-fint-nint" class="headerlink" title="gauslv(r1,r2,iq,fint,nint)"></a>gauslv(r1,r2,iq,fint,nint)</h3><p>fifth order gauss-legendre integration<br>五阶高斯-勒让德积分。</p>
<h4 id="intgds-rr-iq-vals"><a href="#intgds-rr-iq-vals" class="headerlink" title="intgds(rr,iq,vals)"></a>intgds(rr,iq,vals)</h4><p>interpolates integrands for normalisation,cg,q etc..for use with gauslv<br>插值积分以进行归一化、cg、q等，gauslv使用该�</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhiyuanshi1901.github.io/2023/01/26/%E5%9C%B0%E9%9C%87%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%96%B9%E6%B3%95%E5%AE%9E%E8%AE%AD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Shi Zhiyuan">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="日常学习笔记">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 日常学习笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/01/26/%E5%9C%B0%E9%9C%87%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%96%B9%E6%B3%95%E5%AE%9E%E8%AE%AD/" class="post-title-link" itemprop="url">地震数据处理方法实训</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-01-26 22:18:21" itemprop="dateCreated datePublished" datetime="2023-01-26T22:18:21+08:00">2023-01-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-03-04 11:58:40" itemprop="dateModified" datetime="2023-03-04T11:58:40+08:00">2023-03-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E4%BD%9C%E4%B8%9A%E5%B8%83%E7%BD%AE/" itemprop="url" rel="index"><span itemprop="name">作业布置</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="褶积滤波"><a href="#褶积滤波" class="headerlink" title="褶积滤波"></a>褶积滤波</h1><p>这里使用的子进程为实训手册中已有的子进程。<br>计算使用FORTRAN。<br>绘图使用MATLAB。</p>
<p>使用理想低通滤波器和带通滤波器进行滤波。对应滤波保留的频率范围为：<br>低通滤波器：0-70Hz<br>带通滤波器：10-80Hz</p>
<p>均使用时域下的滤波因子得到滤波器，所有滤波过程在时域之下进行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">program ch1_conv_fliter</span><br><span class="line">real, dimension(100) :: X,r_low_end=0., coun=[(i,i=1,100)],r_band_end=0.</span><br><span class="line">real,dimension (101) :: h_low=0., h_band=0., t1</span><br><span class="line">real,dimension (101+100-1) :: r_low=0., r_band=0.</span><br><span class="line">real :: wc1=70.0,wc2=10.0,wc3=80.0 ! 滤波器的滤波边界</span><br><span class="line">complex, dimension(100,2) :: C   ! 定义一个复数数组C，用于表示X。</span><br><span class="line">character(10) :: filename=&#x27;INPUT1.DAT&#x27;</span><br><span class="line">integer :: i, num=100</span><br><span class="line">real, parameter :: pi=3.1415926535, dt=2</span><br><span class="line">! 读取input1的数据并输出到屏幕</span><br><span class="line">open(1, file=filename, form=&#x27;formatted&#x27;, status=&#x27;old&#x27;)</span><br><span class="line">read (1,*)(X(i), i=1,100)</span><br><span class="line">print *,&#x27;################################################&#x27;</span><br><span class="line">print *,&#x27;This is the data in the &#x27;,filename ,&#x27;.&#x27;</span><br><span class="line">print *,&#x27;################################################&#x27;</span><br><span class="line">do i=1,100</span><br><span class="line">PRINT *,X(i)</span><br><span class="line">end do</span><br><span class="line">print *,&#x27;################################################&#x27;</span><br><span class="line"></span><br><span class="line">! 理想低通滤波器</span><br><span class="line">low_pass_fliter: do i=1,101</span><br><span class="line">t1(i) = dt*(i-100/2-1)/1000.</span><br><span class="line">! t1(i) = dt*(i-1)/1000.</span><br><span class="line">	if ((t1(i).lt.0.0001) .and. (t1(i).gt.-0.0001)) then</span><br><span class="line">	h_low(i)=2*pi*wc1/pi</span><br><span class="line">	else</span><br><span class="line">	h_low(i)=sin(2*pi*wc1*t1(i))/(pi*t1(i))</span><br><span class="line">	endif</span><br><span class="line">end do low_pass_fliter</span><br><span class="line"></span><br><span class="line">call CON(X,h_low,r_low,100,101,100+101-1)</span><br><span class="line">! 得到最后的输出，r_low_end为最终的滤波结果</span><br><span class="line">do i=1,100</span><br><span class="line">r_low_end(i)=r_low(i+50)</span><br><span class="line">end do</span><br><span class="line"></span><br><span class="line">print *,&#x27;################################################&#x27;</span><br><span class="line">print *,&#x27;This is the last result, low pass 70.&#x27;</span><br><span class="line">print *,&#x27;################################################&#x27;</span><br><span class="line">do i=1,100</span><br><span class="line">PRINT *,r_low_end(i)</span><br><span class="line">end do</span><br><span class="line">print *,&#x27;################################################&#x27;</span><br><span class="line">! 写入70HZ低通滤波器结果</span><br><span class="line">! open(2,file=&#x27;con_low_filter_70.dat&#x27;, status=&#x27;replace&#x27;, action=&#x27;write&#x27;)</span><br><span class="line">! write_70: do i=1,100</span><br><span class="line">! 	write(2,100) coun(i),r_low_end(i)</span><br><span class="line">	</span><br><span class="line">! end do write_70</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">! 理想带通滤波器</span><br><span class="line">band_pass_fliter: do i=1,101</span><br><span class="line">	if ((t1(i).lt.0.0001) .and. (t1(i).gt.-0.0001)) then</span><br><span class="line">	h_band(i)=2*pi*(wc3-wc2)/pi</span><br><span class="line">	else</span><br><span class="line">	h_band(i)=sin(2*pi*wc3*t1(i))/(pi*t1(i))-sin(2*pi*wc2*t1(i))/(pi*t1(i))</span><br><span class="line">	endif</span><br><span class="line">end do band_pass_fliter</span><br><span class="line"></span><br><span class="line">call CON(X,h_band,r_band,100,101,100+101-1)</span><br><span class="line">! 得到最后的输出，r_band_end为最终的滤波结果</span><br><span class="line">do i=1,100</span><br><span class="line">r_band_end(i)=r_band(i+50)</span><br><span class="line">end do</span><br><span class="line"></span><br><span class="line">print *,&#x27;################################################&#x27;</span><br><span class="line">print *,&#x27;This is the last result，band pass 80-10hz&#x27;</span><br><span class="line">print *,&#x27;################################################&#x27;</span><br><span class="line">do i=1,100</span><br><span class="line">PRINT *,r_band_end(i)</span><br><span class="line">end do</span><br><span class="line">print *,&#x27;################################################&#x27;</span><br><span class="line">! 写入滤波器结果</span><br><span class="line">open(3,file=&#x27;ch1_result.dat&#x27;, status=&#x27;replace&#x27;, action=&#x27;write&#x27;)</span><br><span class="line">! write(3,*) &quot;number,origin,low_pass_70,band_pass_80_10&quot;</span><br><span class="line">write_8: do i=1,100</span><br><span class="line">	write(3,100) coun(i),(i-1.)*dt ,X(i),r_low_end(i),r_band_end(i) ! number,t,origin,low_pass_70,band_pass_80_10</span><br><span class="line">100 format(F4.0,X,F6.0,x,2(F14.7,X), F14.7)</span><br><span class="line">end do write_8</span><br><span class="line">! 未经过截取的数据</span><br><span class="line">open(4,file=&#x27;ch1_result_no.dat&#x27;, status=&#x27;replace&#x27;, action=&#x27;write&#x27;)</span><br><span class="line">! write(3,*) &quot;number,origin,low_pass_70,band_pass_80_10&quot;</span><br><span class="line">write_9: do i=1,200</span><br><span class="line">	write(4,200) (i-1.)*dt ,r_low(i),r_band(i) ! number,t,origin,low_pass_70,band_pass_80_10</span><br><span class="line">200 format(2(F14.7,X), F14.7)</span><br><span class="line">end do write_9</span><br><span class="line"></span><br><span class="line">end program ch1_conv_fliter</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SUBROUTINE DFT(N,C,S)</span><br><span class="line">	COMPLEX C(N),Y(512),W</span><br><span class="line">	IF(S.EQ.1.0)Z=1.0</span><br><span class="line">	IF(S.EQ.-1.0)Z=1.0/FLOAT(N)</span><br><span class="line">	DO 20 I=1,N</span><br><span class="line">	Y(I)=(0.0,0.0)</span><br><span class="line">	DO 20 J=1,N</span><br><span class="line">	A=COS(2.0*3.14159265*(I-1)*(J-1)/FLOAT(N))</span><br><span class="line">	B=SIN(2.0*3.14159265*(I-1)*(J-1)/FLOAT(N))*(-S)</span><br><span class="line">	W=CMPLX(A,B)</span><br><span class="line"> 20	Y(I)=Y(I)+C(J)*W</span><br><span class="line">	DO 30 I=1,N</span><br><span class="line"> 30	C(I)=Y(I)*Z</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br><span class="line"></span><br><span class="line">	SUBROUTINE CON(A,B,C,I,J,K)</span><br><span class="line">	DIMENSION A(I),B(J),C(K)</span><br><span class="line">	DO 1 K1=1,K</span><br><span class="line">  1	C(K1)=0.0</span><br><span class="line">	DO 2 I1=1,I</span><br><span class="line">	DO 2 I2=1,J</span><br><span class="line">	II=I1+I2-1</span><br><span class="line">  2	C(II)=C(II)+A(I1)*B(I2)*0.004</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gfortran ch1_conv_fliter  # 编译</span><br><span class="line">./a.out # 执行</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">clear</span><br><span class="line">load ch1_result.dat</span><br><span class="line">load ch1_result_no.dat</span><br><span class="line">figure(1)</span><br><span class="line">hold on</span><br><span class="line">subplot(3,1,1)</span><br><span class="line">plot(ch1_result(:,2), ch1_result(:,3))</span><br><span class="line">title(&#x27;Origin&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(3,1,2)</span><br><span class="line">plot(ch1_result(:,2), ch1_result(:,4))</span><br><span class="line">title(&#x27;low_pass-70&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(3,1,3)</span><br><span class="line">plot(ch1_result(:,2), ch1_result(:,5))</span><br><span class="line">title(&#x27;band_pass_10-80&#x27;)</span><br><span class="line"></span><br><span class="line">figure(2)</span><br><span class="line">hold on</span><br><span class="line">subplot(3,1,2)</span><br><span class="line">plot(ch1_result_no(:,1), ch1_result_no(:,2))</span><br><span class="line">title(&#x27;low_pass-70&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(3,1,3)</span><br><span class="line">plot(ch1_result_no(:,1), ch1_result_no(:,3))</span><br><span class="line">title(&#x27;band_pass_10-80&#x27;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="快变滤波"><a href="#快变滤波" class="headerlink" title="快变滤波"></a>快变滤波</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br></pre></td><td class="code"><pre><span class="line">program ch2_fliter</span><br><span class="line">real, dimension(100) :: X</span><br><span class="line">real, dimension(:), allocatable:: X_fft_output,H_low,H_band,X_real, X_image</span><br><span class="line">COMPLEX, dimension(:), allocatable:: C, C_low,C_band ! 定义一个复数数组C，用于表示X。C_low表示使用低通滤波器得到的最终频率域数据。</span><br><span class="line">real, dimension(:,:), allocatable:: X_low, X_band</span><br><span class="line">real :: wc1=70.0,wc2=10.0,wc3=80.0,dt=2.  ! 滤波器的滤波边界! 采样间隔2ms</span><br><span class="line">character(10) :: filename=&#x27;INPUT1.DAT&#x27;</span><br><span class="line">integer :: i, num=100, nfft ! 频率域采样间隔</span><br><span class="line">real, parameter :: pi=3.1415926535 </span><br><span class="line">real :: df, k, f</span><br><span class="line">! 读取input1的数据并输出到屏幕</span><br><span class="line">open(1, file=filename, form=&#x27;formatted&#x27;, status=&#x27;old&#x27;)</span><br><span class="line">read (1,*)(X(i), i=1,100)</span><br><span class="line">print *,&#x27;################################################&#x27;</span><br><span class="line">print *,&#x27;This is the data in the &#x27;,filename ,&#x27;.&#x27;</span><br><span class="line">print *,&#x27;################################################&#x27;</span><br><span class="line">do i=1,100</span><br><span class="line">PRINT *,X(i)</span><br><span class="line">end do</span><br><span class="line">print *,&#x27;################################################&#x27;</span><br><span class="line"></span><br><span class="line">! 创建文件,输出原始数据</span><br><span class="line">open(unit=10, status=&#x27;replace&#x27;,action=&#x27;write&#x27;, file=&#x27;ch2_result.dat&#x27;)</span><br><span class="line">! write(10,*)&#x27;Origin data of seis.&#x27;</span><br><span class="line">! write(10,*)&#x27;t(ms),amplitude&#x27;</span><br><span class="line">do i=1,num</span><br><span class="line">t=(i-1)*dt</span><br><span class="line">! write(10,300) t,X(i)</span><br><span class="line">enddo</span><br><span class="line">300 format(F4.0,&#x27;,&#x27;,F15.6)</span><br><span class="line"></span><br><span class="line">dt=dt/1000. ! 转换单位为s</span><br><span class="line">! 计算FFT点数</span><br><span class="line">k=log(real(num))/log(2.)</span><br><span class="line">if(num .gt. 2**k) k=int(k+1)</span><br><span class="line">nfft=2**k</span><br><span class="line">print *, &#x27;FFT点数为：&#x27;,nfft</span><br><span class="line">! 定义可变数组大小</span><br><span class="line">allocate(X_fft_output(nfft),H_low(nfft),H_band(nfft),X_real(nfft), X_image(nfft))</span><br><span class="line">allocate(C(nfft), C_low(nfft),C_band(nfft),X_low(nfft,2), X_band(nfft,2))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">! 频率域采样间隔</span><br><span class="line">df=1./(nfft*dt)</span><br><span class="line">print *, &#x27;频率域采样间隔为：&#x27;, df ,&#x27;HZ&#x27;</span><br><span class="line"></span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line">print *, &#x27;数据重组,为了使用fft将输入数据补零&#x27;</span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line">! 进行数据重组，将X转换为fft需要的数组C</span><br><span class="line">real_to_complex: do i=1,nfft</span><br><span class="line">if (i.le.num) then</span><br><span class="line">	C(i)=CMPLX(X(i), 0.0)</span><br><span class="line">else</span><br><span class="line">	C(i)=CMPLX(0.0, 0.0)</span><br><span class="line">endif</span><br><span class="line">end do real_to_complex</span><br><span class="line"></span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line">print *,&#x27;补零后的复数数组：&#x27;</span><br><span class="line">print *, C</span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line"></span><br><span class="line">! 进行FFT</span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line">print *, &#x27;执行FFT&#x27;</span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line">call FFT(nfft,C,1.0)</span><br><span class="line">! 得到实部和虚部</span><br><span class="line">complex_to_real: do i=1,nfft</span><br><span class="line"> 	X_real(i)=real(C(i))</span><br><span class="line">	X_image(i)=aimag(C(i))</span><br><span class="line">end do complex_to_real</span><br><span class="line">print *,&#x27;FFT后的频谱数据。&#x27;</span><br><span class="line">print *,&#x27;-real-------------------------------------------&#x27;</span><br><span class="line">print *, X_real</span><br><span class="line">print *,&#x27;-image-------------------------------------------&#x27;</span><br><span class="line">print *, X_image</span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line"></span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line">print *, &#x27;设计滤波器&#x27;</span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line"></span><br><span class="line">! 设置频率域滤波器</span><br><span class="line">! 低通滤波器</span><br><span class="line">low_pass_filter: do i=1,(nfft/2+1)</span><br><span class="line">	f=(i-1)*df</span><br><span class="line">	if((f.le.wc1).and.(f.ge.(-wc1))) then </span><br><span class="line">		H_low(i)=1.</span><br><span class="line">	else</span><br><span class="line">		H_low(i)=0.</span><br><span class="line">	end if</span><br><span class="line">end do low_pass_filter</span><br><span class="line">low_pass_filter2: do i=(nfft/2)+2,nfft</span><br><span class="line">	f=(i-1)*df</span><br><span class="line">	H_low(i)=H_low(nfft-i+2)</span><br><span class="line">end do low_pass_filter2</span><br><span class="line"></span><br><span class="line">! 带通滤波器</span><br><span class="line">band_pass_filter: do i=1,(nfft/2+1)</span><br><span class="line">	f=(i-1)*df</span><br><span class="line">	if((f.le.wc3.and.f.ge.wc2) .or. (f.ge.(-wc3).and.(f.le.(-wc2)))) then </span><br><span class="line">		H_band(i)=1.</span><br><span class="line">	else</span><br><span class="line">		H_band(i)=0.</span><br><span class="line">	end if</span><br><span class="line">end do band_pass_filter</span><br><span class="line">band_pass_filter2: do i=(nfft/2)+2,nfft</span><br><span class="line">	f=(i-1)*df</span><br><span class="line">	H_band(i)=H_band(nfft-i+2)</span><br><span class="line">end do band_pass_filter2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">100 format(I4, &#x27;,&#x27; , 3(f15.6,&#x27;,&#x27;),f15.6)</span><br><span class="line">! 进行频率域滤波</span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line">print *, &#x27;执行频率域滤波&#x27;</span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line">! 低通滤波,得到频率域结果</span><br><span class="line">! write(10,*) &quot;low pass frequency&quot;</span><br><span class="line">! write(10,*) &quot;i,frequence,real,image,amplitude&quot;</span><br><span class="line">do i=1,nfft</span><br><span class="line">	f=(i-1)*df</span><br><span class="line">	X_low(i,1)=X_real(i)*H_low(i)</span><br><span class="line">	X_low(i,2)=X_image(i)*H_low(i)</span><br><span class="line">	f=(i-1)*df</span><br><span class="line">	amp=sqrt(X_low(i,1)*X_low(i,1)+X_low(i,2)*X_low(i,2))*dt</span><br><span class="line">	! write(10,100) i, f, X_low(i,1),X_low(i,2),amp</span><br><span class="line">	C_low(i)=complex(X_low(i,1),X_low(i,2)) ! 将X转化为复数数组</span><br><span class="line">enddo </span><br><span class="line"></span><br><span class="line">! 带通滤波,得到频率域结果</span><br><span class="line">! write(10,*) &quot;band pass frequency&quot;</span><br><span class="line">! write(10,*) &quot;i,frequence,real,image,amplitude&quot;</span><br><span class="line">do i=1,nfft</span><br><span class="line">	f=(i-1)*df</span><br><span class="line">	X_band(i,1)=X_real(i)*H_band(i)</span><br><span class="line">	X_band(i,2)=X_image(i)*H_band(i)</span><br><span class="line">	f=(i-1)*df</span><br><span class="line">	amp=sqrt(X_band(i,1)*X_band(i,1)+X_band(i,2)*X_band(i,2))*dt</span><br><span class="line">	! write(10,100) i, f, X_band(i,1),X_band(i,2),amp</span><br><span class="line">	C_band(i)=complex(X_band(i,1),X_band(i,2)) ! 将X转化为复数数组</span><br><span class="line">enddo </span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line">print *, &#x27;频率域滤波执行完成&#x27;</span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">! write(10,*) &quot;low pass time&quot;</span><br><span class="line">! write(10,*) &quot;i,time(ms),origin, amplitude_low,amplitude_band&quot;</span><br><span class="line"></span><br><span class="line">! 进行反FFT</span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line">print *, &#x27;执行反FFT变换，得到时间域&#x27;</span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line">call FFT(nfft,C_low,-1.0)</span><br><span class="line">call FFT(nfft,C_band,-1.0)</span><br><span class="line"></span><br><span class="line">do i=1,num</span><br><span class="line">t=(i-1)*dt*1000.</span><br><span class="line">write(10,200) i, t, X(i), real(C_low(i)), real(C_band(i))</span><br><span class="line">enddo</span><br><span class="line">200 format(I4,x,F15.6,x,2(F15.6,x),F15.6)</span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line">print *, &#x27;写入完成&#x27;</span><br><span class="line">print *,&#x27;---------------------------------------------&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">deallocate(X_fft_output)</span><br><span class="line">end program ch2_fliter</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SUBROUTINE DFT(N,C,S)</span><br><span class="line">	COMPLEX C(N),Y(512),W</span><br><span class="line">	IF(S.EQ.1.0)Z=1.0</span><br><span class="line">	IF(S.EQ.-1.0)Z=1.0/FLOAT(N)</span><br><span class="line">	DO 20 I=1,N</span><br><span class="line">	Y(I)=(0.0,0.0)</span><br><span class="line">	DO 20 J=1,N</span><br><span class="line">	A=COS(2.0*3.14159265*(I-1)*(J-1)/FLOAT(N))</span><br><span class="line">	B=SIN(2.0*3.14159265*(I-1)*(J-1)/FLOAT(N))*(-S)</span><br><span class="line">	W=CMPLX(A,B)</span><br><span class="line"> 20	Y(I)=Y(I)+C(J)*W</span><br><span class="line">	DO 30 I=1,N</span><br><span class="line"> 30	C(I)=Y(I)*Z</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br><span class="line"></span><br><span class="line">	SUBROUTINE CON(A,B,C,I,J,K)</span><br><span class="line">	DIMENSION A(I),B(J),C(K)</span><br><span class="line">	DO 1 K1=1,K</span><br><span class="line">  1	C(K1)=0.0</span><br><span class="line">	DO 2 I1=1,I</span><br><span class="line">	DO 2 I2=1,J</span><br><span class="line">	II=I1+I2-1</span><br><span class="line">  2	C(II)=C(II)+A(I1)*B(I2)*0.004</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br><span class="line"></span><br><span class="line">	SUBROUTINE FFT(LX,CX,SIGNI)</span><br><span class="line">	COMPLEX CX(LX),CARG,CEXP,CW,CTEMP</span><br><span class="line">	J=1</span><br><span class="line">	SC=1.0/LX</span><br><span class="line">	IF(SIGNI.EQ.1.0)SC=1.0</span><br><span class="line">	SIG=-SIGNI</span><br><span class="line">	DO 30 I=1,LX</span><br><span class="line">	IF(I.GT.J)GO TO 10</span><br><span class="line">	CTEMP=CX(J)*SC</span><br><span class="line">	CX(J)=CX(I)*SC</span><br><span class="line">	CX(I)=CTEMP</span><br><span class="line"> 10     M=LX/2</span><br><span class="line"> 20	IF(J.LE.M)GO TO 30</span><br><span class="line">	J=J-M</span><br><span class="line">	M=M/2</span><br><span class="line">	IF(M.GE.1)GO TO 20</span><br><span class="line"> 30	J=J+M</span><br><span class="line">	L=1</span><br><span class="line"> 40	ISTEP=2*L</span><br><span class="line">	DO 50 M=1,L</span><br><span class="line">	CARG=(0.0,1.0)*(3.14159265*SIG*(M-1))/L</span><br><span class="line">	CW=CEXP(CARG)</span><br><span class="line">	DO 50 I=M,LX,ISTEP</span><br><span class="line">	CTEMP=CW*CX(I+L)</span><br><span class="line">	CX(I+L)=CX(I)-CTEMP</span><br><span class="line"> 50	CX(I)=CX(I)+CTEMP</span><br><span class="line">	L=ISTEP</span><br><span class="line">	IF(L.LT.LX)GO TO 40</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">clear</span><br><span class="line">load ch2_result.dat</span><br><span class="line"></span><br><span class="line">figure(2)</span><br><span class="line">hold on</span><br><span class="line">subplot(3,1,1)</span><br><span class="line">plot(ch2_result(:,2), ch2_result(:,3))</span><br><span class="line">title(&#x27;Origin&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(3,1,2)</span><br><span class="line">plot(ch2_result(:,2), ch2_result(:,4))</span><br><span class="line">title(&#x27;lowpass 70&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(3,1,3)</span><br><span class="line">plot(ch2_result(:,2), ch2_result(:,5))</span><br><span class="line">title(&#x27;bandpass 10-80&#x27;)</span><br></pre></td></tr></table></figure>

<h1 id="褶积滤波与递归滤波的比较"><a href="#褶积滤波与递归滤波的比较" class="headerlink" title="褶积滤波与递归滤波的比较"></a>褶积滤波与递归滤波的比较</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line">program ch3_compare</span><br><span class="line">implicit none</span><br><span class="line">real :: sum_ax, sum_bx</span><br><span class="line">real, dimension(50) :: X, con_fliter_result_end, con_fliter_zero_result_end, X_digui, X_digui_zero</span><br><span class="line">real, parameter :: dt=2</span><br><span class="line">! 褶积滤波的滤波因子</span><br><span class="line">real, dimension(21) :: hn,hn_r</span><br><span class="line">integer :: i, j, p, numht_zero, num_con_fliter_zero_result, num_con_fliter_result</span><br><span class="line">real, dimension(:), allocatable:: ht_zero, con_fliter_result, con_fliter_zero_result</span><br><span class="line"></span><br><span class="line">real, dimension(5) :: a</span><br><span class="line">real, dimension(4) :: b</span><br><span class="line">real(kind=4) :: t1, t1e, t2, t2e, t3, t3e, t4, t4e  ! 定义运行时间</span><br><span class="line"></span><br><span class="line">hn=[1.0, 5.254, 11.6, 13.7, 8.47, 0.775, -3.325, -2.764, &amp;</span><br><span class="line">-0.364, 1.099, 0.97, 0.15, -0.37, -0.344, -0.06, -0.126, 0.122, 0.025, -0.042, -0.043,0.0]</span><br><span class="line"></span><br><span class="line">a=[1,4,6,4,1]</span><br><span class="line">b=[-1.254,0.987,-0.341,0.0524]</span><br><span class="line"></span><br><span class="line">! 返序的hn，用于制作零相位滤波因子</span><br><span class="line">do i=1,size(hn)</span><br><span class="line">    hn_r(size(hn)-i+1)=hn(i)</span><br><span class="line">enddo</span><br><span class="line">open(unit=2, file=&#x27;ch3_test_result.dat&#x27;, status=&#x27;replace&#x27;, action=&#x27;write&#x27;)</span><br><span class="line">open(unit=3, file=&#x27;ch3_result.dat&#x27;, status=&#x27;replace&#x27;, action=&#x27;write&#x27;)</span><br><span class="line">open(1, file=&#x27;INPUT3.DAT&#x27;, form=&#x27;FORMATTED&#x27;, status=&#x27;OLD&#x27;)</span><br><span class="line">read(1,*) (X(i), i=1,50)</span><br><span class="line"></span><br><span class="line">numht_zero=2*size(hn)-1</span><br><span class="line">allocate(ht_zero(numht_zero))</span><br><span class="line"></span><br><span class="line">! 计算零相位滤波因子ht_zero，其为h(t)*h(-t)</span><br><span class="line">call CON(hn, hn_r, ht_zero, size(hn), size(hn_r), numht_zero)</span><br><span class="line">! 开启零相位褶积滤波结果数组</span><br><span class="line">num_con_fliter_zero_result=size(X)+numht_zero-1</span><br><span class="line">allocate(con_fliter_zero_result(num_con_fliter_zero_result))</span><br><span class="line">! 输出原始数据</span><br><span class="line">write(2,*) &#x27;Original data.&#x27;</span><br><span class="line">do i=1, size(X)</span><br><span class="line">    write (2,100) i, dt*(i-1)/1000., X(i)</span><br><span class="line">enddo</span><br><span class="line">call cpu_time(t1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">! 计算零相位褶积滤波</span><br><span class="line">do p=1,1000000</span><br><span class="line">call CON(X, ht_zero, con_fliter_zero_result, size(X), size(ht_zero), num_con_fliter_zero_result)</span><br><span class="line">! write(2,*) &#x27;Zero phase convolution filter result1.&#x27;</span><br><span class="line">do i=(numht_zero-1)/2+1, num_con_fliter_zero_result-(numht_zero-1)/2</span><br><span class="line">    ! write (2,100) i-(numht_zero-1)/2-1+1, dt*(i-(numht_zero-1)/2-1)/1000., con_fliter_zero_result(i) ! 舍去两端(size(ht)-1)/2个点</span><br><span class="line">	con_fliter_zero_result_end(i-((numht_zero-1)/2+1)+1)=con_fliter_zero_result(i)</span><br><span class="line">enddo</span><br><span class="line">end do</span><br><span class="line">call cpu_time(t1e)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">! 计算褶积滤波</span><br><span class="line">num_con_fliter_result=size(X)+size(hn)-1</span><br><span class="line">allocate(con_fliter_result(num_con_fliter_result))</span><br><span class="line">call cpu_time(t2)</span><br><span class="line">do p=1,1000000</span><br><span class="line">call CON(X, hn, con_fliter_result, size(X), size(hn), num_con_fliter_result)</span><br><span class="line">! write(2,*) &#x27;convolution filter result.&#x27;</span><br><span class="line">do i=(size(hn)-1)/2+1, num_con_fliter_result-(size(hn)-1)/2</span><br><span class="line">    ! write (2,100) i-(size(hn)-1)/2-1+1, dt*(i-(size(hn)-1)/2-1)/1000., con_fliter_result(i) ! 舍去两端(size(ht)-1)/2个点</span><br><span class="line">	con_fliter_result_end(i+1-((size(hn)-1)/2+1))=con_fliter_zero_result(i)</span><br><span class="line">enddo</span><br><span class="line">enddo</span><br><span class="line">call cpu_time(t2e)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">! 创建递归滤波</span><br><span class="line">call cpu_time(t3)</span><br><span class="line">do p=1,1000000</span><br><span class="line">do i=1,size(X)</span><br><span class="line">sum_ax=0.</span><br><span class="line">sum_bx=0.</span><br><span class="line">	if(i.lt.(size(a)-1)) then</span><br><span class="line">		if(i.eq.1) then</span><br><span class="line">			sum_ax=a(i)*X(i)</span><br><span class="line">			sum_bx=0.</span><br><span class="line">		else</span><br><span class="line">			do j=1,i</span><br><span class="line">				sum_ax=sum_ax+X(j)*a(i+1-j)</span><br><span class="line">			end do</span><br><span class="line"></span><br><span class="line">			do j=1,i-1</span><br><span class="line">				sum_bx=sum_bx+X_digui(j)*b(i-j)</span><br><span class="line">			end do</span><br><span class="line">		endif</span><br><span class="line">	else </span><br><span class="line">		do j=1,size(a)</span><br><span class="line">			sum_ax=sum_ax+X(i-j+1)*a(j)</span><br><span class="line">		end do</span><br><span class="line">		do j=1,size(b)</span><br><span class="line">			sum_bx=sum_bx+X_digui(i-j)*b(j)</span><br><span class="line">		end do</span><br><span class="line">	endif</span><br><span class="line"> 	X_digui(i)=sum_ax-sum_bx</span><br><span class="line">enddo</span><br><span class="line">enddo</span><br><span class="line">call cpu_time(t3e)</span><br><span class="line"></span><br><span class="line">! write (2, *) &#x27;Digui filter data&#x27;</span><br><span class="line">! do i=1,size(X_digui)</span><br><span class="line">!     write (2,100) i, (i-1)*dt/1000., X_digui(i)</span><br><span class="line">! enddo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">call cpu_time(t4)</span><br><span class="line">! 创建零相位递归滤波</span><br><span class="line">do p=1,1000000</span><br><span class="line">do i=size(X),1,-1</span><br><span class="line">	sum_ax=0.</span><br><span class="line">	sum_bx=0.</span><br><span class="line">	if(i.gt.(size(X)-size(a)+2)) then</span><br><span class="line">		if(i.eq.size(X)) then</span><br><span class="line">			sum_ax=a(1)*X_digui(i)</span><br><span class="line">			sum_bx=0.</span><br><span class="line">		else</span><br><span class="line">			do j=1,size(X_digui)-i+1</span><br><span class="line">				sum_ax=sum_ax+X_digui(i+j-1)*a(j)</span><br><span class="line">			end do</span><br><span class="line"></span><br><span class="line">			do j=1,size(X_digui)-i</span><br><span class="line">				sum_bx=sum_bx+X_digui(i+j)*b(j)</span><br><span class="line">			end do</span><br><span class="line">		endif</span><br><span class="line">	else </span><br><span class="line">		do j=1,size(a)</span><br><span class="line">			sum_ax=sum_ax+X_digui(i+j-1)*a(j)</span><br><span class="line">		end do</span><br><span class="line">		do j=1,size(b)</span><br><span class="line">			sum_bx=sum_bx+X_digui(i+j)*b(j)</span><br><span class="line">		end do</span><br><span class="line">	endif</span><br><span class="line"> 	X_digui_zero(i)=sum_ax-sum_bx</span><br><span class="line">enddo</span><br><span class="line">enddo</span><br><span class="line">call cpu_time(t4e)</span><br><span class="line"></span><br><span class="line">! write (2, *) &#x27;Digui zero filter data&#x27;</span><br><span class="line">! do i=1,size(X_digui)</span><br><span class="line">!     write (2,100) i, (i-1)*dt/1000., X_digui_zero(i)</span><br><span class="line">! enddo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">do i=1,size(X_digui)</span><br><span class="line">    write(3,200) i, (i-1)*dt,X(i), con_fliter_result_end(i), con_fliter_zero_result_end(i), X_digui(i),  X_digui_zero(i)</span><br><span class="line">enddo</span><br><span class="line">100 format(I4, 2(&#x27;,&#x27;, F15.6))</span><br><span class="line">200 format(I4,x,F5.1,5(x, F15.4))</span><br><span class="line">write(2,300) t1e-t1, t2e-t2, t3e-t3, t4e-t4</span><br><span class="line">300 format(4(F29.27,x)) </span><br><span class="line">end program ch3_compare</span><br><span class="line"></span><br><span class="line">	SUBROUTINE CON(A,B,C,I,J,K)</span><br><span class="line">	DIMENSION A(I),B(J),C(K)</span><br><span class="line">	DO 1 K1=1,K</span><br><span class="line">  1	C(K1)=0.0</span><br><span class="line">	DO 2 I1=1,I</span><br><span class="line">	DO 2 I2=1,J</span><br><span class="line">	II=I1+I2-1</span><br><span class="line">  2	C(II)=C(II)+A(I1)*B(I2)*0.004</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">clear</span><br><span class="line">load ch3_result.dat</span><br><span class="line"></span><br><span class="line">figure(2)</span><br><span class="line">hold on</span><br><span class="line">subplot(5,1,1)</span><br><span class="line">plot(ch3_result(:,2), ch3_result(:,3))</span><br><span class="line">title(&#x27;Origin&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(5,1,2)</span><br><span class="line">plot(ch3_result(:,2), ch3_result(:,4))</span><br><span class="line">title(&#x27;褶积滤波&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(5,1,3)</span><br><span class="line">plot(ch3_result(:,2), ch3_result(:,5))</span><br><span class="line">title(&#x27;零相位褶积滤波&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(5,1,4)</span><br><span class="line">plot(ch3_result(:,2), ch3_result(:,6))</span><br><span class="line">title(&#x27;递归滤波&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(5,1,5)</span><br><span class="line">plot(ch3_result(:,2), ch3_result(:,7))</span><br><span class="line">title(&#x27;零相位递归滤波&#x27;)</span><br></pre></td></tr></table></figure>


<h1 id="设计高通滤波因子进行频域分析"><a href="#设计高通滤波因子进行频域分析" class="headerlink" title="设计高通滤波因子进行频域分析"></a>设计高通滤波因子进行频域分析</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">program ch4_highpass</span><br><span class="line">real, parameter :: dt=4., pi=3.1415926535, wc=30.</span><br><span class="line">real, dimension(101) :: ht, t, f, hwr, hwi</span><br><span class="line">complex, dimension(101) :: hw   ! 定义一个复数数组hw，用于表示频率域的滤波因子。</span><br><span class="line">open(6,file=&#x27;ch4_result.dat&#x27;, status=&#x27;replace&#x27;,action=&#x27;write&#x27;)</span><br><span class="line"></span><br><span class="line">! 设计时域滤波因子ht</span><br><span class="line">df=1000/dt/size(f)</span><br><span class="line">do i=1,size(ht)</span><br><span class="line">    t(i)=dt*(i-1.-(size(ht)-1.)/2.)/1000.</span><br><span class="line">	! t(i)=dt*(i-1.)/1000.</span><br><span class="line">    f(i)=df*(i-1)</span><br><span class="line">	! if (t(i).ne.0.) then</span><br><span class="line">	! 	f(i)=1./t(i)</span><br><span class="line">	! else</span><br><span class="line">	! 	f(i)=1./dt*1000.</span><br><span class="line">	! endif</span><br><span class="line">    if (t(i).ne.0) then</span><br><span class="line">        ht(i)=0.-1.*sin(2*pi*t(i)*wc)/pi/t(i)! /(pi*t(i))</span><br><span class="line">        hw(i)=CMPLX(ht(i), 0.0)</span><br><span class="line">    elseif(t(i).eq.0) then</span><br><span class="line">        ht(i)=1000.-2.*wc</span><br><span class="line">        hw(i)=CMPLX(ht(i), 0.0)</span><br><span class="line">    else</span><br><span class="line">        continue</span><br><span class="line">    endif</span><br><span class="line">enddo</span><br><span class="line"></span><br><span class="line">call DFT(size(f), hw, 1.0)</span><br><span class="line"></span><br><span class="line">complex_to_real: do i=1,size(f)</span><br><span class="line"> 	hwr(i)=real(hw(i))</span><br><span class="line">	hwi(i)=aimag(hw(i))</span><br><span class="line">end do complex_to_real</span><br><span class="line"></span><br><span class="line">! 输出：序号，时间，时域滤波因子，频率，频率域滤波器</span><br><span class="line">do i=1,size(f)</span><br><span class="line">    write (6,100) i, t(i), ht(i), f(i), sqrt(hwr(i)**2+hwi(i)**2)</span><br><span class="line">enddo</span><br><span class="line">100 format(I4,6(x,F20.4))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">end program ch4_highpass</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	SUBROUTINE DFT(N,C,S)</span><br><span class="line">	COMPLEX C(N),Y(512),W</span><br><span class="line">	IF(S.EQ.1.0)Z=1.0</span><br><span class="line">	IF(S.EQ.-1.0)Z=1.0/FLOAT(N)</span><br><span class="line">	DO 20 I=1,N</span><br><span class="line">	Y(I)=(0.0,0.0)</span><br><span class="line">	DO 20 J=1,N</span><br><span class="line">	A=COS(2.0*3.14159265*(I-1)*(J-1)/FLOAT(N))</span><br><span class="line">	B=SIN(2.0*3.14159265*(I-1)*(J-1)/FLOAT(N))*(-S)</span><br><span class="line">	W=CMPLX(A,B)</span><br><span class="line"> 20	Y(I)=Y(I)+C(J)*W</span><br><span class="line">	DO 30 I=1,N</span><br><span class="line"> 30	C(I)=Y(I)*Z</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">clear</span><br><span class="line">load ch4_result.dat</span><br><span class="line">load ch4_test.dat</span><br><span class="line"></span><br><span class="line">figure(2)</span><br><span class="line">hold on</span><br><span class="line">subplot(2,1,1)</span><br><span class="line">plot(ch4_result(:,2), ch4_result(:,3))</span><br><span class="line">title(&#x27;Origin&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(2,1,2)</span><br><span class="line">plot(ch4_result(:,4), ch4_result(:,5))</span><br><span class="line">title(&#x27;frequency&#x27;)</span><br></pre></td></tr></table></figure>

<h1 id="不同信号的频谱分析"><a href="#不同信号的频谱分析" class="headerlink" title="不同信号的频谱分析"></a>不同信号的频谱分析</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">program ch5_freanalysis</span><br><span class="line">integer, parameter :: N=128, dt=4, pi=3.1415926535</span><br><span class="line">integer :: k, nfft</span><br><span class="line">complex, dimension(N,2) :: x_per_fre, x_pulse_fre, x_seis_fre</span><br><span class="line">real, dimension(N) :: x_per, x_pulse, x_seis</span><br><span class="line">real :: df,f,x_per_amp, x_pulse_amp, x_seis_amp</span><br><span class="line"></span><br><span class="line">open(1, file=&#x27;WAVE.DAT&#x27;, form=&#x27;formatted&#x27;, status=&#x27;old&#x27;)</span><br><span class="line">read(1,*) (x_seis(i), i=1,N)</span><br><span class="line"></span><br><span class="line">do i=1,N</span><br><span class="line">    x_per(i)=sin(2.*pi*i/64.)</span><br><span class="line">    if(i.eq.1) then</span><br><span class="line">        x_pulse(i)=1</span><br><span class="line">    else </span><br><span class="line">        x_pulse(i)=0   </span><br><span class="line">    endif</span><br><span class="line">    x_per_fre(i,:)=CMPLX(x_per(i),0.0)</span><br><span class="line">    x_pulse_fre(i,:)=CMPLX(x_pulse(i),0.0)</span><br><span class="line">    x_seis_fre(i,:)=CMPLX(x_seis(i),0.0)</span><br><span class="line">enddo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">call FFT(N, x_per_fre, 1.0)</span><br><span class="line">call FFT(N, x_pulse_fre, 1.0)</span><br><span class="line">call FFT(N, x_seis_fre, 1.0)</span><br><span class="line">open(3, file=&#x27;ch5_result.dat&#x27;,status=&#x27;replace&#x27;,action=&#x27;write&#x27;)</span><br><span class="line"></span><br><span class="line">df = 1000./dt/N</span><br><span class="line">do i=1,N</span><br><span class="line">    f = (i-1)*df</span><br><span class="line">    x_per_amp=sqrt(real(x_per_fre(i,1))**2+aimag(x_per_fre(i,2))**2)</span><br><span class="line">    x_pulse_amp=sqrt(real(x_pulse_fre(i,1))**2+aimag(x_pulse_fre(i,2))**2)</span><br><span class="line">    x_seis_amp=sqrt(real(x_seis_fre(i,1))**2+aimag(x_seis_fre(i,2))**2)</span><br><span class="line">    write(3,100) i, f, x_per_amp, x_pulse_amp, x_seis_amp</span><br><span class="line">enddo</span><br><span class="line">100 format(I4, 4(x,F15.4))</span><br><span class="line">end program ch5_freanalysis</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	SUBROUTINE FFT(LX,CX,SIGNI)</span><br><span class="line">	COMPLEX CX(LX),CARG,CEXP,CW,CTEMP</span><br><span class="line">	J=1</span><br><span class="line">	SC=1.0/LX</span><br><span class="line">	IF(SIGNI.EQ.1.0)SC=1.0</span><br><span class="line">	SIG=-SIGNI</span><br><span class="line">	DO 30 I=1,LX</span><br><span class="line">	IF(I.GT.J)GO TO 10</span><br><span class="line">	CTEMP=CX(J)*SC</span><br><span class="line">	CX(J)=CX(I)*SC</span><br><span class="line">	CX(I)=CTEMP</span><br><span class="line"> 10     M=LX/2</span><br><span class="line"> 20	IF(J.LE.M)GO TO 30</span><br><span class="line">	J=J-M</span><br><span class="line">	M=M/2</span><br><span class="line">	IF(M.GE.1)GO TO 20</span><br><span class="line"> 30	J=J+M</span><br><span class="line">	L=1</span><br><span class="line"> 40	ISTEP=2*L</span><br><span class="line">	DO 50 M=1,L</span><br><span class="line">	CARG=(0.0,1.0)*(3.14159265*SIG*(M-1))/L</span><br><span class="line">	CW=CEXP(CARG)</span><br><span class="line">	DO 50 I=M,LX,ISTEP</span><br><span class="line">	CTEMP=CW*CX(I+L)</span><br><span class="line">	CX(I+L)=CX(I)-CTEMP</span><br><span class="line"> 50	CX(I)=CX(I)+CTEMP</span><br><span class="line">	L=ISTEP</span><br><span class="line">	IF(L.LT.LX)GO TO 40</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">load ch5_result.dat</span><br><span class="line"></span><br><span class="line">figure(5)</span><br><span class="line">hold on</span><br><span class="line">subplot(3,1,1)</span><br><span class="line">plot(ch5_result(:,2), ch5_result(:,3))</span><br><span class="line">title(&#x27;周期&#x27;)</span><br><span class="line">xlabel(&#x27;frequency Hz&#x27;)</span><br><span class="line">ylabel(&#x27;amplitude&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(3,1,2)</span><br><span class="line">plot(ch5_result(:,2), ch5_result(:,4))</span><br><span class="line">title(&#x27;脉冲&#x27;)</span><br><span class="line">xlabel(&#x27;frequency Hz&#x27;)</span><br><span class="line">ylabel(&#x27;amplitude&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(3,1,3)</span><br><span class="line">plot(ch5_result(:,2), ch5_result(:,5))</span><br><span class="line">title(&#x27;地震波&#x27;)</span><br><span class="line">xlabel(&#x27;frequency Hz&#x27;)</span><br><span class="line">ylabel(&#x27;amplitude&#x27;)</span><br></pre></td></tr></table></figure>

<h1 id="FFT补零的影响分析"><a href="#FFT补零的影响分析" class="headerlink" title="FFT补零的影响分析"></a>FFT补零的影响分析</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line">program ch6_zeros</span><br><span class="line"></span><br><span class="line">integer, parameter :: N=60, dt=4, pi=3.1415926535, N1=64, N2=128</span><br><span class="line">complex, dimension(N,2) :: x_per_fre, x_seis_fre</span><br><span class="line">complex, dimension(N1,2) :: x_per_fre1, x_seis_fre1</span><br><span class="line">complex, dimension(N2,2) :: x_per_fre2, x_seis_fre2</span><br><span class="line">real, dimension(N) :: x_per, x_seis</span><br><span class="line">real :: df,f,x_per_amp, x_seis_amp</span><br><span class="line"></span><br><span class="line">open(1, file=&#x27;WAVE.DAT&#x27;, form=&#x27;formatted&#x27;, status=&#x27;old&#x27;)</span><br><span class="line">read(1,*) (x_seis(i), i=1,N)</span><br><span class="line">! 设置存储文件</span><br><span class="line">open(3, file=&#x27;ch6_result_nozero.dat&#x27;,status=&#x27;replace&#x27;,action=&#x27;write&#x27;)</span><br><span class="line">open(4, file=&#x27;ch6_result_64.dat&#x27;,status=&#x27;replace&#x27;,action=&#x27;write&#x27;)</span><br><span class="line">open(5, file=&#x27;ch6_result_128.dat&#x27;,status=&#x27;replace&#x27;,action=&#x27;write&#x27;)</span><br><span class="line"></span><br><span class="line">! No zero</span><br><span class="line">do i=1,N</span><br><span class="line">    x_per(i)=sin(2.*pi*i/30.)</span><br><span class="line">    x_per_fre(i,:)=CMPLX(x_per(i),0.0)</span><br><span class="line">    x_seis_fre(i,:)=CMPLX(x_seis(i),0.0)</span><br><span class="line">enddo</span><br><span class="line">call DFT(N, x_per_fre, 1.0)</span><br><span class="line">call DFT(N, x_seis_fre, 1.0)</span><br><span class="line">df = 1000./dt/N</span><br><span class="line">do i=1,N</span><br><span class="line">    f = (i-1)*df</span><br><span class="line">    x_per_amp=sqrt(real(x_per_fre(i,1))**2+aimag(x_per_fre(i,2))**2)</span><br><span class="line">    x_seis_amp=sqrt(real(x_seis_fre(i,1))**2+aimag(x_seis_fre(i,2))**2)</span><br><span class="line">    write(3,100) i, f, x_per_amp, x_seis_amp</span><br><span class="line">end do</span><br><span class="line"></span><br><span class="line">! TO 64 with zero</span><br><span class="line">do i=1,N1</span><br><span class="line">    if (i.le.N) then</span><br><span class="line">        x_per_fre1(i,:)=CMPLX(x_per(i),0.0)</span><br><span class="line">        x_seis_fre1(i,:)=CMPLX(x_seis(i),0.0)</span><br><span class="line">    else</span><br><span class="line">        x_per_fre1(i,:)=CMPLX(0.0,0.0)</span><br><span class="line">        x_seis_fre1(i,:)=CMPLX(0.0,0.0)</span><br><span class="line">    endif</span><br><span class="line">end do</span><br><span class="line">call DFT(N, x_per_fre1, 1.0)</span><br><span class="line">call DFT(N, x_seis_fre1, 1.0)</span><br><span class="line">df = 1000./dt/N1</span><br><span class="line"></span><br><span class="line">do i=1,N1</span><br><span class="line">    f = (i-1)*df</span><br><span class="line">    x_per_amp=sqrt(real(x_per_fre1(i,1))**2+aimag(x_per_fre1(i,2))**2)</span><br><span class="line">    x_seis_amp=sqrt(real(x_seis_fre1(i,1))**2+aimag(x_seis_fre1(i,2))**2)</span><br><span class="line">    write(4,100) i, f, x_per_amp, x_seis_amp</span><br><span class="line">enddo</span><br><span class="line"></span><br><span class="line">! TO 128 with zero</span><br><span class="line">do i=1,N2</span><br><span class="line">    if (i.le.N) then</span><br><span class="line">        x_per_fre2(i,:)=CMPLX(x_per(i),0.0)</span><br><span class="line">        x_seis_fre2(i,:)=CMPLX(x_seis(i),0.0)</span><br><span class="line">    else</span><br><span class="line">        x_per_fre2(i,:)=CMPLX(0.0,0.0)</span><br><span class="line">        x_seis_fre2(i,:)=CMPLX(0.0,0.0)</span><br><span class="line">    endif</span><br><span class="line">end do</span><br><span class="line">call DFT(N, x_per_fre2, 1.0)</span><br><span class="line">call DFT(N, x_seis_fre2, 1.0)</span><br><span class="line">df = 1000./dt/N2</span><br><span class="line">do i=1,N2</span><br><span class="line">    f = (i-1)*df</span><br><span class="line">    x_per_amp=sqrt(real(x_per_fre2(i,1))**2+aimag(x_per_fre2(i,2))**2)</span><br><span class="line">    x_seis_amp=sqrt(real(x_seis_fre2(i,1))**2+aimag(x_seis_fre2(i,2))**2)</span><br><span class="line">    write(5,100) i, f, x_per_amp, x_seis_amp</span><br><span class="line">end do</span><br><span class="line"></span><br><span class="line">100 format(I4, 3(x,F15.4))</span><br><span class="line"></span><br><span class="line">end program ch6_zeros</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	SUBROUTINE FFT(LX,CX,SIGNI)</span><br><span class="line">	COMPLEX CX(LX),CARG,CEXP,CW,CTEMP</span><br><span class="line">	J=1</span><br><span class="line">	SC=1.0/LX</span><br><span class="line">	IF(SIGNI.EQ.1.0)SC=1.0</span><br><span class="line">	SIG=-SIGNI</span><br><span class="line">	DO 30 I=1,LX</span><br><span class="line">	IF(I.GT.J)GO TO 10</span><br><span class="line">	CTEMP=CX(J)*SC</span><br><span class="line">	CX(J)=CX(I)*SC</span><br><span class="line">	CX(I)=CTEMP</span><br><span class="line"> 10     M=LX/2</span><br><span class="line"> 20	IF(J.LE.M)GO TO 30</span><br><span class="line">	J=J-M</span><br><span class="line">	M=M/2</span><br><span class="line">	IF(M.GE.1)GO TO 20</span><br><span class="line"> 30	J=J+M</span><br><span class="line">	L=1</span><br><span class="line"> 40	ISTEP=2*L</span><br><span class="line">	DO 50 M=1,L</span><br><span class="line">	CARG=(0.0,1.0)*(3.14159265*SIG*(M-1))/L</span><br><span class="line">	CW=CEXP(CARG)</span><br><span class="line">	DO 50 I=M,LX,ISTEP</span><br><span class="line">	CTEMP=CW*CX(I+L)</span><br><span class="line">	CX(I+L)=CX(I)-CTEMP</span><br><span class="line"> 50	CX(I)=CX(I)+CTEMP</span><br><span class="line">	L=ISTEP</span><br><span class="line">	IF(L.LT.LX)GO TO 40</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br><span class="line"></span><br><span class="line">SUBROUTINE DFT(N,C,S)</span><br><span class="line">	COMPLEX C(N),Y(512),W</span><br><span class="line">	IF(S.EQ.1.0)Z=1.0</span><br><span class="line">	IF(S.EQ.-1.0)Z=1.0/FLOAT(N)</span><br><span class="line">	DO 20 I=1,N</span><br><span class="line">	Y(I)=(0.0,0.0)</span><br><span class="line">	DO 20 J=1,N</span><br><span class="line">	A=COS(2.0*3.14159265*(I-1)*(J-1)/FLOAT(N))</span><br><span class="line">	B=SIN(2.0*3.14159265*(I-1)*(J-1)/FLOAT(N))*(-S)</span><br><span class="line">	W=CMPLX(A,B)</span><br><span class="line"> 20	Y(I)=Y(I)+C(J)*W</span><br><span class="line">	DO 30 I=1,N</span><br><span class="line"> 30	C(I)=Y(I)*Z</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">load ch6_result_nozero.dat</span><br><span class="line">load ch6_result_64.dat</span><br><span class="line">load ch6_result_128.dat</span><br><span class="line"></span><br><span class="line">figure(5)</span><br><span class="line">hold on</span><br><span class="line">subplot(3,2,1)</span><br><span class="line">plot(ch6_result_nozero(:,2), ch6_result_nozero(:,3))</span><br><span class="line">title(&#x27;周期，无补零&#x27;)</span><br><span class="line">xlabel(&#x27;frequency Hz&#x27;)</span><br><span class="line">ylabel(&#x27;amplitude&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(3,2,2)</span><br><span class="line">plot(ch6_result_nozero(:,2), ch6_result_nozero(:,4))</span><br><span class="line">title(&#x27;非周期，无补零&#x27;)</span><br><span class="line">xlabel(&#x27;frequency Hz&#x27;)</span><br><span class="line">ylabel(&#x27;amplitude&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">subplot(3,2,3)</span><br><span class="line">plot(ch6_result_64(:,2), ch6_result_64(:,3))</span><br><span class="line">title(&#x27;周期，64个点&#x27;)</span><br><span class="line">xlabel(&#x27;frequency Hz&#x27;)</span><br><span class="line">ylabel(&#x27;amplitude&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(3,2,4)</span><br><span class="line">plot(ch6_result_64(:,2), ch6_result_64(:,4))</span><br><span class="line">title(&#x27;非周期，64个点&#x27;)</span><br><span class="line">xlabel(&#x27;frequency Hz&#x27;)</span><br><span class="line">ylabel(&#x27;amplitude&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">subplot(3,2,5)</span><br><span class="line">plot(ch6_result_128(:,2), ch6_result_128(:,3))</span><br><span class="line">title(&#x27;周期，128个点&#x27;)</span><br><span class="line">xlabel(&#x27;frequency Hz&#x27;)</span><br><span class="line">ylabel(&#x27;amplitude&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(3,2,6)</span><br><span class="line">plot(ch6_result_128(:,2), ch6_result_128(:,4))</span><br><span class="line">title(&#x27;非周期，128个点&#x27;)</span><br><span class="line">xlabel(&#x27;frequency Hz&#x27;)</span><br><span class="line">ylabel(&#x27;amplitude&#x27;)</span><br></pre></td></tr></table></figure>

<h1 id="线性褶积与圆周褶积比较"><a href="#线性褶积与圆周褶积比较" class="headerlink" title="线性褶积与圆周褶积比较"></a>线性褶积与圆周褶积比较</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">program ch7_circle</span><br><span class="line">real, parameter :: pi=3.1415926535</span><br><span class="line">real, dimension(101) :: X=0., h_low=0., t</span><br><span class="line">! real,dimension (101) :: h_low=0.</span><br><span class="line">real,dimension (100+101-1) :: result_low=0., result_circle</span><br><span class="line">real,dimension (201) :: X_c=0., h_r=0., t2, result_circle_r</span><br><span class="line">real :: wc1=70.0, f ! 滤波器的滤波边界</span><br><span class="line">integer :: i, dt=2</span><br><span class="line">open(1, file=&#x27;INPUT1.DAT&#x27;, form=&#x27;formatted&#x27;, status=&#x27;old&#x27;)</span><br><span class="line">open(2, file=&#x27;ch7_result.dat&#x27;,status=&#x27;replace&#x27;,action=&#x27;write&#x27;)</span><br><span class="line">open(3, file=&#x27;ch7_result_low.dat&#x27;,status=&#x27;replace&#x27;,action=&#x27;write&#x27;)</span><br><span class="line">open(4, file=&#x27;ch7_result_circle.dat&#x27;,status=&#x27;replace&#x27;,action=&#x27;write&#x27;)</span><br><span class="line">read (1,*)(X(i), i=1,100)</span><br><span class="line"></span><br><span class="line">! 理想低通滤波器</span><br><span class="line"></span><br><span class="line">low_pass_fliter: do i=1,101</span><br><span class="line">t(i) = dt*(i-100/2-1)/1000.</span><br><span class="line">	if ((t(i).lt.0.0001) .and. (t(i).gt.-0.0001)) then</span><br><span class="line">	h_low(i)=2*pi*wc1/pi</span><br><span class="line">	else</span><br><span class="line">	h_low(i)=sin(2*pi*wc1*t(i))/(pi*t(i))</span><br><span class="line">	endif</span><br><span class="line">end do low_pass_fliter</span><br><span class="line"></span><br><span class="line">! 卷积</span><br><span class="line">call CON(X,h_low,result_low,100,101,100+101-1)  ! result_low is the result of linear convolution</span><br><span class="line">call CIRCON(X, h_low, result_circle, 101)</span><br><span class="line"></span><br><span class="line">do i=1,101   ! 为圆周卷积补零</span><br><span class="line">X_c(i) = X(i)</span><br><span class="line">enddo</span><br><span class="line"></span><br><span class="line">do i=1,201</span><br><span class="line">t2(i) = dt*(i-200/2-1)/1000.</span><br><span class="line">	if ((t2(i).lt.0.0001) .and. (t2(i).gt.-0.0001)) then</span><br><span class="line">	h_r(i)=2*pi*wc1/pi</span><br><span class="line">	else</span><br><span class="line">	h_r(i)=sin(2*pi*wc1*t2(i))/(pi*t2(i))</span><br><span class="line">	endif</span><br><span class="line">end do</span><br><span class="line">! 圆周卷积</span><br><span class="line">call CIRCON(X_c, h_r, result_circle_r, 201)</span><br><span class="line"></span><br><span class="line">do i=1,101</span><br><span class="line">    write(2,300) i, (i-1.)*dt, X(i), result_low(i+50), result_circle(i)</span><br><span class="line">end do</span><br><span class="line">300 format(I4, 4(x, F15.4))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">do i=1,101</span><br><span class="line">    write(4,200) i, (i-1.)*dt, X_c(i), result_circle_r(i+100)</span><br><span class="line">end do</span><br><span class="line">200 format(I4, 3(x, F15.4))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">end program ch7_circle</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	SUBROUTINE CON(A,B,C,I,J,K)</span><br><span class="line">	DIMENSION A(I),B(J),C(K)</span><br><span class="line">	DO 1 K1=1,K</span><br><span class="line">  1	C(K1)=0.0</span><br><span class="line">	DO 2 I1=1,I</span><br><span class="line">	DO 2 I2=1,J</span><br><span class="line">	II=I1+I2-1</span><br><span class="line">  2	C(II)=C(II)+A(I1)*B(I2)*0.004</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	SUBROUTINE CIRCON(X,H,Y,N)</span><br><span class="line">	REAL X(N),H(N),Y(N)</span><br><span class="line">	DO I=1,N</span><br><span class="line">	Y(I)=0.0</span><br><span class="line">	ENDDO</span><br><span class="line">	DO I=1,N</span><br><span class="line">	   DO J=1,N</span><br><span class="line">	     IF(I-J.GT.0) Y(I)=Y(I)+X(J)*H(I-J)</span><br><span class="line">	   ENDDO </span><br><span class="line">	ENDDO</span><br><span class="line">	END</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">clear</span><br><span class="line">load ch7_result.dat</span><br><span class="line">load ch7_result_circle.dat</span><br><span class="line">figure(5)</span><br><span class="line">hold on</span><br><span class="line">subplot(3,1,1)</span><br><span class="line">plot(ch7_result(:,2), ch7_result(:,3))</span><br><span class="line">title(&#x27;源数据&#x27;)</span><br><span class="line">xlabel(&#x27;T s&#x27;)</span><br><span class="line">ylabel(&#x27;amplitude&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(3,1,2)</span><br><span class="line">plot(ch7_result(:,2), ch7_result(:,4))</span><br><span class="line">title(&#x27;线性褶积&#x27;)</span><br><span class="line">xlabel(&#x27;T s&#x27;)</span><br><span class="line">ylabel(&#x27;amplitude&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">subplot(3,1,3)</span><br><span class="line">plot(ch7_result(:,2), ch7_result(:,5))</span><br><span class="line">title(&#x27;圆周褶积&#x27;)</span><br><span class="line">xlabel(&#x27;T s&#x27;)</span><br><span class="line">ylabel(&#x27;amplitude&#x27;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">figure(6)</span><br><span class="line">hold on</span><br><span class="line">subplot(3,1,1)</span><br><span class="line">plot(ch7_result_circle(:,2), ch7_result_circle(:,3))</span><br><span class="line">title(&#x27;源数据&#x27;)</span><br><span class="line">xlabel(&#x27;T s&#x27;)</span><br><span class="line">ylabel(&#x27;amplitude&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(3,1,2)</span><br><span class="line">plot(ch7_result_circle(:,2), ch7_result_circle(:,4))</span><br><span class="line">title(&#x27;圆周褶积&#x27;)</span><br><span class="line">xlabel(&#x27;T s&#x27;)</span><br><span class="line">ylabel(&#x27;amplitude&#x27;)</span><br></pre></td></tr></table></figure>
<h1 id="最小平方法求反射系数"><a href="#最小平方法求反射系数" class="headerlink" title="最小平方法求反射系数"></a>最小平方法求反射系数</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">program ch8_leasqu</span><br><span class="line">implicit none</span><br><span class="line">integer, parameter :: N=200, Nb=12, m=61</span><br><span class="line">real, dimension(Nb) :: bn</span><br><span class="line">real, dimension(N) :: ref_coe</span><br><span class="line">real, dimension(m) :: rbb, a</span><br><span class="line">real, dimension(N+Nb-1) :: X</span><br><span class="line">real, dimension(N+Nb-1+m-1) :: ref_coe_inver</span><br><span class="line">integer :: i</span><br><span class="line">bn=[17.5, 12.5, 7.0, 0.0, -3.5, -7.0,-3.0, -1.0, 0.0, 1.4, 3.5, 2.0]</span><br><span class="line">! 读取反射系数序列 ref_coe</span><br><span class="line">open(1, file=&#x27;INPUT8.DAT&#x27;, form=&#x27;formatted&#x27;, status=&#x27;old&#x27;)</span><br><span class="line">read(1,*)(ref_coe(i), i=1,200)</span><br><span class="line">! 计算合成地震记录</span><br><span class="line">call CON(bn, ref_coe, X, Nb, N, N+Nb-1)  </span><br><span class="line"></span><br><span class="line">! 使用最小平方法求取反射系数序列</span><br><span class="line">! 求子波自相关</span><br><span class="line">call AUTCOR(Nb,m,bn,rbb)</span><br><span class="line">! 解相应的托布利兹矩阵，求反子波a。</span><br><span class="line">call PEO(m,rbb,a)</span><br><span class="line">! 反子波与地震记录褶积，得到反射系数序列</span><br><span class="line">call CON(a, X, ref_coe_inver, m, N+Nb-1, N+Nb-1+m-1)</span><br><span class="line">open(3, file=&#x27;ch8_input.dat&#x27;, status=&#x27;replace&#x27;,action=&#x27;write&#x27;)</span><br><span class="line">do i=1,N</span><br><span class="line">    write(3,200) i, ref_coe(i)</span><br><span class="line">enddo</span><br><span class="line">200 format(I4, x, F15.4)</span><br><span class="line">open(2, file=&#x27;ch8_result.dat&#x27;, status=&#x27;replace&#x27;,action=&#x27;write&#x27;)</span><br><span class="line">do i=1,N+Nb-1+m-1</span><br><span class="line">    write(2,100) i, ref_coe_inver(i)</span><br><span class="line">enddo</span><br><span class="line">100 format(I4, x, F15.6)</span><br><span class="line"></span><br><span class="line">end program ch8_leasqu</span><br><span class="line"></span><br><span class="line">	SUBROUTINE CON(A,B,C,I,J,K)</span><br><span class="line">	DIMENSION A(I),B(J),C(K)</span><br><span class="line">	DO 1 K1=1,K</span><br><span class="line">  1	C(K1)=0.0</span><br><span class="line">	DO 2 I1=1,I</span><br><span class="line">	DO 2 I2=1,J</span><br><span class="line">	II=I1+I2-1</span><br><span class="line">  2	C(II)=C(II)+A(I1)*B(I2)*0.004</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br><span class="line"></span><br><span class="line">! 解托布利兹矩阵，只有期望输出为脉冲时适用</span><br><span class="line">	SUBROUTINE PEO(LR,R,A)</span><br><span class="line">	DIMENSION R(LR),A(LR)</span><br><span class="line">	V=R(1)</span><br><span class="line">	A(1)=1.0</span><br><span class="line">	IF(LR.EQ.1)RETURN</span><br><span class="line">	DO 6 L=2,LR</span><br><span class="line">	D=0.0</span><br><span class="line">	L3=L-1</span><br><span class="line">	DO 1 J=1,L3</span><br><span class="line">	K=L-J+1</span><br><span class="line"> 1	D=D+A(J)*R(K)</span><br><span class="line">	C=D/V</span><br><span class="line">	IF(L.EQ.2)GOTO 4</span><br><span class="line">	L1=(L-2)/2</span><br><span class="line">	L2=L1+1</span><br><span class="line">	IF(L2.LT.2)GOTO 3</span><br><span class="line">	DO 2 J=2,L2</span><br><span class="line">	HOLD=A(J)</span><br><span class="line">	K=L-J+1</span><br><span class="line">	A(J)=A(J)-C*A(K)</span><br><span class="line"> 2	A(K)=A(K)-C*HOLD</span><br><span class="line">	IF(2*L1.EQ.L-2)GOTO 4</span><br><span class="line"> 3	LT3=L2+1</span><br><span class="line">	A(LT3)=A(LT3)-C*A(LT3)</span><br><span class="line"> 4	A(L)=-C</span><br><span class="line"> 6	V=V-C*D</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br><span class="line"></span><br><span class="line">! 自相关程序</span><br><span class="line">! C自相关的数组 A输出</span><br><span class="line">    SUBROUTINE AUTCOR(J,K,C,A)</span><br><span class="line">	DIMENSION C(J),A(K)</span><br><span class="line">	DO 7 N=1,K</span><br><span class="line">	A(N)=0.0</span><br><span class="line">	I=N</span><br><span class="line">	DO 6 IN=I,J</span><br><span class="line">	IL=IN-N+1</span><br><span class="line">  6	A(N)=A(N)+C(IN)*C(IL)</span><br><span class="line">  7	CONTINUE</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">load ch8_input.dat</span><br><span class="line">load ch8_result.dat</span><br><span class="line"></span><br><span class="line">figure(1)</span><br><span class="line">hold on</span><br><span class="line">subplot(3,1,1)</span><br><span class="line">plot(ch8_input(:,1), ch8_input(:,2))</span><br><span class="line">title(&#x27;原始反射系数序列&#x27;)</span><br><span class="line">subplot(3,1,2)</span><br><span class="line">plot(ch8_result(:,1), ch8_result(:,2))</span><br><span class="line">title(&#x27;反演反射系数序列未截取&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(3,1,3)</span><br><span class="line">plot(ch8_result(1:200,1), ch8_result(1:200,2))</span><br><span class="line">title(&#x27;反演反射系数序列截取到200&#x27;)</span><br></pre></td></tr></table></figure>

<h1 id="子波零相位变换"><a href="#子波零相位变换" class="headerlink" title="子波零相位变换"></a>子波零相位变换</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">program ch9_zerophase</span><br><span class="line">integer, parameter :: N=25</span><br><span class="line">real, dimension(N) :: bo</span><br><span class="line">complex, dimension(N,2) :: bo_comp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bo=[0.,1.,3.,5.,7.,9.,10.,8.,6.,4.,2.,0.,-1.,0.,1.,2.,3.,1.5,0.,-1.,0.,2.,1.,0.,0.]</span><br><span class="line">do i=1,N</span><br><span class="line">    bo_comp(i,:) = CMPLX(bo(i), 0.0)</span><br><span class="line">enddo</span><br><span class="line">! 对原始子波做傅氏变换到频率域</span><br><span class="line">call DFT(N,bo_comp,1.0)</span><br><span class="line">! 在频率域保持振幅谱不变，将虚部设置为0</span><br><span class="line">do i=1,N</span><br><span class="line">    bo_comp(i,:) = CMPLX(sqrt(real(bo_comp(i,1))**2+imag(bo_comp(i,2))**2), 0.0)</span><br><span class="line">enddo</span><br><span class="line">! 变换到时域</span><br><span class="line">call DFT(N, bo_comp, -1.0)</span><br><span class="line"></span><br><span class="line">open(1, file=&#x27;ch9_result.dat&#x27;, status=&#x27;replace&#x27;,action=&#x27;write&#x27;)</span><br><span class="line">do i=1,N</span><br><span class="line">    write(1,100) i, bo(i), real(bo_comp(i,1))</span><br><span class="line">enddo</span><br><span class="line">100 format (I4,2(x,F15.4))</span><br><span class="line"></span><br><span class="line">end program ch9_zerophase</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	SUBROUTINE DFT(N,C,S)</span><br><span class="line">	COMPLEX C(N),Y(512),W</span><br><span class="line">	IF(S.EQ.1.0)Z=1.0</span><br><span class="line">	IF(S.EQ.-1.0)Z=1.0/FLOAT(N)</span><br><span class="line">	DO 20 I=1,N</span><br><span class="line">	Y(I)=(0.0,0.0)</span><br><span class="line">	DO 20 J=1,N</span><br><span class="line">	A=COS(2.0*3.14159265*(I-1)*(J-1)/FLOAT(N))</span><br><span class="line">	B=SIN(2.0*3.14159265*(I-1)*(J-1)/FLOAT(N))*(-S)</span><br><span class="line">	W=CMPLX(A,B)</span><br><span class="line"> 20	Y(I)=Y(I)+C(J)*W</span><br><span class="line">	DO 30 I=1,N</span><br><span class="line"> 30	C(I)=Y(I)*Z</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">load ch9_result.dat</span><br><span class="line"></span><br><span class="line">figure(1)</span><br><span class="line">hold on</span><br><span class="line">subplot(2,1,1)</span><br><span class="line">plot(ch9_result(:,1), ch9_result(:,2))</span><br><span class="line">title(&#x27;原始子波&#x27;)</span><br><span class="line">xlabel(&#x27;序号i，无意义&#x27;)</span><br><span class="line"></span><br><span class="line">subplot(2,1,2)</span><br><span class="line">plot(ch9_result(:,1), ch9_result(:,3))</span><br><span class="line">title(&#x27;零相位子波&#x27;)</span><br><span class="line">xlabel(&#x27;序号i，无意义&#x27;)</span><br></pre></td></tr></table></figure>

<h1 id="子波最小相位转换"><a href="#子波最小相位转换" class="headerlink" title="子波最小相位转换"></a>子波最小相位转换</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">program ch10_leastphase</span><br><span class="line">integer, parameter :: Nb=25, m=26</span><br><span class="line">real, dimension(Nb) :: b</span><br><span class="line">real, dimension(m) :: rbb, y, a0</span><br><span class="line">real, dimension(Nb+m-1) :: by, g, grev</span><br><span class="line">real :: b00,bysingle</span><br><span class="line">integer :: i</span><br><span class="line">real, dimension(2*Nb+m-2) :: b0</span><br><span class="line"></span><br><span class="line">! 已知非最小相位子波</span><br><span class="line">b=[0.,1.,2.,3.,1.5,0.,-1.,0.,1.,3.,5.,7.,9.,10.,8.,6.,4.,2.,0.,-1.,0.,2.,3.,2.,0.]</span><br><span class="line">! 求子波自相关</span><br><span class="line">call AUTCOR(Nb,m,b,rbb)</span><br><span class="line">! 解矩阵，得到y(t)</span><br><span class="line">call PEO(m,rbb,y)</span><br><span class="line">!得到b0（0）,用b00表示</span><br><span class="line">call CON(b,y,by,Nb,m,Nb+m-1)</span><br><span class="line">bysingle=0.</span><br><span class="line">do i = 1,Nb+m-1</span><br><span class="line">    bysingle=bysingle+by(i)**2</span><br><span class="line">enddo</span><br><span class="line">b00=1./bysingle</span><br><span class="line"></span><br><span class="line">! 得到 a0</span><br><span class="line">do i=1,m</span><br><span class="line">    a0(i) = b00*y(i)</span><br><span class="line">enddo</span><br><span class="line"></span><br><span class="line">! 得到g(t)</span><br><span class="line">call CON(b,a0,g, Nb,m,Nb+m-1)</span><br><span class="line"></span><br><span class="line">! 计算g(-t) 即grev</span><br><span class="line">do i=1,Nb+m-1</span><br><span class="line">    grev(i) = g(Nb+m-i)</span><br><span class="line">enddo</span><br><span class="line"></span><br><span class="line">! 计算b0</span><br><span class="line">call CON(b,grev,b0,Nb,Nb+m-1,2*Nb+m-2)</span><br><span class="line"></span><br><span class="line">open(2, file=&#x27;ch10_result.dat&#x27;, status=&#x27;replace&#x27;,action=&#x27;write&#x27;)</span><br><span class="line">open(1, file=&#x27;ch10_input.dat&#x27;, status=&#x27;replace&#x27;,action=&#x27;write&#x27;)</span><br><span class="line">do i=1,Nb</span><br><span class="line">    write(1,100) i, b(i)</span><br><span class="line">enddo</span><br><span class="line">do i=1,2*Nb+m-2</span><br><span class="line">    write(2,100) i, b0(i)</span><br><span class="line">enddo</span><br><span class="line">100 format(I4,x, F15.4)</span><br><span class="line">end program ch10_leastphase</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	SUBROUTINE CON(A,B,C,I,J,K)</span><br><span class="line">	DIMENSION A(I),B(J),C(K)</span><br><span class="line">	DO 1 K1=1,K</span><br><span class="line">  1	C(K1)=0.0</span><br><span class="line">	DO 2 I1=1,I</span><br><span class="line">	DO 2 I2=1,J</span><br><span class="line">	II=I1+I2-1</span><br><span class="line">  2	C(II)=C(II)+A(I1)*B(I2)*0.004</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br><span class="line"></span><br><span class="line">! 解托布利兹矩阵，只有期望输出为脉冲时适用</span><br><span class="line">	SUBROUTINE PEO(LR,R,A)</span><br><span class="line">	DIMENSION R(LR),A(LR)</span><br><span class="line">	V=R(1)</span><br><span class="line">	A(1)=1.0</span><br><span class="line">	IF(LR.EQ.1)RETURN</span><br><span class="line">	DO 6 L=2,LR</span><br><span class="line">	D=0.0</span><br><span class="line">	L3=L-1</span><br><span class="line">	DO 1 J=1,L3</span><br><span class="line">	K=L-J+1</span><br><span class="line"> 1	D=D+A(J)*R(K)</span><br><span class="line">	C=D/V</span><br><span class="line">	IF(L.EQ.2)GOTO 4</span><br><span class="line">	L1=(L-2)/2</span><br><span class="line">	L2=L1+1</span><br><span class="line">	IF(L2.LT.2)GOTO 3</span><br><span class="line">	DO 2 J=2,L2</span><br><span class="line">	HOLD=A(J)</span><br><span class="line">	K=L-J+1</span><br><span class="line">	A(J)=A(J)-C*A(K)</span><br><span class="line"> 2	A(K)=A(K)-C*HOLD</span><br><span class="line">	IF(2*L1.EQ.L-2)GOTO 4</span><br><span class="line"> 3	LT3=L2+1</span><br><span class="line">	A(LT3)=A(LT3)-C*A(LT3)</span><br><span class="line"> 4	A(L)=-C</span><br><span class="line"> 6	V=V-C*D</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br><span class="line"></span><br><span class="line">! 自相关程序</span><br><span class="line">! C自相关的数组 A输出</span><br><span class="line">    SUBROUTINE AUTCOR(J,K,C,A)</span><br><span class="line">	DIMENSION C(J),A(K)</span><br><span class="line">	DO 7 N=1,K</span><br><span class="line">	A(N)=0.0</span><br><span class="line">	I=N</span><br><span class="line">	DO 6 IN=I,J</span><br><span class="line">	IL=IN-N+1</span><br><span class="line">  6	A(N)=A(N)+C(IN)*C(IL)</span><br><span class="line">  7	CONTINUE</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">load ch10_input.dat</span><br><span class="line">load ch10_result.dat</span><br><span class="line"></span><br><span class="line">figure(1)</span><br><span class="line">hold on</span><br><span class="line">subplot(2,1,1)</span><br><span class="line">plot(ch10_input(:,1), ch10_input(:,2))</span><br><span class="line">title(&#x27;原始子波&#x27;)</span><br><span class="line">subplot(2,1,2)</span><br><span class="line">plot(ch10_result(:,1), ch10_result(:,2))</span><br><span class="line">title(&#x27;最小相位子波未截取&#x27;)</span><br></pre></td></tr></table></figure>
<h1 id="静校正"><a href="#静校正" class="headerlink" title="静校正"></a>静校正</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">program ch11_static</span><br><span class="line">real, dimension(1000) :: X</span><br><span class="line">real, dimension(100) :: refer</span><br><span class="line">real, dimension(10,100) :: Xorigin, X_static</span><br><span class="line">integer, dimension(10,1) :: static</span><br><span class="line">integer start, i, k, j, sta</span><br><span class="line">integer, parameter :: M=50</span><br><span class="line">real, dimension(10,M) :: rxy</span><br><span class="line">open(1,file=&#x27;SEIS.DAT&#x27;, form=&#x27;formatted&#x27;,status=&#x27;old&#x27;)</span><br><span class="line">read(1,*)(X(i),i=1,1000)</span><br><span class="line">start=1</span><br><span class="line">do j=1,10</span><br><span class="line">    do k=1,100</span><br><span class="line">        Xorigin(j,k)=X(start)</span><br><span class="line">        start=start+1</span><br><span class="line">    enddo</span><br><span class="line">enddo</span><br><span class="line"></span><br><span class="line">! 选择第1道作为参考道，形成参考道refer</span><br><span class="line">do i=1,100</span><br><span class="line">    refer(i) = Xorigin(1,i)</span><br><span class="line">enddo</span><br><span class="line"></span><br><span class="line">! refer与各道做互相关求取各道的相对剩余静校正量static</span><br><span class="line">! 做互相关</span><br><span class="line">do i=1,10</span><br><span class="line">    call COAUTCOR(100,100,M,refer, Xorigin(i,:), rxy(i,:))</span><br><span class="line">enddo</span><br><span class="line"></span><br><span class="line">! 绘制互相关曲线</span><br><span class="line">open(3, file=&#x27;ch11_outTAO.dat&#x27;, status=&#x27;replace&#x27;,action=&#x27;write&#x27;)</span><br><span class="line"></span><br><span class="line">do j=1,M</span><br><span class="line">    write(3,300)  j-1, rxy(1,j), rxy(2,j), rxy(3,j), rxy(4,j), rxy(5,j), rxy(6,j), rxy(7,j), rxy(8,j), rxy(9,j), rxy(10,j)</span><br><span class="line">enddo</span><br><span class="line">300 format(I4,10(x,F15.4))</span><br><span class="line"></span><br><span class="line">! 由上面的互相关曲线得到了剩余静校正量：static</span><br><span class="line">do i=1,10</span><br><span class="line">    static(i,:)=maxloc(rxy(i,:))</span><br><span class="line">enddo</span><br><span class="line"></span><br><span class="line">! 进行静校正</span><br><span class="line">! 初始化为0，避免生成错误数据</span><br><span class="line">do i=1,10</span><br><span class="line">    do j=1,100</span><br><span class="line">        X_static(i,j)=0.</span><br><span class="line">    enddo</span><br><span class="line">enddo</span><br><span class="line">! 进行静校正</span><br><span class="line">do i=1,10</span><br><span class="line">    sta=static(i,1)</span><br><span class="line">    k=1</span><br><span class="line">    do j=sta,100</span><br><span class="line">        X_static(i,k)=Xorigin(i,j)</span><br><span class="line">        k=k+1</span><br><span class="line">    enddo</span><br><span class="line">enddo</span><br><span class="line">! 输出原始数据集</span><br><span class="line">open(2, file=&#x27;ch11_input.dat&#x27;, status=&#x27;replace&#x27;,action=&#x27;write&#x27;)</span><br><span class="line">do i=1,1000</span><br><span class="line">    write(2,200)  i, X(i)</span><br><span class="line">enddo</span><br><span class="line">200 format(I4,x,F15.4)</span><br><span class="line">! 输出静校正后的数据</span><br><span class="line">open(4, file=&#x27;ch11_outstatic.dat&#x27;, status=&#x27;replace&#x27;,action=&#x27;write&#x27;)</span><br><span class="line">do j=1,100</span><br><span class="line">    write(4,400)  j, X_static(1,j), X_static(2,j), X_static(3,j), &amp;</span><br><span class="line">    X_static(4,j), X_static(5,j), X_static(6,j), X_static(7,j), X_static(8,j), X_static(9,j), X_static(10,j)</span><br><span class="line">enddo</span><br><span class="line">400 format(I4,10(x,F15.4))</span><br><span class="line"></span><br><span class="line">end program ch11_static</span><br><span class="line"></span><br><span class="line">! 互相关</span><br><span class="line">	SUBROUTINE COAUTCOR(J,L,K,A,B,C)     </span><br><span class="line">	DIMENSION A(J),B(L),C(K)</span><br><span class="line">	DO 7 N=1,K</span><br><span class="line">	C(N)=0.0</span><br><span class="line">	IF (J.LE.L+1-N) THEN</span><br><span class="line">		MIN=J</span><br><span class="line">	ELSE </span><br><span class="line">		MIN=L+1-N</span><br><span class="line">	ENDIF</span><br><span class="line"> 	DO 6 IA=1,MIN</span><br><span class="line">	IB=IA+N-1</span><br><span class="line">  6	C(N)=C(N)+A(IA)*B(IB)</span><br><span class="line">  7	CONTINUE</span><br><span class="line">	RETURN</span><br><span class="line">	END</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">clear</span><br><span class="line">load ch11_input.dat</span><br><span class="line">load ch11_outTAO.dat</span><br><span class="line">load ch11_outstatic.dat</span><br><span class="line"></span><br><span class="line">figure(1)</span><br><span class="line">hold on</span><br><span class="line">sgtitle(&#x27;原始地震道&#x27;)</span><br><span class="line">for i=1:10</span><br><span class="line">    subplot(10,1,i)</span><br><span class="line">    plot(1:100, ch11_input(i*100-99:i*100,2))</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">figure(2)</span><br><span class="line">hold on</span><br><span class="line">sgtitle(&#x27;相关函数曲线&#x27;)</span><br><span class="line">for i=1:10 </span><br><span class="line">    subplot(10,1,i)</span><br><span class="line">    plot( ch11_outTAO(:,1), ch11_outTAO(:,i+1))</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">figure(3)</span><br><span class="line">hold on</span><br><span class="line">sgtitle(&#x27;静校正后的地震数据&#x27;)</span><br><span class="line">for i=1:10 </span><br><span class="line">    subplot(10,1,i)</span><br><span class="line">    plot( ch11_outstatic(:,1), ch11_outstatic(:,i+1))</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhiyuanshi1901.github.io/2023/01/23/Fortran%E5%88%9D%E6%8E%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Shi Zhiyuan">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="日常学习笔记">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 日常学习笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/01/23/Fortran%E5%88%9D%E6%8E%A2/" class="post-title-link" itemprop="url">Fortran初探</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-01-23 21:26:55" itemprop="dateCreated datePublished" datetime="2023-01-23T21:26:55+08:00">2023-01-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-03-15 16:50:07" itemprop="dateModified" datetime="2023-03-15T16:50:07+08:00">2023-03-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">学习笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>1、[Fortran权威指南&#x2F;(英)奇弗斯(Chivers,I.),(英)斯莱索尔姆(Sleightholme,J.)著；陈宝国等译.–北京：人民邮电出版社，2009.10]</p>
<p>2、<a target="_blank" rel="noopener" href="https://www.yiibai.com/fortran/fortran_basic_input_output.html">https://www.yiibai.com/fortran/fortran_basic_input_output.html</a></p>
<p>3、[Fortran 程序设计：第四版&#x2F;（美）史蒂芬·查普曼著；王志强等译.-北京：中国电力出版社，2018.10（2022.8重印）]</p>
<h1 id="基础内容"><a href="#基础内容" class="headerlink" title="基础内容"></a>基础内容</h1><p>！ 作为注释标记</p>
<h2 id="Fortran规则："><a href="#Fortran规则：" class="headerlink" title="Fortran规则："></a>Fortran规则：</h2><ul>
<li>自由源格式</li>
<li>不区分大小写</li>
<li>存在语句顺序<ul>
<li>PROGRAM</li>
<li>类型声明语句</li>
<li>处理与I&#x2F;O语句</li>
<li>END PROGRAM</li>
</ul>
</li>
<li>！用于引入注释</li>
<li>变量名称长度最多31字符，包括_</li>
<li>每行最多132个字符</li>
<li>最多可以允许39个连续行</li>
<li>如果不使用<code>IMPLICIT NONE</code>语句，则没有显式声明的变量被看成默认的类型。即：首个字符是A-H或O-Z，则默认为REAL型。若为I-N，则默认INTEGER型。</li>
</ul>
<h2 id="1、输出你的名字"><a href="#1、输出你的名字" class="headerlink" title="1、输出你的名字"></a>1、输出你的名字</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">PROGRAM ch0701      ！程序命名</span><br><span class="line">!</span><br><span class="line">! This program reads in and prints out a name</span><br><span class="line">!</span><br><span class="line">IMPLICIT NONE   ！ 表示使用的每个数据项的类型必须是显式的</span><br><span class="line">CHARACTER*20 :: First_Name ! 类型声明</span><br><span class="line">!</span><br><span class="line">	PRINT *,&#x27; Type in your first name.&#x27;     ！ 输出语句</span><br><span class="line">	PRINT *,&#x27; up to 20 characters&#x27;</span><br><span class="line">	READ *,First_Name       ！读取键盘输入的字符</span><br><span class="line">	PRINT *,First_Name</span><br><span class="line">!</span><br><span class="line">END PROGRAM ch0701   ！ 终止程序</span><br></pre></td></tr></table></figure>


<h2 id="2、计算平均值"><a href="#2、计算平均值" class="headerlink" title="2、计算平均值"></a>2、计算平均值</h2><p>遵循的原则：声明所有变量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">PROGRAM ch0702   ！程序命名</span><br><span class="line">!</span><br><span class="line">! This program reads in three numbers and sums</span><br><span class="line">! and averages them</span><br><span class="line">!</span><br><span class="line"></span><br><span class="line">IMPLICIT NONE   ！ 表示使用的每个数据项的类型必须是显式的</span><br><span class="line">REAL :: N1,N2,N3,Average = 0.0,Total = 0.0</span><br><span class="line">INTEGER :: N = 3</span><br><span class="line">	PRINT *,&#x27; Type in three numbers.&#x27;</span><br><span class="line">	PRINT *,&#x27; Separated by spaces or commas&#x27;</span><br><span class="line">	READ *,N1,N2,N3</span><br><span class="line">	Total= N1 + N2 + N3   ! 三个变量值相加</span><br><span class="line">	AVERAGE=Total/N</span><br><span class="line">	PRINT *,&#x27;Average of the numbers is &#x27;,Average</span><br><span class="line">END PROGRAM ch0702</span><br></pre></td></tr></table></figure>

<h1 id="运算"><a href="#运算" class="headerlink" title="运算"></a>运算</h1><ul>
<li>加：+</li>
<li>减：-</li>
<li>乘：*</li>
<li>除：&#x2F;</li>
<li>乘方：**</li>
</ul>
<p><strong>注意：整型运算最终结果也是整型！</strong><br><strong>注意：实型运算最终结果需要考虑精度！尤其是结果不是有限小数的情况</strong></p>
<h2 id="字符常数和变量"><a href="#字符常数和变量" class="headerlink" title="字符常数和变量"></a>字符常数和变量</h2><ul>
<li>显式变量：<br>需要定义<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INTEGER :: VAR1[,VAR2,VAR3]</span><br></pre></td></tr></table></figure></li>
<li>REAL 定义实型</li>
<li>INTEGER 定义整型</li>
<li>CHARACTER 定义字符型<br>字符型可以定义长度，缺省时为1。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CHARACTER(len=&lt;len&gt;) ::</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>注：实际上，‘::’是可选的。其有无不影响程序运行。存在的目的是为了兼容早期的Fortran。不过，::看起来有种独特的美感（某本教程的作者说它很可爱），所以还是加上。</strong></p>
<ul>
<li>默认式变量：i，j，k，l，m，n为开头的变量名为INTEGER整型；其他为REAL实型。</li>
</ul>
<p>常数定义：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">type,PARAMETER :: name=value [,name1=value1 ...]</span><br><span class="line">！例如</span><br><span class="line">real,parameter :: pi=3.1415926535</span><br></pre></td></tr></table></figure>

<p><strong>注：大写小写都可以。大写看起来好看，小写看起来更舒服（对于像我这样英语不好的人）。</strong></p>
<h2 id="运算顺序"><a href="#运算顺序" class="headerlink" title="运算顺序"></a>运算顺序</h2><ul>
<li>圆括号优先。</li>
<li>从右到左做指数运算</li>
<li>从左到右做乘法和除法运算</li>
<li>从左到右做加法和减法运算</li>
</ul>
<p>运算法则与C或Python相同，但是需要注意：</p>
<ul>
<li>求幂运算：从右往左的顺序</li>
<li>加减法：不需要注意运算顺序</li>
<li>乘法除法：非整型运算不一定按照从左到右的顺序，需要加括号保证顺序<br>注意：使用时加括号时最好的方式。</li>
</ul>
<p><strong>个人更喜欢多加括号。有些教程说熟练掌握，记住顺序。但是对于非计算机专业使用而言，加上括号的可读性更高，不需要纠结自己是否用对了。例如++i这种运算，个人认为十分“反人类”。</strong></p>
<h2 id="字符格式转换函数"><a href="#字符格式转换函数" class="headerlink" title="字符格式转换函数"></a>字符格式转换函数</h2><ul>
<li>INT(x) 实数-整数 截尾取整</li>
<li>NINT(x) 四舍五入取整</li>
<li>CEILING(x) 大于或等于x的最小整数</li>
<li>FLOOR(x) 小于或等于x的最大整数</li>
<li>REAL(X) 整数转化实数<br>前面即行x表示实数，X表示整数</li>
</ul>
<h2 id="内置函数"><a href="#内置函数" class="headerlink" title="内置函数"></a>内置函数</h2><p>内置函数为最通用的函数。</p>
<table>
<thead>
<tr>
<th align="center">函数名</th>
<th align="center">参数类型</th>
<th align="center">结果类型</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">SQRT(X)</td>
<td align="center">real</td>
<td align="center">real</td>
<td align="center">X的平方根</td>
</tr>
<tr>
<td align="center">ABS(X)</td>
<td align="center">real&#x2F;integer</td>
<td align="center">*</td>
<td align="center">绝对值</td>
</tr>
<tr>
<td align="center">ACHAR(I)</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">SIN(X)</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">弧度制</td>
</tr>
<tr>
<td align="center">SIND(X)</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">角度制</td>
</tr>
<tr>
<td align="center">COS(X)</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">COSD(X)</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">TAN(X)</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">TAND(X)</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">EXP(X)</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">LOG(X)</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">LOGIO(X)</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">IACHAR(C)</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">MOD(A,B)</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">MAX(A,B)</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">MIN(A,B)</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">ASIN(X)</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">ASIND(X)</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">ACOS(X)</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">ACOSD(X)</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">ATAN(X)</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">ATAND(X)</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">ATAN2(Y&#x2F;X)</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">ATAN2D(Y,X)</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody></table>
<p>注:*指输出类型与输入类型相同。</p>
<h2 id="表控输入与输出"><a href="#表控输入与输出" class="headerlink" title="表控输入与输出"></a>表控输入与输出</h2><p>表控输入：变量列表中的变量类型决定输入数据需要的格式。</p>
<pre><code>READ(*,*)input_list
WRITE(*,*)output_list
PRINT *. output_list

# (*,*)表示任意长度，使用``,``隔开
</code></pre>
<p>WRITE与PRINT等价。</p>
<p>关于PRINT：</p>
<pre><code>PRINT fmt, i/o_list
</code></pre>
<p>fmt是读取格式说明，示例如下：</p>
<pre><code>PRINT 100, x , y
100 FORMAT (2F10.2)
string = &#39;(2F10.2)&#39;
PRINT string,x,y
</code></pre>
<h2 id="IMPLICIT-NONE语句"><a href="#IMPLICIT-NONE语句" class="headerlink" title="IMPLICIT NONE语句"></a>IMPLICIT NONE语句</h2><p>加入</p>
<pre><code>IMPLICIT NONE
</code></pre>
<p>所有变量需要显式定义，因此可以避免计算机因为变量名出错而输出错误的答案。</p>
<h2 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h2><p>养成良好编程习惯：</p>
<ul>
<li>使用IMPLICIT NONE 语句。</li>
<li>返回所有输入值以及计量单位。（这也是为什么在mineos中看到运行时返回输入值的原因）</li>
<li>初始化所有变量：显式输入，不要忘记初始化变量。</li>
<li>圆括号使赋值语句更清晰。</li>
</ul>
<h2 id="截断"><a href="#截断" class="headerlink" title="截断"></a>截断</h2><p>注意截断。整型截断为舍入</p>
<h2 id="PARAMETER-语句"><a href="#PARAMETER-语句" class="headerlink" title="PARAMETER 语句"></a>PARAMETER 语句</h2><pre><code>REAL , PARAMETER :: value=12
</code></pre>
<p>类似于C语言中的固定变量，即在类型声明语句之前将某个变量名与变量关联，从而不可更改该变量名的值。<br>类似于<code>#define</code>。</p>
<h2 id="精度问题"><a href="#精度问题" class="headerlink" title="精度问题"></a>精度问题</h2><h2 id="变量状态"><a href="#变量状态" class="headerlink" title="变量状态"></a>变量状态</h2><ul>
<li>已确定的状态 defined：已定义值</li>
<li>未确定的状态 undefined：未定义值</li>
</ul>
<h2 id="思考题"><a href="#思考题" class="headerlink" title="思考题"></a>思考题</h2><h3 id="运行示例4"><a href="#运行示例4" class="headerlink" title="运行示例4"></a>运行示例4</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">PROGRAM ch0804</span><br><span class="line">implicit none</span><br><span class="line">real :: light_minute, distance, elapse</span><br><span class="line">integer :: minute, second </span><br><span class="line">real, parameter :: light_year=9.46*10**12</span><br><span class="line"></span><br><span class="line">light_minute = light_year/(365.25 * 24.0 * 60.0)</span><br><span class="line">distance = 150.0 * 10 ** 6</span><br><span class="line">elapse = distance / light_minute</span><br><span class="line">minute = elapse</span><br><span class="line">second = (elapse - minute) * 60</span><br><span class="line">print *,&#x27; light takes &#x27; , minute, &#x27; Minutes&#x27;</span><br><span class="line">print *,&#x27;             &#x27; , second, &#x27; seconds&#x27;</span><br><span class="line">print *,&#x27; To reach the earth from the sum&#x27;</span><br><span class="line">END PROGRAM ch0804</span><br></pre></td></tr></table></figure>

<p>在运行ch0804出现错误：</p>
<pre><code>Error: Result of exponentiation at (1) exceeds the range of INTEGER(4)
</code></pre>
<p>表示结果超出整型范围。</p>
<p>疑问：？？？ 未解决</p>
<h3 id="计算摆的周期"><a href="#计算摆的周期" class="headerlink" title="计算摆的周期"></a>计算摆的周期</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PROGRAM period_of_pendulum</span><br><span class="line">implicit none</span><br><span class="line">real :: length,T</span><br><span class="line">real , parameter :: pi = 3.1415926535</span><br><span class="line">print *,&#x27;Please input the length of pendulum:&#x27;</span><br><span class="line">read *, length</span><br><span class="line">T = 2 * Pi * (length / 9.81) ** .5</span><br><span class="line">print *,&#x27;The period is &#x27;, T, &#x27;seconds.&#x27;</span><br><span class="line">end program period_of_pendulum</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> Please input the length of pendulum:</span><br><span class="line">1</span><br><span class="line"> The period is    2.00606656     seconds.</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>在计算器中的输出值为：2.006066681。</p>
<h3 id="进制转换"><a href="#进制转换" class="headerlink" title="进制转换"></a>进制转换</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">program base_conversion</span><br><span class="line">real :: x1=1.0</span><br><span class="line">real :: x2=0.1</span><br><span class="line">real :: x3=0.01</span><br><span class="line">real :: x4=0.001</span><br><span class="line">real :: x5=0.0001</span><br><span class="line">	print *,&#x27; &#x27;,x1</span><br><span class="line">	print *,&#x27; &#x27;,x2</span><br><span class="line">	print *,&#x27; &#x27;,x3</span><br><span class="line">	print *,&#x27; &#x27;,x4</span><br><span class="line">	print *,&#x27; &#x27;,x5</span><br><span class="line">end program base_conversion</span><br></pre></td></tr></table></figure>
<p>输出结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> 1.00000000    </span><br><span class="line">0.100000001    </span><br><span class="line"> 9.99999978E-03</span><br><span class="line"> 1.00000005E-03</span><br><span class="line"> 9.99999975E-05</span><br></pre></td></tr></table></figure>
<p>1.0保持不变，但是其他值均发生了改变。</p>
<h3 id="简单减法"><a href="#简单减法" class="headerlink" title="简单减法"></a>简单减法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">program subtract</span><br><span class="line">real :: a=1.0002</span><br><span class="line">real :: b=1.0001</span><br><span class="line">real :: c</span><br><span class="line">	c=a-b</span><br><span class="line">	print *,a</span><br><span class="line">	print *,b</span><br><span class="line">	print *,c</span><br><span class="line">end program subtract</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.00020003    </span><br><span class="line">1.00010002    </span><br><span class="line">1.00016594E-04</span><br></pre></td></tr></table></figure>
<p>理论结果为0.0001，但是结果输出不同了，而且a和b的值也发生了变化。这与十进制与二进制的转换有关。</p>
<h3 id="fortran下的表达式等价原则"><a href="#fortran下的表达式等价原则" class="headerlink" title="fortran下的表达式等价原则"></a>fortran下的表达式等价原则</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">program expression_equivalence</span><br><span class="line">real :: x=1.002</span><br><span class="line">real :: y=1.001</span><br><span class="line">real :: t1,t2,t3,t4,t5</span><br><span class="line">	t1=x-y</span><br><span class="line">	t2=x+y</span><br><span class="line">	print *,t1</span><br><span class="line">	print *,t2</span><br><span class="line">	t3=t1*t2</span><br><span class="line">	t4=x**2-y**2</span><br><span class="line">	t5=x*x-y*y</span><br><span class="line">	print *,t3</span><br><span class="line">	print *,t4</span><br><span class="line">	print *,t5</span><br><span class="line">end program expression_equivalence</span><br></pre></td></tr></table></figure>
<p>输出结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x-y=9.99927521E-04</span><br><span class="line">x+y=2.00300002    </span><br><span class="line">(x-y)*(x+y)=2.00285483E-03</span><br><span class="line">x^2-y^2=2.00295448E-03</span><br><span class="line">x*x-y*y=2.00295448E-03</span><br></pre></td></tr></table></figure>
<p>计算器：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x-y=0.001</span><br><span class="line">x+y=2.003  </span><br><span class="line">(x-y)*(x+y)=2.003E-3</span><br><span class="line">x^2-y^2=2.003E-3</span><br><span class="line">x*x-y*y=2.003E-3</span><br></pre></td></tr></table></figure>
<p>LibreOffice：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x-y=0.001</span><br><span class="line">x+y=2.003  </span><br><span class="line">(x-y)*(x+y)=0.002003</span><br><span class="line">x^2-y^2=0.002003</span><br><span class="line">x*x-y*y=0.002003</span><br></pre></td></tr></table></figure>
<h3 id="ch0804变形"><a href="#ch0804变形" class="headerlink" title="ch0804变形"></a>ch0804变形</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">PROGRAM ch0804changed</span><br><span class="line">implicit none</span><br><span class="line">real :: light_minute, distance, elapse</span><br><span class="line">integer :: minute, second </span><br><span class="line">real :: light_year  ! 改变的为这一句和下面一句，将其改变为可变变量</span><br><span class="line">light_year=9.46*10**12</span><br><span class="line">light_minute = light_year/(365.25 * 24.0 * 60.0)</span><br><span class="line">distance = 150.0 * 10 ** 6</span><br><span class="line">elapse = distance / light_minute</span><br><span class="line">minute = elapse</span><br><span class="line">second = (elapse - minute) * 60</span><br><span class="line">print *,&#x27; light takes &#x27; , minute, &#x27; Minutes&#x27;</span><br><span class="line">print *,&#x27;             &#x27; , second, &#x27; seconds&#x27;</span><br><span class="line">print *,&#x27; To reach the earth from the sum&#x27;</span><br><span class="line">END PROGRAM ch0804changed</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">    6 | light_year=9.46*10**12</span><br><span class="line">      |                  1</span><br><span class="line">Error: Result of exponentiation at (1) exceeds the range of INTEGER(4)</span><br></pre></td></tr></table></figure>
<p>疑问： ？？？未解决</p>
<h1 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h1><h2 id="DIMENSION-属性"><a href="#DIMENSION-属性" class="headerlink" title="DIMENSION 属性"></a>DIMENSION 属性</h2><p>使用dimension属性将变量定义为数组：</p>
<pre><code>real , dimension(len) :: wages
integer , dimension(len) :: sample
</code></pre>
<p>赋值数组内的元素：</p>
<pre><code>wages(1)=1.
wages = [1.,2.,33.]
wages = 1 # 赋值为相同值
(arg1, arg2, ... , index = istart, iend, incr) # 隐藏的循环初始化赋值
</code></pre>
<p>示例1：</p>
<pre><code>integer, dimension(25)::array4=[(0,i=1,4),5*j,j=1,5]
</code></pre>
<p>结果：</p>
<pre><code>0,0,0,0,5,0,0,0,0,10,0,0,0,0,15,0,0,0,0,20
</code></pre>
<p>示例2：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">program ch0901</span><br><span class="line">implicit none</span><br><span class="line">real :: total=0.0, average=0.0 !定义变量</span><br><span class="line">real , dimension(1:12) :: rainfall</span><br><span class="line">integer :: month</span><br><span class="line"></span><br><span class="line">	print *,&#x27;Type in the rainfall values&#x27;</span><br><span class="line">	print *,&#x27;one per line&#x27;</span><br><span class="line">	do month=1,12   ! 使用do进行循环</span><br><span class="line">		read *, rainfall(month)</span><br><span class="line">	enddo</span><br><span class="line">	</span><br><span class="line">	do month=1,12</span><br><span class="line">		total = total + rainfall(month)</span><br><span class="line">	enddo</span><br><span class="line">	</span><br><span class="line">	average = total / 12</span><br><span class="line">	print *,&#x27;average monthly rainfall was&#x27;</span><br><span class="line">	print *, average</span><br><span class="line">end program ch0901</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> Type in the rainfall values</span><br><span class="line"> one per line</span><br><span class="line">23</span><br><span class="line">22</span><br><span class="line">24</span><br><span class="line">23</span><br><span class="line">21</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">12</span><br><span class="line">10</span><br><span class="line">45</span><br><span class="line">40</span><br><span class="line">44</span><br><span class="line"> average monthly rainfall was</span><br><span class="line">   24.2500000  </span><br></pre></td></tr></table></figure>
<h2 id="改变数组下标取值范围"><a href="#改变数组下标取值范围" class="headerlink" title="改变数组下标取值范围"></a>改变数组下标取值范围</h2><p>一般使用<code>1,2,...,N</code>表示下标索引。但是有时以<code>0</code>开始更为方便。<br>指定下标的方式为：</p>
<pre><code>real, dimension(lower_bound : upper_bound) :: array
</code></pre>
<p>数组宽度&#x3D;上界值-下界值+1</p>
<h2 id="数组下标越界"><a href="#数组下标越界" class="headerlink" title="数组下标越界"></a>数组下标越界</h2><p>边界检测消耗运算资源。debug时开启，运行时关闭。</p>
<p>开启边界检测器在运行时输入:</p>
<pre><code># windows情况下
ifort -check filename.f90 # 编译
filename.f90 # 运行
</code></pre>
<h2 id="使用命名常数"><a href="#使用命名常数" class="headerlink" title="使用命名常数"></a>使用命名常数</h2><pre><code>REAL, DIMENSION(MAX_SIZE)::array1
</code></pre>
<p>MAX_SIZE可以修改。</p>
<h2 id="使用整个数组"><a href="#使用整个数组" class="headerlink" title="使用整个数组"></a>使用整个数组</h2><p>数组<code>a</code>与数组<code>b</code>相加，为两个数组中的逐个元素相加。但是两个数组纬度必须相同！标量值与数组相同，将作用于每个元素。</p>
<h2 id="使用部分数组"><a href="#使用部分数组" class="headerlink" title="使用部分数组"></a>使用部分数组</h2><p>部分数组，即数组的子集。</p>
<pre><code>subscript_1 : subscript_2 : stride  # 最小下标，最大下标，下标增量
</code></pre>
<p>若缺省，则分别为：数组的最小下标，数组的最大下标，1。</p>
<h2 id="可变数组"><a href="#可变数组" class="headerlink" title="可变数组"></a>可变数组</h2><p>定义可变数组：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">real, dimension(:,:), allocatable :: array1,array2</span><br></pre></td></tr></table></figure>
<p>分配内存空间：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">allocate(array1(len1,len2),array2(len3,len4))</span><br></pre></td></tr></table></figure>
<p>释放内存空间：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deallocate(array1,array2)</span><br></pre></td></tr></table></figure>

<h2 id="数组输入输出"><a href="#数组输入输出" class="headerlink" title="数组输入输出"></a>数组输入输出</h2><h3 id="数组元素输入输出"><a href="#数组元素输入输出" class="headerlink" title="数组元素输入输出"></a>数组元素输入输出</h3><p>可以使用<code>WRITE</code>语句。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WRITE (*,100)a(1),a(2),a(3)</span><br><span class="line">100 FORMAT (&#x27;a=&#x27;,3F10.2)</span><br></pre></td></tr></table></figure>

<p>隐式DO循环：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WRITE (*,100) (a(i), i=1,3)</span><br><span class="line">100 FORMAT (&#x27;a=&#x27;,3F10.2)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WRITE (unit, format)(arg1, arg2,...,index = istart, iend, incr)</span><br></pre></td></tr></table></figure>
<p>arg为要输入或者输出的数值。index控制循环。<code>READ</code>同上。<br>arg如果为数组，可以使用：<code>arg(index)</code>表示输出。</p>
<p>嵌套隐式DO循环：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">write(*,100) ((i,j,j=1,3),i=1,2)</span><br><span class="line">100 FORMAT (I5,1X,I5)</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1 1</span><br><span class="line">1 2</span><br><span class="line">1 3</span><br><span class="line">2 1</span><br><span class="line">2 2</span><br><span class="line">2 3</span><br></pre></td></tr></table></figure>

<h3 id="整个数组的输入输出"><a href="#整个数组的输入输出" class="headerlink" title="整个数组的输入输出"></a>整个数组的输入输出</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">real, dimension(5)::a=[1,2,3,4,5]</span><br><span class="line">WRITE(*,100) a</span><br><span class="line">100 FORMAT (6F8.3)</span><br><span class="line">WRITE(*,100) a(2::2) # 输出指定下标</span><br><span class="line">WRITE(*,100) a([3,2,3,4]) # 输出数组指定的下标</span><br></pre></td></tr></table></figure>


<h2 id="do循环"><a href="#do循环" class="headerlink" title="do循环"></a>do循环</h2><pre><code>do counter = start, end, increment
......  ！语句
enddo
</code></pre>
<p>其中，increment默认为1，可以省略。</p>
<h2 id="使用参数设置数组大小"><a href="#使用参数设置数组大小" class="headerlink" title="使用参数设置数组大小"></a>使用参数设置数组大小</h2><p>例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">program ch0902</span><br><span class="line">implicit none</span><br><span class="line"></span><br><span class="line">integer ,parameter :: number_of_people = 10</span><br><span class="line">real :: total=0.0, average=0.0 !定义变量</span><br><span class="line">integer :: person</span><br><span class="line">real , dimension(1:number_of_people) :: weight</span><br><span class="line"></span><br><span class="line">	do person = 1, number_of_people</span><br><span class="line">		print *,&#x27;type in the weight for person &#x27;, person</span><br><span class="line">		read *,weight(person)</span><br><span class="line">		total = total + weight(person)</span><br><span class="line">	enddo</span><br><span class="line">	average = total/number_of_people</span><br><span class="line">	</span><br><span class="line">	print *,&#x27;the total of the weights is &#x27;, total</span><br><span class="line">	print *,&#x27;average weight is &#x27;, average</span><br><span class="line">	print *,&#x27; &#x27;,number_of_people, &#x27; weights were &#x27;</span><br><span class="line">	</span><br><span class="line">	do person = 1, number_of_people</span><br><span class="line">		print *,weight(person)</span><br><span class="line">	enddo</span><br><span class="line">end program ch0902</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"> type in the weight for person            1</span><br><span class="line">85</span><br><span class="line"> type in the weight for person            2</span><br><span class="line">76</span><br><span class="line"> type in the weight for person            3</span><br><span class="line">85</span><br><span class="line"> type in the weight for person            4</span><br><span class="line">90</span><br><span class="line"> type in the weight for person            5</span><br><span class="line">69</span><br><span class="line"> type in the weight for person            6</span><br><span class="line">83</span><br><span class="line"> type in the weight for person            7</span><br><span class="line">64</span><br><span class="line"> type in the weight for person            8</span><br><span class="line">57</span><br><span class="line"> type in the weight for person            9</span><br><span class="line">65</span><br><span class="line"> type in the weight for person           10</span><br><span class="line">76</span><br><span class="line"> the total of the weights is    750.000000    </span><br><span class="line"> average weight is    75.0000000    </span><br><span class="line">            10  weights were </span><br><span class="line">   85.0000000    </span><br><span class="line">   76.0000000    </span><br><span class="line">   85.0000000    </span><br><span class="line">   90.0000000    </span><br><span class="line">   69.0000000    </span><br><span class="line">   83.0000000    </span><br><span class="line">   64.0000000    </span><br><span class="line">   57.0000000    </span><br><span class="line">   65.0000000    </span><br><span class="line">   76.0000000   </span><br></pre></td></tr></table></figure>

<p>语句：</p>
<pre><code>real , dimension(number) :: weight
</code></pre>
<p>若下界未指定，则为1。</p>
<h2 id="格式化输出形式"><a href="#格式化输出形式" class="headerlink" title="格式化输出形式"></a>格式化输出形式</h2><h3 id="format输出"><a href="#format输出" class="headerlink" title="format输出"></a>format输出</h3><p>常用描述符号与举例：<br>参考：<a target="_blank" rel="noopener" href="https://www.yiibai.com/fortran/fortran_basic_input_output.html">https://www.yiibai.com/fortran/fortran_basic_input_output.html</a></p>
<p>例句：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">print 100</span><br><span class="line">100 format (20x, &#x27;Length&#x27;, 20x,&#x27;period&#x27;)</span><br><span class="line"></span><br><span class="line">do number = 1,10</span><br><span class="line">	print 200, length(number), T(number)</span><br><span class="line">	200 format (20x, i5, 20x, f5.2)  </span><br><span class="line">	 ！ 输出为length和T，其中20x表示空间格数，i5指整数5个长度。f为实数。</span><br><span class="line">enddo</span><br></pre></td></tr></table></figure>

<h2 id="思考题-1"><a href="#思考题-1" class="headerlink" title="思考题"></a>思考题</h2><h3 id="2、计算5个数的平均值"><a href="#2、计算5个数的平均值" class="headerlink" title="2、计算5个数的平均值"></a>2、计算5个数的平均值</h3><p>注意！ 定义数组时使用<code>:</code>分隔上下界，使用do循环使用<code>,</code>分隔上下界。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">program average_5</span><br><span class="line"></span><br><span class="line">integer , parameter :: quantity=5</span><br><span class="line">real , dimension(1 : quantity) :: numbers</span><br><span class="line">real :: total=0.0, average=0.0</span><br><span class="line">integer :: range</span><br><span class="line">do range=1,quantity</span><br><span class="line">	print *,&#x27;Please input &#x27;,quantity,&#x27;numbers, the &#x27;, range,&#x27;one is:&#x27;</span><br><span class="line">	read *,numbers(range)</span><br><span class="line">	total = total + numbers(range)</span><br><span class="line">enddo</span><br><span class="line"></span><br><span class="line">average=total/quantity</span><br><span class="line">print *,&#x27;The average of &#x27;,quantity,&#x27;numbers is:&#x27;,average</span><br><span class="line"></span><br><span class="line">end program average_5</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> Please input            5 numbers, the            1 one is:</span><br><span class="line">5</span><br><span class="line"> Please input            5 numbers, the            2 one is:</span><br><span class="line">3.4</span><br><span class="line"> Please input            5 numbers, the            3 one is:</span><br><span class="line">0.6</span><br><span class="line"> Please input            5 numbers, the            4 one is:</span><br><span class="line">2.8</span><br><span class="line"> Please input            5 numbers, the            5 one is:</span><br><span class="line">8.9</span><br><span class="line"> The average of            5 numbers is:   4.14000034    </span><br></pre></td></tr></table></figure>

<h3 id="3-1、改写体重总数，计算身高总数和平均数"><a href="#3-1、改写体重总数，计算身高总数和平均数" class="headerlink" title="3-1、改写体重总数，计算身高总数和平均数"></a>3-1、改写体重总数，计算身高总数和平均数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">program ch0902</span><br><span class="line">implicit none</span><br><span class="line"></span><br><span class="line">integer ,parameter :: number_of_people = 10</span><br><span class="line">real :: total_weight=0.0, average_weight=0.0,total_height=0.0, average_height=0.0</span><br><span class="line">integer :: person</span><br><span class="line">real , dimension(1:number_of_people) :: weight, height</span><br><span class="line"></span><br><span class="line">	do person = 1, number_of_people</span><br><span class="line">		print *,&#x27;type in the weight and height for person &#x27;, person, &#x27;use space as the interval:&#x27;</span><br><span class="line">		read *,weight(person), height(person)</span><br><span class="line">		total_weight = total_weight + weight(person)</span><br><span class="line">		total_height = total_height + height(person)</span><br><span class="line">	enddo</span><br><span class="line">	average_weight = total_weight/number_of_people</span><br><span class="line">	average_height = total_height/number_of_people</span><br><span class="line">	</span><br><span class="line">	print *,&#x27;the total of the weights is &#x27;, total_weight, &#x27;the total of the heights is &#x27;, total_height</span><br><span class="line">	print *,&#x27;average weight is &#x27;, average_weight, &#x27; average height is &#x27;, average_height</span><br><span class="line">	</span><br><span class="line">	print *,&#x27; &#x27;,number_of_people, &#x27; weights and heights were &#x27;	</span><br><span class="line">	print *,&#x27;^I&#x27;,&#x27;number_of_people&#x27;, &#x27;^I weights&#x27;,&#x27; ^I heights&#x27;	</span><br><span class="line">	do person = 1, number_of_people</span><br><span class="line">		print *,person,&#x27;^I&#x27;,weight(person),&#x27;^I&#x27;, height(person)</span><br><span class="line">	enddo</span><br><span class="line">	</span><br><span class="line">end program ch0902</span><br></pre></td></tr></table></figure>
<p>忘了改program名了，但是也证明了内部program的名称和外部文件名称可以不同，以外部文件名为准。<br>输出：<br>（ps：输出有些杂乱，因为还没有掌握输出书写的一些方式。）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"> type in the weight and height for person            1 use space as the interval:</span><br><span class="line">85 1.85</span><br><span class="line"> type in the weight and height for person            2 use space as the interval:</span><br><span class="line">76 1.80</span><br><span class="line"> type in the weight and height for person            3 use space as the interval:</span><br><span class="line">85 1.85</span><br><span class="line"> type in the weight and height for person            4 use space as the interval:</span><br><span class="line">90 1.70</span><br><span class="line"> type in the weight and height for person            5 use space as the interval:</span><br><span class="line">69 1.75</span><br><span class="line"> type in the weight and height for person            6 use space as the interval:</span><br><span class="line">83 1.67</span><br><span class="line"> type in the weight and height for person            7 use space as the interval:</span><br><span class="line">64 1.55</span><br><span class="line"> type in the weight and height for person            8 use space as the interval:</span><br><span class="line">57 1.63</span><br><span class="line"> type in the weight and height for person            9 use space as the interval:</span><br><span class="line">65 1.79</span><br><span class="line"> type in the weight and height for person           10 use space as the interval:</span><br><span class="line">76 1.78</span><br><span class="line"> the total of the weights is    750.000000     the total of the heights is    17.3700008    </span><br><span class="line"> average weight is    75.0000000      average height is    1.73700011    </span><br><span class="line">            10  weights and heights were </span><br><span class="line"> ^Inumber_of_people^I weights ^I heights</span><br><span class="line">           1 ^I   85.0000000     ^I   1.85000002    </span><br><span class="line">           2 ^I   76.0000000     ^I   1.79999995    </span><br><span class="line">           3 ^I   85.0000000     ^I   1.85000002    </span><br><span class="line">           4 ^I   90.0000000     ^I   1.70000005    </span><br><span class="line">           5 ^I   69.0000000     ^I   1.75000000    </span><br><span class="line">           6 ^I   83.0000000     ^I   1.66999996    </span><br><span class="line">           7 ^I   64.0000000     ^I   1.54999995    </span><br><span class="line">           8 ^I   57.0000000     ^I   1.63000000    </span><br><span class="line">           9 ^I   65.0000000     ^I   1.78999996    </span><br><span class="line">          10 ^I   76.0000000     ^I   1.77999997 </span><br></pre></td></tr></table></figure>

<h3 id="3-2-计算BIM值"><a href="#3-2-计算BIM值" class="headerlink" title="3-2 计算BIM值"></a>3-2 计算BIM值</h3><p>使用语句：<br>    a.out &lt; data.dat &gt; results.txt</p>
<p>实现文件的输入和输出操作。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">program ch3_2</span><br><span class="line">implicit none</span><br><span class="line"></span><br><span class="line">integer ,parameter :: number_of_people = 10</span><br><span class="line">real :: total_weight=0.0, average_weight=0.0,total_height=0.0, average_height=0.0</span><br><span class="line">integer :: person</span><br><span class="line">real , dimension(1:number_of_people) :: weight, height, BMI</span><br><span class="line"></span><br><span class="line">	do person = 1, number_of_people</span><br><span class="line">		print *,&#x27;type in the weight and height for person &#x27;, person, &#x27;use space as the interval:&#x27;</span><br><span class="line">		read *,weight(person), height(person)</span><br><span class="line">		total_weight = total_weight + weight(person)</span><br><span class="line">		total_height = total_height + height(person)</span><br><span class="line">		BMI(person)=weight(person)/(height(person)**2)</span><br><span class="line">	enddo</span><br><span class="line">	</span><br><span class="line">	average_weight = total_weight/number_of_people</span><br><span class="line">	average_height = total_height/number_of_people</span><br><span class="line">	</span><br><span class="line">	print *,&#x27;the total of the weights is &#x27;, total_weight, &#x27;the total of the heights is &#x27;, total_height</span><br><span class="line">	print *,&#x27;average weight is &#x27;, average_weight, &#x27; average height is &#x27;, average_height</span><br><span class="line">	</span><br><span class="line">	print *,&#x27; &#x27;,number_of_people, &#x27; weights and heights were &#x27;	</span><br><span class="line">	print *,&#x27;number_of_people&#x27;, &#x27;weights&#x27;,&#x27;heights&#x27;	,&#x27;BMI&#x27;</span><br><span class="line">	do person = 1, number_of_people</span><br><span class="line">		print *,person ,weight(person), height(person), BMI(person)</span><br><span class="line">	enddo</span><br><span class="line">	</span><br><span class="line">end program ch3_2</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">文件 result.txt</span><br><span class="line"> type in the weight and height for person            1 use space as the interval:</span><br><span class="line"> type in the weight and height for person            2 use space as the interval:</span><br><span class="line"> type in the weight and height for person            3 use space as the interval:</span><br><span class="line"> type in the weight and height for person            4 use space as the interval:</span><br><span class="line"> type in the weight and height for person            5 use space as the interval:</span><br><span class="line"> type in the weight and height for person            6 use space as the interval:</span><br><span class="line"> type in the weight and height for person            7 use space as the interval:</span><br><span class="line"> type in the weight and height for person            8 use space as the interval:</span><br><span class="line"> type in the weight and height for person            9 use space as the interval:</span><br><span class="line"> type in the weight and height for person           10 use space as the interval:</span><br><span class="line"> the total of the weights is    750.000000     the total of the heights is    17.3700008    </span><br><span class="line"> average weight is    75.0000000      average height is    1.73700011    </span><br><span class="line">            10  weights and heights were </span><br><span class="line"> number_of_peopleweightsheightsBMI</span><br><span class="line">           1   85.0000000       1.85000002       24.8356457    </span><br><span class="line">           2   76.0000000       1.79999995       23.4567909    </span><br><span class="line">           3   85.0000000       1.85000002       24.8356457    </span><br><span class="line">           4   90.0000000       1.70000005       31.1418667    </span><br><span class="line">           5   69.0000000       1.75000000       22.5306129    </span><br><span class="line">           6   83.0000000       1.66999996       29.7608395    </span><br><span class="line">           7   64.0000000       1.54999995       26.6389179    </span><br><span class="line">           8   57.0000000       1.63000000       21.4535751    </span><br><span class="line">           9   65.0000000       1.78999996       20.2865086    </span><br><span class="line">          10   76.0000000       1.77999997       23.9868717    </span><br></pre></td></tr></table></figure>

<h3 id="6、计算摆的周期（制表）"><a href="#6、计算摆的周期（制表）" class="headerlink" title="6、计算摆的周期（制表）"></a>6、计算摆的周期（制表）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">program ch6</span><br><span class="line">implicit none</span><br><span class="line">real , parameter :: pi = 3.1415926535</span><br><span class="line">integer ,dimension(1:10) :: length</span><br><span class="line">integer :: number</span><br><span class="line">real ,dimension(1:10) :: T</span><br><span class="line">do number = 1,10,1</span><br><span class="line">	length(number) = number</span><br><span class="line">enddo</span><br><span class="line">do number = 1,10</span><br><span class="line">	T(number) = 2 * pi * (length(number) / 9.81) ** .5</span><br><span class="line">enddo</span><br><span class="line"></span><br><span class="line">print 100</span><br><span class="line">100 format (20x, &#x27;Length&#x27;, 20x,&#x27;period&#x27;)</span><br><span class="line"></span><br><span class="line">do number = 1,10</span><br><span class="line">	print 200, length(number), T(number)</span><br><span class="line">	200 format (20x, i5, 20x, f5.2)  </span><br><span class="line">enddo</span><br><span class="line"></span><br><span class="line">end program ch6</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Length                    period</span><br><span class="line">    1                     2.01</span><br><span class="line">    2                     2.84</span><br><span class="line">    3                     3.47</span><br><span class="line">    4                     4.01</span><br><span class="line">    5                     4.49</span><br><span class="line">    6                     4.91</span><br><span class="line">    7                     5.31</span><br><span class="line">    8                     5.67</span><br><span class="line">    9                     6.02</span><br><span class="line">   10                     6.34</span><br></pre></td></tr></table></figure>

<h1 id="分支结构"><a href="#分支结构" class="headerlink" title="分支结构"></a>分支结构</h1><h2 id="IF"><a href="#IF" class="headerlink" title="IF"></a>IF</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">IF(logical_expr1)THEN</span><br><span class="line">    语句1</span><br><span class="line">    语句2</span><br><span class="line">    ...</span><br><span class="line">ELSE IF(logical_expr2)THEN</span><br><span class="line">    语句1</span><br><span class="line">    语句2</span><br><span class="line">    ...</span><br><span class="line">ELSE</span><br><span class="line">    语句1</span><br><span class="line">    语句2</span><br><span class="line">    ...</span><br><span class="line">END IF</span><br></pre></td></tr></table></figure>

<p>嵌套IF语句命名使其运行更加稳妥。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">outer IF(test1)THEN</span><br><span class="line">    </span><br><span class="line">    inner IF(test1)THEN</span><br><span class="line"></span><br><span class="line">    END IF inner</span><br><span class="line">    </span><br><span class="line">END IF outer</span><br></pre></td></tr></table></figure>

<p>逻辑IF语句</p>
<pre><code>IF(logical_expr) a,b,c
</code></pre>
<p>算数IF语句</p>
<pre><code>IF(expr) a, b, c
</code></pre>
<ul>
<li>&lt;0 执行a</li>
<li>&#x3D;0 执行b</li>
<li>大于0 执行c</li>
</ul>
<h2 id="SELECT-CASE结构"><a href="#SELECT-CASE结构" class="headerlink" title="SELECT CASE结构"></a>SELECT CASE结构</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[name:]SELECT CASE( case_expr)</span><br><span class="line">CASE(情况选择1)[name]</span><br><span class="line">    语句1</span><br><span class="line">    语句2</span><br><span class="line">    ...</span><br><span class="line">CASE(情况选择2)[name]</span><br><span class="line">    语句1</span><br><span class="line">    语句2</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">CASE DEFAULT [name]</span><br><span class="line">    语句1</span><br><span class="line">    语句2</span><br><span class="line">    ...</span><br><span class="line">END SELECT [name]</span><br></pre></td></tr></table></figure>

<p>命名case结构，使得更加清晰。</p>
<h2 id="DEBUGE"><a href="#DEBUGE" class="headerlink" title="DEBUGE"></a>DEBUGE</h2><p>在分支结构中插入WRITE是最简单的方式，输出表明运行到哪一步。</p>
<p>测试相等性时，使用近似测试。</p>
<h1 id="循环与字符操作"><a href="#循环与字符操作" class="headerlink" title="循环与字符操作"></a>循环与字符操作</h1><h2 id="do循环-1"><a href="#do循环-1" class="headerlink" title="do循环"></a>do循环</h2><p>不确定性执行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[name:]DO</span><br><span class="line">...</span><br><span class="line">    if(EXP)EXIT</span><br><span class="line">...</span><br><span class="line">END DO [name]</span><br></pre></td></tr></table></figure>
<p>EXP为真，执行EXIT，退出循环。</p>
<h2 id="do-while循环"><a href="#do-while循环" class="headerlink" title="do while循环"></a>do while循环</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DO WHILE(EXP)</span><br><span class="line">    ...</span><br><span class="line">    ...</span><br><span class="line">END DO</span><br></pre></td></tr></table></figure>
<p>EXP为真，循环进行，为假时立刻退出循环。</p>
<h2 id="迭代计数循环"><a href="#迭代计数循环" class="headerlink" title="迭代计数循环"></a>迭代计数循环</h2><pre><code>[name:]do counter = start, end, increment
......  ！语句
end do [name]
</code></pre>
<ul>
<li>increment 默认为1，可以省略。</li>
<li>counter 整型变量，作为循环计数使用。</li>
<li>start end 计数循环的参数，表示开始和结束。</li>
<li>计算规则：<code>counter*increment≤end*increment</code> 时进行循环。</li>
</ul>
<p><strong>注：为了防止永久循环，不可在循环中修改控制变量。</strong></p>
<h2 id="CYCLE语句与EXIT语句"><a href="#CYCLE语句与EXIT语句" class="headerlink" title="CYCLE语句与EXIT语句"></a>CYCLE语句与EXIT语句</h2><h3 id="CYCLE"><a href="#CYCLE" class="headerlink" title="CYCLE"></a>CYCLE</h3><p>使用CYCLE使得当前循环被终止，循环返回顶部。</p>
<p>在嵌套循环中，使用<code>CYCLE [name]</code>语句，可以使其<code>CYCLE</code>正确的循环。</p>
<pre><code>IF(j=2)CYCLE outer
</code></pre>
<p>可以实现在内部循环中终止当前的外循环。</p>
<h3 id="EXIT"><a href="#EXIT" class="headerlink" title="EXIT"></a>EXIT</h3><p>使用<code>EXIT</code>使得循环被终止。</p>
<h2 id="字符操作"><a href="#字符操作" class="headerlink" title="字符操作"></a>字符操作</h2><h3 id="子串提取"><a href="#子串提取" class="headerlink" title="子串提取"></a>子串提取</h3><p>定义CHARACTER时。使用<code>len=&lt;len&gt;</code>语句，使得变量只能存储相应长度的字符。</p>
<h3 id="连接操作符"><a href="#连接操作符" class="headerlink" title="连接操作符"></a>连接操作符</h3><p><code>//</code>是连接操作符。</p>
<p>将两个或者多个字符串或者子串合并成一个大的字符串。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = &#x27;ABCDEFGHIJ&#x27;</span><br><span class="line">b = &#x27;123456789&#x27;</span><br><span class="line">c = a(1:3)//b(4:5)</span><br></pre></td></tr></table></figure>
<p><code>c</code>的值为：<code>’ABC45‘</code></p>
<h3 id="内置字符函数"><a href="#内置字符函数" class="headerlink" title="内置字符函数"></a>内置字符函数</h3><p>参考3 表4-1</p>
<h1 id="I-x2F-O内容"><a href="#I-x2F-O内容" class="headerlink" title="I&#x2F;O内容"></a>I&#x2F;O内容</h1><h2 id="格式和格式化WRITE"><a href="#格式和格式化WRITE" class="headerlink" title="格式和格式化WRITE"></a>格式和格式化WRITE</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WRITE(*,100)i,result</span><br><span class="line">100 FORMAT(&#x27;result :&#x27; ,I3, &#x27;is&#x27; ,F7.3)</span><br></pre></td></tr></table></figure>
<ul>
<li>100 指的是FORMAT的语句标号</li>
<li>I3 F7.3 格式符号</li>
</ul>
<h2 id="格式描述符"><a href="#格式描述符" class="headerlink" title="格式描述符"></a>格式描述符</h2><table>
<thead>
<tr>
<th align="center">符号</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">c</td>
<td align="center">列号</td>
</tr>
<tr>
<td align="center">d</td>
<td align="center">实数输入或者输出的小数位右边的位数</td>
</tr>
<tr>
<td align="center">m</td>
<td align="center">要显示的最小位数，不够补零</td>
</tr>
<tr>
<td align="center">n</td>
<td align="center">要跳过的空格数</td>
</tr>
<tr>
<td align="center">r</td>
<td align="center">重复计数，一组或者一个描述符的使用次数，即该格式符重复r次</td>
</tr>
<tr>
<td align="center">w</td>
<td align="center">域宽，输入或者输出占用的字符数；若不能显示所有字符则使用*代替</td>
</tr>
</tbody></table>
<h3 id="整数输出：I描述符"><a href="#整数输出：I描述符" class="headerlink" title="整数输出：I描述符"></a>整数输出：I描述符</h3><p><code>rIw</code>或者<code>rIw.m</code>。</p>
<h3 id="实数输出：F描述符"><a href="#实数输出：F描述符" class="headerlink" title="实数输出：F描述符"></a>实数输出：F描述符</h3><p><code>rFw.d</code><br>右对齐显示，不足补空格。</p>
<h3 id="实数输出：E描述符"><a href="#实数输出：E描述符" class="headerlink" title="实数输出：E描述符"></a>实数输出：E描述符</h3><p>科学计数法：<br><code>rEw.d</code><br>±0.ddddE±ee<br>一般w大于等于d+7。才能容纳整个数字字符。</p>
<h3 id="科学计数法：ES描述符"><a href="#科学计数法：ES描述符" class="headerlink" title="科学计数法：ES描述符"></a>科学计数法：ES描述符</h3><p>该格式为输出数值在1.0-10.0之间的数。<br><code>rESw.d</code></p>
<h3 id="逻辑输出：L描述符"><a href="#逻辑输出：L描述符" class="headerlink" title="逻辑输出：L描述符"></a>逻辑输出：L描述符</h3><p><code>rLw</code><br>右对齐显示逻辑输出<code>T</code>与<code>F</code></p>
<h3 id="字符输出：A描述符"><a href="#字符输出：A描述符" class="headerlink" title="字符输出：A描述符"></a>字符输出：A描述符</h3><p><code>rA</code>或者<code>rAw</code></p>
<h3 id="水平定位：X-T描述符"><a href="#水平定位：X-T描述符" class="headerlink" title="水平定位：X T描述符"></a>水平定位：X T描述符</h3><ul>
<li><code>nX</code><br>缓冲区中插入间距。<code>n</code>：插入的空格数。</li>
<li><code>Tc</code><br>在缓冲区中跳过特定列。<code>c</code>：转到的列号。转到相应列号开始打印。<br>注意：确保T跳到的位置不会覆盖之前的内容。</li>
</ul>
<h3 id="格式描述符重复使用"><a href="#格式描述符重复使用" class="headerlink" title="格式描述符重复使用"></a>格式描述符重复使用</h3><p>可以使用语句<code>2(I6,F10.2)</code>表示<code>(I6,F10.2,I6,F10.2)</code>。</p>
<p>可以使用<code>*(I6,F10.2)</code>使其一直重复直至没有输出数据。</p>
<h3 id="改变输出行：-x2F-描述符"><a href="#改变输出行：-x2F-描述符" class="headerlink" title="改变输出行：&#x2F;描述符"></a>改变输出行：&#x2F;描述符</h3><p>在打印机中使用。</p>
<h3 id="格式使用"><a href="#格式使用" class="headerlink" title="格式使用"></a>格式使用</h3><p>如果<code>FORMAT</code>中的格式符不足，则在没有重复次数的开始括号处重新开始。</p>
<h2 id="格式化READ语句"><a href="#格式化READ语句" class="headerlink" title="格式化READ语句"></a>格式化READ语句</h2><h3 id="整数输入：I描述符"><a href="#整数输入：I描述符" class="headerlink" title="整数输入：I描述符"></a>整数输入：I描述符</h3><p><code>rIw</code></p>
<h3 id="实数输入：F描述符"><a href="#实数输入：F描述符" class="headerlink" title="实数输入：F描述符"></a>实数输入：F描述符</h3><p><code>rFw.d</code><br>注:在实数描述符中输入，一定要输入带有小数点的整数！否则会产生错误！</p>
<h3 id="逻辑输入：L描述符"><a href="#逻辑输入：L描述符" class="headerlink" title="逻辑输入：L描述符"></a>逻辑输入：L描述符</h3><p><code>rLw</code></p>
<h3 id="字符输入：A描述符"><a href="#字符输入：A描述符" class="headerlink" title="字符输入：A描述符"></a>字符输入：A描述符</h3><p><code>rA</code>或<code>rAw</code></p>
<h3 id="水平定位：X和T描述符"><a href="#水平定位：X和T描述符" class="headerlink" title="水平定位：X和T描述符"></a>水平定位：X和T描述符</h3><h3 id="垂直定位：-x2F-描述符"><a href="#垂直定位：-x2F-描述符" class="headerlink" title="垂直定位：&#x2F;描述符"></a>垂直定位：&#x2F;描述符</h3><h2 id="文件及文件处理"><a href="#文件及文件处理" class="headerlink" title="文件及文件处理"></a>文件及文件处理</h2><h3 id="OPEN"><a href="#OPEN" class="headerlink" title="OPEN"></a>OPEN</h3><p>将一个文件与一个给定的i&#x2F;o单元号关联起来。格式为：</p>
<pre><code>OPEN(open_list)
</code></pre>
<p>open_list子句包含存取文件信息等。</p>
<ul>
<li>UNIT&#x3D;指明与文件关联的io单元号。<br>  <code>UNIT=int_expr</code></li>
<li>FILE&#x3D;指定要打开的文件名。<br>  <code>FILE=char_expr</code></li>
<li>STATUS&#x3D;指定要打开文件的状态。<br>  <code>STATUS=char_expr</code><br>  其中，char_expr为下列值之一:”OLD”,”NEW”,”REPLACE”,”SCRATCH”,”UNKNOW”。</li>
<li>ACTION&#x3D;指定一个文件是否以只读、只写或者读写方式打开。<br>  <code>ACTION=char_expr</code><br>  其中，char_expr为下列值之一：“READ”,”WRITE”,”READWRITE”。</li>
<li>IOSTAT&#x3D;指定一个整数变量名，打开操作的状态可以返回到这个变量中。<br>  <code>IOSTAT=int_var</code><br>  其中，Open成功执行后，ISOTAT值为0。如果不成功，为一个包含错误信息的正整数。</li>
<li>IOMSG&#x3D;指定一个字符变量名，包含错误信息。<br>  <code>IOMSG=chart_var</code><br>  字符变量。OPEN语句成功执行，字符变量内容不变。否则返回错误信息。</li>
</ul>
<h3 id="CLOSE"><a href="#CLOSE" class="headerlink" title="CLOSE"></a>CLOSE</h3><pre><code>CLOSE(close_list)
</code></pre>
<p>clost_list必须包含一个指定io单元号的子句，可以指定其它选项。（目前未阅读到那一章）。</p>
<h3 id="磁盘文件读写"><a href="#磁盘文件读写" class="headerlink" title="磁盘文件读写"></a>磁盘文件读写</h3><pre><code>READ(unit,*)变量名
</code></pre>
<p><code>READ</code>中<code>()</code>内第一个为读取的文件的io单元号。WRITE同。</p>
<h3 id="文件定位"><a href="#文件定位" class="headerlink" title="文件定位"></a>文件定位</h3><p>unit:与要使用的文件关联的IO单元号</p>
<h4 id="BACKSPACE"><a href="#BACKSPACE" class="headerlink" title="BACKSPACE"></a>BACKSPACE</h4><pre><code>BACKSPACE(UNIT=unit)
</code></pre>
<p>回退一条记录。</p>
<h4 id="REWIND"><a href="#REWIND" class="headerlink" title="REWIND"></a>REWIND</h4><pre><code>REWIND(UNIT=unit)
</code></pre>
<p>从文件头重新开始文件。</p>
<h1 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h1><p>外部过程：把每个子任务作为独立的程序单元进行编码。</p>
<p>两种外部过程：子例程和函数子程序（函数）。</p>
<h2 id="子例程"><a href="#子例程" class="headerlink" title="子例程"></a>子例程</h2><p>CALL语句使用过程名调用，格式如下:<br>定义：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SUBROUTINE subroutine_name (argument_list)</span><br><span class="line">...</span><br><span class="line">(Delaration section)</span><br><span class="line">...</span><br><span class="line">(Execution section)</span><br><span class="line">...</span><br><span class="line">RETURN </span><br><span class="line">END SUBROUTINE [subroutine_name]</span><br></pre></td></tr></table></figure>

<h3 id="INTENT属性："><a href="#INTENT属性：" class="headerlink" title="INTENT属性："></a>INTENT属性：</h3><p>定义<code>argument_list</code>中的变量，需要定义IN或OUT变量，以表示变量是输入还是输出。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">REAL, INTENT(IN)::IN_VALUE1</span><br><span class="line">REAL, INTENT(OUT)::OUT_VALUE1</span><br><span class="line">REAL, DIMENSION(N), INTENT(INOUT)::ARRAY # 定义一个能输入和输出的数组</span><br></pre></td></tr></table></figure>
<p>其中，<code>INOUT</code>可以写为：<code>IN OUT</code>。<br>使用INTENT属性可以避免修改了<code>IN</code>类型的变量导致之后的该变量被改变，从而产生的错误。记住每一个形参都要设置INTENT属性！！！</p>
<p>定义内部变量时，定义临时变量。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REAL ::temp</span><br></pre></td></tr></table></figure>

<p>调用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CALL subroutine_name (argument_list)</span><br></pre></td></tr></table></figure>
<p>调用时注意<code>argument_list</code>中的变量类型必须一一对应！</p>
<h3 id="传递数组"><a href="#传递数组" class="headerlink" title="传递数组"></a>传递数组</h3><p>数组可以显式传递或者不定大小传递。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">REAL, INTENT(IN), DIMENSION(n)::data1 # n为数组大小，在输入列表中给出。</span><br><span class="line">REAL, INTENT(IN), DIMENSION(*)::data1 # 不定大小，边界检测，整个或者部分数组都不能工作。</span><br></pre></td></tr></table></figure>
<p><strong>注：目前基本不使用不定数组的格式，因为会产生越界问题，且不易监测。</strong></p>
<h3 id="传递字符变量"><a href="#传递字符变量" class="headerlink" title="传递字符变量"></a>传递字符变量</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CHARACTER (len=*), INTENT(IN)::STRING1</span><br></pre></td></tr></table></figure>
<p>使用<code>*</code>表示长度即可。因为没有必要在编译时必须知道字符串长度。</p>
<h3 id="小问题"><a href="#小问题" class="headerlink" title="小问题"></a>小问题</h3><p>不要在子例程中加入<code>STOP</code>语句，否则程序会“神秘终止”。<br>正确方法是对可能存在的错误进行检测。使用<code>IF</code>语句进行检测，采取相应操作。例如返回<code>error=0</code>。</p>
<h2 id="模块共享数据"><a href="#模块共享数据" class="headerlink" title="模块共享数据"></a>模块共享数据</h2><p>模块，使用<code>MODULE</code>声明。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MODULE shared_data</span><br><span class="line">！ 声明在两个程序之间共享的数据</span><br><span class="line">IMPLICIT NONE</span><br><span class="line">SAVE   ！ 必须包含这个语句。</span><br><span class="line">INTEGER, PARAMETER :: num_vals = 5 ！ 数组中的最大数值个数</span><br><span class="line">REAL, DIMENSION(num_vals)::values ! 数据值</span><br><span class="line">END MODULE shared_data</span><br></pre></td></tr></table></figure>
<p>使用模块中的数据：该语句必须出现在其他语句之前。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USE shared_data</span><br></pre></td></tr></table></figure>
<p>注意：share的数据和局部变量不要重名！</p>
<h2 id="模块过程"><a href="#模块过程" class="headerlink" title="模块过程"></a>模块过程</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">MODULE my_subs</span><br><span class="line">implicit none</span><br><span class="line">contains</span><br><span class="line"></span><br><span class="line">    SUBROUTINE sub1 (a,b,c,x,error)</span><br><span class="line">    implicit none</span><br><span class="line">    </span><br><span class="line">    ...</span><br><span class="line">    end subroutine sub1</span><br><span class="line">    </span><br><span class="line">END MODULE my_subs</span><br></pre></td></tr></table></figure>
<p>使用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USE my_subs</span><br></pre></td></tr></table></figure>
<p>即可在调用程序单元中使用子例程sub1。</p>
<p>使用模块调用子进程，可以使程序完全掌握子进程内的所有参数等，返回必要的错误信息。而直接调用子进程，主程序无法了解子进程中的任何信息。</p>
<h2 id="FORTRAN函数"><a href="#FORTRAN函数" class="headerlink" title="FORTRAN函数"></a>FORTRAN函数</h2><p>函数：结果是单个数值、逻辑值、字符串或数组的过程。只能返回一个值。</p>
<p>用户定义函数格式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">FUNCTION name (参数列表)</span><br><span class="line">...</span><br><span class="line">(在声明部分必须声明name类型)</span><br><span class="line">REAL, INTENT(IN):: INPUT_1</span><br><span class="line">...</span><br><span class="line">（执行部分）</span><br><span class="line">...</span><br><span class="line">name = expr</span><br><span class="line">RETURN</span><br><span class="line">END FUNCTION [name]</span><br></pre></td></tr></table></figure>

<p>由于函数必须返回一个值，因此需要定义函数返回值类型，有两种，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INTEGER FUNCTION my_function(i,j)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FUNCTION my_function(i,j)</span><br><span class="line">INTEGER :: my_function</span><br></pre></td></tr></table></figure>
<p>函数名为输出变量的名称，并且该变量已被定义，因此不需要在函数中再次定义。但是输入参数需要定义！</p>
<h2 id="过程作为参数传递给其它过程"><a href="#过程作为参数传递给其它过程" class="headerlink" title="过程作为参数传递给其它过程"></a>过程作为参数传递给其它过程</h2><h3 id="用户定义函数作为参数传递"><a href="#用户定义函数作为参数传递" class="headerlink" title="用户定义函数作为参数传递"></a>用户定义函数作为参数传递</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 外部定义函数，声明函数是外部调用的</span><br><span class="line">REAL, EXTERNAL :: fun_1, fun_2[,.....]</span><br><span class="line"></span><br><span class="line"># 调用fun的SUBROUTINE中</span><br><span class="line">REAL,EXTERNAL :: fun</span><br></pre></td></tr></table></figure>

<h3 id="子例程作为参数传递"><a href="#子例程作为参数传递" class="headerlink" title="子例程作为参数传递"></a>子例程作为参数传递</h3><p>在SUBROUTINE中，传递名为<code>sub</code>的子例程。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SUBROUTINE subs(sub, ...)</span><br><span class="line">...</span><br><span class="line">EXTERNAL :: sub ！ 定义子例程</span><br><span class="line">（定义其他输入输出变量）</span><br><span class="line">...</span><br><span class="line">CALL sub(value_list) ! 调用子例程</span><br><span class="line">...</span><br><span class="line">END SUBROUTINE subs</span><br></pre></td></tr></table></figure>

<h1 id="部分内置子进程"><a href="#部分内置子进程" class="headerlink" title="部分内置子进程"></a>部分内置子进程</h1><h2 id="EXP-求指数"><a href="#EXP-求指数" class="headerlink" title="EXP() 求指数"></a>EXP() 求指数</h2><ul>
<li>单精度 EXP()</li>
<li>双精度 DEXP()</li>
<li>复数 CEXP()</li>
</ul>
<h1 id="复数"><a href="#复数" class="headerlink" title="复数"></a>复数</h1><p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">program test</span><br><span class="line">COMPLEX, dimension(2):: a</span><br><span class="line">real x</span><br><span class="line"></span><br><span class="line">a(1)=CMPLX(1.0,2.0)</span><br><span class="line">x=aimag(a(1))</span><br><span class="line">print*, x</span><br><span class="line">read *,</span><br><span class="line">end program test</span><br></pre></td></tr></table></figure>
<h1 id="一些已经不再使用的内容"><a href="#一些已经不再使用的内容" class="headerlink" title="一些已经不再使用的内容"></a>一些已经不再使用的内容</h1><h2 id="equivalence-等价"><a href="#equivalence-等价" class="headerlink" title="equivalence 等价"></a>equivalence 等价</h2><p>示例：</p>
<pre><code>equivalence (nn,abuf)
</code></pre>
<p>nn和abuf等价，即二者完全相同，改变任何一方都会改变另一方。在定义变量时写入。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhiyuanshi1901.github.io/2023/01/03/CMT-ndk%E4%B8%8E%E8%A1%8D%E7%94%9F%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Shi Zhiyuan">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="日常学习笔记">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 日常学习笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/01/03/CMT-ndk%E4%B8%8E%E8%A1%8D%E7%94%9F%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F/" class="post-title-link" itemprop="url">CMT .ndk与衍生数据格式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-01-03 09:53:18" itemprop="dateCreated datePublished" datetime="2023-01-03T09:53:18+08:00">2023-01-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-01-09 10:40:12" itemprop="dateModified" datetime="2023-01-09T10:40:12+08:00">2023-01-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%9C%B0%E9%9C%87%E5%AD%A6%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/" itemprop="url" rel="index"><span itemprop="name">地震学常用软件</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="CMT-ndk格式数据"><a href="#CMT-ndk格式数据" class="headerlink" title="CMT .ndk格式数据"></a>CMT .ndk格式数据</h1><p>原介绍：<a target="_blank" rel="noopener" href="https://www.ldeo.columbia.edu/~gcmt/projects/CMT/catalog/allorder.ndk_explained">https://www.ldeo.columbia.edu/~gcmt/projects/CMT/catalog/allorder.ndk_explained</a></p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>CMT，全称Centroid-Moment-Tensor，是地震震源机制解的<br>这个数据为ASCII格式，共五行，每行80个字符长度。</p>
<p>数据格式如下：</p>
<p>示例1（补充了每个参数的含义）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">LINE1：</span><br><span class="line">PDE  2005/01/01 01:20:05.4  13.78（纬度）  -88.78（经度） 193.1（震源深度） 5.0（震级mb） 0.0（ms） EL SALVADOR（地理位置）             </span><br><span class="line">LINE2：</span><br><span class="line">C200501010120A（事件名称）   B:  4    4  40（台站数，通道数，最短周期） S: 27   33  50 M:  0    0   0 CMT: 1 TRIHD:  0.6</span><br><span class="line">LINE3：</span><br><span class="line">CENTROID:     -0.3（时间） 0.9  13.76（纬度） 0.06  -89.08（经度） 0.09 162.8（深度） 12.5 FREE（深度类型） S-20050322125201（时间戳）</span><br><span class="line">LINE4：</span><br><span class="line">23（时间指数，*e23）  0.838（Mrr） 0.201（前一个值的标准误差） -0.005（Mtt） 0.231 -0.833（Mpp） 0.270  1.050（Mrt） 0.121 -0.369（Mrp） 0.161  0.044（Mtp） 0.240</span><br><span class="line">LINE5：</span><br><span class="line">V10（版本号）   1.581 56  12  -0.537 23 140  -1.044 24 241（三个特征向量的特征值、plunge和方位角）   1.312   9 29  142（第一个节面的走向，倾角，方位角） 133 72   66 （第二个节面的相关数值）</span><br></pre></td></tr></table></figure>

<p>示例2：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PDE  2005/01/01 01:42:24.9   7.29   93.92  30.0 5.1 0.0 NICOBAR ISLANDS, INDIA R</span><br><span class="line">C200501010142A   B: 17   27  40 S: 41   58  50 M:  0    0   0 CMT: 1 TRIHD:  0.7</span><br><span class="line">CENTROID:     -1.1 0.8   7.24 0.04   93.96 0.04  12.0  0.0 BDY  S-20050322125628</span><br><span class="line">23 -1.310 0.212  2.320 0.166 -1.010 0.241  0.013 0.535 -2.570 0.668  1.780 0.151</span><br><span class="line">V10   3.376 16 149   0.611 43  44  -3.987 43 254   3.681 282 48  -23  28 73 -136</span><br></pre></td></tr></table></figure>


<h2 id="逐行内容"><a href="#逐行内容" class="headerlink" title="逐行内容"></a>逐行内容</h2><h3 id="第一行：震中数据行"><a href="#第一行：震中数据行" class="headerlink" title="第一行：震中数据行"></a>第一行：震中数据行</h3><p>示例：</p>
<pre><code>PDE  2005/01/01 01:42:24.9   7.29   93.92  30.0 5.1 0.0 NICOBAR ISLANDS, INDIA R
</code></pre>
<ul>
<li>[1-4]   震中参考地震记录。例如（PDE：USGS位置；ISC：ISC地震记录；SWE：面波位置；[Ekstrom，BSSA，2006]）</li>
<li>[6-15]  Date of reference event 事件日期</li>
<li>[17-26] Time of reference event 事件时间</li>
<li>[28-33] Latitude 纬度</li>
<li>[35-41] Longitude 经度</li>
<li>[43-47] Depth 震源深度</li>
<li>[49-55] Reported magnitudes, usually mb and MS 震级，通常是mb（体波震级）或ms（面波震级）</li>
<li>[57-80] Geographical location (24 characters) 地理位置，24个字符</li>
</ul>
<h3 id="第二行：CMT信息-1"><a href="#第二行：CMT信息-1" class="headerlink" title="第二行：CMT信息 1"></a>第二行：CMT信息 1</h3><p>示例：</p>
<pre><code>C200501010142A   B: 17   27  40 S: 41   58  50 M:  0    0   0 CMT: 1 TRIHD:  0.7
</code></pre>
<ul>
<li><p>[1-16]  <em>CMT event name. This string is a unique CMT-event identifier. Older<br>  events have 8-character names, current ones have 14-character names.<br>  See (1) below for the naming conventions used.</em><br>  CMT事件名称。独一无二的CMT事件标识符，较老的事件8个字符，最近的是14个字符。note（1）中描述了命名规则。</p>
</li>
<li><p>[18-61] <em>Data used in the CMT inversion. Three data types may be used:<br>  Long-period body waves (B), Intermediate-period surface waves (S),<br>  and long-period mantle waves (M). For each data type, three values<br>  are given: the number of stations used, the number of components<br>  used, and the shortest period used.</em><br>  B S M CMT反演使用的数据，三类数据类型：</p>
<ul>
<li>B：长周期体波 </li>
<li>S：中等周期面波</li>
<li>M：长周期地幔波<br>每一个数据类型有三个数值：台站数，通道数，使用的最短周期</li>
</ul>
</li>
<li><p>[63-68] <em>Type of source inverted for: “CMT: 0” - general moment tensor;<br>  “CMT: 1” - moment tensor with constraint of zero trace (standard);<br>  “CMT: 2” - double-couple source.</em><br>  反转源类型： </p>
<ul>
<li>0：一般矩张量</li>
<li>1：具有零迹约束的矩张量？</li>
<li>2：双力偶震源</li>
</ul>
</li>
<li><p>[70-80] <em>Type and duration of moment-rate function assumed in the inversion.<br>  “TRIHD” indicates a triangular moment-rate function, “BOXHD” indicates<br>  a boxcar moment-rate function. The value given is half the duration<br>  of the moment-rate function. This value is assumed in the inversion,<br>  following a standard scaling relationship (see note (2) below),<br>  and is not derived from the analysis.</em><br>  反演中假设的矩率函数的类型和持续时间。</p>
<ul>
<li>“TRIHD”：表示三角形矩速率函数，</li>
<li>“BOXHD”：表示boxcar矩速率函数。给定的值是矩率函数持续时间的一半。该值在反演中按照标准缩放关系（见下面的note（2））假设，而不是从分析中得出的。</li>
</ul>
</li>
</ul>
<h3 id="第三行：CMT信息-2"><a href="#第三行：CMT信息-2" class="headerlink" title="第三行：CMT信息 2"></a>第三行：CMT信息 2</h3><p>示例：</p>
<pre><code>CENTROID:     -1.1 0.8   7.24 0.04   93.96 0.04  12.0  0.0 BDY  S-20050322125628
</code></pre>
<ul>
<li><p>[1-58]  <em>Centroid parameters determined in the inversion. Centroid time, given<br>  with respect to the reference time, centroid latitude, centroid<br>  longitude, and centroid depth. The value of each variable is followed<br>  by its estimated standard error. See note (3) below for cases in<br>  which the hypocentral coordinates are held fixed.</em><br>  反演中确定的质心参数。质心时间，相对于参考时间、质心纬度、质心经度和质心深度给出。每个变量的值后跟其估计的标准误差。关于次中心坐标固定的情况，见note（3）。例如第一个参数是2.9,则在第一行的时间基础上加2.9s，如果有负号就是减2.9s。</p>
</li>
<li><p>[60-63] <em>Type of depth. “FREE” indicates that the depth was a result of the<br>  inversion; “FIX “ that the depth was fixed and not inverted for;<br>  “BDY “ that the depth was fixed based on modeling of broad-band<br>  P waveforms.</em><br>  深度类型：</p>
<ul>
<li>FREE：深度是反演的结果</li>
<li>FIX：深度经过校正，没有经过反转？</li>
<li>BDY：深度经过模拟宽频P波校正</li>
</ul>
</li>
<li><p>[65-80] <em>Timestamp. This 16-character string identifies the type of analysis that<br>  led to the given CMT results and, for recent events, the date and<br>  time of the analysis. This is useful to distinguish Quick CMTs (“Q-“),<br>  calculated within hours of an event, from Standard CMTs (“S-“), which<br>  are calculated later. The format for this string should not be<br>  considered fixed.</em><br>  时间戳。16个字符长度的字符串，标识导致给定 CMT 结果的分析类型，以及分析的日期和时间（对于最近事件）。用来区分事件发生后小时内计算的快速CMTs（“Q-”），稍后计算的标准CMTs（“S-”）。字符串的格式不固定。</p>
</li>
</ul>
<h3 id="第四行：CMT信息-3"><a href="#第四行：CMT信息-3" class="headerlink" title="第四行：CMT信息 3"></a>第四行：CMT信息 3</h3><p>示例：</p>
<pre><code>23 -1.310 0.212  2.320 0.166 -1.010 0.241  0.013 0.535 -2.570 0.668  1.780 0.151
</code></pre>
<ul>
<li><p>[1-2]   <em>The exponent for all following moment values. For example, if the<br>  exponent is given as 24, the moment values that follow, expressed in<br>  dyne-cm, should be multiplied by 10**24.</em><br>  所有后续时刻值的指数。例如，如果指数为 24，则后面的矩值（以 dyne-cm 表示）应乘以 10**24。</p>
</li>
<li><p>[3-80]  <em>The six moment-tensor elements: Mrr, Mtt, Mpp, Mrt, Mrp, Mtp, where r<br>  is up, t is south, and p is east. See Aki and Richards for conversions<br>  to other coordinate systems. The value of each moment-tensor<br>element is followed by its estimated standard error. See note (4)<br>below for cases in which some elements are constrained in the inversion.</em><br>  六个矩张量元素：Mrr, Mtt, Mpp, Mrt, Mrp, Mtp</p>
<ul>
<li><p>r：up</p>
</li>
<li><p>t：south</p>
</li>
<li><p>p：east</p>
<p>每个矩张量元素的值后面跟着他的标准误差。有关某些元素在反转中受到限制的情况，请参见note（4）。</p>
</li>
</ul>
</li>
</ul>
<h3 id="第五行：CMT信息-4"><a href="#第五行：CMT信息-4" class="headerlink" title="第五行：CMT信息 4"></a>第五行：CMT信息 4</h3><p>示例：</p>
<pre><code>V10   3.376 16 149   0.611 43  44  -3.987 43 254   3.681 282 48  -23  28 73 -136
</code></pre>
<ul>
<li><p>[1-3]   <em>Version code. This three-character string is used to track the version<br>  of the program that generates the “ndk” file.</em><br>  版本号，三个字符的字符串用于记录获取ndk文件的程序版本号。</p>
</li>
<li><p>[4-48]  <em>Moment tensor expressed in its principal-axis system: eigenvalue,<br>  plunge, and azimuth of the three eigenvectors. The eigenvalue should be<br>  multiplied by 1.0E(exponent) as given on line four.</em><br>  在其主轴系统中表示的矩张量：三个特征向量的特征值、plunge和方位角。特征值应乘以 10**（指数），如第四行所示。</p>
</li>
<li><p>[50-56] <em>Scalar moment, to be multiplied by 1.0E(exponent) as given on line four.</em></p>
<p>  标量力矩，乘10**（第四行的指数）</p>
</li>
<li><p>[58-80] <em>Strike, dip, and rake for first nodal plane of the best-double-couple<br>  mechanism, repeated for the second nodal plane. The angles are defined<br>  as in Aki and Richards.</em><br>  最佳双耦合机制解第一个节面的走向，倾角，滑动角，后三个是第二个界面的相关数据。角度定义与Aki和Richards相同。</p>
</li>
</ul>
<h2 id="Notes-additional-information"><a href="#Notes-additional-information" class="headerlink" title="Notes (additional information):"></a>Notes (additional information):</h2><h3 id="NOTE-1"><a href="#NOTE-1" class="headerlink" title="NOTE 1"></a>NOTE 1</h3><p><em>CMT event names follow two conventions. Older events use an 8-character<br>name with the structure XMMDDYYZ, where MMDDYY represents the date of<br>the event, Z is a letter (A-Z followed by a-z) distinguishing different<br>events on the same day, and X is a letter (B,M,Z,C,…) used to identify<br>the types of data used in the inversion. Newer events use 14-character event<br>names with the structure XYYYYMMDDhhmmZ, in which the time is given to greater<br>precision, and the initial letter is limited to four possibilities: B - body<br>waves only, S - surface waves only, M - mantle waves only, C - a combination<br>of data types.</em></p>
<ul>
<li><p>较老的命名规则：8个字符，XMMDDYYZ</p>
<ul>
<li>MMDDYY：事件日期</li>
<li>X：用于标记反演中使用的数据类型。(B,M,Z,C,…) </li>
<li>Z：区分同一天不同的地震事件(A-Z 之后是 a-z)</li>
</ul>
</li>
<li><p>新的命名规则：14个字符，XYYYYMMDDhhmmZ</p>
<p>  2005年1月1日开始使用新的命名规则。</p>
<p>  事件时间更加精准，首字母X只有四种：</p>
<ul>
<li>B：只有体波</li>
<li>S：只有面波</li>
<li>M：只有地幔波</li>
<li>C：综合数据类型</li>
</ul>
</li>
</ul>
<h3 id="NOTE-2"><a href="#NOTE-2" class="headerlink" title="NOTE 2"></a>NOTE 2</h3><p><em>The source duration is generally estimated using an empirically determined<br>relationship such that the duration increases as the cube root of the scalar<br>moment. Specifically, we currently use a relationship where the half duration<br>for an event with moment 1E24 is 1.05 seconds, and for an event with moment<br>1E27 is 10.5 seconds.</em></p>
<p>源持续时间通常使用经验确定的关系来估计，使得持续时间随着标量矩的立方根而增加。<br>具体来说，我们目前使用的关系是，矩为 10<strong>24 的事件的半持续时间为 1.05 秒，<br>矩为 10</strong>27 的事件的半持续时间为 10.5 秒。</p>
<h3 id="NOTE-3"><a href="#NOTE-3" class="headerlink" title="NOTE 3"></a>NOTE 3</h3><p><em>For some small earthquakes for which the azimuthal distribution of stations<br>with useful seismograms is poor, we constrain the epicenter of the event to<br>the reference location. This is reflected in the catalog by standard<br>errors of 0.0 for both the centroid latitude and the centroid longitude.</em></p>
<p>对于一些具有有用地震图的台站方位分布较差的小地震，我们将事件的震中限制在参考位置。<br>这反映在目录中，质心纬度和质心经度的标准误差均为 0.0。</p>
<h3 id="NOTE-4"><a href="#NOTE-4" class="headerlink" title="NOTE 4"></a>NOTE 4</h3><p><em>For some very shallow earthquakes, the CMT inversion does not well<br>constrain the vertical-dip-slip components of the moment tensor (Mrt and Mrp),<br>and we constrain these components to zero in the inversion. The standard<br>errors for Mrt and Mrp are set to zero in this case.</em></p>
<p>对于一些很浅的地震，CMT 反演并没有很好地约束矩张量的垂直倾滑分量（Mrt 和 Mrp），<br>我们在反演中将这些分量约束为零。在这种情况下，Mrt 和 Mrp 的标准误差设置为零。</p>
<h1 id="MINEOS-CMT数据格式"><a href="#MINEOS-CMT数据格式" class="headerlink" title="MINEOS CMT数据格式"></a>MINEOS CMT数据格式</h1><h2 id="官方内容"><a href="#官方内容" class="headerlink" title="官方内容"></a>官方内容</h2><p><em>There is a single event file called china_cmt_event.txt that contains Harvard CMT infor-mation for an event in Southern China.</em></p>
<p>单个事件文件：包含单个中国南部地震事件的 Harvard CMT 信息</p>
<p><em>The third input file is the file china_cmt_evt, which is a single-lined listing containing the coordinates and event parameters of an earthquake in China. The moment tensor is not used by this program, but by the program syndat which follows.</em></p>
<p>单行列表包含坐标和事件参数。矩张量不由这个程序（green）使用，而是在程序syndat中使用</p>
<p><em>This example will choose modes only between frequencies of 0 and 166 mHz (i.e., periods greater than 6 sec). It will produce Green’s functions that are 8000 samples long. The time sampling specified in the china_cmt_evt file is 1 sec, so this is a time series length of a little over two hours. In many cases, both the minor and major arc arrivals can be seen.</em><br><em>The program will output a .wfdisc relation in the database called green; that is, a file called green.wfdisc which points to the waveforms on disk in a default location.</em></p>
<p>此示例将仅在 0 和 166 mHz 的频率（即大于 6 秒的周期）之间选择模式。它将产生 8000 个样本长的 Green 函数。china_cmt_evt文件中指定的时间采样为 1 秒，因此这是两个多小时的时间序列长度。在许多情况下，可以看到小弧和大弧到达。<br>该程序将在数据库中输出一个名为绿色的 .wfdisc 关系;也就是说，一个名为 green.wfdisc 的文件指向默认位置的磁盘上的波形。</p>
<p><em>Figure B.1: Station BJT. Comparison with Herrmann’s plane code. Three-component synthetic seismogram<br>for the fundamental spheroidal and toroidal modes. Mineos seismogram is plotted in red, Herrmann’s in<br>blue. Earthquake is 25.39N, 101.40E (Southern China), depth is 33 km. Model is PREM, in which the water<br>layer is filled with the upper crust’s velocities. The crust has only two layers.</em></p>
<p>这一栏中包含了事件信息，得知事件的坐标和发震深度。</p>
<h2 id="格式内容"><a href="#格式内容" class="headerlink" title="格式内容"></a>格式内容</h2><p>harward CMT保存的.ndk格式的cmt数据:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PDE  2000/01/14 23:37:07.9  25.61  101.06  33.0 5.4 5.9 YUNNAN PROVINCE, CHINA  </span><br><span class="line">B011400F         B: 57  127  45 S:  0    0   0 M:  0    0   0 CMT: 1 BOXHD:  2.3</span><br><span class="line">CENTROID:      2.9 0.2  25.39 0.02  101.40 0.02  33.0  0.0 FIX  O-00000000000000</span><br><span class="line">24 -0.600 0.095 -6.289 0.121  6.888 0.132 -1.854 0.256  0.118 0.239 -4.726 0.118</span><br><span class="line">V10   8.460  4 252  -0.260 76 143  -8.200 13 343   8.330  27 78   -6 118 84 -168</span><br></pre></td></tr></table></figure>

<p>china_cmt_event的数据格式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">B011400F 2000  14 23 37 10.80 25.39  101.40  33.00 1.0 -2.3 8.33e24 -0.60  -6.29   6.89  -1.85   0.12  -4.73 1.0e24 27 78   -6 118 84 -168</span><br></pre></td></tr></table></figure>

<p>格式内容（补充了参数含义）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">B011400F（事件编号evid） 2000（年份）  14（一年的第几天） 23（时） 37（分） 10.80（centroid秒） 25.39（CENTROID纬度）  101.40（CENTROID经度）  33.00（CENTROID震源深度） 1.0（CMT） -2.3（BOXHD但是原本是正值，这里是负值） 8.33e24（） -0.60（Mrr）  -6.29(Mpp)   6.89(Mtt)  -1.85(Mrt)   0.12(Mrp)  -4.73(Mtp) 1.0e24（） 27 78   -6 118 84 -168（这六个数是第一个节面、第二个节面的走向、倾向、方位角）</span><br></pre></td></tr></table></figure>

<p>以下[ ]内为这些数据的字节数，如果字节数不足则在前方补充空格。实际编辑使用空格隔开每个参数即可，不必限制字节。</p>
<p><strong>注：由于新版事件编号为14个字符长度，因此在MINEOS导入过程中事件编号只能导入前8个字符。具体影响未知。</strong></p>
<table>
<thead>
<tr>
<th align="center">字节位置</th>
<th align="center">含义</th>
<th align="center">字节位置</th>
<th align="center">含义</th>
<th align="center">字节位置</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">[1-8]</td>
<td align="center">事件编号evid</td>
<td align="center">[45-50]</td>
<td align="center">centroid震源深度</td>
<td align="center">[96-101]</td>
<td align="center">Mrp(Mrφ)</td>
</tr>
<tr>
<td align="center">[10-13]</td>
<td align="center">年份</td>
<td align="center">[52-54]</td>
<td align="center">格林函数和地震图的时间步长，单位s</td>
<td align="center">[103-108]</td>
<td align="center">Mtp(Mθφ)</td>
</tr>
<tr>
<td align="center">[15-17]</td>
<td align="center">一年第几天</td>
<td align="center">[56-59]</td>
<td align="center">halfd source half-time duration 单位s</td>
<td align="center">[110-115]</td>
<td align="center">Mn 张量分量的归一化系数</td>
</tr>
<tr>
<td align="center">[19-20]</td>
<td align="center">时 （事件发生时间）</td>
<td align="center">[61-67]</td>
<td align="center">M0，标量张量矩，单位dyn*cm</td>
<td align="center">[117-118]</td>
<td align="center">第一个节面的走向strike</td>
</tr>
<tr>
<td align="center">[22-23]</td>
<td align="center">分</td>
<td align="center">[69-73]</td>
<td align="center">Mrr</td>
<td align="center">[120-121]</td>
<td align="center">第一个节面的倾向dip</td>
</tr>
<tr>
<td align="center">[25-29]</td>
<td align="center">centroid秒，小数格式</td>
<td align="center">[75-80]</td>
<td align="center">Mtt (Mθθ)</td>
<td align="center">[123-126]</td>
<td align="center">第一个节面的滑动角 slip</td>
</tr>
<tr>
<td align="center">[31-35]</td>
<td align="center">centroid纬度</td>
<td align="center">[82-87]</td>
<td align="center">Mpp  (Mφφ)</td>
<td align="center">[128-130]</td>
<td align="center">第二个节面的走向</td>
</tr>
<tr>
<td align="center">[37-43]</td>
<td align="center">centroid经度</td>
<td align="center">[89-94]</td>
<td align="center">Mrt (Mrθ)</td>
<td align="center">[132-133]</td>
<td align="center">第二个节面的倾向</td>
</tr>
<tr>
<td align="center">******</td>
<td align="center">*****</td>
<td align="center">*******</td>
<td align="center">******</td>
<td align="center">[135-138]</td>
<td align="center">第二个节面的滑动角</td>
</tr>
</tbody></table>
<p>Mrr, Mtt, Mpp, Mrt, Mrp, Mtp 通过Mn归一化的矩张量分量。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhiyuanshi1901.github.io/2022/12/31/TauP%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Shi Zhiyuan">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="日常学习笔记">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 日常学习笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/12/31/TauP%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">TauP安装</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-12-31 21:02:52" itemprop="dateCreated datePublished" datetime="2022-12-31T21:02:52+08:00">2022-12-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-04-23 16:11:15" itemprop="dateModified" datetime="2023-04-23T16:11:15+08:00">2023-04-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%9C%B0%E9%9C%87%E5%AD%A6%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/" itemprop="url" rel="index"><span itemprop="name">地震学常用软件</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h1><p><a target="_blank" rel="noopener" href="https://seismo-learn.org/software/taup/install/">https://seismo-learn.org/software/taup/install/</a></p>
<h1 id="官方网站："><a href="#官方网站：" class="headerlink" title="官方网站："></a>官方网站：</h1><p><a target="_blank" rel="noopener" href="https://www.seis.sc.edu/taup/">https://www.seis.sc.edu/taup/</a></p>
<h1 id="java安装："><a href="#java安装：" class="headerlink" title="java安装："></a>java安装：</h1><p>需要安装java运行环境。</p>
<pre><code>sudo yum install epel-release
sudo yum install java-11-openjdk
</code></pre>
<p>如果上面代码不行，运行：</p>
<pre><code>sudo yum -y install java-1.8.0-openjdk*
</code></pre>
<h1 id="TauP安装"><a href="#TauP安装" class="headerlink" title="TauP安装"></a>TauP安装</h1><p>将下载的安装包解压</p>
<pre><code>tar -xvf TauP-2.6.1.tgz
</code></pre>
<p>将taup安装到&#x2F;opt&#x2F;目录下:</p>
<pre><code>mkdir -p ~/opt/
mv TauP-2.6.1 ~/opt/
</code></pre>
<p>修改环境变量，将Taup的路径添加到PATH中：</p>
<pre><code>echo &#39;export PATH=$&#123;HOME&#125;/opt/TauP-2.5.0/bin:$&#123;PATH&#125;&#39; &gt;&gt; ~/.bashrc
source ~/.bashrc
</code></pre>
<p>终端输入taup，出现Taup图形界面即可。<br>注意：此处的Taup版本为2.5.0， 需要修改为对应版本。</p>
<h1 id="出现过的问题"><a href="#出现过的问题" class="headerlink" title="出现过的问题"></a>出现过的问题</h1><p>如果出现</p>
<pre><code>Exception in thread &quot;main&quot; java.lang.ArrayIndexOutOfBoundsException: 0
    at edu.sc.seis.TauP.ToolRun.main(ToolRun.java:140)
</code></pre>
<p>说明java版本问题，重装即可。</p>
<p>首先卸载原有java，查看java版本</p>
<pre><code>java -version
</code></pre>
<p>显示：</p>
<pre><code>java-11-openjdk-headless-11.0.17.0.8-2.el8.x86_64
tzdata-java-2022g-1.el8.noarch
javapackages-filesystem-5.3.0-1.module_el8.0.0+11+5b8c10bd.noarch
java-11-openjdk-11.0.17.0.8-2.el8.x86_64
java-1.8.0-openjdk-headless-1.8.0.352.b08-2.el8.x86_64
</code></pre>
<p>卸载java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y remove java-11-openjdk-headless-11.0.17.0.8-2.el8.x86_64</span><br><span class="line">yum -y remove java-1.8.0-openjdk-headless-1.8.0.352.b08-2.el8.x86_64</span><br></pre></td></tr></table></figure>

<p>检查是否卸载完成</p>
<pre><code>java -version
</code></pre>
<p>若显示没有java文件，即可重装：运行java安装命令即可。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhiyuanshi1901.github.io/2022/12/29/Mineos%E6%96%B0%E6%A8%A1%E5%9E%8B%E8%BF%90%E8%A1%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Shi Zhiyuan">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="日常学习笔记">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 日常学习笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/12/29/Mineos%E6%96%B0%E6%A8%A1%E5%9E%8B%E8%BF%90%E8%A1%8C/" class="post-title-link" itemprop="url">Mineos新模型运行</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-12-29 21:40:07 / 修改时间：21:51:19" itemprop="dateCreated datePublished" datetime="2022-12-29T21:40:07+08:00">2022-12-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%9C%B0%E9%9C%87%E5%AD%A6%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/" itemprop="url" rel="index"><span itemprop="name">地震学常用软件</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="试运行minos-bran-f"><a href="#试运行minos-bran-f" class="headerlink" title="试运行minos_bran.f"></a>试运行minos_bran.f</h1><h2 id="错误示例"><a href="#错误示例" class="headerlink" title="错误示例"></a>错误示例</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">(base) [shizhiyuan@localhost mineos-1.0.0.rbh]$ ./minos_bran</span><br><span class="line"> input model file:</span><br><span class="line">/DEMO/models/CPacific.txt    </span><br><span class="line"> /DEMO/models/CPacific.txt</span><br><span class="line"> output file:</span><br><span class="line">CP_S</span><br><span class="line"> CP_S</span><br><span class="line">At line 400 of file minos_bran.f (unit = 7, file = &#x27;fort.7&#x27;)</span><br><span class="line">Fortran runtime error: End of file</span><br><span class="line"></span><br><span class="line">Error termination. Backtrace:</span><br><span class="line">#0  0x7f5d66f41171 in ???</span><br><span class="line">#1  0x7f5d66f41d19 in ???</span><br><span class="line">#2  0x7f5d66f42521 in ???</span><br><span class="line">#3  0x7f5d6714a12b in ???</span><br><span class="line">#4  0x7f5d6714a722 in ???</span><br><span class="line">#5  0x7f5d6714729b in ???</span><br><span class="line">#6  0x7f5d6714be34 in ???</span><br><span class="line">#7  0x7f5d6714cca4 in ???</span><br><span class="line">#8  0x7f5d67149bb4 in ???</span><br><span class="line">#9  0x410ded in ???</span><br><span class="line">#10  0x41221c in ???</span><br><span class="line">#11  0x400c5c in ???</span><br><span class="line">#12  0x7f5d663bcd84 in ???</span><br><span class="line">#13  0x400c8d in ???</span><br></pre></td></tr></table></figure>


<p>这里出现了报错，原因是输入模型文件的时候路径需要特定的格式，如下是正确的运行：</p>
<h2 id="正确示例"><a href="#正确示例" class="headerlink" title="正确示例"></a>正确示例</h2><p>这里试运行NRussia模型，设置文件夹为DEMO4。</p>
<h3 id="运行内容是生成S振型的文件。"><a href="#运行内容是生成S振型的文件。" class="headerlink" title="运行内容是生成S振型的文件。"></a>运行内容是生成S振型的文件。</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">(base) [shizhiyuan@localhost DEMO4]$ time minos_bran</span><br><span class="line"> input model file:</span><br><span class="line">../models/NRussia.txt</span><br><span class="line"> ../models/NRussia.txt</span><br><span class="line"> output file:</span><br><span class="line">NRussia_S</span><br><span class="line"> NRussia_S</span><br><span class="line"> eigenfunction file (output):</span><br><span class="line">eNRussia_S </span><br><span class="line"> eNRussia_S</span><br><span class="line"> enter eps and wgrav</span><br><span class="line">1e-10 10</span><br><span class="line">   1.0000000000000000E-010   10.000000000000000     </span><br><span class="line"> enter jcom (1=rad;2=tor;3=sph;4=ictor)</span><br><span class="line">3</span><br><span class="line">           3</span><br><span class="line"> enter lmin,lmax,wmin,wmax,nmin,nmax</span><br><span class="line">1 6000 0.0 166.0 0 0</span><br><span class="line">           1        6000   0.0000000000000000        166.00000000000000                0           0</span><br><span class="line"></span><br><span class="line">real	1m13.243s</span><br><span class="line">user	0m1.250s</span><br><span class="line">sys	0m0.006s</span><br></pre></td></tr></table></figure>

<h3 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h3><p>正确示例中已经cd到DEMO文件夹下，此时需要退出到前一个文件夹，才能进入到models文件夹。因此，路径为：<br>..&#x2F;models&#x2F;NRussia.txt<br>这样运行实测不会出现错误。但是之前运行是在外部文件夹下，理应直接&#x2F;DEMO……这样是没有问题的。但是实测不行，也不知道为什么。目前在DEMO新建文件夹使用没有问题，而且这样能够区分不同的DEMO。</p>
<h3 id="生成T振型的文件"><a href="#生成T振型的文件" class="headerlink" title="生成T振型的文件"></a>生成T振型的文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">(base) [shizhiyuan@localhost DEMO4]$ time minos_bran</span><br><span class="line"> input model file:</span><br><span class="line">../models/NRussia.txt</span><br><span class="line"> ../models/NRussia.txt</span><br><span class="line"> output file:</span><br><span class="line">NRussia_T</span><br><span class="line"> NRussia_T</span><br><span class="line"> eigenfunction file (output):</span><br><span class="line">eNRussia_T</span><br><span class="line"> eNRussia_T</span><br><span class="line"> enter eps and wgrav</span><br><span class="line">1.0e-10 1</span><br><span class="line">   1.0000000000000000E-010   1.0000000000000000     </span><br><span class="line"> enter jcom (1=rad;2=tor;3=sph;4=ictor)</span><br><span class="line">2</span><br><span class="line">           2</span><br><span class="line"> enter lmin,lmax,wmin,wmax,nmin,nmax</span><br><span class="line">1 6000 0.0 166.0 0 0</span><br><span class="line">           1        6000   0.0000000000000000        166.00000000000000                0           0</span><br><span class="line"></span><br><span class="line">real	1m13.767s</span><br><span class="line">user	0m0.248s</span><br><span class="line">sys	0m0.005s</span><br></pre></td></tr></table></figure>


<h1 id="运行eigcon"><a href="#运行eigcon" class="headerlink" title="运行eigcon"></a>运行eigcon</h1><h2 id="S振型的相关文件"><a href="#S振型的相关文件" class="headerlink" title="S振型的相关文件"></a>S振型的相关文件</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">(base) [shizhiyuan@localhost DEMO4]$ time eigcon</span><br><span class="line"> ============= Program eigcon ====================</span><br><span class="line">  spheroidals (3) or toroidals (2) or radial (1) or</span><br><span class="line">  inner core toroidals (4) modes</span><br><span class="line">3</span><br><span class="line">           3</span><br><span class="line">  enter name of model file</span><br><span class="line">../models/NRussia.txt</span><br><span class="line"> ../models/NRussia.txt</span><br><span class="line"> enter max depth [km] : </span><br><span class="line">1000</span><br><span class="line">   1000.00000    </span><br><span class="line">  enter name of minos_bran output text file</span><br><span class="line">NRussia_S</span><br><span class="line"> NRussia_S</span><br><span class="line">  minos_bran output binary unformatted file name</span><br><span class="line">eNRussia_S</span><br><span class="line"> eNRussia_S</span><br><span class="line">  enter path/dbase_name or dbase_name to store eigenfunctions:</span><br><span class="line">test_S</span><br><span class="line"> test_S</span><br><span class="line"> ====================================================</span><br><span class="line"> eigcon: n,nstart,nrad =          260         119         142</span><br><span class="line"></span><br><span class="line">real	1m3.563s</span><br><span class="line">user	0m0.041s</span><br><span class="line">sys	0m0.008s</span><br></pre></td></tr></table></figure>
<h2 id="T振型相关"><a href="#T振型相关" class="headerlink" title="T振型相关"></a>T振型相关</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">(base) [shizhiyuan@localhost DEMO4]$ time eigcon</span><br><span class="line"> ============= Program eigcon ====================</span><br><span class="line">  spheroidals (3) or toroidals (2) or radial (1) or</span><br><span class="line">  inner core toroidals (4) modes</span><br><span class="line">2</span><br><span class="line">           2</span><br><span class="line">  enter name of model file</span><br><span class="line">../models/NRussia.txt</span><br><span class="line"> ../models/NRussia.txt</span><br><span class="line"> enter max depth [km] : </span><br><span class="line">1000</span><br><span class="line">   1000.00000    </span><br><span class="line">  enter name of minos_bran output text file</span><br><span class="line">NRussia_T</span><br><span class="line"> NRussia_T</span><br><span class="line">  minos_bran output binary unformatted file name</span><br><span class="line">eNRussia_T</span><br><span class="line"> eNRussia_T</span><br><span class="line">  enter path/dbase_name or dbase_name to store eigenfunctions:</span><br><span class="line">test_T</span><br><span class="line"> test_T</span><br><span class="line"> ====================================================</span><br><span class="line"> eigcon: n,nstart,nrad =          260         119         142</span><br><span class="line"></span><br><span class="line">real	1m9.287s</span><br><span class="line">user	0m0.021s</span><br><span class="line">sys	0m0.004s</span><br></pre></td></tr></table></figure>

<h1 id="green运行"><a href="#green运行" class="headerlink" title="green运行"></a>green运行</h1><p>此处复制了DEMO3的short.site;short.sitechan;china_cmt_event文件;db_list文件。这四个文件需要预先编辑完成。关于这四个文件如何编辑将在其他地方讲述，目前未完成。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">(base) [shizhiyuan@localhost DEMO4]$ time green</span><br><span class="line"> ============= Program green ====================</span><br><span class="line"> enter path to db with sta &amp; stachan:</span><br><span class="line">short</span><br><span class="line"> short</span><br><span class="line"> enter name of file within list of nmodes db:</span><br><span class="line">db_list        </span><br><span class="line"> db_list</span><br><span class="line"> enter input CMT file name:</span><br><span class="line">china_cmt_event</span><br><span class="line"> china_cmt_event</span><br><span class="line"> min and max frequencies to be considered (mHz) : </span><br><span class="line">10 260</span><br><span class="line">   10.0000000       260.000000    </span><br><span class="line"> enter # pts in greens fns .le.        30000  :</span><br><span class="line">8000</span><br><span class="line">        8000</span><br><span class="line"> enter Green functions output db file name:</span><br><span class="line">green</span><br><span class="line"> green</span><br><span class="line"> ====================================================</span><br><span class="line"> green: Event: B011400F  2000  14 23:37:10.800 lat =   25.390, lon =   101.400</span><br><span class="line"> green:        source depth = 33.0 km</span><br><span class="line"> green: step =    1.000 sec, nsamples =   8000</span><br><span class="line"> green: # sph. modes in band =        1918   must be .le.       300000</span><br><span class="line"> green: # tor. modes in band =        1712   must be .le.       300000</span><br><span class="line"> green: Input dbname : short</span><br><span class="line"> green: Station: ALE      82.5033  -62.3500 , Channels: 3</span><br><span class="line"> green: Channel: #            1   ALE   LHZ        0.00000000       0.00000000    </span><br><span class="line"> green: Channel: #            2   ALE   LHN        0.00000000       90.0000000    </span><br><span class="line"> green: Channel: #            3   ALE   LHE        90.0000000       90.0000000    </span><br><span class="line"> green: Epicentral Distance :     72.020</span><br><span class="line"> green: Azimuth of Source   :     15.433</span><br><span class="line"> green:    1 ALE    LHZ     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:    2 ALE    LHN     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:    3 ALE    LHE     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green: Station: ANMO     34.9502 -106.4602 , Channels: 3</span><br><span class="line"> green: Channel: #            1   ANMO  LHZ        0.00000000       0.00000000    </span><br><span class="line"> green: Channel: #            2   ANMO  LH2        10.0000000       90.0000000    </span><br><span class="line"> green: Channel: #            3   ANMO  LH1        280.000000       90.0000000    </span><br><span class="line"> green: Epicentral Distance :    114.439</span><br><span class="line"> green: Azimuth of Source   :    -27.665</span><br><span class="line"> green:    4 ANMO   LHZ     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:    5 ANMO   LH2     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:    6 ANMO   LH1     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green: Station: BAK      35.3441 -119.1043 , Channels: 3</span><br><span class="line"> green: Channel: #            1   BAK   BHZ        0.00000000       0.00000000    </span><br><span class="line"> green: Channel: #            2   BAK   BHN        0.00000000       90.0000000    </span><br><span class="line"> green: Channel: #            3   BAK   BHE        90.0000000       90.0000000    </span><br><span class="line"> green: Epicentral Distance :    108.462</span><br><span class="line"> green: Azimuth of Source   :    -38.270</span><br><span class="line"> green:    7 BAK    BHZ     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:    8 BAK    BHN     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:    9 BAK    BHE     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green: Station: BDFB    -15.6418  -48.0148 , Channels: 3</span><br><span class="line"> green: Channel: #            1   BDFB  LHZ        0.00000000       0.00000000    </span><br><span class="line"> green: Channel: #            2   BDFB  LHN        0.00000000       90.0000000    </span><br><span class="line"> green: Channel: #            3   BDFB  LHE        90.0000000       90.0000000    </span><br><span class="line"> green: Epicentral Distance :    149.822</span><br><span class="line"> green: Azimuth of Source   :     66.283</span><br><span class="line"> green:   10 BDFB   LHZ     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   11 BDFB   LHN     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   12 BDFB   LHE     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green: Station: BILL     68.0651  166.4524 , Channels: 3</span><br><span class="line"> green: Channel: #            1   BILL  LHZ        0.00000000       0.00000000    </span><br><span class="line"> green: Channel: #            2   BILL  LHN        0.00000000       90.0000000    </span><br><span class="line"> green: Channel: #            3   BILL  LHE        90.0000000       90.0000000    </span><br><span class="line"> green: Epicentral Distance :     57.417</span><br><span class="line"> green: Azimuth of Source   :   -103.266</span><br><span class="line"> green:   13 BILL   LHZ     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   14 BILL   LHN     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   15 BILL   LHE     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green: Station: BJT      40.0183  116.1679 , Channels: 3</span><br><span class="line"> green: Channel: #            1   BJT   LHZ        0.00000000       0.00000000    </span><br><span class="line"> green: Channel: #            2   BJT   LHN        0.00000000       90.0000000    </span><br><span class="line"> green: Channel: #            3   BJT   LHE        90.0000000       90.0000000    </span><br><span class="line"> green: Epicentral Distance :     19.123</span><br><span class="line"> green: Azimuth of Source   :   -135.267</span><br><span class="line"> green:   16 BJT    LHZ     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   17 BJT    LHN     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   18 BJT    LHE     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green: Station: BRVK     53.0581   70.2828 , Channels: 3</span><br><span class="line"> green: Channel: #            1   BRVK  LHZ        0.00000000       0.00000000    </span><br><span class="line"> green: Channel: #            2   BRVK  LHN        0.00000000       90.0000000    </span><br><span class="line"> green: Channel: #            3   BRVK  LHE        90.0000000       90.0000000    </span><br><span class="line"> green: Epicentral Distance :     36.158</span><br><span class="line"> green: Azimuth of Source   :    127.603</span><br><span class="line"> green:   19 BRVK   LHZ     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   20 BRVK   LHN     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   21 BRVK   LHE     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green: Station: CASY    -66.2792  110.5364 , Channels: 3</span><br><span class="line"> green: Channel: #            1   CASY  LHZ        0.00000000       0.00000000    </span><br><span class="line"> green: Channel: #            2   CASY  LHN        180.000000       90.0000000    </span><br><span class="line"> green: Channel: #            3   CASY  LHE        270.000000       90.0000000    </span><br><span class="line"> green: Epicentral Distance :     91.644</span><br><span class="line"> green: Azimuth of Source   :     -8.261</span><br><span class="line"> green:   22 CASY   LHZ     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   23 CASY   LHN     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   24 CASY   LHE     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green: Station: CCM      38.0557  -91.2446 , Channels: 3</span><br><span class="line"> green: Channel: #            1   CCM   LHZ        0.00000000       0.00000000    </span><br><span class="line"> green: Channel: #            2   CCM   LHN        0.00000000       90.0000000    </span><br><span class="line"> green: Channel: #            3   CCM   LHE        90.0000000       90.0000000    </span><br><span class="line"> green: Epicentral Distance :    115.783</span><br><span class="line"> green: Azimuth of Source   :    -12.703</span><br><span class="line"> green:   25 CCM    LHZ     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   26 CCM    LHN     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   27 CCM    LHE     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green: Station: TLY      51.6807  103.6438 , Channels: 3</span><br><span class="line"> green: Channel: #            1   TLY   LHZ        0.00000000       0.00000000    </span><br><span class="line"> green: Channel: #            2   TLY   LHN        0.00000000       90.0000000    </span><br><span class="line"> green: Channel: #            3   TLY   LHE        90.0000000       90.0000000    </span><br><span class="line"> green: Epicentral Distance :     26.308</span><br><span class="line"> green: Azimuth of Source   :   -175.417</span><br><span class="line"> green:   28 TLY    LHZ     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   29 TLY    LHN     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   30 TLY    LHE     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"></span><br><span class="line">real	1m30.361s</span><br><span class="line">user	0m1.101s</span><br><span class="line">sys	0m0.014s</span><br></pre></td></tr></table></figure>

<h1 id="生成理论地震图"><a href="#生成理论地震图" class="headerlink" title="生成理论地震图"></a>生成理论地震图</h1><p>使用syndat即可：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">(base) [shizhiyuan@localhost DEMO4]$ time syndat</span><br><span class="line"> ============== Program syndat ==================</span><br><span class="line"> enter input CMT file name:</span><br><span class="line">china_cmt_event</span><br><span class="line"> china_cmt_event</span><br><span class="line"> enter tensor type: 0 - moment, 1 - nodal plane 1, 2 - nodal plane 2</span><br><span class="line">0</span><br><span class="line">           0</span><br><span class="line"> enter input dbname</span><br><span class="line">green</span><br><span class="line"> green</span><br><span class="line"> enter output dbname</span><br><span class="line">Syndat</span><br><span class="line"> Syndat</span><br><span class="line"> Enter output units: 0 [nm/s/s] 1 [nm/s] 2 [nm]</span><br><span class="line">0</span><br><span class="line">syndat: CMT solution:</span><br><span class="line">syndat: Event: B011400F 2000  14 23: 37: 10.8, lat/lon =    25.39   101.40,</span><br><span class="line">syndat: depth =   33.0 km, step =    1.000 sec, Duration =  -2.3 sec,</span><br><span class="line">syndat: M0 =   0.833E+25,</span><br><span class="line">syndat: comp:  -0.600E+24 -0.629E+25  0.689E+25 -0.185E+25  0.120E+24 -0.473E+25</span><br><span class="line">syndat: plane1:   27.  78.  -6. plane2:  118.  84.-168.</span><br><span class="line">syndat: Selected moment tensor components:</span><br><span class="line">syndat: -0.600E+24 -0.629E+25  0.689E+25 -0.185E+25  0.120E+24 -0.473E+25</span><br><span class="line"></span><br><span class="line">syndat: Synthetic waveforms: </span><br><span class="line">syndat:    1 ALE    LHZ         1.000    8000</span><br><span class="line">syndat:    2 ALE    LHN         1.000    8000</span><br><span class="line">syndat:    3 ALE    LHE         1.000    8000</span><br><span class="line">syndat:    4 ANMO   LHZ         1.000    8000</span><br><span class="line">syndat:    5 ANMO   LH2         1.000    8000</span><br><span class="line">syndat:    6 ANMO   LH1         1.000    8000</span><br><span class="line">syndat:    7 BAK    BHZ         1.000    8000</span><br><span class="line">syndat:    8 BAK    BHN         1.000    8000</span><br><span class="line">syndat:    9 BAK    BHE         1.000    8000</span><br><span class="line">syndat:   10 BDFB   LHZ         1.000    8000</span><br><span class="line">syndat:   11 BDFB   LHN         1.000    8000</span><br><span class="line">syndat:   12 BDFB   LHE         1.000    8000</span><br><span class="line">syndat:   13 BILL   LHZ         1.000    8000</span><br><span class="line">syndat:   14 BILL   LHN         1.000    8000</span><br><span class="line">syndat:   15 BILL   LHE         1.000    8000</span><br><span class="line">syndat:   16 BJT    LHZ         1.000    8000</span><br><span class="line">syndat:   17 BJT    LHN         1.000    8000</span><br><span class="line">syndat:   18 BJT    LHE         1.000    8000</span><br><span class="line">syndat:   19 BRVK   LHZ         1.000    8000</span><br><span class="line">syndat:   20 BRVK   LHN         1.000    8000</span><br><span class="line">syndat:   21 BRVK   LHE         1.000    8000</span><br><span class="line">syndat:   22 CASY   LHZ         1.000    8000</span><br><span class="line">syndat:   23 CASY   LHN         1.000    8000</span><br><span class="line">syndat:   24 CASY   LHE         1.000    8000</span><br><span class="line">syndat:   25 CCM    LHZ         1.000    8000</span><br><span class="line">syndat:   26 CCM    LHN         1.000    8000</span><br><span class="line">syndat:   27 CCM    LHE         1.000    8000</span><br><span class="line">syndat:   28 TLY    LHZ         1.000    8000</span><br><span class="line">syndat:   29 TLY    LHN         1.000    8000</span><br><span class="line">syndat:   30 TLY    LHE         1.000    8000</span><br><span class="line"></span><br><span class="line">real	0m23.119s</span><br><span class="line">user	0m0.006s</span><br><span class="line">sys	0m0.002s</span><br></pre></td></tr></table></figure>

<h1 id="将理论地震图转化为SAC格式"><a href="#将理论地震图转化为SAC格式" class="headerlink" title="将理论地震图转化为SAC格式"></a>将理论地震图转化为SAC格式</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(base) [shizhiyuan@localhost DEMO4]$ time cucss2sac Syndat Syndat_SAC</span><br><span class="line">Relation Syndat.origin does not exist. Event info is not included in SAC header.</span><br><span class="line">Relation Syndat.site does not exist. Stations info is not included in SAC header.</span><br><span class="line"></span><br><span class="line">real	0m0.006s</span><br><span class="line">user	0m0.001s</span><br><span class="line">sys	0m0.003s</span><br></pre></td></tr></table></figure>

<h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><p>在这里发现相比于DEMO3,这里缺少了Syndat.site，Syndat.sitechan，Syndat.origin文件，因此缺失了台站和事件信息。</p>
<p>查看DEMO3的bash文件，发现运行green之后有这样的语句：</p>
<pre><code>cp -p short.site green.site
cp -p short.sitechan green.sitechan
creat_origin china_cmt_event green
</code></pre>
<p>这三个语句创建了green的三类文件：.site,.sitechan和.origin。</p>
<p>同样的，在运行完Syndat之后也有语句</p>
<pre><code>cp -p short.site Syndat.site
cp -p short.sitechan Syndat.sitechan
creat_origin china_cmt_event Syndat
</code></pre>
<p>补充之后,内容便完整了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/default%20=%20''/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/default%20=%20''/">1</a><span class="page-number current">2</span><a class="page-number" href="/default%20=%20''/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/default%20=%20''/page/6/">6</a><a class="extend next" rel="next" href="/default%20=%20''/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Shi Zhiyuan</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  





</body>
</html>
