<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 5.4.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"zhiyuanshi1901.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.12.2","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="Zhiyuan Shi">
<meta property="og:url" content="https://zhiyuanshi1901.github.io/default%20=%20''/page/2/index.html">
<meta property="og:site_name" content="Zhiyuan Shi">
<meta property="og:locale" content="en_US">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://zhiyuanshi1901.github.io/default%20=%20''/page/2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"default = ''/page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Zhiyuan Shi</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Zhiyuan Shi</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">13</span></a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">26</span></a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name"></p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">52</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/ZhiyuanShi1901" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ZhiyuanShi1901" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:dshi78066@gmail.com" title="Personal E-Mail → mailto:dshi78066@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>Personal E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:1901030201@s.upc.edu.cn" title="Work E-Mail → mailto:1901030201@s.upc.edu.cn" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>Work E-Mail</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhiyuanshi1901.github.io/2022/12/29/Mineos%E6%96%B0%E6%A8%A1%E5%9E%8B%E8%BF%90%E8%A1%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/12/29/Mineos%E6%96%B0%E6%A8%A1%E5%9E%8B%E8%BF%90%E8%A1%8C/" class="post-title-link" itemprop="url">Mineos新模型运行</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-12-29 21:40:07 / Modified: 21:51:19" itemprop="dateCreated datePublished" datetime="2022-12-29T21:40:07+08:00">2022-12-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%9C%B0%E9%9C%87%E5%AD%A6%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/" itemprop="url" rel="index"><span itemprop="name">地震学常用软件</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="试运行minos-bran-f"><a href="#试运行minos-bran-f" class="headerlink" title="试运行minos_bran.f"></a>试运行minos_bran.f</h1><h2 id="错误示例"><a href="#错误示例" class="headerlink" title="错误示例"></a>错误示例</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">(base) [shizhiyuan@localhost mineos-1.0.0.rbh]$ ./minos_bran</span><br><span class="line"> input model file:</span><br><span class="line">/DEMO/models/CPacific.txt    </span><br><span class="line"> /DEMO/models/CPacific.txt</span><br><span class="line"> output file:</span><br><span class="line">CP_S</span><br><span class="line"> CP_S</span><br><span class="line">At line 400 of file minos_bran.f (unit = 7, file = &#x27;fort.7&#x27;)</span><br><span class="line">Fortran runtime error: End of file</span><br><span class="line"></span><br><span class="line">Error termination. Backtrace:</span><br><span class="line">#0  0x7f5d66f41171 in ???</span><br><span class="line">#1  0x7f5d66f41d19 in ???</span><br><span class="line">#2  0x7f5d66f42521 in ???</span><br><span class="line">#3  0x7f5d6714a12b in ???</span><br><span class="line">#4  0x7f5d6714a722 in ???</span><br><span class="line">#5  0x7f5d6714729b in ???</span><br><span class="line">#6  0x7f5d6714be34 in ???</span><br><span class="line">#7  0x7f5d6714cca4 in ???</span><br><span class="line">#8  0x7f5d67149bb4 in ???</span><br><span class="line">#9  0x410ded in ???</span><br><span class="line">#10  0x41221c in ???</span><br><span class="line">#11  0x400c5c in ???</span><br><span class="line">#12  0x7f5d663bcd84 in ???</span><br><span class="line">#13  0x400c8d in ???</span><br></pre></td></tr></table></figure>


<p>这里出现了报错，原因是输入模型文件的时候路径需要特定的格式，如下是正确的运行：</p>
<h2 id="正确示例"><a href="#正确示例" class="headerlink" title="正确示例"></a>正确示例</h2><p>这里试运行NRussia模型，设置文件夹为DEMO4。</p>
<h3 id="运行内容是生成S振型的文件。"><a href="#运行内容是生成S振型的文件。" class="headerlink" title="运行内容是生成S振型的文件。"></a>运行内容是生成S振型的文件。</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">(base) [shizhiyuan@localhost DEMO4]$ time minos_bran</span><br><span class="line"> input model file:</span><br><span class="line">../models/NRussia.txt</span><br><span class="line"> ../models/NRussia.txt</span><br><span class="line"> output file:</span><br><span class="line">NRussia_S</span><br><span class="line"> NRussia_S</span><br><span class="line"> eigenfunction file (output):</span><br><span class="line">eNRussia_S </span><br><span class="line"> eNRussia_S</span><br><span class="line"> enter eps and wgrav</span><br><span class="line">1e-10 10</span><br><span class="line">   1.0000000000000000E-010   10.000000000000000     </span><br><span class="line"> enter jcom (1=rad;2=tor;3=sph;4=ictor)</span><br><span class="line">3</span><br><span class="line">           3</span><br><span class="line"> enter lmin,lmax,wmin,wmax,nmin,nmax</span><br><span class="line">1 6000 0.0 166.0 0 0</span><br><span class="line">           1        6000   0.0000000000000000        166.00000000000000                0           0</span><br><span class="line"></span><br><span class="line">real	1m13.243s</span><br><span class="line">user	0m1.250s</span><br><span class="line">sys	0m0.006s</span><br></pre></td></tr></table></figure>

<h3 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h3><p>正确示例中已经cd到DEMO文件夹下，此时需要退出到前一个文件夹，才能进入到models文件夹。因此，路径为：<br>..&#x2F;models&#x2F;NRussia.txt<br>这样运行实测不会出现错误。但是之前运行是在外部文件夹下，理应直接&#x2F;DEMO……这样是没有问题的。但是实测不行，也不知道为什么。目前在DEMO新建文件夹使用没有问题，而且这样能够区分不同的DEMO。</p>
<h3 id="生成T振型的文件"><a href="#生成T振型的文件" class="headerlink" title="生成T振型的文件"></a>生成T振型的文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">(base) [shizhiyuan@localhost DEMO4]$ time minos_bran</span><br><span class="line"> input model file:</span><br><span class="line">../models/NRussia.txt</span><br><span class="line"> ../models/NRussia.txt</span><br><span class="line"> output file:</span><br><span class="line">NRussia_T</span><br><span class="line"> NRussia_T</span><br><span class="line"> eigenfunction file (output):</span><br><span class="line">eNRussia_T</span><br><span class="line"> eNRussia_T</span><br><span class="line"> enter eps and wgrav</span><br><span class="line">1.0e-10 1</span><br><span class="line">   1.0000000000000000E-010   1.0000000000000000     </span><br><span class="line"> enter jcom (1=rad;2=tor;3=sph;4=ictor)</span><br><span class="line">2</span><br><span class="line">           2</span><br><span class="line"> enter lmin,lmax,wmin,wmax,nmin,nmax</span><br><span class="line">1 6000 0.0 166.0 0 0</span><br><span class="line">           1        6000   0.0000000000000000        166.00000000000000                0           0</span><br><span class="line"></span><br><span class="line">real	1m13.767s</span><br><span class="line">user	0m0.248s</span><br><span class="line">sys	0m0.005s</span><br></pre></td></tr></table></figure>


<h1 id="运行eigcon"><a href="#运行eigcon" class="headerlink" title="运行eigcon"></a>运行eigcon</h1><h2 id="S振型的相关文件"><a href="#S振型的相关文件" class="headerlink" title="S振型的相关文件"></a>S振型的相关文件</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">(base) [shizhiyuan@localhost DEMO4]$ time eigcon</span><br><span class="line"> ============= Program eigcon ====================</span><br><span class="line">  spheroidals (3) or toroidals (2) or radial (1) or</span><br><span class="line">  inner core toroidals (4) modes</span><br><span class="line">3</span><br><span class="line">           3</span><br><span class="line">  enter name of model file</span><br><span class="line">../models/NRussia.txt</span><br><span class="line"> ../models/NRussia.txt</span><br><span class="line"> enter max depth [km] : </span><br><span class="line">1000</span><br><span class="line">   1000.00000    </span><br><span class="line">  enter name of minos_bran output text file</span><br><span class="line">NRussia_S</span><br><span class="line"> NRussia_S</span><br><span class="line">  minos_bran output binary unformatted file name</span><br><span class="line">eNRussia_S</span><br><span class="line"> eNRussia_S</span><br><span class="line">  enter path/dbase_name or dbase_name to store eigenfunctions:</span><br><span class="line">test_S</span><br><span class="line"> test_S</span><br><span class="line"> ====================================================</span><br><span class="line"> eigcon: n,nstart,nrad =          260         119         142</span><br><span class="line"></span><br><span class="line">real	1m3.563s</span><br><span class="line">user	0m0.041s</span><br><span class="line">sys	0m0.008s</span><br></pre></td></tr></table></figure>
<h2 id="T振型相关"><a href="#T振型相关" class="headerlink" title="T振型相关"></a>T振型相关</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">(base) [shizhiyuan@localhost DEMO4]$ time eigcon</span><br><span class="line"> ============= Program eigcon ====================</span><br><span class="line">  spheroidals (3) or toroidals (2) or radial (1) or</span><br><span class="line">  inner core toroidals (4) modes</span><br><span class="line">2</span><br><span class="line">           2</span><br><span class="line">  enter name of model file</span><br><span class="line">../models/NRussia.txt</span><br><span class="line"> ../models/NRussia.txt</span><br><span class="line"> enter max depth [km] : </span><br><span class="line">1000</span><br><span class="line">   1000.00000    </span><br><span class="line">  enter name of minos_bran output text file</span><br><span class="line">NRussia_T</span><br><span class="line"> NRussia_T</span><br><span class="line">  minos_bran output binary unformatted file name</span><br><span class="line">eNRussia_T</span><br><span class="line"> eNRussia_T</span><br><span class="line">  enter path/dbase_name or dbase_name to store eigenfunctions:</span><br><span class="line">test_T</span><br><span class="line"> test_T</span><br><span class="line"> ====================================================</span><br><span class="line"> eigcon: n,nstart,nrad =          260         119         142</span><br><span class="line"></span><br><span class="line">real	1m9.287s</span><br><span class="line">user	0m0.021s</span><br><span class="line">sys	0m0.004s</span><br></pre></td></tr></table></figure>

<h1 id="green运行"><a href="#green运行" class="headerlink" title="green运行"></a>green运行</h1><p>此处复制了DEMO3的short.site;short.sitechan;china_cmt_event文件;db_list文件。这四个文件需要预先编辑完成。关于这四个文件如何编辑将在其他地方讲述，目前未完成。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">(base) [shizhiyuan@localhost DEMO4]$ time green</span><br><span class="line"> ============= Program green ====================</span><br><span class="line"> enter path to db with sta &amp; stachan:</span><br><span class="line">short</span><br><span class="line"> short</span><br><span class="line"> enter name of file within list of nmodes db:</span><br><span class="line">db_list        </span><br><span class="line"> db_list</span><br><span class="line"> enter input CMT file name:</span><br><span class="line">china_cmt_event</span><br><span class="line"> china_cmt_event</span><br><span class="line"> min and max frequencies to be considered (mHz) : </span><br><span class="line">10 260</span><br><span class="line">   10.0000000       260.000000    </span><br><span class="line"> enter # pts in greens fns .le.        30000  :</span><br><span class="line">8000</span><br><span class="line">        8000</span><br><span class="line"> enter Green functions output db file name:</span><br><span class="line">green</span><br><span class="line"> green</span><br><span class="line"> ====================================================</span><br><span class="line"> green: Event: B011400F  2000  14 23:37:10.800 lat =   25.390, lon =   101.400</span><br><span class="line"> green:        source depth = 33.0 km</span><br><span class="line"> green: step =    1.000 sec, nsamples =   8000</span><br><span class="line"> green: # sph. modes in band =        1918   must be .le.       300000</span><br><span class="line"> green: # tor. modes in band =        1712   must be .le.       300000</span><br><span class="line"> green: Input dbname : short</span><br><span class="line"> green: Station: ALE      82.5033  -62.3500 , Channels: 3</span><br><span class="line"> green: Channel: #            1   ALE   LHZ        0.00000000       0.00000000    </span><br><span class="line"> green: Channel: #            2   ALE   LHN        0.00000000       90.0000000    </span><br><span class="line"> green: Channel: #            3   ALE   LHE        90.0000000       90.0000000    </span><br><span class="line"> green: Epicentral Distance :     72.020</span><br><span class="line"> green: Azimuth of Source   :     15.433</span><br><span class="line"> green:    1 ALE    LHZ     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:    2 ALE    LHN     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:    3 ALE    LHE     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green: Station: ANMO     34.9502 -106.4602 , Channels: 3</span><br><span class="line"> green: Channel: #            1   ANMO  LHZ        0.00000000       0.00000000    </span><br><span class="line"> green: Channel: #            2   ANMO  LH2        10.0000000       90.0000000    </span><br><span class="line"> green: Channel: #            3   ANMO  LH1        280.000000       90.0000000    </span><br><span class="line"> green: Epicentral Distance :    114.439</span><br><span class="line"> green: Azimuth of Source   :    -27.665</span><br><span class="line"> green:    4 ANMO   LHZ     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:    5 ANMO   LH2     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:    6 ANMO   LH1     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green: Station: BAK      35.3441 -119.1043 , Channels: 3</span><br><span class="line"> green: Channel: #            1   BAK   BHZ        0.00000000       0.00000000    </span><br><span class="line"> green: Channel: #            2   BAK   BHN        0.00000000       90.0000000    </span><br><span class="line"> green: Channel: #            3   BAK   BHE        90.0000000       90.0000000    </span><br><span class="line"> green: Epicentral Distance :    108.462</span><br><span class="line"> green: Azimuth of Source   :    -38.270</span><br><span class="line"> green:    7 BAK    BHZ     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:    8 BAK    BHN     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:    9 BAK    BHE     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green: Station: BDFB    -15.6418  -48.0148 , Channels: 3</span><br><span class="line"> green: Channel: #            1   BDFB  LHZ        0.00000000       0.00000000    </span><br><span class="line"> green: Channel: #            2   BDFB  LHN        0.00000000       90.0000000    </span><br><span class="line"> green: Channel: #            3   BDFB  LHE        90.0000000       90.0000000    </span><br><span class="line"> green: Epicentral Distance :    149.822</span><br><span class="line"> green: Azimuth of Source   :     66.283</span><br><span class="line"> green:   10 BDFB   LHZ     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   11 BDFB   LHN     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   12 BDFB   LHE     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green: Station: BILL     68.0651  166.4524 , Channels: 3</span><br><span class="line"> green: Channel: #            1   BILL  LHZ        0.00000000       0.00000000    </span><br><span class="line"> green: Channel: #            2   BILL  LHN        0.00000000       90.0000000    </span><br><span class="line"> green: Channel: #            3   BILL  LHE        90.0000000       90.0000000    </span><br><span class="line"> green: Epicentral Distance :     57.417</span><br><span class="line"> green: Azimuth of Source   :   -103.266</span><br><span class="line"> green:   13 BILL   LHZ     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   14 BILL   LHN     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   15 BILL   LHE     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green: Station: BJT      40.0183  116.1679 , Channels: 3</span><br><span class="line"> green: Channel: #            1   BJT   LHZ        0.00000000       0.00000000    </span><br><span class="line"> green: Channel: #            2   BJT   LHN        0.00000000       90.0000000    </span><br><span class="line"> green: Channel: #            3   BJT   LHE        90.0000000       90.0000000    </span><br><span class="line"> green: Epicentral Distance :     19.123</span><br><span class="line"> green: Azimuth of Source   :   -135.267</span><br><span class="line"> green:   16 BJT    LHZ     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   17 BJT    LHN     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   18 BJT    LHE     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green: Station: BRVK     53.0581   70.2828 , Channels: 3</span><br><span class="line"> green: Channel: #            1   BRVK  LHZ        0.00000000       0.00000000    </span><br><span class="line"> green: Channel: #            2   BRVK  LHN        0.00000000       90.0000000    </span><br><span class="line"> green: Channel: #            3   BRVK  LHE        90.0000000       90.0000000    </span><br><span class="line"> green: Epicentral Distance :     36.158</span><br><span class="line"> green: Azimuth of Source   :    127.603</span><br><span class="line"> green:   19 BRVK   LHZ     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   20 BRVK   LHN     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   21 BRVK   LHE     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green: Station: CASY    -66.2792  110.5364 , Channels: 3</span><br><span class="line"> green: Channel: #            1   CASY  LHZ        0.00000000       0.00000000    </span><br><span class="line"> green: Channel: #            2   CASY  LHN        180.000000       90.0000000    </span><br><span class="line"> green: Channel: #            3   CASY  LHE        270.000000       90.0000000    </span><br><span class="line"> green: Epicentral Distance :     91.644</span><br><span class="line"> green: Azimuth of Source   :     -8.261</span><br><span class="line"> green:   22 CASY   LHZ     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   23 CASY   LHN     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   24 CASY   LHE     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green: Station: CCM      38.0557  -91.2446 , Channels: 3</span><br><span class="line"> green: Channel: #            1   CCM   LHZ        0.00000000       0.00000000    </span><br><span class="line"> green: Channel: #            2   CCM   LHN        0.00000000       90.0000000    </span><br><span class="line"> green: Channel: #            3   CCM   LHE        90.0000000       90.0000000    </span><br><span class="line"> green: Epicentral Distance :    115.783</span><br><span class="line"> green: Azimuth of Source   :    -12.703</span><br><span class="line"> green:   25 CCM    LHZ     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   26 CCM    LHN     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   27 CCM    LHE     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green: Station: TLY      51.6807  103.6438 , Channels: 3</span><br><span class="line"> green: Channel: #            1   TLY   LHZ        0.00000000       0.00000000    </span><br><span class="line"> green: Channel: #            2   TLY   LHN        0.00000000       90.0000000    </span><br><span class="line"> green: Channel: #            3   TLY   LHE        90.0000000       90.0000000    </span><br><span class="line"> green: Epicentral Distance :     26.308</span><br><span class="line"> green: Azimuth of Source   :   -175.417</span><br><span class="line"> green:   28 TLY    LHZ     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   29 TLY    LHN     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   30 TLY    LHE     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"></span><br><span class="line">real	1m30.361s</span><br><span class="line">user	0m1.101s</span><br><span class="line">sys	0m0.014s</span><br></pre></td></tr></table></figure>

<h1 id="生成理论地震图"><a href="#生成理论地震图" class="headerlink" title="生成理论地震图"></a>生成理论地震图</h1><p>使用syndat即可：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">(base) [shizhiyuan@localhost DEMO4]$ time syndat</span><br><span class="line"> ============== Program syndat ==================</span><br><span class="line"> enter input CMT file name:</span><br><span class="line">china_cmt_event</span><br><span class="line"> china_cmt_event</span><br><span class="line"> enter tensor type: 0 - moment, 1 - nodal plane 1, 2 - nodal plane 2</span><br><span class="line">0</span><br><span class="line">           0</span><br><span class="line"> enter input dbname</span><br><span class="line">green</span><br><span class="line"> green</span><br><span class="line"> enter output dbname</span><br><span class="line">Syndat</span><br><span class="line"> Syndat</span><br><span class="line"> Enter output units: 0 [nm/s/s] 1 [nm/s] 2 [nm]</span><br><span class="line">0</span><br><span class="line">syndat: CMT solution:</span><br><span class="line">syndat: Event: B011400F 2000  14 23: 37: 10.8, lat/lon =    25.39   101.40,</span><br><span class="line">syndat: depth =   33.0 km, step =    1.000 sec, Duration =  -2.3 sec,</span><br><span class="line">syndat: M0 =   0.833E+25,</span><br><span class="line">syndat: comp:  -0.600E+24 -0.629E+25  0.689E+25 -0.185E+25  0.120E+24 -0.473E+25</span><br><span class="line">syndat: plane1:   27.  78.  -6. plane2:  118.  84.-168.</span><br><span class="line">syndat: Selected moment tensor components:</span><br><span class="line">syndat: -0.600E+24 -0.629E+25  0.689E+25 -0.185E+25  0.120E+24 -0.473E+25</span><br><span class="line"></span><br><span class="line">syndat: Synthetic waveforms: </span><br><span class="line">syndat:    1 ALE    LHZ         1.000    8000</span><br><span class="line">syndat:    2 ALE    LHN         1.000    8000</span><br><span class="line">syndat:    3 ALE    LHE         1.000    8000</span><br><span class="line">syndat:    4 ANMO   LHZ         1.000    8000</span><br><span class="line">syndat:    5 ANMO   LH2         1.000    8000</span><br><span class="line">syndat:    6 ANMO   LH1         1.000    8000</span><br><span class="line">syndat:    7 BAK    BHZ         1.000    8000</span><br><span class="line">syndat:    8 BAK    BHN         1.000    8000</span><br><span class="line">syndat:    9 BAK    BHE         1.000    8000</span><br><span class="line">syndat:   10 BDFB   LHZ         1.000    8000</span><br><span class="line">syndat:   11 BDFB   LHN         1.000    8000</span><br><span class="line">syndat:   12 BDFB   LHE         1.000    8000</span><br><span class="line">syndat:   13 BILL   LHZ         1.000    8000</span><br><span class="line">syndat:   14 BILL   LHN         1.000    8000</span><br><span class="line">syndat:   15 BILL   LHE         1.000    8000</span><br><span class="line">syndat:   16 BJT    LHZ         1.000    8000</span><br><span class="line">syndat:   17 BJT    LHN         1.000    8000</span><br><span class="line">syndat:   18 BJT    LHE         1.000    8000</span><br><span class="line">syndat:   19 BRVK   LHZ         1.000    8000</span><br><span class="line">syndat:   20 BRVK   LHN         1.000    8000</span><br><span class="line">syndat:   21 BRVK   LHE         1.000    8000</span><br><span class="line">syndat:   22 CASY   LHZ         1.000    8000</span><br><span class="line">syndat:   23 CASY   LHN         1.000    8000</span><br><span class="line">syndat:   24 CASY   LHE         1.000    8000</span><br><span class="line">syndat:   25 CCM    LHZ         1.000    8000</span><br><span class="line">syndat:   26 CCM    LHN         1.000    8000</span><br><span class="line">syndat:   27 CCM    LHE         1.000    8000</span><br><span class="line">syndat:   28 TLY    LHZ         1.000    8000</span><br><span class="line">syndat:   29 TLY    LHN         1.000    8000</span><br><span class="line">syndat:   30 TLY    LHE         1.000    8000</span><br><span class="line"></span><br><span class="line">real	0m23.119s</span><br><span class="line">user	0m0.006s</span><br><span class="line">sys	0m0.002s</span><br></pre></td></tr></table></figure>

<h1 id="将理论地震图转化为SAC格式"><a href="#将理论地震图转化为SAC格式" class="headerlink" title="将理论地震图转化为SAC格式"></a>将理论地震图转化为SAC格式</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(base) [shizhiyuan@localhost DEMO4]$ time cucss2sac Syndat Syndat_SAC</span><br><span class="line">Relation Syndat.origin does not exist. Event info is not included in SAC header.</span><br><span class="line">Relation Syndat.site does not exist. Stations info is not included in SAC header.</span><br><span class="line"></span><br><span class="line">real	0m0.006s</span><br><span class="line">user	0m0.001s</span><br><span class="line">sys	0m0.003s</span><br></pre></td></tr></table></figure>

<h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><p>在这里发现相比于DEMO3,这里缺少了Syndat.site，Syndat.sitechan，Syndat.origin文件，因此缺失了台站和事件信息。</p>
<p>查看DEMO3的bash文件，发现运行green之后有这样的语句：</p>
<pre><code>cp -p short.site green.site
cp -p short.sitechan green.sitechan
creat_origin china_cmt_event green
</code></pre>
<p>这三个语句创建了green的三类文件：.site,.sitechan和.origin。</p>
<p>同样的，在运行完Syndat之后也有语句</p>
<pre><code>cp -p short.site Syndat.site
cp -p short.sitechan Syndat.sitechan
creat_origin china_cmt_event Syndat
</code></pre>
<p>补充之后,内容便完整了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhiyuanshi1901.github.io/2022/12/27/CPS-%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/12/27/CPS-%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">CPS 安装</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-12-27 18:26:24 / Modified: 18:28:19" itemprop="dateCreated datePublished" datetime="2022-12-27T18:26:24+08:00">2022-12-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%9C%B0%E9%9C%87%E5%AD%A6%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/" itemprop="url" rel="index"><span itemprop="name">地震学常用软件</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="将安装包解压"><a href="#将安装包解压" class="headerlink" title="将安装包解压"></a>将安装包解压</h1><h1 id="将解压后的文件移动到指定的CPS安装目录"><a href="#将解压后的文件移动到指定的CPS安装目录" class="headerlink" title="将解压后的文件移动到指定的CPS安装目录"></a>将解压后的文件移动到指定的CPS安装目录</h1><pre><code>mkdir -p ~/src/
mv PROGRAMS.330 ~/src/CPS
</code></pre>
<h1 id="安装依赖环境"><a href="#安装依赖环境" class="headerlink" title="安装依赖环境"></a>安装依赖环境</h1><pre><code>sudo yum install libX11-devel
</code></pre>
<h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><p>进入源码目录</p>
<pre><code>cd ~/src/CPS
./Setup LINUX6440
</code></pre>
<h1 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h1><pre><code>./C
</code></pre>
<h1 id="修改环境变量"><a href="#修改环境变量" class="headerlink" title="修改环境变量"></a>修改环境变量</h1><pre><code>echo &#39;# CPS computer programme of seismology&#39; &gt;&gt; ~/.bashrc
echo &#39;export PATH=$&#123;HOME&#125;/src/CPS/bin:$&#123;PATH&#125;&#39; &gt;&gt; ~/.bashrc
source ~/.bashrc
</code></pre>
<h1 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h1><pre><code>sdisp96 -h
</code></pre>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://seismo-learn.org/software/cps/install/">https://seismo-learn.org/software/cps/install/</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhiyuanshi1901.github.io/2022/12/27/Mineos-%E7%A8%8B%E5%BA%8F%E5%8F%82%E6%95%B0%E8%A7%A3%E9%87%8A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/12/27/Mineos-%E7%A8%8B%E5%BA%8F%E5%8F%82%E6%95%B0%E8%A7%A3%E9%87%8A/" class="post-title-link" itemprop="url">Mineos 程序解释</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-12-27 18:22:10" itemprop="dateCreated datePublished" datetime="2022-12-27T18:22:10+08:00">2022-12-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-01-17 12:38:16" itemprop="dateModified" datetime="2023-01-17T12:38:16+08:00">2023-01-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%9C%B0%E9%9C%87%E5%AD%A6%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/" itemprop="url" rel="index"><span itemprop="name">地震学常用软件</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h1><p>minos内README文件<br><a target="_blank" rel="noopener" href="http://chengxua.com/lishi/Julian_simp.html">儒略日计算器</a><br><a target="_blank" rel="noopener" href="http://quickeditor.top/days.html">日序计算器</a></p>
<h1 id="简要说明"><a href="#简要说明" class="headerlink" title="简要说明"></a>简要说明</h1><p>本文主要对mineos软件运行的程序进行了解与描述。<br>内容均源自程序内部解释与运行进程。<br>模型文件为DEMO中具有的PREM等地球模型。</p>
<h1 id="minos-bran"><a href="#minos-bran" class="headerlink" title="minos_bran"></a>minos_bran</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>包含一个输入：<br>模型文件</p>
<p>两个输出：<br>1、模型列表和简正振型属性摘要<br>2、本征函数的一个文件</p>
<h2 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h2><h3 id="jcom"><a href="#jcom" class="headerlink" title="jcom"></a>jcom</h3><p>jcom &#x3D; n， 当n为以下值时：</p>
<ul>
<li>1 radial modes 可能是指只有n值（径向振型）。</li>
<li>2 toroidal modes 环型振型（环振振型）</li>
<li>3 spheroidal modes 球型振型（球振振型）</li>
<li>4 inner core toroidal modes 内核环型振型；因为外核为液态，理论上内核有独立的振型。</li>
</ul>
<h3 id="lmin-lmax-wmin-wmax-nmin-nmax"><a href="#lmin-lmax-wmin-wmax-nmin-nmax" class="headerlink" title="lmin lmax wmin wmax nmin nmax"></a>lmin lmax wmin wmax nmin nmax</h3><p><em>lmin - lmax defines the range of angular orders to be computed.<br>if jcom&#x3D;1 this is ignored. wmin - wmax defines the frequency range to be computed (in millihertz)<br>nmin-nmax specifies the branch numbers to be computed – nmin&#x3D;0 is the fundamental mode</em></p>
<ul>
<li>lmin lmax 定义角度阶数，l。具体内容见扭振振型与球振振型。jcom为1时忽略</li>
<li>wmin wmax 定义计算的频率范围 单位：毫赫兹  振型存在一定的频率。频率与n和l组成的图像在（地震学、震源及地球结构概论图2.9-10所示）</li>
<li>nmin nmax 指定计算的分支编号 nmin&#x3D;0时为基阶振型</li>
</ul>
<h3 id="eps-wgrav"><a href="#eps-wgrav" class="headerlink" title="eps wgrav"></a>eps wgrav</h3><p><em>eps controls the accuracy of the runge-kutta integration scheme. the relative accuracy of an eigen frequency will be 2-3 x eps.<br>it also controls the precision with which a root is found and the minimum relative separation of two roots with the same<br>angular order.it is safe to set eps&#x3D;1.d-7.</em></p>
<p><em>wgrav is the frequency in millihertz above which gravitational<br>terms are neglected-this gives about a factor of 3 increase in speed.</em></p>
<ul>
<li>eps： 控制’’runge-kutta integration scheme’’的准确度。本征频率的相对准确度为2-3倍的eps。<br>它还控制找到根的精度以及具有相同角度顺序的两个根的最小相对距离。设置1e-7是安全的。<br>如果周期为5-10s，eps设置为10^(-12)-10^(-10)。</li>
<li>wgrav：  频率（单位毫赫兹）超过该频率的引力项被忽略。 造成3倍的速度增长。<br>忽略的是重力项；<em>Love 1911年地球的径向振动中考虑了重力的影响，和修订了基阶振型周期为60min。</em>具体的影响还未学习到。</li>
</ul>
<h2 id="输入文件（模型文件）"><a href="#输入文件（模型文件）" class="headerlink" title="输入文件（模型文件）"></a>输入文件（模型文件）</h2><h3 id="简介："><a href="#简介：" class="headerlink" title="简介："></a>简介：</h3><p>模型文件为计算所需的模型，有两种格式：一种为表格数据类型，例如prem模型；另一种格式为多项式格式。</p>
<h3 id="表格数据类型"><a href="#表格数据类型" class="headerlink" title="表格数据类型"></a>表格数据类型</h3><p>例：prem_noocean.txt</p>
<h4 id="第一行：标题，限制为80字节长度"><a href="#第一行：标题，限制为80字节长度" class="headerlink" title="第一行：标题，限制为80字节长度"></a>第一行：标题，限制为80字节长度</h4><pre><code>PREM NO OCEAN MODEL: (    0.0000    0.000) anisotropic case
</code></pre>
<h4 id="第二行：（按照参数出现顺序排列）"><a href="#第二行：（按照参数出现顺序排列）" class="headerlink" title="第二行：（按照参数出现顺序排列）"></a>第二行：（按照参数出现顺序排列）</h4><pre><code>1    1.00000  1
</code></pre>
<ul>
<li>ifanis 1表示各向异性模型（横向各向同性）；0表示各向同性。</li>
<li>tref 物理频散校正使用的模型参考周期（单位s）；&lt;0表示无校正</li>
<li>ifdeck 定义模型类型；1：模型表示为数据表格；0：模型表示为多项式</li>
</ul>
<h4 id="第三行："><a href="#第三行：" class="headerlink" title="第三行："></a>第三行：</h4><pre><code>185  33  66
</code></pre>
<ul>
<li>N 模型节点？，N&lt;&#x3D;350，指模型表格行数，表示有N个点。</li>
<li>nic ICB固态侧的索引？</li>
<li>noc CMB流体侧的索引？</li>
</ul>
<h4 id="第四行-第N-3行：模型表格主体，每一行表示节点在半径r上的模型参数。"><a href="#第四行-第N-3行：模型表格主体，每一行表示节点在半径r上的模型参数。" class="headerlink" title="第四行-第N+3行：模型表格主体，每一行表示节点在半径r上的模型参数。"></a>第四行-第N+3行：模型表格主体，每一行表示节点在半径r上的模型参数。</h4><p>注意：间断面定义为相同半径的不同节点，即两个相邻节点半径相同，但是参数不同。</p>
<pre><code>0. 13088.50 11262.20  3667.80   1327.7     84.6 11262.20  3667.80  1.00000
</code></pre>
<ul>
<li>r 节点所在球体半径（单位m ），注意：minos_bran小数部分去尾，因此厚度&lt;1m的薄层没有意义。薄层会造成额外的界面？。 如果模型包含液态界面，整个液态界面必须为没有中间节点的单层。半径从0（索引为1）开始，在自由界面结束。从球心开始。</li>
<li>rho 密度，单位kg&#x2F;m3</li>
<li>vpv 垂向偏振P波速度，单位m&#x2F;s</li>
<li>vsv 垂向偏振（极化）S波速度，单位m&#x2F;s</li>
<li>qkappa 压缩Q（compressional Q）</li>
<li>qshear 剪切波Q（shear Q）</li>
<li>vph 水平偏振P波速度，单位m&#x2F;s</li>
<li>vsh 水平偏振S波速度，单位m&#x2F;s</li>
<li>eta 横向各向同性模型参数</li>
</ul>
<p>注意：如果模型是各向同性的且ifanis&#x3D;1（横向各向同性），则minos_bran读取时会这样处理第四行之后的数据：<br>vph &#x3D; vpv, vsh &#x3D; vsv,  eta &#x3D; 1,<br>格式：(f8.0, 3f9.2, 2f9.1, 2f9.2, f9.5)</p>
<h3 id="模型类型为多项式类型时（ifdeck-x3D-0）"><a href="#模型类型为多项式类型时（ifdeck-x3D-0）" class="headerlink" title="模型类型为多项式类型时（ifdeck&#x3D;0）"></a>模型类型为多项式类型时（ifdeck&#x3D;0）</h3><h4 id="第三行：-暂无示例"><a href="#第三行：-暂无示例" class="headerlink" title="第三行： 暂无示例"></a>第三行： 暂无示例</h4><p>nreg 模型中区域的数量<br>nic ICB固态侧的索引？与表格数据类型相同<br>noc CMB流体侧的索引？<br>rx 多项式的归一化半径（normalizing radius） 单位km，通常是6371km。下文的归一化半径（normalized radius）应该为x&#x3D;r&#x2F;rx，</p>
<h4 id="第四行：暂无示例"><a href="#第四行：暂无示例" class="headerlink" title="第四行：暂无示例"></a>第四行：暂无示例</h4><p>nlay r1到r2区域中使用的层数<br>r1 单位km<br>r2 单位km</p>
<h4 id="第五行：第4-9或4-12层一般会重复nreg次。各项同性模型4-9行，各向异性模型为4-12行。"><a href="#第五行：第4-9或4-12层一般会重复nreg次。各项同性模型4-9行，各向异性模型为4-12行。" class="headerlink" title="第五行：第4-9或4-12层一般会重复nreg次。各项同性模型4-9行，各向异性模型为4-12行。"></a>第五行：第4-9或4-12层一般会重复nreg次。各项同性模型4-9行，各向异性模型为4-12行。</h4><p>每一行包含五个系数，4阶多项式系数为：a0，a1，a2，a3，a4，x&#x3D;r&#x2F;rx。P（x）&#x3D;a0+a1x+a2x^2+a3x^3+a4x^4。<br>一组5个（各向同性模型）或8个（各向异性模型）多项式用于差值模型参数：密度、速度等。作为第四行定义的区域内归一化半径的函数。</p>
<ul>
<li>第五行：密度rho的系数 (g&#x2F;cm3)</li>
<li>第六行：vpv的系数 (km&#x2F;s)</li>
<li>第七行：vsv的系数 (km&#x2F;s)</li>
<li>第八行：qkappa的系数</li>
<li>第九行：qshear的系数<br>下面三行各向异性模型中：</li>
<li>第十行：vph的系数 (km&#x2F;s)</li>
<li>第十一行：vsh的系数 (km&#x2F;s)</li>
<li>第十二行：eta的系数</li>
</ul>
<h2 id="输出文件"><a href="#输出文件" class="headerlink" title="输出文件"></a>输出文件</h2><h3 id="模型列表"><a href="#模型列表" class="headerlink" title="模型列表"></a>模型列表</h3><p>一个ASCII文件，列出了模型和mode properties（振型属性）。</p>
<p>例如：相速度（km&#x2F;s），频率，周期，群速度（km&#x2F;h），q，一个参数（动能与势能的比值-1）</p>
<p>在DEMO3示例中，prem_noocean_S文件就是输出的模型列表。<br>它的列表有两个表格，第一个表格是输入模型的数据，即第一部分，<br>此即prem_noocean.txt内的数据，标题为：<br><code>PREM NO OCEAN MODEL: (    0.0000    0.000) anisotropic case                     ref per =   1.0 secs</code><br>表示为PREM 无海洋的模型，采样间隔1s。<br>表头为：<br><code>level    radius        rho         vpv         vph         vsv         vsh         eta         qmu         qkap</code></p>
<p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1         0.0    13088.50    11262.20    11262.20     3667.80     3667.80     1.00000       84.60     1327.70</span><br></pre></td></tr></table></figure>

<p>第二个表格（第二部分）表头为：<br><code>integration precision =  0.1000E-09  root precision =  0.1000E-09  gravity cut off =  0.6283E-02 rad/s</code></p>
<p><code>    mode        phs vel       w(mhz)          t(secs)      grp vel(km/s)        q             raylquo</code> </p>
<p>integration precision对应参数eps，<br>该表格中的w对应的范围为0-200,但是最后一行超过了200,想必是取值时由于步长原因超出了一点点。</p>
<h4 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h4><h5 id="第一部分：模型表格"><a href="#第一部分：模型表格" class="headerlink" title="第一部分：模型表格"></a>第一部分：模型表格</h5><p>如果使用的是表格数据格式的模型，即上文中ifdeck&#x3D;1，则只是输入模型的拷贝，加入了索引，改变了参数列的排列顺序。<br>对于各向同性模型，执行了上文中表述的数据处理。<br>如果输入的模型为多项式格式，则通过插值转换为表格数据格式。<br>每一个区域程序构造nlay+1个半径步长相同节点。节点总数N&#x3D;nreg*（nlay+1）；</p>
<ul>
<li>1-5行 包含模型标题、参考周期tref、模型列表的表头和空行。无格式。</li>
<li>6-（N+5）行 index、r、rho、vpv、vph、vsv、vsh、eta、qshear、qkappa，示例见上。<br>格式：(3x, i3, f12.1, 5f12.2, f12.5, 2f12.2)</li>
<li>N+6&#x2F;N+11行 包含具有 Runge-Kutta 精度积分、<br>重力切断频率、空行和简正振型属性表标题（共6行）的文本消息。格式：自由格式</li>
</ul>
<h5 id="第二部分：振型属性"><a href="#第二部分：振型属性" class="headerlink" title="第二部分：振型属性"></a>第二部分：振型属性</h5><p>对于固定的径向阶数 n 和角度阶数 l，minos_bran计算本征函数<br>（单独存储）和标量参数（属性）：特征值（频率）、相位和群速度、<br>Q 以及动能与势能之比。这些标量参数存储在简正振型属性表中。<br>此表中的每一行（行）都给出了当前 n 和 l 的属性。<br>第一部分后面的行如下所示：<br>第(N+12)行到最后：</p>
<ul>
<li>norder 振型的径向阶数 n</li>
<li>typeo 振荡的类型：<ul>
<li>s 球振振型</li>
<li>t 环振振型</li>
<li>c 内核环振振型</li>
</ul>
</li>
<li>lorder 振型的角阶数l</li>
<li>phvel 相速度，单位:km&#x2F;s</li>
<li>freq 频率（本征值） 单位：mHz</li>
<li>per 周期，per&#x3D;1000&#x2F;freq 单位:s</li>
<li>grvel 群速度 单位:km&#x2F;s</li>
<li>Q 剪切波Q</li>
<li>raylquo 动能与势能之比减1。<br>如果本征函数准确并且模型中有足够的径向节点允许正交精确完成，<br>则该比率应该很小（EPS 阶）。（对于强指数振型（如斯通利振型），<br>您可能会看到此参数有所下降。）</li>
</ul>
<p>格式：(i5, a2, i5, 6g16.7)</p>
<h3 id="本征函数文件"><a href="#本征函数文件" class="headerlink" title="本征函数文件"></a>本征函数文件</h3><p>在DEMO3中输出的文件为fortran无格式二进制文件eprem_noocean_S。是一个二进制表达的本征函数。<br>这个文件是一个固定记录长度的二进制封装文件，封装类型很大程度上取决于编译器。为了<br>更加方便，eigcon程序将封装移除，并创建一个二进制文件，在不同语言和平台都能够读取。minos_bran程序使用一个write语句输出每一个本征函数。</p>
<p>文件名为“none”时不再计算本征函数。</p>
<p>这是一个固定记录长度的二进制文件，每个模式都有一个条目写为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">real*4 abuf(nvec)</span><br><span class="line">......</span><br><span class="line">write(ioeig) (abuf(i),i=1,nvec)</span><br></pre></td></tr></table></figure>
<ul>
<li>nvec：spheroidal modes（球型振型），值为：5+6<em>N；toroidal or radial modes（环型或径向振型），值为：5+2</em>N。</li>
<li>abuf的前五个字为：n，l，w，Q和群速度Cg。剩余的包括：<ul>
<li>toroidal modes（环型振型）：W（1..N）、 W’（1..N）</li>
<li>球型振型：本征函数和其关于半径的偏导数 U(1..N),U’(1..N),V(1..N),V’(1..N),P(1..N)，P’(1..N)<ul>
<li>U： 垂直球振振型分量（vertical spheroidal S）本征函数</li>
<li>V: horizontal S component 水平S分量</li>
<li>P：重力势</li>
<li>W：其它振型的常用表示法</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>woodhouse和dahlen（1978）表示W,W’,V,V’ 必须除以 sqrt(l*(l+1)).<br><strong>注：（A be devided by B 相当于 A&#x2F;B）</strong></p>
<p>本征函数的归一化：</p>
<ul>
<li>归一化：<br>frequency<strong>2 * integral(rho<em>w</em>w<em>r</em>r) &#x3D; 1 for toroidal modes<br>frequency</strong>2 * integral(rho*(u<em>u+l</em>(l+1)<em>v</em>v)<em>r</em>r) &#x3D; 1 for spheroidal modes<br>模型经过归一化，密度（rho）为：5515 mg&#x2F;m*<em>3 &#x3D; 1；pi</em>g&#x3D;1<br>积分限为0到rn。W与rho为r的函数。</li>
</ul>
<p>g为重力常数，地球半径（rn&#x3D;6371000m）为1,归一化结果为：<br>acceleration normalisation（加速度归一化） &#x3D; pi<em>g</em>rhobar*rn</p>
<p>velocity normalisation（速度归一化）     &#x3D; rn<em>sqrt(pi</em>g*rhobar)&#x3D; vn</p>
<p>frequency normalization（频率归一化）    &#x3D; vn&#x2F;rn</p>
<h2 id="运行内容"><a href="#运行内容" class="headerlink" title="运行内容"></a>运行内容</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">input model file: ../models/模型名称</span><br><span class="line">output file: 输出的相应振型文件名称</span><br><span class="line">eigenfunction file (output):输出的相应振型二进制无格式文件名称，一般是上一个名称前面+e</span><br><span class="line">enter eps and wgrav：1e-10 10  </span><br><span class="line">enter jcom (1=rad;2=tor;3=sph;4=ictor)：3</span><br><span class="line">enter lmin,lmax,wmin,wmax,nmin,nmax：1 6000 0.0 166.0 0 0</span><br></pre></td></tr></table></figure>

<h1 id="eigcon"><a href="#eigcon" class="headerlink" title="eigcon"></a>eigcon</h1><h2 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h2><p>将minos_bran的输出文件转换为.eigen，仅包含最上层dmax km ( 0 &lt; dmax &lt; Rn) 的信息。R0是自由界面半径（单位km）。<br>他能够运行于所有振型，自动读取输入文件的振型。</p>
<p>输入路径或名称，存储本征函数。其中，输入方式为两种：路径path&#x2F;dbase_name或名称dbase_name。</p>
<p>minos_bran输出的两个文件和模型文件一起被作为输入。<br><strong>eigcon renormalizes the eigen-functions and outputs them to a depth of 1000 km, in this example.</strong><br>这个程序对本征函数进行重归一化，输出在1000km的深度（这个参数可以在程序中设置，即enter max depth中设置。</p>
<p>创建的文件为：dbase_name.eigen， 创建的文件夹为dbase_name.eigen.dat，文件夹中有二进制文件eigen。<br>这里输出的文件为test_S.eigen,命名的为test</p>
<h2 id="参数-1"><a href="#参数-1" class="headerlink" title="参数"></a>参数</h2><h3 id="输入参数"><a href="#输入参数" class="headerlink" title="输入参数"></a>输入参数</h3><ul>
<li>jcom 同minos_bran</li>
<li>max_depth 输出的本征函数（单位km）的深度。<br>所有输出值只在区间（rn，rn-max_depth）内存在。rn是自由界面的半径（单位km）。<br>即：只保留地表与最大深度之间内的本征函数作为输出。</li>
</ul>
<h3 id="程序参数"><a href="#程序参数" class="headerlink" title="程序参数"></a>程序参数</h3><ul>
<li>rn     : radius at surface  表面的半径</li>
<li>wn     : frequency normalization 频率归一化？为什么只是一个参数呢？</li>
<li>vn     : velocity normalisation  速度归一化？</li>
<li>accn   : acceleration normalisation 加速度归一化</li>
<li>n      : index of surface grid point 表面网格点索引</li>
<li>nstart : index of lowest grid point 最低网格点索引</li>
<li>nrad   : # of gridpoints of reduced eigenfunctions 简化本征函数的网格点？</li>
</ul>
<h2 id="输出文件-1"><a href="#输出文件-1" class="headerlink" title="输出文件"></a>输出文件</h2><p>有三个输出文件。关系列表<code>dbname.eigen</code>,一个文件夹<code>dbname.eigen.dat</code>,一个二进制文件<code>dbname.eigen.dat/eigen</code><br>其中二进制文件是存储在文件夹中的，因此用&#x2F;表示。即一个名称为<code>eigen</code>的文件。</p>
<h3 id="dbname-eigen"><a href="#dbname-eigen" class="headerlink" title="dbname.eigen"></a>dbname.eigen</h3><p>这个列表格式在（原文表6.1）中描述。<br>每一行描述了单个本征函数的模态特性（modal properties），<br>并引用了<code>dbname.dat/eigen</code>文件中的数据段。<br>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 2 S 1 3233.67798 4.95166 6.38945 509.68240 67 7 7 f4  0 test_S.eigen.dat eigen -1 01/03/23-12:10:00</span><br></pre></td></tr></table></figure>

<h3 id="dbname-eigen-dat-x2F-eigen"><a href="#dbname-eigen-dat-x2F-eigen" class="headerlink" title="dbname.eigen.dat&#x2F;eigen"></a>dbname.eigen.dat&#x2F;eigen</h3><p>包含段（segments）的二进制文件，每一个段存储单个本征振型（n，l）的归一化本征函数。<br>包含4字节长度的单词组成。<br>。大多数计算机体系结构有两种常见的字节顺序：<br>BIG_ENDIAN（直顺序 1-2-3-4）和LOW_ENDIAN（反向顺序 4-3-2-1）。<br>BIG_ENDIAN由SUN和RISC导向的平台使用，<br>LOW_ENDIAN由PC，VAX和DEC硬件使用。<br>eigcon自动检测字节顺序，并将文本字符串“t4”（BIG_ENDIAN）<br>或“f4”（LOW_ENDIAN）放入.eigen关系中的数据类型字段中。</p>
<p>每一个字段逻辑分为2部分：头部和主体</p>
<h3 id="头部"><a href="#头部" class="headerlink" title="头部"></a>头部</h3><p>这个部分的段存储模态特性（modal properties）的标量参数和归一化系数。<br>前7个word：</p>
<ul>
<li>n integer*4 本征振型径向阶数 n。必须与参考.eigen关系中的<code>norder</code>相同。</li>
<li>l integer*4 角度阶数（harmonic degree） l。必须与参考关系中的<code>lorder</code>相同。</li>
<li>w real<em>4 本征振型频率。单位rad&#x2F;s；w&#x3D;2</em>pi&#x2F;per。per是参考关系中的<code>period field</code>。</li>
<li>q real<em>4 衰减表达中的指数项部分，即exp(-qt)。q&#x3D;0.5</em>w&#x2F;Q,rad&#x2F;sec。</li>
<li>rn real*4 半径归一化系数，以m为单位的情况下，与模型的自由表面的半径相同。</li>
<li>vn real<em>4 速度归一化系数。vn &#x3D; rn</em>(pi<em>G</em>rhon)^1&#x2F;2<ul>
<li>G 引力常数</li>
<li>rhon 密度归一化系数 5515kg&#x2F;m3</li>
<li>wn 圆频率归一化系数 wn&#x3D;vn&#x2F;rn</li>
</ul>
</li>
<li>an real<em>4 加速度归一化系数 an&#x3D;10^20&#x2F;(rhon</em>rn^4)</li>
</ul>
<h3 id="主体-word8-最后"><a href="#主体-word8-最后" class="headerlink" title="主体 word8-最后"></a>主体 word8-最后</h3><ul>
<li>E(nrow, ncol) real*4 存储归一化本征函数的矩阵，括号内为行列数。<br>第一列为半径，其他列为本征函数。本征函数数量取决于模态（modal）类型。<ul>
<li>球振振型 包含7列(r,U,U’,V,V’,P,P’)</li>
<li>环振振型及其他 3列(r,W,W’)<br>本征函数的归一化见上文。</li>
</ul>
</li>
</ul>
<h2 id="运行内容-1"><a href="#运行内容-1" class="headerlink" title="运行内容"></a>运行内容</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">spheroidals (3) or toroidals (2) or radial (1) orinner core toroidals (4) modes: 选择需要的即可。</span><br><span class="line">enter name of model file（输入模型的名称）：（上文中模型的名称）/模型路径/prem_noocean.txt</span><br><span class="line">enter max depth [km] （输入最大深度）:1000</span><br><span class="line">enter name of minos_bran output text file：输入上文minos_bran输出text文件的名称即可，即prem_noocean_S</span><br><span class="line">minos_bran output binary unformatted file name: 输入二进制无格式化文件名，即eprem_noocean_S</span><br><span class="line">enter path/dbase_name or dbase_name to store eigenfunctions(输入存放本征函数的路径或名称):test_S</span><br></pre></td></tr></table></figure>
<p>之后运行结束。</p>
<h2 id="运行过程中的信息"><a href="#运行过程中的信息" class="headerlink" title="运行过程中的信息"></a>运行过程中的信息</h2><h3 id="eigcon：-n-nstart-nrad-x3D-nnn-mmm-kkk"><a href="#eigcon：-n-nstart-nrad-x3D-nnn-mmm-kkk" class="headerlink" title="eigcon： n,nstart,nrad &#x3D; nnn, mmm, kkk"></a>eigcon： n,nstart,nrad &#x3D; nnn, mmm, kkk</h3><ul>
<li>nnn 本征函数节点的总数量</li>
<li>mmm 在使用深度截取本征函数之后的开始的节点数</li>
<li>kkk 截取之后的终止节点数</li>
</ul>
<p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eigcon: n,nstart,nrad = 260  119 142</span><br></pre></td></tr></table></figure>
<p>节点总数为260个，119-142为截取的节点数。</p>
<h1 id="green"><a href="#green" class="headerlink" title="green"></a>green</h1><h2 id="简介-2"><a href="#简介-2" class="headerlink" title="简介"></a>简介</h2><p>这个程序计算单个事件和一组给定的台站的格林函数。<br>每个台站，需要输入指定的通道列表。这个程序能够选择计算不同的格林函数：<br>a) 只计算Z分量；b) 计算三分量，使用标准ZNE传感器；c) 计算三分量，使用12Z传感器。<br>建立台站信息需要创建一个数据集，包含<code>.site</code>和<code>.sitechan</code>两个文件。可以使用IRIS的rdseed或者从全球数据库中选择。<br>另一个输入包含环振振型和球振振型的.eigen关系，在下方的输入一行中提到。</p>
<p>输入：db_list文件，内容为上面eigcon输出的文件列表，不带后缀名。</p>
<p>输出：名为green的.wfdisc文件等。每个传感器有六个格林函数</p>
<p><code>.sitechan</code>文件决定那些台站和通道用于构建格林函数。通道方向（位置）在<code>.sitechan</code>文件中，台站方向（位置）在<code>.site</code>文件中。这两个文件需要预处理。</p>
<p>另一个预处理文件为<code>db_list</code>，包含所有eigenfunction文件。在测试中为eigcon输出的文件，即：test_S和test_T。</p>
<h2 id="输入参数-1"><a href="#输入参数-1" class="headerlink" title="输入参数"></a>输入参数</h2><h3 id="fmin-fmax"><a href="#fmin-fmax" class="headerlink" title="fmin fmax"></a>fmin fmax</h3><p>定义输入本征函数数据集中选择的频率范围。忽略所有频率超过范围的振型。</p>
<h3 id="nsamples"><a href="#nsamples" class="headerlink" title="nsamples"></a>nsamples</h3><p>理论地震图中的样本（这里应该是指地震图中的采样点数量）数量，所有理论地震图从震源时间开始。</p>
<h2 id="输入文件"><a href="#输入文件" class="headerlink" title="输入文件"></a>输入文件</h2><h3 id="in-dbname-site-sitechan文件"><a href="#in-dbname-site-sitechan文件" class="headerlink" title="in_dbname .site .sitechan文件"></a>in_dbname .site .sitechan文件</h3><p>文件介绍见simpledit程序。<br>使用这些关系文件，green程序为每个台站定义一定数量的通道组，<br>每一个组有两种情况：一种是包含独立的Z分量通道；或是三通道分量。<br>在分组之前，green程序按照(sta,chan)字段对.sitechan文档进行排序，<br>并删除所有重复行。注意：.sitechan关系文件中的chan字段是标准SEED格式的三字符的通道名称，详见台站数据格式。</p>
<h3 id="db-list"><a href="#db-list" class="headerlink" title="db_list"></a>db_list</h3><p><strong>This file allows joining an unlimited number of eigcon outputs for spheroidal, toroidal, or radial modes. The single requirement is that intersection between these files is null. Each desired eigenfunction must be present and unique in some eigcon output.</strong><br>此文档允许为球振振型、环振振型或径向振型（radial）连接无限数量的eigcon输出。<br>要求：这些文档之间的交集为null，每个的本征函数必须存在并在eigcon的输出中是唯一的。</p>
<h3 id="cmt-event"><a href="#cmt-event" class="headerlink" title="cmt_event"></a>cmt_event</h3><p>包含一行数据，参考[CMT .ndk与衍生数据格式]</p>
<h2 id="输出文件-2"><a href="#输出文件-2" class="headerlink" title="输出文件"></a>输出文件</h2><h3 id="wfdisc文件"><a href="#wfdisc文件" class="headerlink" title=".wfdisc文件"></a>.wfdisc文件</h3><p>内部每一行的格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALE LHZ 947893030.80000 1 18 2000014 947941029.80000 48000 1.0000000 1.000000 20.000000 -   g f4 - green.wfdisc.dat                                                 g.00001                                   0       -1 01/03/23-12:10:00</span><br></pre></td></tr></table></figure>
<p>二进制文件包含六个格林函数，按照顺序对应于张量分量：Mrr，Mθθ，Mφφ，Mrθ，Mrφ，Mθφ，总长度：nsamp</p>
<h3 id="wfdisc-dat文件"><a href="#wfdisc-dat文件" class="headerlink" title=".wfdisc.dat文件"></a>.wfdisc.dat文件</h3><p>内部存在对应通道数量的文件。</p>
<h2 id="运行内容-2"><a href="#运行内容-2" class="headerlink" title="运行内容"></a>运行内容</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">enter path to db with sta &amp; stachan（输入包含台站等信息的文件路径）:.site和.sitechan的文件名。输入文件名即可。示例为short。</span><br><span class="line">enter name of file within list of nmodes db: dblist 由eigcon程序得到的文件列表。即存放本征函数的路径名列表。示例为db_list</span><br><span class="line">enter input CMT file name(输入CMT文件名称):china_cmt_event</span><br><span class="line">min and max frequencies to be considered (mHz) （需要考虑的频率范围）:10 260</span><br><span class="line">enter # pts in greens fns .le.        30000  （输入格林fns的pts？？？小于30000）: 8000</span><br><span class="line">enter Green functions output db file name（输出文件名）:green</span><br></pre></td></tr></table></figure>

<h2 id="输出信息"><a href="#输出信息" class="headerlink" title="输出信息"></a>输出信息</h2><h3 id="sph-modes-in-band-x3D-nnn-must-be-le-meig"><a href="#sph-modes-in-band-x3D-nnn-must-be-le-meig" class="headerlink" title="sph. modes in band &#x3D;  nnn   must be .le.  meig"></a>sph. modes in band &#x3D;  nnn   must be .le.  meig</h3><ul>
<li>nnn 所有输入数据集的球振振型的总数。</li>
<li>meig 允许的最大数量（max allowed number）的球振振型，是一个限定值，限制nnn的数量。<br>示例：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># sph. modes in band = 1918 must be .le. 300000</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="tor-modes-in-band-x3D-nnn-must-be-le-meig"><a href="#tor-modes-in-band-x3D-nnn-must-be-le-meig" class="headerlink" title="tor. modes in band &#x3D;  nnn   must be .le.  meig"></a>tor. modes in band &#x3D;  nnn   must be .le.  meig</h3><p>同上，但是是环振振型。</p>
<h3 id="cmt-event文件：事件信息"><a href="#cmt-event文件：事件信息" class="headerlink" title="cmt_event文件：事件信息"></a>cmt_event文件：事件信息</h3><p>格式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Event: evid  date&amp;time lat =  ±dd.ddd, lon = ±ddd.ddd</span><br><span class="line">        source depth = ddd.d km</span><br><span class="line">step = d.ddd sec, nsamples =  ddddd</span><br></pre></td></tr></table></figure>
<p>第一行为事件信息数据； 第二行为时间深度； 第三行为格林函数的时间步长和采样点数量。</p>
<p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Event: B011400F  2000  14 23:37:10.800 lat =   25.390, lon =   101.400</span><br><span class="line">       source depth = 33.0 km</span><br><span class="line">step =    1.000 sec, nsamples =   8000</span><br></pre></td></tr></table></figure>

<h3 id="输入的-site和-sitechan文件名"><a href="#输入的-site和-sitechan文件名" class="headerlink" title="输入的.site和.sitechan文件名"></a>输入的.site和.sitechan文件名</h3><p>格式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Input dbname : xxxxx</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Input dbname : short</span><br></pre></td></tr></table></figure>

<h3 id="台站信息"><a href="#台站信息" class="headerlink" title="台站信息"></a>台站信息</h3><p>格式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Station: code lat lon , Channels: nnn</span><br></pre></td></tr></table></figure>
<p>台站码、位置坐标、选择的传感器组的通道数量</p>
<h3 id="通道信息"><a href="#通道信息" class="headerlink" title="通道信息"></a>通道信息</h3><p>格式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Channel: #  nnn code chan hang vang</span><br></pre></td></tr></table></figure>
<ul>
<li>nnn current number in the group 当前组中通道的编号,这个编号可能只是一个表示不同分量的标号。</li>
<li>code 台站码</li>
<li>chan hang vang 通道码、以及对应的水平角和垂直角</li>
</ul>
<p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Channel: # 1   BDFB  LHZ  0.00000000   0.00000000 </span><br><span class="line">Channel: # 2   BDFB  LHN  0.00000000   90.0000000    </span><br><span class="line">Channel: # 3   BDFB  LHE  90.0000000   90.0000000   </span><br></pre></td></tr></table></figure>
<h3 id="震中距"><a href="#震中距" class="headerlink" title="震中距"></a>震中距</h3><p>格式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Epicentral Distance :  ddd.ddd</span><br></pre></td></tr></table></figure>
<p>可以得到台站的震中距</p>
<h3 id="震源方位角"><a href="#震源方位角" class="headerlink" title="震源方位角"></a>震源方位角</h3><p>格式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Azimuth of Source : ddd.ddd</span><br></pre></td></tr></table></figure>
<p>台站到震源的方位角。</p>
<h3 id="格林函数的"><a href="#格林函数的" class="headerlink" title="格林函数的"></a>格林函数的</h3><p>格式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nnn code chan date&amp;time step mmm</span><br></pre></td></tr></table></figure>
<ul>
<li>nnn 通道索引。范围为1-通道总数，是这个通道在这个.sitechan文件中的索引。</li>
<li>code 台站名</li>
<li>chan 通道码</li>
<li>date&amp;time 发震时间</li>
<li>step 格林函数采样时间间隔，单位s</li>
<li>mmm 六个格林函数块的采样点总数，采样点数 nsamples*6<br>示例：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">13 BILL LHZ 2000 14 23:37:10.800 1.000  48000</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="syndat-f"><a href="#syndat-f" class="headerlink" title="syndat.f"></a>syndat.f</h1><h2 id="简介-3"><a href="#简介-3" class="headerlink" title="简介"></a>简介</h2><p>构建理论地震图使用的程序。选择的事件的地震矩张量和格林函数的卷积，得到理论地震图。<br>最终输出的文件为Syndat.wfdisc.dat，内部为理论地震图。</p>
<h2 id="参数-2"><a href="#参数-2" class="headerlink" title="参数"></a>参数</h2><h3 id="plane-输入张量类型"><a href="#plane-输入张量类型" class="headerlink" title="plane 输入张量类型"></a>plane 输入张量类型</h3><ul>
<li>0 moment 张量分量直接从cmt_file中获取</li>
<li>1 nodal plane 1 即从节面1（cmt文件中的倒数6-4个数据）获取角度数据及标量距M0计算矩张量分量</li>
<li>2 nodal plane 2 从节面2获取相应数据计算，同上。</li>
</ul>
<h3 id="datatype-数据类型"><a href="#datatype-数据类型" class="headerlink" title="datatype 数据类型"></a>datatype 数据类型</h3><ul>
<li>0 输出的地震波形为加速度地震图，单位nm&#x2F;s2</li>
<li>1 输出速度图，单位nm&#x2F;s</li>
<li>2 输出位移图，单位nm</li>
</ul>
<h2 id="输入文件-1"><a href="#输入文件-1" class="headerlink" title="输入文件"></a>输入文件</h2><h3 id="输入格林函数文件"><a href="#输入格林函数文件" class="headerlink" title="输入格林函数文件"></a>输入格林函数文件</h3><p>即green程序输出的.wfdisc关系文件。</p>
<h2 id="输出文件-3"><a href="#输出文件-3" class="headerlink" title="输出文件"></a>输出文件</h2><p>地震图文件，可以通过程序cucss2sac转化为sac格式的地震图。</p>
<h2 id="运行内容-3"><a href="#运行内容-3" class="headerlink" title="运行内容"></a>运行内容</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">enter input CMT file name(输入CMT文件名称)：示例为china_cmt_event</span><br><span class="line">enter tensor type(输入张量类型)：0-moment；1-nodal plane1；2-nodal plane2</span><br><span class="line">enter input dbname(输入文件的dbname)：上文格林函数程序运行的输出名。即green</span><br><span class="line">enter output dbname（输出文件的dbname）：设置输出文件名，可以设置为syndat</span><br><span class="line">Enter output units（输入输出单位）： 0 [nm/s/s] 1 [nm/s] 2 [nm]</span><br></pre></td></tr></table></figure>

<h1 id="cucss2sac"><a href="#cucss2sac" class="headerlink" title="cucss2sac"></a>cucss2sac</h1><h2 id="简介-4"><a href="#简介-4" class="headerlink" title="简介"></a>简介</h2><p>将理论地震图转化为其他格式的数据。例如sac格式和asc格式（ASCII）。</p>
<h2 id="描述-1"><a href="#描述-1" class="headerlink" title="描述"></a>描述</h2><p>cucss2sac是为了解决IRIS css2sac中的bug而特别为mineos设计的。它并不是标准css2sac的平替，例如：cucss2sac仅支持CSS3.0架构和如下两种CSS输入二进制数据格式：</p>
<ul>
<li>“t4”(BIG_ENDIAN, single precision floating point)</li>
<li>“f4”(LOW_ENDIAN, single precision floating point)<br>cucss2sac转换CSS二进制数据，不进行校正和修改。在Mineos中，它用于格林函数和理论地震图格式转化。</li>
</ul>
<p>一个CSS数据集名称db_name必须至少包含一个db_name.wfdisc文件，包含波形的CSS格式信息。并且需要包含数据集：.origin和.site关系列表（文件db_name.origin db_name.site)来获取完全的SAC头信息。</p>
<ul>
<li>.origin文件 包含事件位置信息</li>
<li>.site文件 包含台站位置信息</li>
</ul>
<h2 id="生成的SAC文件"><a href="#生成的SAC文件" class="headerlink" title="生成的SAC文件"></a>生成的SAC文件</h2><p>如果在数据集中.origin出现，cucss2sac只使用这个文件的第一行。在ASCII输出的情况下，所有的参数符合ASCII头信息–文件的前三行。例如一个理论地震图的输出如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">EVENT: 2000(014)-23:37:10.800 947893030.80000 25.3900 101.4000 33.0000</span><br><span class="line">STATION: ALE LHE 82.5033 -62.3500 0.0000</span><br><span class="line">DATA: 2000(014)-23:37:10.800 947893030.80000 8000 1.000000</span><br><span class="line"></span><br><span class="line">0.0000000E+00 5.7025738E+00</span><br><span class="line">1.0000000E+00 1.9508668E+00</span><br><span class="line">2.0000000E+00 -4.1160989E+00</span><br><span class="line">3.0000000E+00 -4.1094885E+00</span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">7.9970000E+03 1.5211651E+01</span><br><span class="line">7.9980000E+03 2.7408613E+01</span><br><span class="line">7.9990000E+03 3.5795624E+01</span><br></pre></td></tr></table></figure>

<ul>
<li>EVENT：包含发震事件（origin time）（human and epoch） 纬度(deg) 经度 震源深度(km)</li>
<li>STATION：台站名，通道码，纬度，经度，深度&#x3D;0</li>
<li>DATA：波形开始时间（waveform starting time）（human and epoch），采样点数量，采样间隔（sec）</li>
<li>数据体：为两列，第一列为相对波形开始的时间（sec），第二列为波形点的值，按照选择有nm（位移），nm&#x2F;s（速度），nm&#x2F;s&#x2F;s（加速度），取决于生成地震图时的选择。</li>
</ul>
<p>如果不需要头部信息，使用-n。</p>
<h2 id="生成的ASCII文件"><a href="#生成的ASCII文件" class="headerlink" title="生成的ASCII文件"></a>生成的ASCII文件</h2><p>输出的ASCII文件与SAC不同。头部文件相同，但是数据不同。是一个7列的数据表格。第一列为相对时间，剩下6列为选择的格林函数分量–垂直或一些水平方向。(G rr , G θθ , G φφ , G rθ , G rφ , G θφ )<br>分量的结束和syndat程序中地震矩张量分量Mij的阶数相同，因此相对理论地震图S：</p>
<p>S&#x3D;10E−18*sum（Gij Mij）</p>
<p>其中，Mij单位为dyne*cm， ij&#x3D;rr，θθ，φφ, rθ, rφ, θφ</p>
<h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><pre><code>cucss2sac [-a [-n]] db_name 输出的sac文件路径的名称
</code></pre>
<p>[]内的内容：</p>
<ul>
<li><p>无，输出sac文件</p>
</li>
<li><p>-a 输出ASC文件</p>
</li>
<li><p>-n 按照ASCII表格表头输出，必须和-a一起使用。</p>
</li>
<li><p>dbname：该文件必须包括.wfdisc;.origin;.site文件，才能完成SAC标题的构建。这个文件为之前green函数生成的三个文件。</p>
</li>
</ul>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cucss2sac Syndat Syndat_SAC</span><br><span class="line">cucss2sac green green_SAC</span><br><span class="line">cucss2sac -a Syndat Syndat_ASC</span><br><span class="line">cucss2sac -a -n Syndat Syndat_ASC_NOHEADER</span><br></pre></td></tr></table></figure>

<h1 id="eigen2asc"><a href="#eigen2asc" class="headerlink" title="eigen2asc"></a>eigen2asc</h1><h2 id="简介-5"><a href="#简介-5" class="headerlink" title="简介"></a>简介</h2><p>将本征函数的.eigen文件转化为asc文件。</p>
<h2 id="描述-2"><a href="#描述-2" class="headerlink" title="描述"></a>描述</h2><p>eigen2asc功能转换部分或者全部.eigen关系到一系列ASCII文件。程序eigen2sac在db_name.eigen文件中寻找所有符合振型参数n，l的本征函数：其中，nmin&lt;n&lt;nmax,lmin&lt;l&lt;lmax。并且转换本征函数到ASCII文件。输出文件在out_dir。每一个输出文件包含头部信息和文件内容。<br>头部信息：一行包含.eigen关系的前10个字段，见表6.1（mineos官方手册）。选项 -n 包含头部输出。数据体为三列（包含径向、环型振型（radial toroidal modes））或者七列（球型振型）表格。第一列为半径（单位m），其他列包含本征函数和他们关于半径的导数-U，U‘，V，V’，P，P‘(球型振型)和W，W‘(其他振型)。更多内容见章节4.1（即上面的cucss2sac描述）。输出文件名格式为：X.NNNNNNN.MMMMMMM.ASC；</p>
<p>X：S球型振型，T环型振型。<br>nnnnnnn：数字n<br>mmmmmmm：数字l。</p>
<h2 id="运行-1"><a href="#运行-1" class="headerlink" title="运行"></a>运行</h2><pre><code>eigen2asc nmin nmax lmin lmax db_name out_dir
</code></pre>
<ul>
<li>nmin, nmax - mininal and maximal values of the radial mode number n（径向振型数n）</li>
<li>lmin, lmax - mininal and maximal values of the lateral mode number l（l）</li>
<li>db_name    - data base name, must include .eigen relation;（.eigen文件）</li>
<li>out_dir    - output directory for ASCII files（输出ASCII文件路径）</li>
</ul>
<h2 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h2><pre><code>eigen2asc 0 0 6 8 test_S test_S_ASC
eigen2asc 0 1 2 500 test_S Eigen_S_ASC
eigen2asc -n 0 1 2 500 test_S Eigen_S_no_headers_ASC
</code></pre>
<h1 id="endi"><a href="#endi" class="headerlink" title="endi"></a>endi</h1><h2 id="简介-6"><a href="#简介-6" class="headerlink" title="简介"></a>简介</h2><p>In-place file swapping with fixed width</p>
<h2 id="描述-3"><a href="#描述-3" class="headerlink" title="描述"></a>描述</h2><p><em>This utility is used when you transfer binary files of<br>.wfdisc or .eigen relations to a platform with a<br>different byte order. The utility changes the byte<br>order from BIG_ENDIAN to LOW_ENDIAN and vice versa.<br>endi sequentially reads the file from the list<br>file1 [ file2 … filen] into memory as an unsigned<br>character string, swaps sequential groups of nw<br>bytes long starting from the beginning of the file,<br>and stores the swapped data<br>into the same place as before (swapping in-place).<br>If the last group has a length less than nw,<br>it stays unswapped.</em></p>
<p>这个程序用于转换二进制文件</p>
<p>这个程序改变byte order，从BIG_ENDIAN到LOW_ENDIAN，反之亦然。<br>endi以无符号character string类型顺序读取file1,file2 … 到内存中，交换</p>
<h2 id="运行-2"><a href="#运行-2" class="headerlink" title="运行"></a>运行</h2><pre><code>endi nw file1 [file2 ... filen]
</code></pre>
<h2 id="示例-2"><a href="#示例-2" class="headerlink" title="示例"></a>示例</h2><p>w.00001和w.00002都是来源于在PC上产生的一些.wfdisc关系二进制real*4数据文件。这些文件<br><em>These files have internal LOW_ENDIAN data representation created, e.g., by a direct<br>access FORTRAN WRITE statement.</em></p>
<pre><code>endi 4 w.00001 w.00002
</code></pre>
<p>we change the order of 4-byte words to BIG_ENDIAN for transferring these files on a computer with BIG_ENDIAN byte order, e.g., a SUN Ultra machine, where we may use a direct access READ statement to read data as real*4 variables.</p>
<h1 id="simpledit"><a href="#simpledit" class="headerlink" title="simpledit"></a>simpledit</h1><h2 id="简介-7"><a href="#简介-7" class="headerlink" title="简介"></a>简介</h2><p>从一个输入的ASCII文件创建.site和.sitechan CSS关系</p>
<h2 id="描述-4"><a href="#描述-4" class="headerlink" title="描述"></a>描述</h2><p>将手动创建的具有台站和通道信息的无格式ASCII文件 ascii_file 转换为 CSS3.0 db_name.site和db_name.sitechan关系列表（文件）。 db_name来自于命令行，是数据文件的名称。<br>对于真实数据的另一种创建方法：使用IRIS的rdseed程序创建。<br>注意，CSS格式定义严格，不要人工创建.site和.sitechan文件，这可能造成数值格式错误，造成mineos程序崩溃。<br>对于大量的台站数据，更好的解决方式是写一个直接创建ascii_file或者.site .sitechan文件的程序。</p>
<h2 id="需要预处理的ASCII文件"><a href="#需要预处理的ASCII文件" class="headerlink" title="需要预处理的ASCII文件"></a>需要预处理的ASCII文件</h2><p>这个文件是ASCII格式集，每一行描述了一个单独的台站或者通道。所有列在台站行之后的通道行隶属于这个台站。</p>
<p>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ANMO 34.9502 -106.4602 1.6890 ’Albuquerque, New Mexico, USA’</span><br><span class="line">@ LH1 150.0000 280.0 90.0</span><br><span class="line">@ LH2 150.0000 10.0 90.0</span><br><span class="line">@ LHZ 89.3000 0.0 0.0</span><br><span class="line">BJT 40.0183 116.1679 0.1370 ’Baijiatuan, Beijing, China’</span><br><span class="line">@ LHE 60.0000 90.0 90.0</span><br><span class="line">@ LHN 60.0000 0.0 90.0</span><br><span class="line">@ LHZ 60.0000 0.0 0.0</span><br><span class="line">@ BHE 60.0000 90.0 90.0</span><br><span class="line">@ BHN 60.0000 0.0 90.0</span><br><span class="line">@ BHZ 60.0000 0.0 180.0</span><br><span class="line">BILL 68.0651 166.4524 0.2990 ’Bilibino, Russia’</span><br><span class="line">@ LHZ 0.0000 0.0 0.0</span><br><span class="line">CCM 38.0557 -91.2446 0.1710 ’Cathedral Cave, Missouri, USA’</span><br><span class="line">@ LHE 51.0000 90.0 90.0</span><br><span class="line">@ LHN 51.0000 0.0 90.0</span><br><span class="line">@ LHZ 51.0000 0.0 0.0</span><br></pre></td></tr></table></figure>

<ul>
<li>台站行包含：台站代码sta 纬度lat 经度lon 海拔elev 台站名staname<br>  见表格6.3 .site关系表</li>
<li>通道行：以@开始，其他内容为：通道码chan 传感器edepth hang vang<br>  见表格6.4 .sitechan关系表</li>
</ul>
<p>标准格式为：</p>
<pre><code>@ XXE dd.dddd 90.0 90.0
@ XXN dd.dddd 0.0 90.0
@ XXZ dd.dddd 0.0 0.0
</code></pre>
<ul>
<li>dd.dddd：传感器的edepth。</li>
<li>注意：通道的order不重要。</li>
</ul>
<h2 id="运行-3"><a href="#运行-3" class="headerlink" title="运行"></a>运行</h2><pre><code>simpledit ascii_file db_name
</code></pre>
<h2 id="示例-3"><a href="#示例-3" class="headerlink" title="示例"></a>示例</h2><p>将上述示例保存为普通text文件即可，命名为stations，输入命令：</p>
<pre><code>time simpledit stations short
</code></pre>
<p>即可得到short.site short.sitechan两个文件。</p>
<h1 id="create-origin"><a href="#create-origin" class="headerlink" title="create_origin"></a>create_origin</h1><h2 id="简介-8"><a href="#简介-8" class="headerlink" title="简介"></a>简介</h2><p>转换一个事件text文件为CSS3.0 .origin关系。</p>
<h2 id="描述-5"><a href="#描述-5" class="headerlink" title="描述"></a>描述</h2><p>create_origin是一个shell脚本，从cmt_event ASCII文件中读取green程序输入文件cmt_event第一行,<br>将震源时间和位置信息转换为一行CSS3.0关系表，并将其写入db_name.origin文件。<br>这个脚本只填写.origin关系表中的字段：lat,lon,depth,time,orid,jdate,auth和lddate。其他的字段对于mineos并不重要，<br>由默认值填充。更多信息见下面所示表4.1。</p>
<h2 id="运行-4"><a href="#运行-4" class="headerlink" title="运行"></a>运行</h2><pre><code>create_origin cmt_event db_name
</code></pre>
<h1 id="关系-relation-表"><a href="#关系-relation-表" class="headerlink" title="关系(relation)表"></a>关系(relation)表</h1><h2 id="origin-震源关系"><a href="#origin-震源关系" class="headerlink" title=".origin 震源关系"></a>.origin 震源关系</h2><p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-7.2800  125.9900  473.4000   393567535.30000 1 -1 1982173 -1 -1 -1 -1 -1 - -999.0000 - -999.00 -1 -999.00 -1 -999.00 -1 - PDE &amp; Hvd CMT -1 -1 </span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th align="center">字节索引</th>
<th align="center">名称</th>
<th align="center">含义</th>
<th align="center">NA值</th>
<th align="center">取值范围</th>
<th align="center">备注</th>
<th align="center">单位</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">lat</td>
<td align="center">估算的纬度</td>
<td align="center">不允许</td>
<td align="center">-90.0≤lat≤90.0</td>
<td align="center">纬度，地理纬度，北半球为正；即cmt文件中的纬度</td>
<td align="center">度 ° degrees</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">lon</td>
<td align="center">估算的经度</td>
<td align="center">不允许</td>
<td align="center">-180.0≤lon≤180.0</td>
<td align="center">地理经度，本初子午线以东为正；即cmt文件中的经度</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">depth</td>
<td align="center">震源深度</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">cmt文件中的震源深度</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">time</td>
<td align="center">发震时间</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">发震时间为儒略日时间</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">orid</td>
<td align="center">震源原始id代码</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">1</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">evid</td>
<td align="center">事件代码</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">-1</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">7</td>
<td align="center">jdate</td>
<td align="center">日期</td>
<td align="center">-1</td>
<td align="center">yyyyddd,必须与time属性一致</td>
<td align="center">年份和一年第几天 。具体内容：公元前(B.C.E)日期为负。例如没有0000000.仅用于估计S,T,C振型（Evaluated only for S,T,C）</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">9</td>
<td align="center">ndef</td>
<td align="center">定位（locating）震相索引</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">-1</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">ndp</td>
<td align="center">深度（depth）震相索引</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">-1</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">11</td>
<td align="center">grn</td>
<td align="center">地理区域索引</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">-1</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">12</td>
<td align="center">srn</td>
<td align="center">地震区域索引</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">-1</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">13</td>
<td align="center">etype</td>
<td align="center">事件类型</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">-</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">14</td>
<td align="center">depdp</td>
<td align="center">源自深度震相的估计深度</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">-999.0000</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">15</td>
<td align="center">dtype</td>
<td align="center">使用的深度方法</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">-</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">16</td>
<td align="center">mb</td>
<td align="center">体波震级</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">-999.00</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">17</td>
<td align="center">mbid</td>
<td align="center">mb 编号（magid）？</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">-1</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">18</td>
<td align="center">ms</td>
<td align="center">面波震级</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">-999.00</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">19</td>
<td align="center">msid</td>
<td align="center">ms magid 纬度</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">-1</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">20</td>
<td align="center">ml</td>
<td align="center">近震（local）震级</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">-999.00</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">21</td>
<td align="center">mlid</td>
<td align="center">ml magid</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">-1</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">22</td>
<td align="center">algorithm</td>
<td align="center">使用的定位算法</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">-</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">23</td>
<td align="center">auth</td>
<td align="center">source&#x2F;originator</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">震中参考地震记录 &amp; 震源信息来源</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">24</td>
<td align="center">commid</td>
<td align="center">comment id</td>
<td align="center">-1 No any remarks</td>
<td align="center">≥0</td>
<td align="center">数据文件。注释标识。这是用于指向预定义备注列表中的自由格式注释的整数键。尚未实施。</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">25</td>
<td align="center">lddate</td>
<td align="center">载入时间</td>
<td align="center">未说明</td>
<td align="center">任意值</td>
<td align="center">记录创建的时间，not implemented yet？</td>
<td align="center"></td>
</tr>
</tbody></table>
<p><em>注： -1、-999.00、- 可能是该项没有值或者未知。</em><br><em>6号evid为1可能是由于只有一个地震事件。目前还未尝试是否有多个地震事件的计算方式。</em></p>
<h2 id="eigen-本征关系"><a href="#eigen-本征关系" class="headerlink" title=".eigen 本征关系"></a>.eigen 本征关系</h2><p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 44 S 1 197.56850 4.55313 3.58608 151.39850 67 7 7 f4 0 test_S.eigen.dat                                                 eigen                                  -1 01/09/23-21:11:33</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th align="center">字节索引</th>
<th align="center">名称</th>
<th align="center">含义</th>
<th align="center">NA值</th>
<th align="center">取值范围</th>
<th align="center">备注</th>
<th align="center">单位</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">norder</td>
<td align="center">径向阶数 n</td>
<td align="center">-1</td>
<td align="center">未给出</td>
<td align="center">本征振型的径向阶数n</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">lorder</td>
<td align="center">角度阶数 l</td>
<td align="center">-1</td>
<td align="center">未给出</td>
<td align="center">简正振型的角阶数l，也称 harmonic degree</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">typeo</td>
<td align="center">振型类型</td>
<td align="center">不允许</td>
<td align="center">未给出</td>
<td align="center">二进制数据类型。这个字符表示数据类型。R：radial径向振型；S：球振振型；T：环振振型；C：内核环振振型；P：表示数据包括常熟（constants）、归一化参数（normalization）和半径采样点（radius samples）。</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">eigid</td>
<td align="center">eigen id</td>
<td align="center">不允许</td>
<td align="center"></td>
<td align="center">本征函数索引，这个关键字段是一个由n l和振型类型定义的本征函数数据独一无二的标识</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">per</td>
<td align="center">本征频率 周期表示</td>
<td align="center">-1</td>
<td align="center">&gt;0</td>
<td align="center">对应的本征频率。频率为w&#x3D;2*pi&#x2F;per；w的归一化值位于关联的二进制文件中。</td>
<td align="center">秒 s</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">phvel</td>
<td align="center">相速度</td>
<td align="center">-1</td>
<td align="center">&gt;0</td>
<td align="center">该振型对应的本征频率（per）的相速度。见typeo</td>
<td align="center">km&#x2F;s</td>
</tr>
<tr>
<td align="center">7</td>
<td align="center">grvel</td>
<td align="center">群速度</td>
<td align="center">-1</td>
<td align="center">&gt;0</td>
<td align="center">群速度。给出属性per（本征频率）对应的量级值的群速度。仅评估S,T和C振型，见typeo</td>
<td align="center">km&#x2F;s</td>
</tr>
<tr>
<td align="center">8</td>
<td align="center">attn</td>
<td align="center">衰减</td>
<td align="center">-1</td>
<td align="center">&gt;0</td>
<td align="center">衰减系数Q（品质因子）</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">9</td>
<td align="center">nrow</td>
<td align="center">行号</td>
<td align="center">不允许</td>
<td align="center">&gt;0</td>
<td align="center">二进制文件中存储的本征函数网格（grid）的行号</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">ncol</td>
<td align="center">列号</td>
<td align="center">-1</td>
<td align="center">未说明</td>
<td align="center">二进制文件中存储的本征函数网格（grid）的列号</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">11</td>
<td align="center">npar</td>
<td align="center">参数序号</td>
<td align="center">0</td>
<td align="center">&gt;0</td>
<td align="center">？二进制文件中存储的参数的序号</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">12</td>
<td align="center">datatype</td>
<td align="center">数值存储</td>
<td align="center">不允许</td>
<td align="center">t4或f4</td>
<td align="center">数值存储数据。该属性指定文档系统中数据序列的格式。属性用于在必要时以实数交换四个字节。f4用于PC、DEC、VAX IEEE，单精度实型；t4用于SUN IEEE，单精度实型</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">13</td>
<td align="center">foff</td>
<td align="center">字节偏移量</td>
<td align="center">不允许</td>
<td align="center">≥0</td>
<td align="center">这是数据文档中特征函数段的字节偏移量。见dir和dfile</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">14</td>
<td align="center">dir</td>
<td align="center">所在目录</td>
<td align="center">不允许</td>
<td align="center">任意64个字符的字符串</td>
<td align="center">路径名的目录部分，包含特征关系的当前目录的相对路径</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">15</td>
<td align="center">dfile</td>
<td align="center">文件名称</td>
<td align="center">不允许</td>
<td align="center">任意32个字符的字符串</td>
<td align="center">数据文件。指多路特征函数文件。</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">16</td>
<td align="center">commid</td>
<td align="center">注释标识（comment id）</td>
<td align="center">-1 No any remarks</td>
<td align="center">≥0</td>
<td align="center">数据文件。注释标识。这是用于指向预定义备注列表中的自由格式注释的整数键。尚未实施。</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">17</td>
<td align="center">lddate</td>
<td align="center">载入时间</td>
<td align="center">未说明</td>
<td align="center">任意值</td>
<td align="center">记录创建的时间，not implemented yet？</td>
<td align="center"></td>
</tr>
</tbody></table>
<h2 id="site-台站位置信息"><a href="#site-台站位置信息" class="headerlink" title=".site 台站位置信息"></a>.site 台站位置信息</h2><p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ANMO 1960001 -1 34.9462 -106.4567 1.7400 Albuquerque, New Mexico, USA - - 0.0000 0.0000 01/08/23-21:43:39</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th align="center">字节索引</th>
<th align="center">名称</th>
<th align="center">含义</th>
<th align="center">NA值</th>
<th align="center">取值范围</th>
<th align="center">备注</th>
<th align="center">单位</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">sta</td>
<td align="center">台站码</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">ondate</td>
<td align="center">儒略开始日期</td>
<td align="center">不允许</td>
<td align="center">yyyyddd</td>
<td align="center">台站或者传感器其实日期。台站经常移动，但是台站码不变。该日期使得能够选择当时正确的台站lat，lon和elev。</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">offdate</td>
<td align="center">儒略终止日期</td>
<td align="center">-1</td>
<td align="center">yyyyddd</td>
<td align="center">台站或者传感器关闭、取消或移除的时间。见ondate</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">lat</td>
<td align="center">纬度</td>
<td align="center">不允许</td>
<td align="center">-90.0≤lat≤90.0</td>
<td align="center">纬度，地理纬度，北半球为正；即cmt文件中的纬度</td>
<td align="center">度 ° degrees</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">lon</td>
<td align="center">经度</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">elev</td>
<td align="center">海拔</td>
<td align="center">-999.0</td>
<td align="center">-10.0≤elev≤10.0</td>
<td align="center">地震台站相对于平均海平面的海拔</td>
<td align="center">千米 km</td>
</tr>
<tr>
<td align="center">7</td>
<td align="center">staname</td>
<td align="center">台站描述</td>
<td align="center">-</td>
<td align="center">50个字符以内的大写字符串</td>
<td align="center">sta所描述台站的全名</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">8</td>
<td align="center">statype</td>
<td align="center">台站类型：但台站，台阵等等</td>
<td align="center">-</td>
<td align="center">ss ar （小写）</td>
<td align="center">台站类型。ss：单个台站；ar：台阵</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">9</td>
<td align="center">refsta</td>
<td align="center">台站相对台阵编号</td>
<td align="center">-</td>
<td align="center">任意site关系中的sta</td>
<td align="center">参考台站。这个字符串指定使用的阵列（这个site文件中的所有台站）的参考台站。?见deast，dnorth</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">dnorth</td>
<td align="center">台阵参考偏移距</td>
<td align="center">0.0</td>
<td align="center">-20000.00≤dnorth≤20000.00</td>
<td align="center">北向距离。给出台阵（array element）元素北向或相对位置，位于由refsta值指定的台阵中心以北。见deast</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">11</td>
<td align="center">deast</td>
<td align="center">台阵参考偏移距</td>
<td align="center">0.0</td>
<td align="center">-20000.00≤deast≤20000.00</td>
<td align="center">向东距离。此属性给出台阵元素的“东向”或相对位置，位于由 refsta 值指定的台阵中心以东。见dnorth。</td>
<td align="center">千米 km</td>
</tr>
<tr>
<td align="center">12</td>
<td align="center">lddate</td>
<td align="center">载入时间</td>
<td align="center">未说明</td>
<td align="center">任意值</td>
<td align="center">记录创建的时间，not implemented yet？</td>
<td align="center"></td>
</tr>
</tbody></table>
<h2 id="sitechan-台站通道信息"><a href="#sitechan-台站通道信息" class="headerlink" title=".sitechan 台站通道信息"></a>.sitechan 台站通道信息</h2><p>示例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ANMO LHE 1960001 -1 -1 n 100.0000 90.0 90.0 - 01/08/23-21:43:39</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th align="center">字节索引</th>
<th align="center">名称</th>
<th align="center">含义</th>
<th align="center">NA值</th>
<th align="center">取值范围</th>
<th align="center">备注</th>
<th align="center">单位</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">sta</td>
<td align="center">台站码</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">chan</td>
<td align="center">通道码</td>
<td align="center">需要有效值</td>
<td align="center">3个大写字母</td>
<td align="center">通道码，具体可在搜索中查找</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">ondate</td>
<td align="center">儒略开始日期</td>
<td align="center">不允许</td>
<td align="center">yyyyddd</td>
<td align="center">台站或者传感器其实日期。台站经常移动，但是台站码不变。该日期使得能够选择当时正确的台站lat，lon和elev。</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">chanid</td>
<td align="center">通道id</td>
<td align="center">-1</td>
<td align="center">&gt;0</td>
<td align="center">通道记录标识。是一个独立标识一个特殊记录的代理键（surrogate key）。作为单个标识符，表示sta、chan、time更加方便。但是这三个值对处理人员更加直观。</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">offdate</td>
<td align="center">儒略结束日期</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">ctype</td>
<td align="center">通道类型</td>
<td align="center">-</td>
<td align="center">小写字母n或b或i</td>
<td align="center">表示数据通道类型。n：正常仪器响应；b：台阵数据确定的相干波形？；i：能量叠加的非相干波形？</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">7</td>
<td align="center">edepth</td>
<td align="center">安置深度</td>
<td align="center">不允许</td>
<td align="center">≥0.0</td>
<td align="center">仪器位置的深度，相对于site关系中的elev（台站海拔）</td>
<td align="center">千米 km</td>
</tr>
<tr>
<td align="center">8</td>
<td align="center">hang</td>
<td align="center">水平角</td>
<td align="center">不允许</td>
<td align="center">0.0≤hang≤360.0</td>
<td align="center">地震仪的水平方向。给出地震仪在水平平面上的指向，由正北顺时针。NS走向地震仪指向北，为0；WE走向地震仪指向西，为270</td>
<td align="center">度，° degrees</td>
</tr>
<tr>
<td align="center">9</td>
<td align="center">vang</td>
<td align="center">垂直角</td>
<td align="center">不允许</td>
<td align="center">0.0≤vang≤90.0</td>
<td align="center">地震仪的垂向指向。此属性测量地震仪的敏感轴与向外垂直方向之间的角度。对于垂直走向地震仪，vang&#x3D;0；水平走向地震仪，vang&#x3D;90</td>
<td align="center">度 ° degrees</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">descrip</td>
<td align="center">通道描述</td>
<td align="center">-</td>
<td align="center">50字节长度的任意格式字符串</td>
<td align="center">通道描述，数据通道的描述。对于非仪器通道（例如beams）这是在核心列表的通道选择中仅有的定量描述</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">11</td>
<td align="center">lddate</td>
<td align="center">载入时间</td>
<td align="center">未说明</td>
<td align="center">任意值</td>
<td align="center">记录创建的时间，not implemented yet？</td>
<td align="center"></td>
</tr>
</tbody></table>
<h2 id="wfdisc-波形文件头信息和描述信息"><a href="#wfdisc-波形文件头信息和描述信息" class="headerlink" title="wfdisc 波形文件头信息和描述信息"></a>wfdisc 波形文件头信息和描述信息</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ANMO SHZ 393567535.30000 1 6 1982173 393615534.30000 48000 1.0000000 1.000000 20.000000 - g f4 - green.wfdisc.dat g.00001 0 -1 01/09/23-21:11:33</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th align="center">字节索引</th>
<th align="center">名称</th>
<th align="center">含义</th>
<th align="center">NA值</th>
<th align="center">取值范围</th>
<th align="center">备注</th>
<th align="center">单位</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">sta</td>
<td align="center">台站码</td>
<td align="center">需要有效输入</td>
<td align="center">6个字符的大写字符串</td>
<td align="center">台站码，或者地震台的common code name。通常为3或4个字符</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">chan</td>
<td align="center">通道码</td>
<td align="center">需要有效值</td>
<td align="center">3个大写字母</td>
<td align="center">通道码，具体可在搜索中查找</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">time</td>
<td align="center">文件中第一个采样点的地质时间（epoch time）</td>
<td align="center">不允许</td>
<td align="center">未说明</td>
<td align="center">从1970年1月1日0时为起始点计算的秒数。存储为双精度浮点型，允许15个十进制数字。范围可达3*10^4年。</td>
<td align="center">秒s</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">wfid</td>
<td align="center">波形id，这里是一个索引值，相当于行数</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">chanid</td>
<td align="center">通道操作id</td>
<td align="center">-1</td>
<td align="center">&gt;0</td>
<td align="center">通道记录标识。是一个独立标识一个特殊记录的代理键（surrogate key）。作为单个标识符，表示sta、chan、time更加方便。但是这三个值对处理人员更加直观。</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">jdate</td>
<td align="center">儒略（julian）日期</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">7</td>
<td align="center">endtime</td>
<td align="center">注意！详细查看备注time*(nsamp-1)&#x2F;samprate</td>
<td align="center">+9999999999（10个9）.999</td>
<td align="center">endtime&gt;time</td>
<td align="center">endtime&#x3D;time+（nsamp-1）&#x2F;samprate（这里与前面的含义不一样，源文档如此。这里认为此处+为正确）</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">8</td>
<td align="center">nsamp</td>
<td align="center">采样点个数</td>
<td align="center">不允许</td>
<td align="center">&gt;0</td>
<td align="center">采样点个数，波形段的采样点数量</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">9</td>
<td align="center">samprate</td>
<td align="center">采样率，单位s^-1</td>
<td align="center">不允许</td>
<td align="center">&gt;0</td>
<td align="center">samples&#x2F;second。该值可能与标称值略有不同，以反映时钟漂移。？</td>
<td align="center">s^-1</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">calib</td>
<td align="center">标称校准</td>
<td align="center">不允许</td>
<td align="center">任意非0浮点数</td>
<td align="center">校准系数，即映射数字数据到地球位移的转换系数。该系数在属性calper规定的自由振荡周期内成立。正值表示分量方向的地面位移增量（分量方向，如z、n、e）由增值表示（），负值相反。该值通常反映记录时可用的最佳校准信息。</td>
<td align="center">nanometers或digital count</td>
</tr>
<tr>
<td align="center">11</td>
<td align="center">calper</td>
<td align="center">标称较准周期</td>
<td align="center">不允许</td>
<td align="center">&gt;0</td>
<td align="center">calib有效时规定周期。</td>
<td align="center">秒，s</td>
</tr>
<tr>
<td align="center">12</td>
<td align="center">instype</td>
<td align="center">仪器码</td>
<td align="center">-</td>
<td align="center">大写字母，不计数。详见Ganse and Hutt,1982</td>
<td align="center">标识仪器类型，例如SRO、ASRO以及S-750</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">13</td>
<td align="center">segtype</td>
<td align="center">标引（indexing）方法</td>
<td align="center">-</td>
<td align="center">o v s d g w</td>
<td align="center">segment type。段类型。波形为：o（original）原始；v（virtual）虚拟的；s（segmented）分离的？；d（duplicate）副本；g（Green’s function）格林函数；w（synthetic）合成记录</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">14</td>
<td align="center">datatype</td>
<td align="center">数值存储</td>
<td align="center">不允许</td>
<td align="center">t4或f4</td>
<td align="center">数值存储数据。该属性指定文档系统中数据序列的格式。属性用于在必要时以实数交换四个字节。f4用于PC、DEC、VAX IEEE，单精度实型；t4用于SUN IEEE，单精度实型</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">15</td>
<td align="center">clip</td>
<td align="center">削减（clipped）标志</td>
<td align="center">-</td>
<td align="center">{c n} 小写字母</td>
<td align="center">一个字符指示数据是否削减。c表示是，n表示否</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">16</td>
<td align="center">dir</td>
<td align="center">所在文件夹</td>
<td align="center">不允许</td>
<td align="center">任意64个字符的字符串</td>
<td align="center">路径名的目录部分，包含特征关系的当前目录的相对路径</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">17</td>
<td align="center">dfile</td>
<td align="center">文件名</td>
<td align="center">不允许</td>
<td align="center">任意32个字符长度的字符串</td>
<td align="center">disk waveform？的名称或者单分量格林函数的名称。</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">18</td>
<td align="center">foff</td>
<td align="center">字节偏移量</td>
<td align="center">不允许</td>
<td align="center">≥0</td>
<td align="center">这是数据文档中特征函数段的字节偏移量。见dir和dfile</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">19</td>
<td align="center">commid</td>
<td align="center">注释标识（comment id）</td>
<td align="center">-1 No any remarks</td>
<td align="center">≥0</td>
<td align="center">数据文件。注释标识。这是用于指向预定义备注列表中的自由格式注释的整数键。尚未实施。</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">20</td>
<td align="center">lddate</td>
<td align="center">载入时间</td>
<td align="center">未说明</td>
<td align="center">任意值</td>
<td align="center">记录创建的时间，not implemented yet？</td>
<td align="center"></td>
</tr>
</tbody></table>
<h1 id="振型计算数量"><a href="#振型计算数量" class="headerlink" title="振型计算数量"></a>振型计算数量</h1><p>由模型文件prem_S等得到S与T振型w范围为5-200mHz下的计算数量。目前统计到n&#x3D;19的情况。<br>计算数量与w范围有关，即计算振型的频率范围有关。</p>
<h2 id="S-振型"><a href="#S-振型" class="headerlink" title="S 振型"></a>S 振型</h2><table>
<thead>
<tr>
<th align="center">n</th>
<th align="center">lmin</th>
<th align="center">lmax</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0</td>
<td align="center">44</td>
<td align="center">4653</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">28</td>
<td align="center">2566</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">24</td>
<td align="center">1945</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">23</td>
<td align="center">1792</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">18</td>
<td align="center">1775</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">14</td>
<td align="center">1760</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">13</td>
<td align="center">1742</td>
</tr>
<tr>
<td align="center">7</td>
<td align="center">12</td>
<td align="center">1721</td>
</tr>
<tr>
<td align="center">8</td>
<td align="center">9</td>
<td align="center">1695</td>
</tr>
<tr>
<td align="center">9</td>
<td align="center">8</td>
<td align="center">1667</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">7</td>
<td align="center">1643</td>
</tr>
<tr>
<td align="center">11</td>
<td align="center">5</td>
<td align="center">1627</td>
</tr>
<tr>
<td align="center">12</td>
<td align="center">4</td>
<td align="center">1611</td>
</tr>
<tr>
<td align="center">13</td>
<td align="center">3</td>
<td align="center">1597</td>
</tr>
<tr>
<td align="center">14</td>
<td align="center">2</td>
<td align="center">1582</td>
</tr>
<tr>
<td align="center">15</td>
<td align="center">1</td>
<td align="center">1566</td>
</tr>
<tr>
<td align="center">16</td>
<td align="center">1</td>
<td align="center">1549</td>
</tr>
<tr>
<td align="center">17</td>
<td align="center">1</td>
<td align="center">1530</td>
</tr>
<tr>
<td align="center">18</td>
<td align="center">1</td>
<td align="center">1510</td>
</tr>
<tr>
<td align="center">19</td>
<td align="center">1</td>
<td align="center">1491</td>
</tr>
</tbody></table>
<h2 id="T-振型"><a href="#T-振型" class="headerlink" title="T 振型"></a>T 振型</h2><table>
<thead>
<tr>
<th align="center">n</th>
<th align="center">lmin</th>
<th align="center">lmax</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0</td>
<td align="center">41</td>
<td align="center">2410</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">27</td>
<td align="center">1903</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">20</td>
<td align="center">1745</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">16</td>
<td align="center">1735</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">12</td>
<td align="center">1722</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">1</td>
<td align="center">1706</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">1</td>
<td align="center">1685</td>
</tr>
<tr>
<td align="center">7</td>
<td align="center">1</td>
<td align="center">1661</td>
</tr>
<tr>
<td align="center">8</td>
<td align="center">1</td>
<td align="center">1640</td>
</tr>
<tr>
<td align="center">9</td>
<td align="center">1</td>
<td align="center">1627</td>
</tr>
<tr>
<td align="center">10</td>
<td align="center">1</td>
<td align="center">1611</td>
</tr>
<tr>
<td align="center">11</td>
<td align="center">1</td>
<td align="center">1597</td>
</tr>
<tr>
<td align="center">12</td>
<td align="center">1</td>
<td align="center">1584</td>
</tr>
<tr>
<td align="center">13</td>
<td align="center">1</td>
<td align="center">1569</td>
</tr>
<tr>
<td align="center">14</td>
<td align="center">1</td>
<td align="center">1552</td>
</tr>
<tr>
<td align="center">15</td>
<td align="center">1</td>
<td align="center">1535</td>
</tr>
<tr>
<td align="center">16</td>
<td align="center">1</td>
<td align="center">1515</td>
</tr>
<tr>
<td align="center">17</td>
<td align="center">1</td>
<td align="center">1495</td>
</tr>
<tr>
<td align="center">18</td>
<td align="center">1</td>
<td align="center">1477</td>
</tr>
<tr>
<td align="center">19</td>
<td align="center">1</td>
<td align="center">1460</td>
</tr>
</tbody></table>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhiyuanshi1901.github.io/2022/12/22/Mineos%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/12/22/Mineos%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">Mineos安装与使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-12-22 21:57:37" itemprop="dateCreated datePublished" datetime="2022-12-22T21:57:37+08:00">2022-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-01-20 15:39:40" itemprop="dateModified" datetime="2023-01-20T15:39:40+08:00">2023-01-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%9C%B0%E9%9C%87%E5%AD%A6%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6/" itemprop="url" rel="index"><span itemprop="name">地震学常用软件</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://github.com/geodynamics/mineos">Mineos官方文档</a><br><a target="_blank" rel="noopener" href="https://www.eas.slu.edu/eqc/eqc_cps/TUTORIAL/SPHERICITY/MINEOS/HTML/index.html">Hermann_Mineos安装</a></p>
<h1 id="Mineos简介"><a href="#Mineos简介" class="headerlink" title="Mineos简介"></a>Mineos简介</h1><p>这一部分是官方文档中的第一章，此处进行翻译。</p>
<h2 id="本征函数系统"><a href="#本征函数系统" class="headerlink" title="本征函数系统"></a>本征函数系统</h2><p>minos_bran是Mineos软件包的核心程序。通过频率范围(fmin, fmax)和简正振型(nmin,nmax,lmin,lmax)，<br>minos_bran输出的大小取决于fmax，即设定的最高频率，以及输入模型的径向节点数量。如果设定的周期为6s，选择所有离散分支，则计算的本征函数和本征频率数量为：球振振型150,000个、环振振型100,000个。</p>
<p>eigcon程序执行两个主要步骤。首先对本征函数进行重归一化，截断表格数据，只延伸到考虑的最深的地震深度。即输入的max deepth参数。<br>这种截断大大减小了本征函数文件的大小，加快了格林函数计算速度。此外，eigcon重构了输出的本征函数文件为二进制文件，相比于minos_bran输出的本征函数文件独立于计算机功能结构。</p>
<p>最终的输出基于.eigen关系，指向磁盘中的本征函数文件。详细关系见[Mineos程序参数解释].eigen关系表。</p>
<p>获取.site和.sitechan文件的方式：申请SEED文件，例如IRIS DMC，然后使用rdseed或者antelope（例如sd2de seed2db)转换得到这两个文件。</p>
<p>antelope可以用来查看格林函数。</p>
<h2 id="Mineos局限性"><a href="#Mineos局限性" class="headerlink" title="Mineos局限性"></a>Mineos局限性</h2><ul>
<li><p>当前版本的Mineos使用与低频应用，而周期为几秒（即0.nHz）情况下不适用。</p>
</li>
<li><p>尝试制作衍射P波合成记录时发现内核振型（尤其是能量积分）不能够被准确计算。不确定在内核中添加节点是否能解决问题。已发表的成功事例表明：通过使用不同方式进行能量积分能够解决这个问题，这种方式不依赖于节点间距。</p>
</li>
</ul>
<h1 id="官方安装包安装"><a href="#官方安装包安装" class="headerlink" title="官方安装包安装"></a>官方安装包安装</h1><p>Mineos安装分为如下几步，目前在第二步出现问题，尚未解决。</p>
<h2 id="configure"><a href="#configure" class="headerlink" title="configure"></a>configure</h2><pre><code>./configure
</code></pre>
<p>直接使用这个命令会出现依赖环境问题。例如：<br>    check g77 … no</p>
<p>使用如下命令可以避免出现这种问题。</p>
<pre><code>./configure F77=gfortran FFLAGS=-O2
</code></pre>
<h2 id="make"><a href="#make" class="headerlink" title="make"></a>make</h2><p>使用命令：</p>
<pre><code>make
</code></pre>
<p>出现错误：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">make[1]: 进入目录“/home/shizhiyuan/Documents/mineos-1.0.0”</span><br><span class="line">gfortran  -O2 -c -o minos_bran.o minos_bran.f</span><br><span class="line">minos_bran.f:254:32:</span><br><span class="line"></span><br><span class="line">       data tol/1.d-9/,itmax/15/,ichar/&#x27; s&#x27;,&#x27; t&#x27;,&#x27; s&#x27;,&#x27; c&#x27;/</span><br><span class="line">                                1</span><br><span class="line">错误: (1)处 DATA 语句中类型不兼容；试图从 CHARACTER(1) 转换到 INTEGER(4)</span><br><span class="line">make[1]: *** [Makefile:456：minos_bran.o] 错误 1</span><br><span class="line">make[1]: 离开目录“/home/shizhiyuan/Documents/mineos-1.0.0”</span><br><span class="line">make: *** [Makefile:253：all] 错误 2</span><br></pre></td></tr></table></figure>
<p>DATA 语句中类型不兼容，目前未知解决方法。</p>
<h1 id="使用Hermann网站提供的修改过minos-bran-f文件的安装包安装更为简便，且能够安装成功。"><a href="#使用Hermann网站提供的修改过minos-bran-f文件的安装包安装更为简便，且能够安装成功。" class="headerlink" title="使用Hermann网站提供的修改过minos_bran.f文件的安装包安装更为简便，且能够安装成功。"></a>使用Hermann网站提供的修改过minos_bran.f文件的安装包安装更为简便，且能够安装成功。</h1><p>环境：Centos8</p>
<h2 id="依赖环境"><a href="#依赖环境" class="headerlink" title="依赖环境"></a>依赖环境</h2><p>Mineos依赖于:</p>
<ul>
<li>gcc</li>
<li>g77</li>
<li>f77</li>
<li>gfortran</li>
</ul>
<p>一般安装gcc-gfortran即可。</p>
<pre><code>sudo yum install gcc-gfortran
</code></pre>
<h2 id="configure-1"><a href="#configure-1" class="headerlink" title="configure"></a>configure</h2><pre><code>./configure F77=gfortran FFLAGS=-O2
</code></pre>
<h2 id="make-1"><a href="#make-1" class="headerlink" title="make"></a>make</h2><pre><code>make
</code></pre>
<p>成功的输出:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">make  all-am</span><br><span class="line">make[1]: 进入目录“/home/shizhiyuan/Documents/hermann/MINEOS/mineos-1.0.0.rbh”</span><br><span class="line">make[1]: 离开目录“/home/shizhiyuan/Documents/hermann/MINEOS/mineos-1.0.0.rbh”</span><br></pre></td></tr></table></figure>

<h2 id="make-check"><a href="#make-check" class="headerlink" title="make check"></a>make check</h2><p>不知道具体含义，运行后没有输出。可能是指检查某项内容。</p>
<h2 id="install"><a href="#install" class="headerlink" title="install"></a>install</h2><pre><code>sudo make install
</code></pre>
<p>不用sudo可能出现没有权限创建新目录的情况。</p>
<p>运行成功后的输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">make[1]: 进入目录“/home/shizhiyuan/Documents/hermann/MINEOS/mineos-1.0.0.rbh”</span><br><span class="line">test -z &quot;/usr/local/bin&quot; || /usr/bin/mkdir -p &quot;/usr/local/bin&quot;</span><br><span class="line">  /usr/bin/install -c &#x27;minos_bran&#x27; &#x27;/usr/local/bin/minos_bran&#x27;</span><br><span class="line">  /usr/bin/install -c &#x27;syndat&#x27; &#x27;/usr/local/bin/syndat&#x27;</span><br><span class="line">  /usr/bin/install -c &#x27;green&#x27; &#x27;/usr/local/bin/green&#x27;</span><br><span class="line">  /usr/bin/install -c &#x27;eigcon&#x27; &#x27;/usr/local/bin/eigcon&#x27;</span><br><span class="line">  /usr/bin/install -c &#x27;endi&#x27; &#x27;/usr/local/bin/endi&#x27;</span><br><span class="line">  /usr/bin/install -c &#x27;eigen2asc&#x27; &#x27;/usr/local/bin/eigen2asc&#x27;</span><br><span class="line">  /usr/bin/install -c &#x27;simpledit&#x27; &#x27;/usr/local/bin/simpledit&#x27;</span><br><span class="line">  /usr/bin/install -c &#x27;cucss2sac&#x27; &#x27;/usr/local/bin/cucss2sac&#x27;</span><br><span class="line">test -z &quot;/usr/local/bin&quot; || /usr/bin/mkdir -p &quot;/usr/local/bin&quot;</span><br><span class="line"> /usr/bin/install -c &#x27;scripts/creat_origin&#x27; &#x27;/usr/local/bin/creat_origin&#x27;</span><br><span class="line">test -z &quot;/usr/local/share/mineos&quot; || /usr/bin/mkdir -p &quot;/usr/local/share/mineos&quot;</span><br><span class="line"> /usr/bin/install -c -m 644 &#x27;doc/mineos.pdf&#x27; &#x27;/usr/local/share/mineos/mineos.pdf&#x27;</span><br><span class="line"> /usr/bin/install -c -m 644 &#x27;DEMO/DEMO.tar.gz&#x27; &#x27;/usr/local/share/mineos/DEMO.tar.gz&#x27;</span><br><span class="line"> /usr/bin/install -c -m 644 &#x27;DEMO/README&#x27; &#x27;/usr/local/share/mineos/README&#x27;</span><br><span class="line">make[1]: 离开目录“/home/shizhiyuan/Documents/hermann/MINEOS/mineos-1.0.0.rbh”</span><br></pre></td></tr></table></figure>

<h2 id="补充内容"><a href="#补充内容" class="headerlink" title="补充内容"></a>补充内容</h2><p>运行.csh文件需要安装csh</p>
<pre><code>sudo yum install csh
</code></pre>
<h2 id="test"><a href="#test" class="headerlink" title="test"></a>test</h2><p>先将mineos文件内DEMO文件夹中的DEMO压缩包解压。当然更推荐命令操作：</p>
<pre><code>cd DEMO
gunzip -c DEMO.tar.gz | tar xf -  # 这一步使用操作界面完成，就是解压的步骤。

export PATH=$HOME/cig/bin:$PATH # 添加变量？运行后没有输出。
cd DEMO3
./RUN_MINEOS.sh prem_noocean
</code></pre>
<p>输出结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br></pre></td><td class="code"><pre><span class="line">Step 1:  minos_bran runs for S modes .....................</span><br><span class="line">============== Program minos_bran ==================</span><br><span class="line"> input model file:</span><br><span class="line"> ../models/prem_noocean.txt</span><br><span class="line"> output file:</span><br><span class="line"> prem_noocean_S</span><br><span class="line"> eigenfunction file (output):</span><br><span class="line"> eprem_noocean_S</span><br><span class="line"> enter eps and wgrav</span><br><span class="line">   1.0000000000000000E-010   1.0000000000000000     </span><br><span class="line"> enter jcom (1=rad;2=tor;3=sph;4=ictor)</span><br><span class="line">           3</span><br><span class="line"> enter lmin,lmax,wmin,wmax,nmin,nmax</span><br><span class="line">           2        8000   0.0000000000000000        200.00000000000000                0           0</span><br><span class="line"></span><br><span class="line">real	0m1.441s</span><br><span class="line">user	0m1.433s</span><br><span class="line">sys	0m0.006s</span><br><span class="line">Step 2: minos_bran runs for T modes .....................</span><br><span class="line">============== Program minos_bran ==================</span><br><span class="line"> input model file:</span><br><span class="line"> ../models/prem_noocean.txt</span><br><span class="line"> output file:</span><br><span class="line"> prem_noocean_T</span><br><span class="line"> eigenfunction file (output):</span><br><span class="line"> eprem_noocean_T</span><br><span class="line"> enter eps and wgrav</span><br><span class="line">   1.0000000000000000E-010   1.0000000000000000     </span><br><span class="line"> enter jcom (1=rad;2=tor;3=sph;4=ictor)</span><br><span class="line">           2</span><br><span class="line"> enter lmin,lmax,wmin,wmax,nmin,nmax</span><br><span class="line">           2        8000   0.0000000000000000        200.00000000000000                0           0</span><br><span class="line"></span><br><span class="line">real	0m0.245s</span><br><span class="line">user	0m0.242s</span><br><span class="line">sys	0m0.003s</span><br><span class="line">Step 3: eigen for S .....................................</span><br><span class="line"> ============= Program eigcon ====================</span><br><span class="line">  spheroidals (3) or toroidals (2) or radial (1) or</span><br><span class="line">  inner core toroidals (4) modes</span><br><span class="line">           3</span><br><span class="line">  enter name of model file</span><br><span class="line"> ../models/prem_noocean.txt</span><br><span class="line"> enter max depth [km] : </span><br><span class="line">   1000.00000    </span><br><span class="line">  enter name of minos_bran output text file</span><br><span class="line"> prem_noocean_S</span><br><span class="line">  minos_bran output binary unformatted file name</span><br><span class="line"> eprem_noocean_S</span><br><span class="line">  enter path/dbase_name or dbase_name to store eigenfunctions:</span><br><span class="line"> test_S</span><br><span class="line"> ====================================================</span><br><span class="line"> eigcon: n,nstart,nrad =          185         119          67</span><br><span class="line"></span><br><span class="line">real	0m0.053s</span><br><span class="line">user	0m0.046s</span><br><span class="line">sys	0m0.007s</span><br><span class="line">Step 4: eigen for T .....................................</span><br><span class="line"> ============= Program eigcon ====================</span><br><span class="line">  spheroidals (3) or toroidals (2) or radial (1) or</span><br><span class="line">  inner core toroidals (4) modes</span><br><span class="line">           2</span><br><span class="line">  enter name of model file</span><br><span class="line"> ../models/prem_noocean.txt</span><br><span class="line"> enter max depth [km] : </span><br><span class="line">   1000.00000    </span><br><span class="line">  enter name of minos_bran output text file</span><br><span class="line"> prem_noocean_T</span><br><span class="line">  minos_bran output binary unformatted file name</span><br><span class="line"> eprem_noocean_T</span><br><span class="line">  enter path/dbase_name or dbase_name to store eigenfunctions:</span><br><span class="line"> test_T</span><br><span class="line"> ====================================================</span><br><span class="line"> eigcon: n,nstart,nrad =          185         119          67</span><br><span class="line"></span><br><span class="line">real	0m0.025s</span><br><span class="line">user	0m0.024s</span><br><span class="line">sys	0m0.000s</span><br><span class="line">Step 5: green functions evaluation .........................</span><br><span class="line"> ============= Program green ====================</span><br><span class="line"> enter path to db with sta &amp; stachan:</span><br><span class="line"> short</span><br><span class="line"> enter name of file within list of nmodes db:</span><br><span class="line"> db_list</span><br><span class="line"> enter input CMT file name:</span><br><span class="line"> china_cmt_event</span><br><span class="line"> min and max frequencies to be considered (mHz) : </span><br><span class="line">   10.0000000       260.000000    </span><br><span class="line"> enter # pts in greens fns .le.        30000  :</span><br><span class="line">        8000</span><br><span class="line"> enter Green functions output db file name:</span><br><span class="line"> green</span><br><span class="line"> ====================================================</span><br><span class="line"> green: Event: B011400F  2000  14 23:37:10.800 lat =   25.390, lon =   101.400</span><br><span class="line"> green:        source depth = 33.0 km</span><br><span class="line"> green: step =    1.000 sec, nsamples =   8000</span><br><span class="line"> green: # sph. modes in band =        2596   must be .le.       300000</span><br><span class="line"> green: # tor. modes in band =        2352   must be .le.       300000</span><br><span class="line"> green: Input dbname : short</span><br><span class="line"> green: Station: ALE      82.5033  -62.3500 , Channels: 3</span><br><span class="line"> green: Channel: #            1   ALE   LHZ        0.00000000       0.00000000    </span><br><span class="line"> green: Channel: #            2   ALE   LHN        0.00000000       90.0000000    </span><br><span class="line"> green: Channel: #            3   ALE   LHE        90.0000000       90.0000000    </span><br><span class="line"> green: Epicentral Distance :     72.020</span><br><span class="line"> green: Azimuth of Source   :     15.433</span><br><span class="line"> green:    1 ALE    LHZ     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:    2 ALE    LHN     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:    3 ALE    LHE     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green: Station: ANMO     34.9502 -106.4602 , Channels: 3</span><br><span class="line"> green: Channel: #            1   ANMO  LHZ        0.00000000       0.00000000    </span><br><span class="line"> green: Channel: #            2   ANMO  LH2        10.0000000       90.0000000    </span><br><span class="line"> green: Channel: #            3   ANMO  LH1        280.000000       90.0000000    </span><br><span class="line"> green: Epicentral Distance :    114.439</span><br><span class="line"> green: Azimuth of Source   :    -27.665</span><br><span class="line"> green:    4 ANMO   LHZ     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:    5 ANMO   LH2     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:    6 ANMO   LH1     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green: Station: BAK      35.3441 -119.1043 , Channels: 3</span><br><span class="line"> green: Channel: #            1   BAK   BHZ        0.00000000       0.00000000    </span><br><span class="line"> green: Channel: #            2   BAK   BHN        0.00000000       90.0000000    </span><br><span class="line"> green: Channel: #            3   BAK   BHE        90.0000000       90.0000000    </span><br><span class="line"> green: Epicentral Distance :    108.462</span><br><span class="line"> green: Azimuth of Source   :    -38.270</span><br><span class="line"> green:    7 BAK    BHZ     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:    8 BAK    BHN     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:    9 BAK    BHE     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green: Station: BDFB    -15.6418  -48.0148 , Channels: 3</span><br><span class="line"> green: Channel: #            1   BDFB  LHZ        0.00000000       0.00000000    </span><br><span class="line"> green: Channel: #            2   BDFB  LHN        0.00000000       90.0000000    </span><br><span class="line"> green: Channel: #            3   BDFB  LHE        90.0000000       90.0000000    </span><br><span class="line"> green: Epicentral Distance :    149.822</span><br><span class="line"> green: Azimuth of Source   :     66.283</span><br><span class="line"> green:   10 BDFB   LHZ     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   11 BDFB   LHN     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   12 BDFB   LHE     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green: Station: BILL     68.0651  166.4524 , Channels: 3</span><br><span class="line"> green: Channel: #            1   BILL  LHZ        0.00000000       0.00000000    </span><br><span class="line"> green: Channel: #            2   BILL  LHN        0.00000000       90.0000000    </span><br><span class="line"> green: Channel: #            3   BILL  LHE        90.0000000       90.0000000    </span><br><span class="line"> green: Epicentral Distance :     57.417</span><br><span class="line"> green: Azimuth of Source   :   -103.266</span><br><span class="line"> green:   13 BILL   LHZ     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   14 BILL   LHN     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   15 BILL   LHE     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green: Station: BJT      40.0183  116.1679 , Channels: 3</span><br><span class="line"> green: Channel: #            1   BJT   LHZ        0.00000000       0.00000000    </span><br><span class="line"> green: Channel: #            2   BJT   LHN        0.00000000       90.0000000    </span><br><span class="line"> green: Channel: #            3   BJT   LHE        90.0000000       90.0000000    </span><br><span class="line"> green: Epicentral Distance :     19.123</span><br><span class="line"> green: Azimuth of Source   :   -135.267</span><br><span class="line"> green:   16 BJT    LHZ     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   17 BJT    LHN     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   18 BJT    LHE     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green: Station: BRVK     53.0581   70.2828 , Channels: 3</span><br><span class="line"> green: Channel: #            1   BRVK  LHZ        0.00000000       0.00000000    </span><br><span class="line"> green: Channel: #            2   BRVK  LHN        0.00000000       90.0000000    </span><br><span class="line"> green: Channel: #            3   BRVK  LHE        90.0000000       90.0000000    </span><br><span class="line"> green: Epicentral Distance :     36.158</span><br><span class="line"> green: Azimuth of Source   :    127.603</span><br><span class="line"> green:   19 BRVK   LHZ     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   20 BRVK   LHN     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   21 BRVK   LHE     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green: Station: CASY    -66.2792  110.5364 , Channels: 3</span><br><span class="line"> green: Channel: #            1   CASY  LHZ        0.00000000       0.00000000    </span><br><span class="line"> green: Channel: #            2   CASY  LHN        180.000000       90.0000000    </span><br><span class="line"> green: Channel: #            3   CASY  LHE        270.000000       90.0000000    </span><br><span class="line"> green: Epicentral Distance :     91.644</span><br><span class="line"> green: Azimuth of Source   :     -8.261</span><br><span class="line"> green:   22 CASY   LHZ     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   23 CASY   LHN     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   24 CASY   LHE     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green: Station: CCM      38.0557  -91.2446 , Channels: 3</span><br><span class="line"> green: Channel: #            1   CCM   LHZ        0.00000000       0.00000000    </span><br><span class="line"> green: Channel: #            2   CCM   LHN        0.00000000       90.0000000    </span><br><span class="line"> green: Channel: #            3   CCM   LHE        90.0000000       90.0000000    </span><br><span class="line"> green: Epicentral Distance :    115.783</span><br><span class="line"> green: Azimuth of Source   :    -12.703</span><br><span class="line"> green:   25 CCM    LHZ     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   26 CCM    LHN     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   27 CCM    LHE     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green: Station: TLY      51.6807  103.6438 , Channels: 3</span><br><span class="line"> green: Channel: #            1   TLY   LHZ        0.00000000       0.00000000    </span><br><span class="line"> green: Channel: #            2   TLY   LHN        0.00000000       90.0000000    </span><br><span class="line"> green: Channel: #            3   TLY   LHE        90.0000000       90.0000000    </span><br><span class="line"> green: Epicentral Distance :     26.308</span><br><span class="line"> green: Azimuth of Source   :   -175.417</span><br><span class="line"> green:   28 TLY    LHZ     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   29 TLY    LHN     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"> green:   30 TLY    LHE     2000  14 23:37:10.800    1.000  48000</span><br><span class="line"></span><br><span class="line">real	0m1.470s</span><br><span class="line">user	0m1.458s</span><br><span class="line">sys	0m0.010s</span><br><span class="line">Step 6: synthetic seismogram construction ..................</span><br><span class="line"> ============== Program syndat ==================</span><br><span class="line"> enter input CMT file name:</span><br><span class="line"> china_cmt_event</span><br><span class="line"> enter tensor type: 0 - moment, 1 - nodal plane 1, 2 - nodal plane 2</span><br><span class="line">           0</span><br><span class="line"> enter input dbname</span><br><span class="line"> green</span><br><span class="line"> enter output dbname</span><br><span class="line"> Syndat</span><br><span class="line"> Enter output units: 0 [nm/s/s] 1 [nm/s] 2 [nm]</span><br><span class="line">syndat: CMT solution:</span><br><span class="line">syndat: Event: B011400F 2000  14 23: 37: 10.8, lat/lon =    25.39   101.40,</span><br><span class="line">syndat: depth =   33.0 km, step =    1.000 sec, Duration =  -2.3 sec,</span><br><span class="line">syndat: M0 =   0.833E+25,</span><br><span class="line">syndat: comp:  -0.600E+24 -0.629E+25  0.689E+25 -0.185E+25  0.120E+24 -0.473E+25</span><br><span class="line">syndat: plane1:   27.  78.  -6. plane2:  118.  84.-168.</span><br><span class="line">syndat: Selected moment tensor components:</span><br><span class="line">syndat: -0.600E+24 -0.629E+25  0.689E+25 -0.185E+25  0.120E+24 -0.473E+25</span><br><span class="line"></span><br><span class="line">syndat: Synthetic waveforms: </span><br><span class="line">syndat:    1 ALE    LHZ         1.000    8000</span><br><span class="line">syndat:    2 ALE    LHN         1.000    8000</span><br><span class="line">syndat:    3 ALE    LHE         1.000    8000</span><br><span class="line">syndat:    4 ANMO   LHZ         1.000    8000</span><br><span class="line">syndat:    5 ANMO   LH2         1.000    8000</span><br><span class="line">syndat:    6 ANMO   LH1         1.000    8000</span><br><span class="line">syndat:    7 BAK    BHZ         1.000    8000</span><br><span class="line">syndat:    8 BAK    BHN         1.000    8000</span><br><span class="line">syndat:    9 BAK    BHE         1.000    8000</span><br><span class="line">syndat:   10 BDFB   LHZ         1.000    8000</span><br><span class="line">syndat:   11 BDFB   LHN         1.000    8000</span><br><span class="line">syndat:   12 BDFB   LHE         1.000    8000</span><br><span class="line">syndat:   13 BILL   LHZ         1.000    8000</span><br><span class="line">syndat:   14 BILL   LHN         1.000    8000</span><br><span class="line">syndat:   15 BILL   LHE         1.000    8000</span><br><span class="line">syndat:   16 BJT    LHZ         1.000    8000</span><br><span class="line">syndat:   17 BJT    LHN         1.000    8000</span><br><span class="line">syndat:   18 BJT    LHE         1.000    8000</span><br><span class="line">syndat:   19 BRVK   LHZ         1.000    8000</span><br><span class="line">syndat:   20 BRVK   LHN         1.000    8000</span><br><span class="line">syndat:   21 BRVK   LHE         1.000    8000</span><br><span class="line">syndat:   22 CASY   LHZ         1.000    8000</span><br><span class="line">syndat:   23 CASY   LHN         1.000    8000</span><br><span class="line">syndat:   24 CASY   LHE         1.000    8000</span><br><span class="line">syndat:   25 CCM    LHZ         1.000    8000</span><br><span class="line">syndat:   26 CCM    LHN         1.000    8000</span><br><span class="line">syndat:   27 CCM    LHE         1.000    8000</span><br><span class="line">syndat:   28 TLY    LHZ         1.000    8000</span><br><span class="line">syndat:   29 TLY    LHN         1.000    8000</span><br><span class="line">syndat:   30 TLY    LHE         1.000    8000</span><br><span class="line"></span><br><span class="line">real	0m0.006s</span><br><span class="line">user	0m0.002s</span><br><span class="line">sys	0m0.004s</span><br></pre></td></tr></table></figure>

<h1 id="文件运行初步解析"><a href="#文件运行初步解析" class="headerlink" title="文件运行初步解析"></a>文件运行初步解析</h1><h2 id="运行1"><a href="#运行1" class="headerlink" title="运行1"></a>运行1</h2><pre><code>cd DEMO3
./RUN_MINEOS.sh prem_noocean
</code></pre>
<p>输出如上<code>test</code>。</p>
<p>以下为 <code>运行1</code> 运行之后前后对比。<br><img src="%E5%B7%A6%E4%BE%A7%E4%B8%BA%E8%BF%90%E8%A1%8C%E5%90%8E%E7%9A%84%E5%8F%B3%E4%BE%A7%E4%B8%BA%E8%BF%90%E8%A1%8C%E5%89%8D%E7%9A%84.png"></p>
<p>以下进行初步解析。</p>
<p>据<code>minos_bran.f</code>文件</p>
<p><em>Files prem_noocean_S. prem_noocean_T, eprem_noocean_S and eprem_noocean_T are output of the minos_bran program.</em></p>
<p>minos_bran输出的文件为：<code>prem_noocean_S</code>,<code>prem_noocean_T</code>, <code>eprem_noocean_S</code>和<code>eprem_noocean_T</code>。</p>
<p>以及</p>
<p><em>The results are stored in test_S and test_T databases (eigenfunctions); in green database (Green functions); and in Syndat (synthetic seismograms).</em></p>
<p><code>test_S.eigen.dat</code> 、<code>test_T.eigen.dat</code> 是eigenfunctions,即特征函数。但还有两个同名.eigen文件。 <code>green.wfdisc.dat</code>为格林函数，<code>Syndat.wfdisc.dat</code>为理论地震图。</p>
<h3 id="第一步：运行minos-bran。S-modes-S振型？"><a href="#第一步：运行minos-bran。S-modes-S振型？" class="headerlink" title="第一步：运行minos_bran。S modes S振型？"></a>第一步：运行minos_bran。S modes S振型？</h3><p>输入为：<code>/models/prem_noocean.txt</code>，即prem模型，该模型将海洋处用上地壳填充。</p>
<p>输出为： <code>prem_noocean_S</code>。</p>
<p>特征函数文件：<code>eprem_noocean_S</code>。 </p>
<pre><code>eps： 1e-10 
wgrav： 1 
jcom： 为3,表示为球型振型。
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">输入的参数：</span><br><span class="line">lmin 2</span><br><span class="line">lmax 8000</span><br><span class="line">wmin 0</span><br><span class="line">wmax 200</span><br><span class="line">nmin 0</span><br><span class="line">nmax 0</span><br></pre></td></tr></table></figure>

<p>使用time命令运行minos_bran程序，返回程序运行时间。具体含义可参考Linux系统命令。<br><strong>注：使用time命令可以直接运行当前目录之外的程序。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">real	0m1.450s</span><br><span class="line">user	0m1.441s</span><br><span class="line">sys	0m0.007s</span><br></pre></td></tr></table></figure>

<h3 id="第二步：运行minos-bran-Tmodes-T振型？"><a href="#第二步：运行minos-bran-Tmodes-T振型？" class="headerlink" title="第二步：运行minos_bran Tmodes T振型？"></a>第二步：运行minos_bran Tmodes T振型？</h3><p>屏幕上的输出大意：</p>
<p>输入同样为<code>/models/prem_noocean.txt</code></p>
<p>输出为： <code>prem_noocean_T</code></p>
<p>特征函数文件：<code>eprem_noocean_T</code></p>
<pre><code>eps： 1e-10
wgrav： 1
jcom： 2

输入的参数：
lmin 2
lmax 8000
wmin 0
wmax 200
nmin 0
nmax 0

输出？？？
real	0m0.243s
user	0m0.242s
sys	0m0.000s
</code></pre>
<h3 id="第三步-S-model-eigen"><a href="#第三步-S-model-eigen" class="headerlink" title="第三步 S model-eigen"></a>第三步 S model-eigen</h3><p>运行的程序为eigcon，它的功能是：</p>
<p><em>converts eigenfunction files (output from minos_bran) into .eigen relation containing only info about the upper most<br>dmax km  ( 0 &lt; dmax &lt; Rn), where, RO is radius of the free surface in km. This version works for all modes: spheroidal, toroidal, and radial.</em></p>
<p>将minos_bran的输出文件转换为.eigen，仅包含最上层dmax km ( 0 &lt; dmax &lt; Rn) 的信息。R0是自由界面半径（单位km）。<br>他能够运行于所有振型，自动读取输入文件的振型。</p>
<p>这一步读取控制参数。</p>
<pre><code>读取了输入文件的jcom。
输入的模型文件名称：``prem_noocean.text``
输入的最大深度（max depth，km）：``1000``
minos_bran的输出文件： ``prem_noocean_S``
minos_bran的输出无格式二进制文件：``eprem_noocean_S``
</code></pre>
<p>输入路径或名称，存储特征函数。其中，输入方式为两种：路径<code>path/dbase_name</code>或名称<code>dbase_name</code>。<br>创建的文件为：<code>dbase_name.eigen</code>， 创建的文件夹为<code>dbase_name.eigen.dat</code>，文件夹中有二进制文件<code>eigen</code>。</p>
<p>在屏幕运行输出仅输出了三个参数：</p>
<pre><code>n 185
nstart 119
nrad 67
</code></pre>
<p>结尾有：</p>
<pre><code>real	0m0.046s
user	0m0.043s
sys	0m0.003s
</code></pre>
<h3 id="第四步-关于T的eigen，同3。"><a href="#第四步-关于T的eigen，同3。" class="headerlink" title="第四步 关于T的eigen，同3。"></a>第四步 关于T的eigen，同3。</h3><p>记录屏幕上输出的内容：</p>
<pre><code>jcom 2
输入的模型文件名称：prem_noocean.text
输入的最大深度（max depth，km）：1000
minos_bran的输出文件： prem_noocean_T
minos_bran的输出无格式二进制文件：eprem_noocean_T
路径：test_T

n 185
nstart 119
nrad 67

real	0m0.024s
user	0m0.021s
sys	0m0.003s
</code></pre>
<p>输出的<code>test_S.eigen</code> 和<code>test_S.eigen.dat</code>:<br><img src="test_S%E6%96%87%E4%BB%B6%E5%A4%B9.png"><br><img src="test_S.eigen.dat%E6%96%87%E4%BB%B6.png"></p>
<h3 id="第五步：格林函数估值（evaluation）"><a href="#第五步：格林函数估值（evaluation）" class="headerlink" title="第五步：格林函数估值（evaluation）"></a>第五步：格林函数估值（evaluation）</h3><p>运行的程序为：green.f</p>
<p> <em>green program computes for a single event and a given set of stations, the Green functions.</em><br>这个程序计算单个事件和一组给定的台站。</p>
<p>输入db的路径，结合sta和stachan：short <strong>这两个文件一开始就有</strong><br>short是指<code>shrot.site</code>这个文件和<code>short.sitechan</code>文件，‘结合sta，stachan’可能是指这两个文件。</p>
<p>文件内容如下：<br><img src="short%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9.png"></p>
<p>输入nmodes列表的文件名 ：<code>db_list</code> <strong>这个文件一开始就有</strong></p>
<p>db_list文件内容为：</p>
<pre><code>test_S
test_T
</code></pre>
<p>输入CMT文件名： <code>china_cmt_event</code> <strong>这个文件一开始就有</strong></p>
<p>考虑的最小和最大频率（单位mHz）：10 260</p>
<p>输入pts</p>
<p>输入格林函数的输出文件名：<code>green</code>。这个程序输出的文件为：<code>green.wfdisc</code><br><strong>这个文件内容与屏幕输出不同，但是其包含的内容一致。均为台站、通道、时间等信息。</strong></p>
<p>输出依然存在：</p>
<pre><code>real	0m1.471s
user	0m1.455s
sys	0m0.015s
</code></pre>
<h3 id="第六步：构建理论地震图"><a href="#第六步：构建理论地震图" class="headerlink" title="第六步：构建理论地震图"></a>第六步：构建理论地震图</h3><p>使用的程序为：<code>syndat.f</code></p>
<p><em>syndat program makes synthetic seismograms by convolutions of Green<br>functions with the seismic moment tensor of the choosen event.</em></p>
<p><strong>选择的事件的地震矩张量和格林函数的卷积，得到理论地震图。</strong></p>
<p>输入CMT文件名：<code>china_cmt_event</code><br>张量类型： 0</p>
<p>输入dbname： green</p>
<p>输出dbname：SYndat</p>
<p>输出单位： 0 [nm&#x2F;s&#x2F;s] 1 [nm&#x2F;s] 2 [nm]<br>（可能并没有选择输出单位？屏幕输出仅为此。）</p>
<p>该程序最后输出的文件为：<code>syndat.wfdisc</code>。</p>
<p>也输出了<code>.origin</code>、<code>.site</code>、<code>.sitechan</code>文件。</p>
<p>也有<code>Syndat.wfdisc.dat</code>，里面应该是理论地震图。</p>
<p>之后需要运行将理论地震图转换为sac格式的程序。这一步为运行2的内容。</p>
<h2 id="运行2"><a href="#运行2" class="headerlink" title="运行2"></a>运行2</h2><pre><code>cucss2sac Syndat Syndat_SAC
</code></pre>
<p>将理论地震图转化为sac格式，并保存在Syndat_SAC文件夹中。</p>
<h2 id="运行3"><a href="#运行3" class="headerlink" title="运行3"></a>运行3</h2><pre><code>cucss2sac -a Syndat Syndat_ASC
</code></pre>
<p>转化为ASC格式，即ASCII文件。</p>
<h2 id="运行4"><a href="#运行4" class="headerlink" title="运行4"></a>运行4</h2><pre><code>./RUN_ENDIAN.csh Syndat
./RUN_ENDIAN.csh  green
</code></pre>
<p>把这两个文件波形从LOW_ENDIAN bytes转换到BIG_ENDIAN bytes</p>
<p>如果有ANTELOPE软件，可以在SUN‘s平台直接看到结果（格林函数和理论地震图）</p>
<pre><code>dbpick Syndat 
dbpick green
</code></pre>
<p>目前还没有找到软件。</p>
<h2 id="运行5"><a href="#运行5" class="headerlink" title="运行5"></a>运行5</h2><pre><code>eigen2asc 0 0 6 8 test_S test_S_ASC
</code></pre>
<p>将eigen文件转化为asc文件。</p>
<h1 id="BASH-运行文件（原DEMO3内RUN-MINEOS-csh，经过了修改）"><a href="#BASH-运行文件（原DEMO3内RUN-MINEOS-csh，经过了修改）" class="headerlink" title="BASH 运行文件（原DEMO3内RUN_MINEOS.csh，经过了修改）"></a>BASH 运行文件（原DEMO3内RUN_MINEOS.csh，经过了修改）</h1><ul>
<li>增加了STEP0，生成.site和.sitechan文件。</li>
<li>增加了STEP7，内容为将Syndat转化为SAC格式。</li>
<li>修改了china_cmt_event为xinjiang_cmt_event。内容为另一个地震事件。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/csh</span><br><span class="line">#</span><br><span class="line"># Example of the synthetic seismogram&#x27;s generation script.</span><br><span class="line">#</span><br><span class="line"># Usage: RUN_MINEOS.sh model_name</span><br><span class="line"># </span><br><span class="line"># Available model names for DEMO version:</span><br><span class="line"># prem_noocean  prem_ocean CPacific NRussia</span><br><span class="line">#----------------------------------------------------------</span><br><span class="line">if( $#argv != 1) then</span><br><span class="line">echo &quot; Usage: RUN_MIN.csh model_name&quot;</span><br><span class="line">exit</span><br><span class="line">endif</span><br><span class="line">alias cp cp</span><br><span class="line">alias rm rm</span><br><span class="line">alias mv mv</span><br><span class="line">set model=$1                # setup 1-D model name</span><br><span class="line"># check model name</span><br><span class="line">set flg=0</span><br><span class="line">foreach f (CPacific NRussia prem_noocean prem_noocean_na prem_ocean prem_noocean_1ln.txt)</span><br><span class="line">if($f == $1) set flg=1</span><br><span class="line">end</span><br><span class="line">if($flg == 0) then</span><br><span class="line">echo &quot;Model name $1 is wrong, allowed names are:&quot;</span><br><span class="line">echo &quot;CPacific NRussia prem_noocean prem_noocean_na prem_ocean prem_noocean_1ln.txt&quot;</span><br><span class="line">exit</span><br><span class="line">endif</span><br><span class="line">#----------------------------------------------------------------</span><br><span class="line"># Step 0 </span><br><span class="line"># make .site and .sitechan </span><br><span class="line">time simpledit stations short</span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line"># 1 run minos_bran for S mpde</span><br><span class="line"># n=0, f 0-200mhz</span><br><span class="line">echo &quot;Step 1:  minos_bran runs for S modes .....................&quot;</span><br><span class="line">echo &quot;============== Program minos_bran ==================&quot;</span><br><span class="line">if( -f $&#123;model&#125;_S) rm -f $&#123;model&#125;_S # 存在的话移除掉</span><br><span class="line">if( -f e$&#123;model&#125;_S) rm -f e$&#123;model&#125;_S</span><br><span class="line">time minos_bran &lt;&lt; EOF</span><br><span class="line">../models/$model.txt</span><br><span class="line">$&#123;model&#125;_S</span><br><span class="line">e$&#123;model&#125;_S</span><br><span class="line">1.0e-10 1</span><br><span class="line">3</span><br><span class="line">2 8000 0.0 200.0 0 0</span><br><span class="line">EOF</span><br><span class="line">#=========================================================</span><br><span class="line"># 2. run minos_bran program for fundamental T  mode,</span><br><span class="line"># where,  n=0, 0 &lt; f &lt;  0.2 Hz,</span><br><span class="line">#</span><br><span class="line">echo &quot;Step 2: minos_bran runs for T modes .....................&quot;</span><br><span class="line">echo &quot;============== Program minos_bran ==================&quot;</span><br><span class="line">if( -f $&#123;model&#125;_T) rm -f $&#123;model&#125;_T</span><br><span class="line">if( -f e$&#123;model&#125;_T) rm -f e$&#123;model&#125;_T</span><br><span class="line">time minos_bran &lt;&lt; EOF</span><br><span class="line">../models/$model.txt</span><br><span class="line">$&#123;model&#125;_T</span><br><span class="line">e$&#123;model&#125;_T</span><br><span class="line">1.0e-10 1</span><br><span class="line">2</span><br><span class="line">2 8000 0.0 200.0 0 0</span><br><span class="line">EOF</span><br><span class="line">#============================================================</span><br><span class="line"># 3. Convert minos_bran results to .eigen relation (S mode)</span><br><span class="line">#</span><br><span class="line">echo &quot;Step 3: eigen for S .....................................&quot;</span><br><span class="line">if( -f test_S.eigen) rm -rf test_S.*</span><br><span class="line">time eigcon &lt;&lt; EOF</span><br><span class="line">3</span><br><span class="line">../models/$model.txt</span><br><span class="line">1000</span><br><span class="line">$&#123;model&#125;_S</span><br><span class="line">e$&#123;model&#125;_S</span><br><span class="line">test_S</span><br><span class="line">EOF</span><br><span class="line">#============================================================</span><br><span class="line"># 4. Convert minos_bran results to .eigen relation (T mode)</span><br><span class="line">echo &quot;Step 4: eigen for T .....................................&quot;</span><br><span class="line">if( -f test_T.eigen) rm -rf test_T.*</span><br><span class="line">time eigcon &lt;&lt; EOF</span><br><span class="line">2</span><br><span class="line">../models/$model.txt</span><br><span class="line">1000</span><br><span class="line">$&#123;model&#125;_T</span><br><span class="line">e$&#123;model&#125;_T</span><br><span class="line">test_T</span><br><span class="line">EOF</span><br><span class="line">#=========================================================</span><br><span class="line"># 5. Evaluate green functions for given sitechan relation</span><br><span class="line">echo &quot;Step 5: green functions evaluation .........................&quot;</span><br><span class="line">if( -f green.wfdisc) rm -rf green.*</span><br><span class="line">time green &lt;&lt; EOF</span><br><span class="line">short</span><br><span class="line">db_list</span><br><span class="line">xinjiang_cmt_event</span><br><span class="line">10 260</span><br><span class="line">8000</span><br><span class="line">green</span><br><span class="line">EOF</span><br><span class="line">cp -p short.site green.site</span><br><span class="line">cp -p short.sitechan green.sitechan</span><br><span class="line"># create origin relation for data base green</span><br><span class="line">creat_origin xinjiang_cmt_event green</span><br><span class="line">#============================================================</span><br><span class="line"># 6. Synthetic data construction</span><br><span class="line">echo &quot;Step 6: synthetic seismogram construction ..................&quot;</span><br><span class="line">if( -f Syndat.wfdisc) rm -rf Syndat.*</span><br><span class="line">time syndat &lt;&lt; EOF</span><br><span class="line">xinjiang_cmt_event</span><br><span class="line">0</span><br><span class="line">green</span><br><span class="line">Syndat</span><br><span class="line">0</span><br><span class="line">EOF</span><br><span class="line"># convert Green functions to BIG_ENDIAN binary numerical storage</span><br><span class="line"># this is ANTELOPE requirement</span><br><span class="line"># $bin/wfendi 0 0 Syndat Syndat</span><br><span class="line"># copy .site, .sitechan relations into database Syndat</span><br><span class="line">cp -p short.site Syndat.site</span><br><span class="line">cp -p short.sitechan Syndat.sitechan</span><br><span class="line">creat_origin xinjiang_cmt_event Syndat</span><br><span class="line"># =====================================================</span><br><span class="line">#7.MAKE SAC TRANSFORM</span><br><span class="line">echo &quot;Step 7: SAC transform&quot;</span><br><span class="line">time cucss2sac Syndat Syndat_SAC</span><br><span class="line">echo &quot;over&quot;</span><br><span class="line">exit</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhiyuanshi1901.github.io/2022/12/21/CentOS%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2x-ui%E4%B8%8Ev2rayn/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/12/21/CentOS%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2x-ui%E4%B8%8Ev2rayn/" class="post-title-link" itemprop="url">CentOS服务器部署x-ui与v2rayn</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-12-21 21:09:15 / Modified: 22:23:20" itemprop="dateCreated datePublished" datetime="2022-12-21T21:09:15+08:00">2022-12-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%9E%E8%B7%B5/" itemprop="url" rel="index"><span itemprop="name">Linux服务器实践</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h1><p>[阿帅同学分享的不知名来源的教程]<br><a target="_blank" rel="noopener" href="https://github.com/v2fly/v2ray-core/releases">v2rayN_github</a><br><a target="_blank" rel="noopener" href="https://v2rayn.org/">v2rayN官网</a><br><a target="_blank" rel="noopener" href="https://v2rayng.org/">移动端v2rayNG官网</a><br><a target="_blank" rel="noopener" href="https://github.com/vaxilu/x-ui">x-ui</a><br><a target="_blank" rel="noopener" href="https://github.com/bedefaced/vpn-install">V-Install</a></p>
<p><strong>注意：以下服务器配置过程均在服务器中进行，请勿在PC上进行，具体后果未知。</strong></p>
<h1 id="购买服务器"><a href="#购买服务器" class="headerlink" title="购买服务器"></a>购买服务器</h1><p>使用阿里云轻量应用服务器即可，最低配置每月仅24元。此处选用新加坡的服务器（香港优先，但是已经售罄）。</p>
<h1 id="连接服务器并进行配置"><a href="#连接服务器并进行配置" class="headerlink" title="连接服务器并进行配置"></a>连接服务器并进行配置</h1><p>推荐使用root用户登录。可以不使用<code>sudo</code>命令。</p>
<h2 id="安装git"><a href="#安装git" class="headerlink" title="安装git"></a>安装git</h2><pre><code>yum install git
</code></pre>
<h2 id="clone-V-install库"><a href="#clone-V-install库" class="headerlink" title="clone V-install库"></a>clone V-install库</h2><pre><code>git clone --depth=1 https://github.com/bedefaced/vpn-install.git
</code></pre>
<h2 id="安装V-install"><a href="#安装V-install" class="headerlink" title="安装V-install"></a>安装V-install</h2><p>分别安装PPTP、openvpn和IPSEC。</p>
<pre><code>vpn-install/pptp/install.sh
vpn-install/openvpn/install.sh
vpn-install/ipsec/install.sh
</code></pre>
<p>安装过程中进行配置。不知道的直接输入1或者回车就可以，不用单独设置。<br>用户名、密码和PSK需要自行设置，并且需要牢记。</p>
<h2 id="安装x-ui"><a href="#安装x-ui" class="headerlink" title="安装x-ui"></a>安装x-ui</h2><p>运行：</p>
<pre><code>bash &lt;(curl -Ls https://raw.githubusercontent.com/vaxilu/x-ui/master/install.sh)
</code></pre>
<p>安装过程中需要设置面板端口，随便输入一个1到65535数字即可。<br>面板端口牢记，之后会用到。例如这里设置为8888（宝塔面板的端口），以下示例中端口改为自行设置的端口，不推荐设置8888。</p>
<h1 id="配置防火墙"><a href="#配置防火墙" class="headerlink" title="配置防火墙"></a>配置防火墙</h1><p>如果端口不在防火墙白名单里，则不能连接。在阿里云控制台中配置防火墙。</p>
<p>在控制台左侧，安全-防火墙一栏中，预设有三个可通过防火墙的端口。<br>点击<code>添加规则</code>，依次选择：</p>
<ul>
<li>应用类型：自定义，</li>
<li>协议：TCP</li>
<li>端口范围： 8888</li>
<li>限制IP来源：不要修改</li>
<li>备注：按照自己的想法填写即可</li>
</ul>
<p>点击确定后，这个端口不会被拦截。</p>
<h1 id="配置x-ui面板"><a href="#配置x-ui面板" class="headerlink" title="配置x-ui面板"></a>配置x-ui面板</h1><p>在浏览器官网输入：公网IP:x-ui设置的端口，例如：192.168.0.1:8888。<br>其中，192.168.0.1为公网IP，8888为设置的端口，便可进入到x-ui面板。</p>
<p><strong>注：公网IP地址在控制台<code>概览</code>页面。</strong></p>
<p>如果无法进入，很可能是防火墙设置不正确，或者服务器中x-ui未运行。</p>
<p>点击<code>入站列表</code>，左上角的蓝色加号。</p>
<p><img src="%E8%AE%BE%E7%BD%AE%E8%8A%82%E7%82%B9.png" alt="节点"></p>
<ul>
<li>备注：填写节点的名称，选择一个好记又方便的名称即可。</li>
<li>协议：默认选择vmess即可，也可以选择其他的。因水平有限未进行测试。</li>
<li>端口：可以随意修改，但是注意要在防火墙开放，具体操作在配置防火墙一栏。</li>
<li>传输：默认使用tcp即可，也可以使用ws，但是可能需要额外设置。因水平有限未进行测试。</li>
<li>其余选项可以默认不修改。总流量设置可以设置限制。</li>
</ul>
<p>点击添加即可。</p>
<p>完成后，点击操作，二维码。保存这个二维码，亦可以不保存进入网站查找。</p>
<h1 id="设置v2rayN"><a href="#设置v2rayN" class="headerlink" title="设置v2rayN"></a>设置v2rayN</h1><p>注：一定要下载core版本，否则可能无法使用。<br>下载地址：<a target="_blank" rel="noopener" href="https://github.com/2dust/v2rayN/releases">https://github.com/2dust/v2rayN/releases</a><br>在中间列表空白处点击右键，选择<code>扫描屏幕上的二维码</code>。点击之前，<br>先调出上一步得到的二维码。此时可以自动将服务器导入。</p>
<p>然后对服务器一栏右键，点击<code>设为活动服务器</code></p>
<p>在右下角的最小化软件图标，点击右键，设置<code>系统代理</code>-<code>自动配置系统代理</code>（此时图标由蓝色变红色）；<br><code>路由</code>-<code>Whitelist</code>；即可使用科学上网。</p>
<p><code>系统代理</code>-<code>清除系统代理</code>：即可关闭科学上网。<br>注意： 如上操作<code>系统代理</code>实测可以实现科学上网的开启与关闭，但是不了解具体含义。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>阿里云轻量应用服务器-新加坡服务器实测延迟足够使用，在80ms以内。<br>目前该操作仅适用于Windows PC。</p>
<p>由于该操作使用的服务器只有命令行界面，因此需要一定的Linux基础。</p>
<p>使用过程中发现去掉图形化界面的Linux十分轻快简洁，如果有必要可以在Linux PC去除图形界面操作。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhiyuanshi1901.github.io/2022/12/13/CentOS%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/12/13/CentOS%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">CentOS安装</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-12-13 13:28:36 / Modified: 13:39:20" itemprop="dateCreated datePublished" datetime="2022-12-13T13:28:36+08:00">2022-12-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">Linux学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="CentOS-7-安装"><a href="#CentOS-7-安装" class="headerlink" title="CentOS 7 安装"></a>CentOS 7 安装</h1><p>CentOS7 安装会出现一群企鹅，以及：</p>
<pre><code>....
kernel panic: not syncing: Fatal exception
Kernel Offset: ........
...
</code></pre>
<p>以上为部分错误。<br>硬件：<br>CPU: Ryzen 5600G<br>主板: Minisforum B550</p>
<p>不确定是否为硬件问题，但是显示内核错误。<br>可能是使用Windows平台烧录软件造成的问题，包括Deepin官方烧录软件和rufus均出现这个问题。<br>目前未尝试Linux平台烧录软件。</p>
<h1 id="CentOS-8-安装"><a href="#CentOS-8-安装" class="headerlink" title="CentOS 8 安装"></a>CentOS 8 安装</h1><p>CentOS 8 安装之前，在<code>Install CentOS 8</code>处点击键盘 <code>E</code> 按键，将第一行的：</p>
<pre><code>LABEL=CentOS\...... quiet
</code></pre>
<p>其中，<code>CentOS\...</code> 改为使用的U盘名称。</p>
<p>使用 <code>Ctrl</code> + <code>X</code> 重新加载即可。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhiyuanshi1901.github.io/2022/12/13/CentOS8%E5%AE%89%E8%A3%85%E4%B8%AD%E5%9B%BD%E7%89%88Firefox/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/12/13/CentOS8%E5%AE%89%E8%A3%85%E4%B8%AD%E5%9B%BD%E7%89%88Firefox/" class="post-title-link" itemprop="url">CentOS8安装中国版Firefox</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-12-13 12:57:20 / Modified: 13:43:56" itemprop="dateCreated datePublished" datetime="2022-12-13T12:57:20+08:00">2022-12-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">Linux学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>安装类似于Ubuntu安装方法。在desktop文件中有所差别。</p>
<p>首先将提取的包移动到相应位置</p>
<pre><code>sudo mv firefox /usr/local
</code></pre>
<p>然后创建desktop文件，命名为firefox.desktop：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[Desktop Entry]</span><br><span class="line">Name=firefox</span><br><span class="line">Version=1.0</span><br><span class="line">Name[zh_CN]=火狐浏览器</span><br><span class="line">GenericName=Web Browser</span><br><span class="line">Comment=火狐浏览器</span><br><span class="line">Exec=/usr/local/firefox/firefox # 软件安装位置</span><br><span class="line">Icon=/usr/local/firefox/browser/chrome/icons/default/default128.png # 图标所在位置</span><br><span class="line">Terminal=false</span><br><span class="line">Type=Application</span><br><span class="line">MimeType=text/html;text/xml;application/xhtml+xml;application/vnd.mozilla.xul+xml;text/mml;x-scheme-handler/http;x-scheme-handler/https;</span><br><span class="line">StartupNotify=true</span><br><span class="line">Categories=Network;WebBrowser;</span><br><span class="line">Encoding=UTF-8</span><br></pre></td></tr></table></figure>

<p>将desktop文件移动到<code>/usr/share</code>下的<code>/applications</code>文件夹。</p>
<pre><code>sudo cp firefox.desktop /usr/share/applicaions
</code></pre>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="http://wjhsh.net/szwmd778-p-9944992.html">http://wjhsh.net/szwmd778-p-9944992.html</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhiyuanshi1901.github.io/2022/12/12/WSL%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/12/12/WSL%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">WSL安装</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2022-12-12 12:13:17 / Modified: 12:22:50" itemprop="dateCreated datePublished" datetime="2022-12-12T12:13:17+08:00">2022-12-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>[WSL安装]<a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/windows/wsl/install">https://learn.microsoft.com/zh-cn/windows/wsl/install</a><br>[运行出现——占位程序接收到错误数据]<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_32461955/article/details/127858827">https://blog.csdn.net/qq_32461955/article/details/127858827</a></p>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>WSL是windows平台使用Linux系统的方式之一。通过安装子系统，使用命令行操作Linux。</p>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>使用管理员身份运行power shell。</p>
<p>运行：</p>
<pre><code>wsl --install
</code></pre>
<p>重启后即可。</p>
<h1 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h1><p>点击开始菜单中的Ubuntu即可运行。（默认安装Ubuntu）</p>
<h2 id="查看wsl版本"><a href="#查看wsl版本" class="headerlink" title="查看wsl版本"></a>查看wsl版本</h2><pre><code>wsl -l -v
</code></pre>
<h1 id="出现过的问题"><a href="#出现过的问题" class="headerlink" title="出现过的问题"></a>出现过的问题</h1><h2 id="占位程序接收到错误数据"><a href="#占位程序接收到错误数据" class="headerlink" title="占位程序接收到错误数据"></a>占位程序接收到错误数据</h2><p>显示：Error code: Wsl&#x2F;Service&#x2F;0x800706f7</p>
<p>解决方法：管理员身份运行power shell<br>输入：</p>
<pre><code>netsh winsock reset
</code></pre>
<p>即可解决。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhiyuanshi1901.github.io/2022/11/27/Python-%E5%BA%93%E5%87%BD%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/11/27/Python-%E5%BA%93%E5%87%BD%E6%95%B0/" class="post-title-link" itemprop="url">Python 库函数</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-11-27 10:01:21" itemprop="dateCreated datePublished" datetime="2022-11-27T10:01:21+08:00">2022-11-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-12-05 16:08:06" itemprop="dateModified" datetime="2022-12-05T16:08:06+08:00">2022-12-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="自带函数"><a href="#自带函数" class="headerlink" title="自带函数"></a>自带函数</h1><h2 id="zip"><a href="#zip" class="headerlink" title="zip()"></a>zip()</h2><pre><code>zip([一个或者多个迭代器,...])
</code></pre>
<p>打包为元组。<br>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a = [1, 2, 3]</span><br><span class="line">b = [4, 5, 6]</span><br><span class="line">p = zip(a,b)</span><br><span class="line">&gt;&gt; p = [(1,4), (2,5),(3,6)]</span><br><span class="line">q = zip(*p)</span><br><span class="line">&gt;&gt; q = [(1,2,3),(4,5,6)]</span><br></pre></td></tr></table></figure>

<h1 id="numpy"><a href="#numpy" class="headerlink" title="numpy"></a>numpy</h1><h2 id="std"><a href="#std" class="headerlink" title="std"></a>std</h2><pre><code>numpy.std(a, axis=None)
</code></pre>
<ul>
<li>a:计算a的标准差</li>
<li>axis: <ul>
<li>0 计算每一列的标准差</li>
<li>1 计算每一行的标准差</li>
<li>None 计算全局标准差</li>
</ul>
</li>
</ul>
<h2 id="digitize"><a href="#digitize" class="headerlink" title="digitize"></a>digitize</h2><pre><code>numpy.digitize(x, bins, right=False)
</code></pre>
<p>返回一个和x相同大小的列表，返回值中的元素对应x元素落在bins区间的索引号。</p>
<h2 id="argmax-返回列表的最大值索引值"><a href="#argmax-返回列表的最大值索引值" class="headerlink" title="argmax 返回列表的最大值索引值"></a>argmax 返回列表的最大值索引值</h2><h2 id="random-随机数"><a href="#random-随机数" class="headerlink" title="random 随机数"></a>random 随机数</h2><h3 id="choice"><a href="#choice" class="headerlink" title="choice"></a>choice</h3><p>choice(a, size&#x3D;None, replace&#x3D;True, p&#x3D;None)</p>
<ul>
<li>a 序列</li>
<li>size 采样的数量，可以是整数，可以是tuple(m，n，k)</li>
<li>replace 采样的样本是否需要更换。False时样本不会重复。</li>
<li>p 一维数组，指定a中每个元素采样的概率。默认相同</li>
</ul>
<h1 id="tensorflow"><a href="#tensorflow" class="headerlink" title="tensorflow"></a>tensorflow</h1><h2 id="math"><a href="#math" class="headerlink" title="math"></a>math</h2><h2 id="clip-by-global-norm"><a href="#clip-by-global-norm" class="headerlink" title="clip_by_global_norm"></a>clip_by_global_norm</h2><pre><code>tf.clip_by_global_norm( t_list, clip_norm, use_norm=None, name=None)
</code></pre>
<ul>
<li>t_list 元组、列表或者混合张量</li>
<li>clip_norm 一个标量，大于0。剪裁率</li>
<li>use_norm 浮点数标量<br>给定张量 t_list 的元组或列表，以及裁剪率 clip_norm，此操作返回裁剪张量列表 list_clipped 和 t_list<br>中所有张量的全局范数 (global_norm)。或者，如果您已经计算了 t_list 的全局范数，则可以使用 use_norm 指定全局范数。</li>
</ul>
<h3 id="reduce-mean"><a href="#reduce-mean" class="headerlink" title="reduce_mean"></a>reduce_mean</h3><pre><code>tf.math.reduce_mean(input_tensor, axis=None, keepdims=False, name=None)
</code></pre>
<ul>
<li>input_tensor 输入的张量</li>
<li>axis <ul>
<li>缺省，则输出的值为张量所有值的平均值，为一个数字。</li>
<li>0，输出一个向量，沿着纵向取平均值</li>
<li>1，沿着横向取平均值</li>
</ul>
</li>
<li>keepdims true表示保留长度为1的缩减维度。</li>
</ul>
<h3 id="reduce-sum"><a href="#reduce-sum" class="headerlink" title="reduce_sum"></a>reduce_sum</h3><pre><code>tf.math.reduce_sum(input_tensor, axis=None, keepdims=False, name=None)
</code></pre>
<p>输入与mean相同。</p>
<ul>
<li>axis <ul>
<li>缺省，表示张量的所有值相加</li>
<li>0，纵向相加</li>
<li>1，横向相加，返回横向量。</li>
</ul>
</li>
<li>keepdims 为True时，且axis为1，返回列向量</li>
</ul>
<h2 id="squeeze"><a href="#squeeze" class="headerlink" title="squeeze"></a>squeeze</h2><p><a target="_blank" rel="noopener" href="https://www.tensorflow.org/api_docs/python/tf/squeeze">https://www.tensorflow.org/api_docs/python/tf/squeeze</a></p>
<pre><code>tf.squeeze(input, axis=None, name=None)
</code></pre>
<p>给定一个输入张量。默认移除数量为1的维度。如果axis有值，则移除axis列表对应索引的值。</p>
<ul>
<li>input 输入，是一个张量。</li>
<li>axis 一个列表，指的是张量的索引。</li>
</ul>
<h2 id="kereas"><a href="#kereas" class="headerlink" title="kereas"></a>kereas</h2><h3 id="layers"><a href="#layers" class="headerlink" title="layers"></a>layers</h3><h4 id="Dense"><a href="#Dense" class="headerlink" title="Dense"></a>Dense</h4><pre><code>tf.keras.layers.Dense(
    units,
    activation=None,
    use_bias=True,
    kernel_initializer=&#39;glorot_uniform&#39;,
    bias_initializer=&#39;zeros&#39;,
    kernel_regularizer=None,
    bias_regularizer=None,
    activity_regularizer=None,
    kernel_constraint=None,
    bias_constraint=None,
    **kwargs
)
</code></pre>
<ul>
<li>units 正整数，输出的维度</li>
<li>activation 激活函数<ul>
<li>sigmoid</li>
<li>relu</li>
<li>tf.nn.relu </li>
<li>tf.nn.softmax</li>
</ul>
</li>
<li>use_bias 布尔型 层是否使用bias向量<br>目前暂时只需要前两个参数。</li>
</ul>
<h4 id="Flatten"><a href="#Flatten" class="headerlink" title="Flatten"></a>Flatten</h4><pre><code>tf.keras.layers.Flatten()
</code></pre>
<p>将2D层转化为1D向量，只是重排向量。</p>
<h4 id="Conv2D-定义卷积层"><a href="#Conv2D-定义卷积层" class="headerlink" title="Conv2D 定义卷积层"></a>Conv2D 定义卷积层</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">tf.keras.layers.Conv2D(</span><br><span class="line">    filters,</span><br><span class="line">    kernel_size,</span><br><span class="line">    strides=(1, 1),</span><br><span class="line">    padding=&#x27;valid&#x27;,</span><br><span class="line">    data_format=None,</span><br><span class="line">    dilation_rate=(1, 1),</span><br><span class="line">    groups=1,</span><br><span class="line">    activation=None,</span><br><span class="line">    use_bias=True,</span><br><span class="line">    kernel_initializer=&#x27;glorot_uniform&#x27;,</span><br><span class="line">    bias_initializer=&#x27;zeros&#x27;,</span><br><span class="line">    kernel_regularizer=None,</span><br><span class="line">    bias_regularizer=None,</span><br><span class="line">    activity_regularizer=None,</span><br><span class="line">    kernel_constraint=None,</span><br><span class="line">    bias_constraint=None,</span><br><span class="line">    **kwargs</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>filters 输出的维度。即输出的层的数量。</li>
<li>kernel_size 核的大小。可以是整数或者矩阵。</li>
<li>padding 是否填充0。指在输入层的周围填充0。<code>vaild</code>表示不填充，<code>same</code>表示填充一圈0。</li>
</ul>
<h4 id="MaxPool2D-定义最大池化层"><a href="#MaxPool2D-定义最大池化层" class="headerlink" title="MaxPool2D 定义最大池化层"></a>MaxPool2D 定义最大池化层</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tf.keras.layers.MaxPool2D(</span><br><span class="line">    pool_size=(2, 2),</span><br><span class="line">    strides=None,</span><br><span class="line">    padding=&#x27;valid&#x27;,</span><br><span class="line">    data_format=None,</span><br><span class="line">    **kwargs</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>pool_size 池化核大小</li>
<li>strides 池化核移动的步长</li>
</ul>
<h3 id="optimizers"><a href="#optimizers" class="headerlink" title="optimizers"></a>optimizers</h3><h4 id="SGD-随机梯度下降法"><a href="#SGD-随机梯度下降法" class="headerlink" title="SGD 随机梯度下降法"></a>SGD 随机梯度下降法</h4><pre><code>tf.keras.optimizers.SGD(learning_rate = 0.1)
</code></pre>
<h3 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h3><h4 id="compile"><a href="#compile" class="headerlink" title="compile"></a>compile</h4><p>compile</p>
<h4 id="fit-测试拟合程度"><a href="#fit-测试拟合程度" class="headerlink" title="fit 测试拟合程度"></a>fit 测试拟合程度</h4><h4 id="evaluate"><a href="#evaluate" class="headerlink" title="evaluate"></a>evaluate</h4><pre><code>test_loss, test_acc = model.evaluate(x=test_images, y=test_labels)
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">evaluate(</span><br><span class="line">    x=None,</span><br><span class="line">    y=None,</span><br><span class="line">    batch_size=None,</span><br><span class="line">    verbose=&#x27;auto&#x27;,</span><br><span class="line">    sample_weight=None,</span><br><span class="line">    steps=None,</span><br><span class="line">    callbacks=None,</span><br><span class="line">    max_queue_size=10,</span><br><span class="line">    workers=1,</span><br><span class="line">    use_multiprocessing=False,</span><br><span class="line">    return_dict=False,</span><br><span class="line">    **kwargs</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>x 输入数据</li>
<li>y 目标数据</li>
</ul>
<h4 id="predict"><a href="#predict" class="headerlink" title="predict"></a>predict</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">predict(</span><br><span class="line">    x,</span><br><span class="line">    batch_size=None,</span><br><span class="line">    verbose=&#x27;auto&#x27;,</span><br><span class="line">    steps=None,</span><br><span class="line">    callbacks=None,</span><br><span class="line">    max_queue_size=10,</span><br><span class="line">    workers=1,</span><br><span class="line">    use_multiprocessing=False</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>x 输入的采样点，可以是：<ul>
<li>numpy矩阵，或者矩阵列表</li>
<li>tensorflow张量，或者张量列表</li>
<li>tf.data 数据集</li>
</ul>
</li>
</ul>
<h1 id="functools"><a href="#functools" class="headerlink" title="functools"></a>functools</h1><p>Python标准模块，提供了一些常用的高阶函数，也就是用于处理其它函数的特殊函数。</p>
<h2 id="partial"><a href="#partial" class="headerlink" title="partial"></a>partial</h2><pre><code>functools.partial(func[, *args][, **keywords])
</code></pre>
<p>将对象的缺省默认值修改为args中的值。<br>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int(&#x27;10&#x27;) # 输出为10</span><br><span class="line">int2 = partial(int, base=2)  # base就是keywords</span><br><span class="line">int2(&#x27;10&#x27;) # 输出为2</span><br></pre></td></tr></table></figure>

<ul>
<li>func 可调用的对象或者函数。调用partial对象会转为使用新的参数和关键字参数调用func。</li>
<li>args 最左边的位置参数作为优先位置参数提供给partial对象调用。</li>
<li>keywords 对象被调用时提供关键字参数</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://zhiyuanshi1901.github.io/2022/11/21/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%88%9D%E6%8E%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Zhiyuan Shi">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/11/21/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%88%9D%E6%8E%A2/" class="post-title-link" itemprop="url">深度学习初探</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-11-21 20:08:19" itemprop="dateCreated datePublished" datetime="2022-11-21T20:08:19+08:00">2022-11-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-11-30 22:06:56" itemprop="dateModified" datetime="2022-11-30T22:06:56+08:00">2022-11-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">深度学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>来源于：</p>
<p><a target="_blank" rel="noopener" href="http://introtodeeplearning.com/">MIT-Introduction to Deep Learning</a></p>
<p>代码为MIT课程练习LAB，可以使用Colab进行学习。链接：<br><a target="_blank" rel="noopener" href="https://github.com/aamini/introtodeeplearning">MIT-Codes Github resposibility</a></p>
<p>Information：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Copyright 2022 MIT 6.S191 Introduction to Deep Learning. All Rights Reserved.</span><br><span class="line"># </span><br><span class="line"># Licensed under the MIT License. You may not use this file except in compliance</span><br><span class="line"># with the License. Use and/or modification of this code outside of 6.S191 must</span><br><span class="line"># reference:</span><br><span class="line">#</span><br><span class="line"># © MIT 6.S191: Introduction to Deep Learning</span><br><span class="line"># http://introtodeeplearning.com</span><br></pre></td></tr></table></figure>

<h1 id="Lab-1-Intro-to-TensorFlow-and-Music-Generation-with-RNNs"><a href="#Lab-1-Intro-to-TensorFlow-and-Music-Generation-with-RNNs" class="headerlink" title="Lab 1: Intro to TensorFlow and Music Generation with RNNs"></a>Lab 1: Intro to TensorFlow and Music Generation with RNNs</h1><h2 id="Part-1-Intro-to-TensorFlow"><a href="#Part-1-Intro-to-TensorFlow" class="headerlink" title="Part 1:Intro to TensorFlow"></a>Part 1:Intro to TensorFlow</h2><h3 id="创建tf值"><a href="#创建tf值" class="headerlink" title="创建tf值"></a>创建tf值</h3><ul>
<li><p><code> x=tf.constant(&#39;String&#39;, tf.string)</code>:<br>创建一个常量，这个常量可以是多维列表。<br><code>tf.string</code>表示为字符串,<code>tf.float64</code>表示浮点型。</p>
</li>
<li><p><code>x=tf.Variable(value)</code>:创建一个变量</p>
</li>
<li><p><code>tf.zeros([a, b, c])</code>:创建一个全是0的矩阵,列表中表示size。</p>
</li>
</ul>
<h3 id="查看tf变量属性"><a href="#查看tf变量属性" class="headerlink" title="查看tf变量属性"></a>查看tf变量属性</h3><ul>
<li><code>tf.rank(value).numpy()</code>:查看value的维数</li>
<li><code>tf.shape(value).numpy()</code>:查看value的大小</li>
</ul>
<h3 id="tf计算函数"><a href="#tf计算函数" class="headerlink" title="tf计算函数"></a>tf计算函数</h3><ul>
<li><code>tf.add(a, b)</code>: a+b</li>
<li><code>tf.subtract(a, b)</code>: a-b</li>
<li><code>tf.multiply(a, b)</code>: a*b</li>
</ul>
<h3 id="创建一个简单的神经网络"><a href="#创建一个简单的神经网络" class="headerlink" title="创建一个简单的神经网络"></a>创建一个简单的神经网络</h3><p>使用的输出公式: <code>y=sigmoid(xW+b)</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">### Defining a network Layer ###</span><br><span class="line"></span><br><span class="line"># n_output_nodes: number of output nodes 输出节点个数</span><br><span class="line"># input_shape: shape of the input 输入大小</span><br><span class="line"># x: input to the layer 层的输入</span><br><span class="line"></span><br><span class="line">class OurDenseLayer(tf.keras.layers.Layer):  # 继承了Layer</span><br><span class="line">  def __init__(self, n_output_nodes):</span><br><span class="line">    super(OurDenseLayer, self).__init__()</span><br><span class="line">    self.n_output_nodes = n_output_nodes</span><br><span class="line"></span><br><span class="line">  def build(self, input_shape):</span><br><span class="line">    d = int(input_shape[-1])</span><br><span class="line">    # Define and initialize parameters: a weight matrix W and bias b  定义并初始化参数：权重W 误差b</span><br><span class="line">    # Note that parameter initialization is random! 参数的初始值是随机的！！！</span><br><span class="line">    self.W = self.add_weight(&quot;weight&quot;, shape=[d, self.n_output_nodes]) # note the dimensionality d行‘节点个数&#x27;列</span><br><span class="line">    self.b = self.add_weight(&quot;bias&quot;, shape=[1, self.n_output_nodes]) # note the dimensionality  1行 ‘节点个数&#x27;列</span><br><span class="line"></span><br><span class="line">  def call(self, x):</span><br><span class="line">    &#x27;&#x27;&#x27;TODO: define the operation for z (hint: use tf.matmul) 定义z &#x27;&#x27;&#x27;</span><br><span class="line">    z = tf.add(tf.matmul(x, self.W), self.b) # TODO</span><br><span class="line"></span><br><span class="line">    &#x27;&#x27;&#x27;TODO: define the operation for out (hint: use tf.sigmoid) 定义输出  &#x27;&#x27;&#x27;</span><br><span class="line">    y = tf.sigmoid(z) # TODO</span><br><span class="line">    return y</span><br><span class="line"></span><br><span class="line"># Since layer parameters are initialized randomly, we will set a random seed for reproducibility 层的参数初始化值是随机的，设置一个随机种子</span><br><span class="line">tf.random.set_seed(1)</span><br><span class="line">layer = OurDenseLayer(3)</span><br><span class="line">layer.build((1,2))</span><br><span class="line">x_input = tf.constant([[1,2.]], shape=(1,2))</span><br><span class="line">y = layer.call(x_input)</span><br><span class="line"></span><br><span class="line"># test the output!</span><br><span class="line">print(y.numpy())</span><br></pre></td></tr></table></figure>

<h3 id="使用时序-Sequential-API的神经网络"><a href="#使用时序-Sequential-API的神经网络" class="headerlink" title="使用时序(Sequential)API的神经网络"></a>使用时序(Sequential)API的神经网络</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">from tensorflow.keras import Sequential</span><br><span class="line">from tensorflow.keras.layers import Dense</span><br><span class="line"></span><br><span class="line">n_output_nodes = 3</span><br><span class="line"></span><br><span class="line"># First define the model </span><br><span class="line">model = Sequential()</span><br><span class="line"></span><br><span class="line">dense_layer = Dense(units=n_output_nodes) # TODO  </span><br><span class="line"># 答案：dense_layer = Dense(n_output_nodes, activation=&#x27;sigmoid&#x27;) # TODO</span><br><span class="line"># Add the dense layer to the model</span><br><span class="line">model.add(dense_layer)</span><br></pre></td></tr></table></figure>
<p>测试输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x_input = tf.constant([[1,2.]], shape=(1,2))</span><br><span class="line">model_output = model(x_input) # TODO   将x输入model模型中运行。</span><br><span class="line"># 答案 model_output = model(x_input).numpy()</span><br><span class="line">print(model_output) </span><br></pre></td></tr></table></figure>

<p>使用Model类创建继承的子类SubclassModel：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">from tensorflow.keras import Model</span><br><span class="line">from tensorflow.keras.layers import Dense</span><br><span class="line">class SubclassModel(tf.keras.Model):</span><br><span class="line">    def __init__(self, n_output_nodes):</span><br><span class="line">        super(SubclassModel, self).__init__()</span><br><span class="line">        &#x27;&#x27;&#x27;TODO: Our model consists of a single Dense layer. Define this layer.&#x27;&#x27;&#x27; </span><br><span class="line">        self.dense_layer = Dense(n_output_nodes, activation=&#x27;sigmoid&#x27;)   &#x27;&#x27;&#x27;TODO: Dense Layer&#x27;&#x27;&#x27;</span><br><span class="line">        # 答案 self.dense_layer = Dense(n_output_nodes, activation=&#x27;sigmoid&#x27;)</span><br><span class="line">        # 此处使用sigmoid函数，若使用relu，输出为0；使用tanh，输出的0、2位置为负数。</span><br><span class="line">    def call(self, inputs):</span><br><span class="line">        return self.dense_layer(inputs)</span><br><span class="line"># 测试：   </span><br><span class="line">n_output_nodes = 3</span><br><span class="line">model = SubclassModel(n_output_nodes)</span><br><span class="line">x_input = tf.constant([[1,2.]], shape=(1,2))</span><br><span class="line">print(model.call(x_input))</span><br></pre></td></tr></table></figure>

<p>在<code>call</code>函数中增加：<code>isidentity=False</code>，<br>isidentity，“有时我们希望网络简单地输出原来的值”。<br>True时返回输入值，否则正常执行。</p>
<h3 id="梯度计算"><a href="#梯度计算" class="headerlink" title="梯度计算"></a>梯度计算</h3><p>通过<code>GradientTape()</code>方法实现梯度计算。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x = tf.Variable(3.0)</span><br><span class="line">with tf.GradientTape() as tape:</span><br><span class="line">    y=x*x</span><br><span class="line">dy_dx=tape.gradient(y, x)</span><br></pre></td></tr></table></figure>

<p>SGD梯度法优化方法：<br>计算损失L&#x3D;(x−x_f)^2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">x = tf.Variable([tf.random.normal([1])]) # x随机取值</span><br><span class="line">learning_rate = 1e-2 # SGD的学习率</span><br><span class="line">history = []</span><br><span class="line">x_f = 4     # 定义目标值</span><br><span class="line"></span><br><span class="line">for i in range(500):</span><br><span class="line">    with tf.GradientTape() as tape:</span><br><span class="line">        loss = (x - x_f)**2  </span><br><span class="line">    grad = tape.gradient(loss, x) # 计算梯度值</span><br><span class="line">    new_x = x - learning_rate*grad # sgd update</span><br><span class="line">    x.assign(new_x) # 更新x值，即用new_x值替换x值。</span><br><span class="line">    history.append(x.numpy()[0]) # 加入索引是因为x为列表，但是x列表只有一个值。</span><br><span class="line"></span><br><span class="line"># Plot the evolution of x as we optimize towards x_f!</span><br><span class="line">plt.plot(history)</span><br><span class="line">plt.plot([0, 500],[x_f,x_f])</span><br><span class="line">plt.legend((&#x27;Predicted&#x27;, &#x27;True&#x27;))</span><br><span class="line">plt.xlabel(&#x27;Iteration&#x27;)</span><br><span class="line">plt.ylabel(&#x27;x value&#x27;)</span><br></pre></td></tr></table></figure>

<h1 id="Lab-2-Computer-Vision"><a href="#Lab-2-Computer-Vision" class="headerlink" title="Lab 2: Computer Vision"></a>Lab 2: Computer Vision</h1><h2 id="Part-1-MNIST-Digit-Classification-手写数字识别"><a href="#Part-1-MNIST-Digit-Classification-手写数字识别" class="headerlink" title="Part 1: MNIST Digit Classification 手写数字识别"></a>Part 1: MNIST Digit Classification 手写数字识别</h2><h3 id="初始模型创建"><a href="#初始模型创建" class="headerlink" title="初始模型创建"></a>初始模型创建</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">def build_fc_model():</span><br><span class="line">  fc_model = tf.keras.Sequential([</span><br><span class="line">      # First define a Flatten layer定义一个展平层</span><br><span class="line">      tf.keras.layers.Flatten(),</span><br><span class="line"></span><br><span class="line">      # &#x27;&#x27;&#x27;TODO: Define the activation function for the first fully connected (Dense) layer.&#x27;&#x27;&#x27;第一层全连接层激活函数</span><br><span class="line">      tf.keras.layers.Dense(128, activation=tf.nn.relu),</span><br><span class="line"></span><br><span class="line">      # &#x27;&#x27;&#x27;TODO: Define the second Dense layer to output the classification probabilities&#x27;&#x27;&#x27;定义第二层全连接层，输出分类概率</span><br><span class="line">      tf.keras.layers.Dense(10, activation=tf.nn.softmax) </span><br><span class="line">  ])</span><br><span class="line">  return fc_model</span><br><span class="line">model = build_fc_model()</span><br></pre></td></tr></table></figure>
<p>第一层全连接层使用<code>relu</code>激活函数，第二层全连接层用于输出预测的概率值，使用<code>softmax</code>激活函数.</p>
<p>这里使用<code>tf.nn.relu</code>形式，如果用<code>&#39;relu&#39;</code>会报错。</p>
<h3 id="模型编译"><a href="#模型编译" class="headerlink" title="模型编译"></a>模型编译</h3><p>在训练模型之前执行模型编译，包括设置优化器、损失函数、训练测试的指标：这里使用准确率。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">model.compile(optimizer=tf.keras.optimizers.SGD(learning_rate=1e-1), </span><br><span class="line">              loss=&#x27;sparse_categorical_crossentropy&#x27;,</span><br><span class="line">              metrics=[&#x27;accuracy&#x27;])</span><br></pre></td></tr></table></figure>

<h3 id="模型训练"><a href="#模型训练" class="headerlink" title="模型训练"></a>模型训练</h3><p>训练过程中显示损失和准确率。</p>
<ul>
<li>epochs：训练次数<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BATCH_SIZE = 64</span><br><span class="line">EPOCHS = 5</span><br><span class="line">model.fit(train_images, train_labels, batch_size=BATCH_SIZE, epochs=EPOCHS)</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="使用测试训练集测试模型准确性"><a href="#使用测试训练集测试模型准确性" class="headerlink" title="使用测试训练集测试模型准确性"></a>使用测试训练集测试模型准确性</h3><p><code>evaluate</code>方法用来测试准确性。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">test_loss, test_acc = model.evaluate(x=test_images, y=test_labels)</span><br><span class="line"></span><br><span class="line">print(&#x27;Test accuracy:&#x27;, test_acc)</span><br></pre></td></tr></table></figure>

<h3 id="创建CNN网络模型，并进行编译、训练和测试。"><a href="#创建CNN网络模型，并进行编译、训练和测试。" class="headerlink" title="创建CNN网络模型，并进行编译、训练和测试。"></a>创建CNN网络模型，并进行编译、训练和测试。</h3><p>创建模型：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">def build_cnn_model():</span><br><span class="line">    cnn_model = tf.keras.Sequential([</span><br><span class="line">        # 定义第一个卷积层</span><br><span class="line">        tf.keras.layers.Conv2D(filters=24, kernel_size=(3, 3), activation=&#x27;relu&#x27;), </span><br><span class="line">        # 定义第一个最大池化层</span><br><span class="line">        tf.keras.layers.MaxPool2D(pool_size=(2, 2)),</span><br><span class="line">        # 定义第二个卷积层</span><br><span class="line">        tf.keras.layers.Conv2D(filters=36, kernel_size=(3, 3), activation=&#x27;relu&#x27;),</span><br><span class="line">        # 定义第二个最大池化层</span><br><span class="line">        tf.keras.layers.MaxPool2D(pool_size=(2, 2)),</span><br><span class="line">        tf.keras.layers.Flatten(),</span><br><span class="line">        tf.keras.layers.Dense(128, activation=tf.nn.relu),</span><br><span class="line">        # 输出分类概率，这一层输出为概率，因此输出个数为10，表示10个数字。</span><br><span class="line">        tf.keras.layers.Dense(10, activation=tf.nn.softmax),</span><br><span class="line">    ])</span><br><span class="line">    return cnn_model</span><br><span class="line">cnn_model = build_cnn_model()    # 输入一些数据进行模型初始化</span><br><span class="line">cnn_model.predict(train_images[[0]])    # 输出模型的一些摘要信息</span><br><span class="line">print(cnn_model.summary())</span><br></pre></td></tr></table></figure>
<p>编译:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnn_model.compile(optimizer=tf.keras.optimizers.Adam(learning_rate=1e-3), loss=&#x27;sparse_categorical_crossentropy&#x27;, metrics=[&#x27;accuracy&#x27;]) </span><br></pre></td></tr></table></figure>
<p>训练：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnn_model.fit(x=train_images, y=train_labels, batch_size=BATCH_SIZE, epochs=EPOCHS)</span><br></pre></td></tr></table></figure>
<p>测试：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">test_loss, test_acc = cnn_model.evaluate(train_images, train_labels)</span><br><span class="line">print(&#x27;Test accuracy:&#x27;, test_acc)</span><br></pre></td></tr></table></figure>
<p>至此模型已经训练完毕，此时输入图片进行预测：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">predictions = cnn_model.predict(test_images)</span><br><span class="line">predictions[0] # 输出的概率列表</span><br><span class="line"></span><br><span class="line">prediction = np.argmax(predictions[0]) # 此为预测值</span><br><span class="line">print(prediction)</span><br><span class="line"></span><br><span class="line">print(&quot;Label of this digit is:&quot;, test_labels[0])</span><br><span class="line">plt.imshow(test_images[0,:,:,0], cmap=plt.cm.binary)    # 此为输出对应预测值的图像</span><br></pre></td></tr></table></figure>
<p>输出为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">array([1.1896365e-08, 2.9328827e-08, 1.0020367e-07, 1.9016676e-07,</span><br><span class="line">       8.6228073e-11, 5.7627930e-11, 1.5786619e-13, 9.9999928e-01,</span><br><span class="line">       3.2206058e-09, 3.1025860e-07], dtype=float32)</span><br><span class="line">7</span><br></pre></td></tr></table></figure>
<p><img src="L2P1_1.png"></p>
<h3 id="使用随机梯度下降训练CNN网络模型"><a href="#使用随机梯度下降训练CNN网络模型" class="headerlink" title="使用随机梯度下降训练CNN网络模型"></a>使用随机梯度下降训练CNN网络模型</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"># 重建CNN网络</span><br><span class="line">cnn_model = build_cnn_model()</span><br><span class="line"></span><br><span class="line">batch_size = 12</span><br><span class="line">loss_history = mdl.util.LossHistory(smoothing_factor=0.95) # 记录训练过程的损失</span><br><span class="line">plotter = mdl.util.PeriodicPlotter(sec=2, xlabel=&#x27;Iterations&#x27;, ylabel=&#x27;Loss&#x27;, scale=&#x27;semilogy&#x27;)</span><br><span class="line">optimizer = tf.keras.optimizers.SGD(learning_rate=1e-2) # 定义优化器</span><br><span class="line"></span><br><span class="line">if hasattr(tqdm, &#x27;_instances&#x27;): tqdm._instances.clear() # 如果存在，清除掉</span><br><span class="line"></span><br><span class="line">for idx in tqdm(range(0, train_images.shape[0], batch_size)):</span><br><span class="line">  # 首先抓取数据并将输入图像转化为张量。</span><br><span class="line">  (images, labels) = (train_images[idx:idx+batch_size], train_labels[idx:idx+batch_size])</span><br><span class="line">  images = tf.convert_to_tensor(images, dtype=tf.float32)</span><br><span class="line">  # 使用GradientTape方法记录梯度操作</span><br><span class="line">  with tf.GradientTape() as tape:</span><br><span class="line">    # 输入图片获得预测值</span><br><span class="line">    logits = cnn_model(images)</span><br><span class="line"></span><br><span class="line">    #&#x27;&#x27;&#x27;TODO: compute the categorical cross entropy loss</span><br><span class="line">    # 计算分类交叉熵损失(categorical cross entropy loss)</span><br><span class="line">    loss_value = tf.keras.backend.sparse_categorical_crossentropy(labels, logits) # 目标， 输出</span><br><span class="line">  loss_history.append(loss_value.numpy().mean()) # 将损失记录到记录着中。</span><br><span class="line">  plotter.plot(loss_history.get())</span><br><span class="line">  # 反向传播</span><br><span class="line">  # 使用trainable_variables获得预测值</span><br><span class="line">  # 计算参数梯度，d右/d左，利用apply_gradients计算，将梯度应用到变量中。</span><br><span class="line">  # zip()将变量重新打包，输入其中。</span><br><span class="line">  grads = tape.gradient(loss_value, cnn_model.trainable_variables)</span><br><span class="line">  optimizer.apply_gradients(zip(grads, cnn_model.trainable_variables))</span><br></pre></td></tr></table></figure>

<h2 id="Part-2-Debiasing-Facial-Detection-Systems-去偏面部检测系统"><a href="#Part-2-Debiasing-Facial-Detection-Systems-去偏面部检测系统" class="headerlink" title="Part 2: Debiasing Facial Detection Systems 去偏面部检测系统"></a>Part 2: Debiasing Facial Detection Systems 去偏面部检测系统</h2><h3 id="依赖项："><a href="#依赖项：" class="headerlink" title="依赖项："></a>依赖项：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import tensorflow as tf</span><br><span class="line">import IPython</span><br><span class="line">import functools</span><br><span class="line">import matplotlib.pyplot as plt</span><br><span class="line">import numpy as np</span><br><span class="line">from tqdm import tqdm</span><br><span class="line">import mitdeeplearning as mdl</span><br></pre></td></tr></table></figure>

<h3 id="获取数据集"><a href="#获取数据集" class="headerlink" title="获取数据集"></a>获取数据集</h3><p>获取数据的网站：</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://mmlab.ie.cuhk.edu.hk/projects/CelebA.html">Celeba</a>: 脸部图像数据集，此处为正向数据。</li>
<li><a target="_blank" rel="noopener" href="https://image-net.org/">ImageNet</a>:不同类别的图像集</li>
<li><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Fitzpatrick_scale">Fitzpatrick Scale</a>:肤色分类系统</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 从Celeba和ImageNet获取数据</span><br><span class="line">path_to_training_data = tf.keras.utils.get_file(&#x27;train_face.h5&#x27;, &#x27;https://www.dropbox.com/s/hlz8atheyozp1yx/train_face.h5?dl=1&#x27;)</span><br><span class="line"># 使用下载的数据集实例化训练数据集加载器</span><br><span class="line">loader = mdl.lab2.TrainingDatasetLoader(path_to_training_data)</span><br></pre></td></tr></table></figure>

<h3 id="定义并训练CNN网络模型"><a href="#定义并训练CNN网络模型" class="headerlink" title="定义并训练CNN网络模型"></a>定义并训练CNN网络模型</h3><p>定义四层卷积层，然后输出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">n_filters = 12 # 卷积滤波器的base number </span><br><span class="line"># 定义标准CNN模型函数</span><br><span class="line">def make_standard_classifier(n_outputs=1):</span><br><span class="line">  Conv2D = functools.partial(tf.keras.layers.Conv2D, padding=&#x27;same&#x27;, activation=&#x27;relu&#x27;)  # 函数Conv2D的相应默认值修改为same和relu</span><br><span class="line">  BatchNormalization = tf.keras.layers.BatchNormalization</span><br><span class="line">  Flatten = tf.keras.layers.Flatten</span><br><span class="line">  Dense = functools.partial(tf.keras.layers.Dense, activation=&#x27;relu&#x27;)</span><br><span class="line"></span><br><span class="line">  model = tf.keras.Sequential([</span><br><span class="line">    Conv2D(filters=1*n_filters, kernel_size=5,  strides=2),</span><br><span class="line">    BatchNormalization(),</span><br><span class="line">    </span><br><span class="line">    Conv2D(filters=2*n_filters, kernel_size=5,  strides=2),</span><br><span class="line">    BatchNormalization(),</span><br><span class="line"></span><br><span class="line">    Conv2D(filters=4*n_filters, kernel_size=3,  strides=2),</span><br><span class="line">    BatchNormalization(),</span><br><span class="line"></span><br><span class="line">    Conv2D(filters=6*n_filters, kernel_size=3,  strides=2),</span><br><span class="line">    BatchNormalization(),</span><br><span class="line"></span><br><span class="line">    Flatten(),</span><br><span class="line">    Dense(512),</span><br><span class="line">    Dense(n_outputs, activation=None),</span><br><span class="line">  ])</span><br><span class="line">  return model</span><br><span class="line"></span><br><span class="line">standard_classifier = make_standard_classifier()</span><br></pre></td></tr></table></figure>
<p>对模型进行训练:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"># 训练使用的参数集</span><br><span class="line">batch_size = 32</span><br><span class="line">num_epochs = 2  # keep small to run faster  越小运算越快</span><br><span class="line">learning_rate = 5e-4</span><br><span class="line"></span><br><span class="line">optimizer = tf.keras.optimizers.Adam(learning_rate) # define our optimizer</span><br><span class="line">loss_history = mdl.util.LossHistory(smoothing_factor=0.99) # to record loss evolution</span><br><span class="line">plotter = mdl.util.PeriodicPlotter(sec=2, scale=&#x27;semilogy&#x27;)</span><br><span class="line">if hasattr(tqdm, &#x27;_instances&#x27;): tqdm._instances.clear() # clear if it exists</span><br><span class="line"></span><br><span class="line">@tf.function</span><br><span class="line">def standard_train_step(x, y):</span><br><span class="line">  with tf.GradientTape() as tape:</span><br><span class="line">    # 将图像输入模型</span><br><span class="line">    logits = standard_classifier(x) </span><br><span class="line">    # 计算损失</span><br><span class="line">    loss = tf.nn.sigmoid_cross_entropy_with_logits(labels=y, logits=logits) # 目标值 预测值</span><br><span class="line"></span><br><span class="line">  # 反向传播，进行优化</span><br><span class="line">  grads = tape.gradient(loss, standard_classifier.trainable_variables)</span><br><span class="line">  optimizer.apply_gradients(zip(grads, standard_classifier.trainable_variables))</span><br><span class="line">  return loss</span><br><span class="line"></span><br><span class="line"># 进行训练循环</span><br><span class="line">for epoch in range(num_epochs):</span><br><span class="line">  for idx in tqdm(range(loader.get_train_size()//batch_size)):</span><br><span class="line">    # 抓取一批训练数据通过网络传播</span><br><span class="line">    x, y = loader.get_batch(batch_size)</span><br><span class="line">    loss = standard_train_step(x, y)</span><br><span class="line">    # 记录损失并将损失的演变绘制为训练的函数</span><br><span class="line">    loss_history.append(loss.numpy().mean())</span><br><span class="line">    plotter.plot(loss_history.get())</span><br></pre></td></tr></table></figure>
<p>性能评估：</p>
<ul>
<li>此部分使用CelebA数据集进行评估。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 标准CNN网络模型</span><br><span class="line"># 使用CelebA+Imagenet两个数据集的子集进行评估</span><br><span class="line">(batch_x, batch_y) = loader.get_batch(5000)</span><br><span class="line">y_pred_standard = tf.round(tf.nn.sigmoid(standard_classifier.predict(batch_x)))</span><br><span class="line">acc_standard = tf.reduce_mean(tf.cast(tf.equal(batch_y, y_pred_standard), tf.float32))</span><br><span class="line">print(&quot;Standard CNN accuracy on (potentially biased) training set: &#123;:.4f&#125;&quot;.format(acc_standard.numpy()))</span><br></pre></td></tr></table></figure></li>
<li>使用未知数据集进行评估</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">### 评估在测试数据上的CNN网络模型</span><br><span class="line">standard_classifier_logits = [standard_classifier(np.array(x, dtype=np.float32)) for x in test_faces]</span><br><span class="line">standard_classifier_probs = tf.squeeze(tf.sigmoid(standard_classifier_logits))  # 删除为1的内容</span><br><span class="line"></span><br><span class="line"># Plot the prediction accuracies per demographic 绘制预测准确度</span><br><span class="line">xx = range(len(keys))</span><br><span class="line">yy = standard_classifier_probs.numpy().mean(1)</span><br><span class="line">plt.bar(xx, yy)</span><br><span class="line">plt.xticks(xx, keys)</span><br><span class="line">plt.ylim(max(0,yy.min()-yy.ptp()/2.), yy.max()+yy.ptp()/2.)</span><br><span class="line">plt.title(&quot;Standard classifier predictions&quot;);</span><br></pre></td></tr></table></figure>

<h3 id="用于学习隐结构-latent-structure-的变分自编码器-VAE"><a href="#用于学习隐结构-latent-structure-的变分自编码器-VAE" class="headerlink" title="用于学习隐结构(latent structure)的变分自编码器(VAE)"></a>用于学习隐结构(latent structure)的变分自编码器(VAE)</h3><p>对于某些训练集中不存在或者存在较少的特征，例如深色皮肤，戴帽子的人等，<br>这些特征可以通过无监督的学习方式，使用VAE进行训练。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 定义VAE损失函数</span><br><span class="line">&#x27;&#x27;&#x27; Function to calculate VAE loss given:</span><br><span class="line">      输入 x, </span><br><span class="line">      重构输出 x_recon, </span><br><span class="line">      编码均值 mu, </span><br><span class="line">      编码标准偏差的log值 logsigma, </span><br><span class="line">      隐损失的权重参数 kl_weight</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">def vae_loss_function(x, x_recon, mu, logsigma, kl_weight=0.0005):</span><br><span class="line">  # 定义隐损失函数:Latent_Loss=0.5*sum(sigmaj+mu^2-1-log(sigmaj))</span><br><span class="line">  latent_loss = 1/2 * tf.reduce_sum(tf.exp(logsigma) + tf.square(mu) - 1 - logsigma, axis=1) #</span><br><span class="line"></span><br><span class="line">  # https://www.tensorflow.org/api_docs/python/tf/math/reduce_mean</span><br><span class="line">  # 定义L1规范的reconstruction loss，即重构损失:reconstruction_Loss=||x-x_recon)||1 计算输入与重构输入的1范数。</span><br><span class="line">  reconstruction_loss = tf.reduce_mean(tf.abs(x - x_recon), axis=(1, 2, 3)) # 即使使用这种axis，可能是按照不同顺序计算维度的平均值，最后得到的是一个数值，即number而非张量</span><br><span class="line"></span><br><span class="line">  # 定义VAE损失:Lvae=c*LatentLoss+Reconstruction_loss</span><br><span class="line">  vae_loss = kl_weight * latent_loss + reconstruction_loss</span><br><span class="line">  return vae_loss</span><br></pre></td></tr></table></figure>

<p>VAEs重参数计算；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 输入为：隐分布（潜在分布）均值、隐分布的log值</span><br><span class="line"># 输出为：z张量，采样潜在向量</span><br><span class="line">def sampling(z_mean, z_logsigma):</span><br><span class="line">  # By default, random.normal is &quot;standard&quot; (ie. mean=0 and std=1.0)</span><br><span class="line">  batch, latent_dim = z_mean.shape</span><br><span class="line">  epsilon = tf.random.normal(shape=(batch, latent_dim))</span><br><span class="line"></span><br><span class="line">  # 定义重参数化计算：z=mu+exp(0.5*log(sigma))*epsilon</span><br><span class="line">  z = z_mean + tf.math.exp(z_logsigma / 2) * epsilon  # b不知道这里tf.math.exp需不需要加math，因为前面的reduce_mean没有加math</span><br><span class="line">  return z</span><br></pre></td></tr></table></figure>

<h3 id="DB-VAE-去偏变分自编码器"><a href="#DB-VAE-去偏变分自编码器" class="headerlink" title="DB-VAE 去偏变分自编码器"></a>DB-VAE 去偏变分自编码器</h3><p>将具有更低出现频率的特征增加采样，而高频特征减少采样，达到平均采样的目的。<br>具体流程图如下：<br><img src="L2P2_2.png" alt="2"></p>
<p>DB损失函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 输入：输入值，重构值，真正的标签值，预测的标签值，隐分布的均值，隐分布标准方差的log值</span><br><span class="line">def debiasing_loss_function(x, x_pred, y, y_logit, mu, logsigma):</span><br><span class="line"></span><br><span class="line">  # 使用VAE损失函数计算VAE损失</span><br><span class="line">  vae_loss = vae_loss_function(x, x_pred, mu, logsigma) # TODO</span><br><span class="line">  </span><br><span class="line">  # sigmoid_cross_entropy_with_logits计算分类损失</span><br><span class="line">  # https://www.tensorflow.org/api_docs/python/tf/nn/sigmoid_cross_entropy_with_logits</span><br><span class="line">  classification_loss = tf.nn.sigmoid_cross_entropy_with_logits(labels=y , logits=y_logit)</span><br><span class="line"></span><br><span class="line">  # 使用训练数据标签创建变量：该变量反映是否是人脸数据的指标</span><br><span class="line">  face_indicator = tf.cast(tf.equal(y, 1), tf.float32)</span><br><span class="line"></span><br><span class="line">  # 定义总损失</span><br><span class="line">  total_loss = tf.reduce_mean(classification_loss + face_indicator * vae_loss)</span><br><span class="line"></span><br><span class="line">  return total_loss, classification_loss</span><br><span class="line">  # 输出：DBVAE的总损失，分类损失</span><br></pre></td></tr></table></figure>

<p>定义DBVAE的解码器部分：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># 解码器部分</span><br><span class="line">n_filters = 12 # 卷积滤波器的base number，和CNN一样</span><br><span class="line">latent_dim = 100 # 因变量的数量</span><br><span class="line"></span><br><span class="line">def make_face_decoder_network():</span><br><span class="line">  # 定义不同的层</span><br><span class="line">  Conv2DTranspose = functools.partial(tf.keras.layers.Conv2DTranspose, padding=&#x27;same&#x27;, activation=&#x27;relu&#x27;)</span><br><span class="line">  BatchNormalization = tf.keras.layers.BatchNormalization</span><br><span class="line">  Flatten = tf.keras.layers.Flatten</span><br><span class="line">  Dense = functools.partial(tf.keras.layers.Dense, activation=&#x27;relu&#x27;)</span><br><span class="line">  Reshape = tf.keras.layers.Reshape</span><br><span class="line"></span><br><span class="line">  # 使用Sequential构建解码器</span><br><span class="line">  decoder = tf.keras.Sequential([</span><br><span class="line">    # Transform to pre-convolutional generation</span><br><span class="line">    Dense(units=4*4*6*n_filters),  # 4x4 feature maps (with 6N occurances)</span><br><span class="line">    Reshape(target_shape=(4, 4, 6*n_filters)),</span><br><span class="line"></span><br><span class="line">    # Upscaling convolutions (inverse of encoder)</span><br><span class="line">    Conv2DTranspose(filters=4*n_filters, kernel_size=3,  strides=2),</span><br><span class="line">    Conv2DTranspose(filters=2*n_filters, kernel_size=3,  strides=2),</span><br><span class="line">    Conv2DTranspose(filters=1*n_filters, kernel_size=5,  strides=2),</span><br><span class="line">    Conv2DTranspose(filters=3, kernel_size=5,  strides=2),</span><br><span class="line">  ])</span><br><span class="line">  return decoder</span><br></pre></td></tr></table></figure>

<p>定义和创建DB—VAE网络:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">class DB_VAE(tf.keras.Model):</span><br><span class="line">  def __init__(self, latent_dim):</span><br><span class="line">    super(DB_VAE, self).__init__()</span><br><span class="line">    self.latent_dim = latent_dim</span><br><span class="line"></span><br><span class="line">    # Define the number of outputs for the encoder. Recall that we have </span><br><span class="line">    # `latent_dim` latent variables, as well as a supervised output for the </span><br><span class="line">    # classification.</span><br><span class="line">    # 定义编码器的输出数量。</span><br><span class="line">    num_encoder_dims = 2*self.latent_dim + 1</span><br><span class="line"></span><br><span class="line">    self.encoder = make_standard_classifier(num_encoder_dims)</span><br><span class="line">    self.decoder = make_face_decoder_network()</span><br><span class="line"></span><br><span class="line">  # function to feed images into encoder, encode the latent space, and output</span><br><span class="line">  #   classification probability</span><br><span class="line">  # 定义编码器，输出预测值，mu和logsigma </span><br><span class="line">  def encode(self, x):</span><br><span class="line">    encoder_output = self.encoder(x)   # 编码器输出</span><br><span class="line">    # classification prediction 分类预测值</span><br><span class="line">    y_logit = tf.expand_dims(encoder_output[:, 0], -1)</span><br><span class="line">    # latent variable distribution parameters 因变量分布参数</span><br><span class="line">    z_mean = encoder_output[:, 1:self.latent_dim+1] </span><br><span class="line">    z_logsigma = encoder_output[:, self.latent_dim+1:]</span><br><span class="line">    return y_logit, z_mean, z_logsigma</span><br><span class="line"></span><br><span class="line">  # VAE reparameterization: given a mean and logsigma, sample latent variables</span><br><span class="line">  def reparameterize(self, z_mean, z_logsigma):</span><br><span class="line">    # VAE重参数构建</span><br><span class="line">    z = sampling(z_mean, z_logsigma)</span><br><span class="line">    return z</span><br><span class="line"></span><br><span class="line">  # 解码因空间，输出输入的重建</span><br><span class="line">  def decode(self, z):</span><br><span class="line">    reconstruction = self.decoder(z)  # why???</span><br><span class="line">    return reconstruction</span><br><span class="line"></span><br><span class="line">  # The call function will be used to pass inputs x through the core VAE</span><br><span class="line">  def call(self, x): </span><br><span class="line">    # Encode input to a prediction and latent space</span><br><span class="line">    y_logit, z_mean, z_logsigma = self.encode(x)</span><br><span class="line">    # 重参数化</span><br><span class="line">    z = self.reparameterize(z_mean, z_logsigma)</span><br><span class="line">    # 使用decode重构建</span><br><span class="line">    recon = self.decode(z)</span><br><span class="line">    return y_logit, z_mean, z_logsigma, recon</span><br><span class="line"></span><br><span class="line">  # 预测是否是人脸</span><br><span class="line">  def predict(self, x):</span><br><span class="line">    y_logit, z_mean, z_logsigma = self.encode(x)</span><br><span class="line">    return y_logit</span><br><span class="line"></span><br><span class="line">dbvae = DB_VAE(latent_dim)</span><br></pre></td></tr></table></figure>


<h3 id="实现DB-VAE"><a href="#实现DB-VAE" class="headerlink" title="实现DB-VAE"></a>实现DB-VAE</h3><p>定义一个辅助函数，输出隐变量均值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def get_latent_mu(images, dbvae, batch_size=1024):</span><br><span class="line">  N = images.shape[0]</span><br><span class="line">  mu = np.zeros((N, latent_dim))</span><br><span class="line">  for start_ind in range(0, N, batch_size):</span><br><span class="line">    end_ind = min(start_ind+batch_size, N+1)</span><br><span class="line">    batch = (images[start_ind:end_ind]).astype(np.float32)/255.</span><br><span class="line">    _, batch_mu, _ = dbvae.encode(batch)</span><br><span class="line">    mu[start_ind:end_ind] = batch_mu</span><br><span class="line">  return mu</span><br></pre></td></tr></table></figure>

<p>重新定义重采样算法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"># 根据图像在训练数据中的分布重新计算批次中图像的采样概率的函数</span><br><span class="line">def get_training_sample_probabilities(images, dbvae, bins=10, smoothing_fac=0.001): </span><br><span class="line">    print(&quot;Recomputing the sampling probabilities&quot;)</span><br><span class="line">    mu = get_latent_mu(images, dbvae) # 获得潜在变量均值</span><br><span class="line">    training_sample_p = np.zeros(mu.shape[0]) # 图像采样概率</span><br><span class="line"></span><br><span class="line">    # 考虑每个潜在变量的分布</span><br><span class="line">    for i in range(latent_dim):</span><br><span class="line"></span><br><span class="line">        latent_distribution = mu[:,i]</span><br><span class="line">        # generate a histogram of the latent distribution</span><br><span class="line">        # 潜在分布直方图</span><br><span class="line">        hist_density, bin_edges =  np.histogram(latent_distribution, density=True, bins=bins)</span><br><span class="line"></span><br><span class="line">        # find which latent bin every data sample falls in </span><br><span class="line">        bin_edges[0] = -float(&#x27;inf&#x27;)</span><br><span class="line">        bin_edges[-1] = float(&#x27;inf&#x27;)</span><br><span class="line">        </span><br><span class="line">        # call the digitize function to find which bins in the latent distribution every data sample falls in to</span><br><span class="line">        # https://docs.scipy.org/doc/numpy-1.13.0/reference/generated/numpy.digitize.html</span><br><span class="line">        bin_idx = np.digitize(latent_distribution, bin_edges)O</span><br><span class="line"></span><br><span class="line">        # 平滑密度函数</span><br><span class="line">        hist_smoothed_density = hist_density + smoothing_fac</span><br><span class="line">        hist_smoothed_density = hist_smoothed_density / np.sum(hist_smoothed_density)</span><br><span class="line"></span><br><span class="line">        p = 1.0/(hist_smoothed_density[bin_idx-1])# 反转密度函数</span><br><span class="line">        p = p/np.sum(p)     # 将概率归一化</span><br><span class="line">        training_sample_p = np.maximum(p, training_sample_p)  # 选择较大的p值作为采样概率</span><br><span class="line">    training_sample_p /= np.sum(training_sample_p) # 最终归一化</span><br><span class="line"></span><br><span class="line">    return training_sample_p</span><br></pre></td></tr></table></figure>

<p>训练DB-VAE网络：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"># Hyperparameters</span><br><span class="line">batch_size = 32</span><br><span class="line">learning_rate = 5e-4</span><br><span class="line">latent_dim = 100</span><br><span class="line"></span><br><span class="line"># DB-VAE训练次数增加，因为它更加复杂。</span><br><span class="line">num_epochs = 6  </span><br><span class="line"></span><br><span class="line"># 创建一个DB-VAE对象dbvae，以及一个Adam优化器</span><br><span class="line">dbvae = DB_VAE(100)</span><br><span class="line">optimizer = tf.keras.optimizers.Adam(learning_rate)</span><br><span class="line"></span><br><span class="line"># 使用tf.function使得得以绘制直方图</span><br><span class="line">@tf.function</span><br><span class="line">def debiasing_train_step(x, y):</span><br><span class="line"></span><br><span class="line">  with tf.GradientTape() as tape:</span><br><span class="line">  # 输入x进入dbvae</span><br><span class="line">    y_logit, z_mean, z_logsigma, x_recon = dbvae(x)</span><br><span class="line"></span><br><span class="line">  # 计算损失</span><br><span class="line">    loss, class_loss = debiasing_loss_function(x=x, x_pred=x_recon, y=y, y_logit=y_logit, mu=z_mean, logsigma=z_logsigma) # TODO</span><br><span class="line">  </span><br><span class="line">  # 使用GradientTape.gradient计算梯度</span><br><span class="line">  grads = tape.gradient(loss, dbvae.trainable_variables) </span><br><span class="line"></span><br><span class="line">  # apply gradients to variables 调用梯度到优化器</span><br><span class="line">  optimizer.apply_gradients(zip(grads, dbvae.trainable_variables))</span><br><span class="line">  return loss</span><br><span class="line"></span><br><span class="line"># 加载数据集</span><br><span class="line">all_faces = loader.get_all_train_faces()</span><br><span class="line"></span><br><span class="line">if hasattr(tqdm, &#x27;_instances&#x27;): tqdm._instances.clear() # 存在则清除</span><br><span class="line"></span><br><span class="line"># 训练循环</span><br><span class="line">for i in range(num_epochs):</span><br><span class="line">  IPython.display.clear_output(wait=True)</span><br><span class="line">  print(&quot;Starting epoch &#123;&#125;/&#123;&#125;&quot;.format(i+1, num_epochs))</span><br><span class="line"></span><br><span class="line">  # Recompute data sampling proabilities 重新计算数据采样概率</span><br><span class="line">  p_faces = get_training_sample_probabilities(images=all_faces ,dbvae=dbvae)</span><br><span class="line">  </span><br><span class="line">  # 获取一批训练数据并计算训练步长</span><br><span class="line">  for j in tqdm(range(loader.get_train_size() // batch_size)):</span><br><span class="line">    # load a batch of data</span><br><span class="line">    (x, y) = loader.get_batch(batch_size, p_pos=p_faces)</span><br><span class="line">    # loss optimization</span><br><span class="line">    loss = debiasing_train_step(x, y)</span><br><span class="line">    </span><br><span class="line">    # plot the progress every 200 steps</span><br><span class="line">    if j % 500 == 0: </span><br><span class="line">      mdl.util.plot_sample(x, y, dbvae)</span><br></pre></td></tr></table></figure>

<p>准确性评估：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">dbvae_logits = [dbvae.predict(np.array(x, dtype=np.float32)) for x in test_faces]</span><br><span class="line">dbvae_probs = tf.squeeze(tf.sigmoid(dbvae_logits))</span><br><span class="line"></span><br><span class="line">xx = np.arange(len(keys))</span><br><span class="line">plt.bar(xx, standard_classifier_probs.numpy().mean(1), width=0.2, label=&quot;Standard CNN&quot;)</span><br><span class="line">plt.bar(xx+0.2, dbvae_probs.numpy().mean(1), width=0.2, label=&quot;DB-VAE&quot;)</span><br><span class="line">plt.xticks(xx, keys); </span><br><span class="line">plt.title(&quot;Network predictions on test dataset&quot;)</span><br><span class="line">plt.ylabel(&quot;Probability&quot;); plt.legend(bbox_to_anchor=(1.04,1), loc=&quot;upper left&quot;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/default%20=%20''/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/default%20=%20''/">1</a><span class="page-number current">2</span><a class="page-number" href="/default%20=%20''/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/default%20=%20''/page/6/">6</a><a class="extend next" rel="next" href="/default%20=%20''/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder"></span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  





</body>
</html>
